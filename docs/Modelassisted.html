<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 10 Model-assisted estimation | Spatial sampling with R</title>
  <meta name="description" content="This book is for students, scientists, researchers and consultants who want to know how to collect spatial data, either for estimating parameters for the population or several subpopulations, or for mapping. How many data do we need, and how to select the population units? The book presents a wide overview of spatial sampling designs. Besides there is a chapter on designs for sampling in space and time for monitoring. The emphasis is not on the theory, but on how to implement sampling designs in R and on how the (sub)population parameters can be estimated from the sample." />
  <meta name="generator" content="bookdown 0.23 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 10 Model-assisted estimation | Spatial sampling with R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="/images/cover.pdf" />
  <meta property="og:description" content="This book is for students, scientists, researchers and consultants who want to know how to collect spatial data, either for estimating parameters for the population or several subpopulations, or for mapping. How many data do we need, and how to select the population units? The book presents a wide overview of spatial sampling designs. Besides there is a chapter on designs for sampling in space and time for monitoring. The emphasis is not on the theory, but on how to implement sampling designs in R and on how the (sub)population parameters can be estimated from the sample." />
  <meta name="github-repo" content="DickBrus/SpatialSamplingwithR" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 10 Model-assisted estimation | Spatial sampling with R" />
  
  <meta name="twitter:description" content="This book is for students, scientists, researchers and consultants who want to know how to collect spatial data, either for estimating parameters for the population or several subpopulations, or for mapping. How many data do we need, and how to select the population units? The book presents a wide overview of spatial sampling designs. Besides there is a chapter on designs for sampling in space and time for monitoring. The emphasis is not on the theory, but on how to implement sampling designs in R and on how the (sub)population parameters can be estimated from the sample." />
  <meta name="twitter:image" content="/images/cover.pdf" />

<meta name="author" content="Dick J. Brus" />


<meta name="date" content="2021-09-24" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="BalancedSpreaded.html"/>
<link rel="next" href="Twophase.html"/>
<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Spatial sampling with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="GeneralIntro.html"><a href="GeneralIntro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="GeneralIntro.html"><a href="GeneralIntro.html#BasicConcepts"><i class="fa fa-check"></i><b>1.1</b> Basic sampling concepts</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="GeneralIntro.html"><a href="GeneralIntro.html#PopulationParameters"><i class="fa fa-check"></i><b>1.1.1</b> Population parameters</a></li>
<li class="chapter" data-level="1.1.2" data-path="GeneralIntro.html"><a href="GeneralIntro.html#descriptive-statistics-versus-inference-about-a-population"><i class="fa fa-check"></i><b>1.1.2</b> Descriptive statistics versus inference about a population</a></li>
<li class="chapter" data-level="1.1.3" data-path="GeneralIntro.html"><a href="GeneralIntro.html#random-sampling-versus-probability-sampling"><i class="fa fa-check"></i><b>1.1.3</b> Random sampling versus probability sampling</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="GeneralIntro.html"><a href="GeneralIntro.html#DBvsMB"><i class="fa fa-check"></i><b>1.2</b> Design-based versus model-based approach</a></li>
<li class="chapter" data-level="1.3" data-path="GeneralIntro.html"><a href="GeneralIntro.html#Datasets"><i class="fa fa-check"></i><b>1.3</b> Populations used in sampling experiments</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="GeneralIntro.html"><a href="GeneralIntro.html#Voorst"><i class="fa fa-check"></i><b>1.3.1</b> Soil organic matter in Voorst (Netherlands)</a></li>
<li class="chapter" data-level="1.3.2" data-path="GeneralIntro.html"><a href="GeneralIntro.html#Poppy"><i class="fa fa-check"></i><b>1.3.2</b> Poppy fields in Kandahar (Afghanistan)</a></li>
<li class="chapter" data-level="1.3.3" data-path="GeneralIntro.html"><a href="GeneralIntro.html#aboveground-biomass-in-eastern-amazonia"><i class="fa fa-check"></i><b>1.3.3</b> Aboveground biomass in Eastern Amazonia</a></li>
<li class="chapter" data-level="1.3.4" data-path="GeneralIntro.html"><a href="GeneralIntro.html#TASSpainPortugal"><i class="fa fa-check"></i><b>1.3.4</b> Annual mean air temperature in Spain and Portugal</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>I Probability sampling for estimating (sub)population parameters</b></span></li>
<li class="chapter" data-level="2" data-path="IntroProbabilitySampling.html"><a href="IntroProbabilitySampling.html"><i class="fa fa-check"></i><b>2</b> Introduction to probability sampling</a>
<ul>
<li class="chapter" data-level="2.1" data-path="IntroProbabilitySampling.html"><a href="IntroProbabilitySampling.html#HTestimator"><i class="fa fa-check"></i><b>2.1</b> Horvitz-Thompson estimator</a></li>
<li class="chapter" data-level="2.2" data-path="IntroProbabilitySampling.html"><a href="IntroProbabilitySampling.html#hansen-hurwitz-estimator"><i class="fa fa-check"></i><b>2.2</b> Hansen-Hurwitz estimator</a></li>
<li class="chapter" data-level="2.3" data-path="IntroProbabilitySampling.html"><a href="IntroProbabilitySampling.html#using-models-in-design-based-approach"><i class="fa fa-check"></i><b>2.3</b> Using models in design-based approach</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="SI.html"><a href="SI.html"><i class="fa fa-check"></i><b>3</b> Simple random sampling</a>
<ul>
<li class="chapter" data-level="3.1" data-path="SI.html"><a href="SI.html#HTestimatorSI"><i class="fa fa-check"></i><b>3.1</b> Estimation of population parameters</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="SI.html"><a href="SI.html#PopProportion"><i class="fa fa-check"></i><b>3.1.1</b> Population proportion</a></li>
<li class="chapter" data-level="3.1.2" data-path="SI.html"><a href="SI.html#CDF"><i class="fa fa-check"></i><b>3.1.2</b> Cumulative distribution function and quantiles</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="SI.html"><a href="SI.html#VarMeanSI"><i class="fa fa-check"></i><b>3.2</b> Sampling variance of estimator of population mean, total and proportion</a></li>
<li class="chapter" data-level="3.3" data-path="SI.html"><a href="SI.html#ConfidenceInterval"><i class="fa fa-check"></i><b>3.3</b> Confidence interval estimates</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="SI.html"><a href="SI.html#ConfidenceIntervalProportion"><i class="fa fa-check"></i><b>3.3.1</b> Confidence interval for proportion</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="SI.html"><a href="SI.html#SIcircularplots"><i class="fa fa-check"></i><b>3.4</b> Simple random sampling of circular plots</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="SI.html"><a href="SI.html#sampling-from-a-finite-set-of-fixed-circles"><i class="fa fa-check"></i><b>3.4.1</b> Sampling from a finite set of fixed circles</a></li>
<li class="chapter" data-level="3.4.2" data-path="SI.html"><a href="SI.html#sampling-from-an-infinite-set-of-floating-circles"><i class="fa fa-check"></i><b>3.4.2</b> Sampling from an infinite set of floating circles</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="STSI.html"><a href="STSI.html"><i class="fa fa-check"></i><b>4</b> Stratified simple random sampling</a>
<ul>
<li class="chapter" data-level="4.1" data-path="STSI.html"><a href="STSI.html#EstimatorsSTSI"><i class="fa fa-check"></i><b>4.1</b> Estimation of population parameters</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="STSI.html"><a href="STSI.html#estimation-of-population-proportion-cumulative-distribution-function-and-quantiles"><i class="fa fa-check"></i><b>4.1.1</b> Estimation of population proportion, cumulative distribution function and quantiles</a></li>
<li class="chapter" data-level="4.1.2" data-path="STSI.html"><a href="STSI.html#WhyStratify"><i class="fa fa-check"></i><b>4.1.2</b> Why should we stratify?</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="STSI.html"><a href="STSI.html#CISTSI"><i class="fa fa-check"></i><b>4.2</b> Confidence interval estimate</a></li>
<li class="chapter" data-level="4.3" data-path="STSI.html"><a href="STSI.html#STSIallocation"><i class="fa fa-check"></i><b>4.3</b> Allocation of sample size to strata</a></li>
<li class="chapter" data-level="4.4" data-path="STSI.html"><a href="STSI.html#cumrootf"><i class="fa fa-check"></i><b>4.4</b> <em>Cum-root-f</em> stratification</a></li>
<li class="chapter" data-level="4.5" data-path="STSI.html"><a href="STSI.html#kmeansstratification"><i class="fa fa-check"></i><b>4.5</b> Stratification with multiple covariates</a></li>
<li class="chapter" data-level="4.6" data-path="STSI.html"><a href="STSI.html#geostrata"><i class="fa fa-check"></i><b>4.6</b> Geographical stratification</a></li>
<li class="chapter" data-level="4.7" data-path="STSI.html"><a href="STSI.html#multi-way-stratification"><i class="fa fa-check"></i><b>4.7</b> Multi-way stratification</a></li>
<li class="chapter" data-level="4.8" data-path="STSI.html"><a href="STSI.html#MultivariateStratification"><i class="fa fa-check"></i><b>4.8</b> Multivariate stratification</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="SY.html"><a href="SY.html"><i class="fa fa-check"></i><b>5</b> Systematic random sampling</a>
<ul>
<li class="chapter" data-level="5.1" data-path="SY.html"><a href="SY.html#EstVarSY"><i class="fa fa-check"></i><b>5.1</b> Estimation of population parameters</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="SY.html"><a href="SY.html#approximating-the-sampling-variance-of-the-estimator-of-the-mean"><i class="fa fa-check"></i><b>5.1.1</b> Approximating the sampling variance of the estimator of the mean</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="Cl.html"><a href="Cl.html"><i class="fa fa-check"></i><b>6</b> Cluster random sampling</a>
<ul>
<li class="chapter" data-level="6.1" data-path="Cl.html"><a href="Cl.html#clustersamplingestimators"><i class="fa fa-check"></i><b>6.1</b> Estimation of population parameters</a></li>
<li class="chapter" data-level="6.2" data-path="Cl.html"><a href="Cl.html#clusters-selected-with-probabilities-proportional-to-size-without-replacement"><i class="fa fa-check"></i><b>6.2</b> Clusters selected with probabilities proportional to size, without replacement</a></li>
<li class="chapter" data-level="6.3" data-path="Cl.html"><a href="Cl.html#simple-random-sampling-of-clusters"><i class="fa fa-check"></i><b>6.3</b> Simple random sampling of clusters</a></li>
<li class="chapter" data-level="6.4" data-path="Cl.html"><a href="Cl.html#StratifiedCl"><i class="fa fa-check"></i><b>6.4</b> Stratified cluster random sampling</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="Twostage.html"><a href="Twostage.html"><i class="fa fa-check"></i><b>7</b> Two-stage cluster random sampling</a>
<ul>
<li class="chapter" data-level="7.1" data-path="Twostage.html"><a href="Twostage.html#twostagesamplingestimators"><i class="fa fa-check"></i><b>7.1</b> Estimation of population parameters</a></li>
<li class="chapter" data-level="7.2" data-path="Twostage.html"><a href="Twostage.html#primary-sampling-units-selected-with-probabilities-proportional-to-size-without-replacement"><i class="fa fa-check"></i><b>7.2</b> Primary sampling units selected with probabilities proportional to size, without replacement</a></li>
<li class="chapter" data-level="7.3" data-path="Twostage.html"><a href="Twostage.html#simple-random-sampling-of-primary-sampling-units"><i class="fa fa-check"></i><b>7.3</b> Simple random sampling of primary sampling units</a></li>
<li class="chapter" data-level="7.4" data-path="Twostage.html"><a href="Twostage.html#StratifiedTwostage"><i class="fa fa-check"></i><b>7.4</b> Stratified two-stage cluster random sampling</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="pps.html"><a href="pps.html"><i class="fa fa-check"></i><b>8</b> Sampling with probabilities proportional to size</a>
<ul>
<li class="chapter" data-level="8.1" data-path="pps.html"><a href="pps.html#ppswr"><i class="fa fa-check"></i><b>8.1</b> Probability-proportional-to-size sampling with replacement</a></li>
<li class="chapter" data-level="8.2" data-path="pps.html"><a href="pps.html#ppswor"><i class="fa fa-check"></i><b>8.2</b> Probability-proportional-to-size sampling without replacement</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="pps.html"><a href="pps.html#Systematicpps"><i class="fa fa-check"></i><b>8.2.1</b> Systematic pps sampling without replacement</a></li>
<li class="chapter" data-level="8.2.2" data-path="pps.html"><a href="pps.html#pivotalmethod"><i class="fa fa-check"></i><b>8.2.2</b> The pivotal method</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html"><i class="fa fa-check"></i><b>9</b> Balanced and well-spread sampling</a>
<ul>
<li class="chapter" data-level="9.1" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#Balanced"><i class="fa fa-check"></i><b>9.1</b> Balanced sampling</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#balanced-sample-versus-balanced-sampling-design"><i class="fa fa-check"></i><b>9.1.1</b> Balanced sample versus balanced sampling design</a></li>
<li class="chapter" data-level="9.1.2" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#unequal-inclusion-probabilities"><i class="fa fa-check"></i><b>9.1.2</b> Unequal inclusion probabilities</a></li>
<li class="chapter" data-level="9.1.3" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#StratifiedsamplingasBalancedsampling"><i class="fa fa-check"></i><b>9.1.3</b> Stratified random sampling</a></li>
<li class="chapter" data-level="9.1.4" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#Multiwaystratification"><i class="fa fa-check"></i><b>9.1.4</b> Multi-way stratification</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#Spreaded"><i class="fa fa-check"></i><b>9.2</b> Well-spread sampling</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#LPM"><i class="fa fa-check"></i><b>9.2.1</b> Local pivotal method</a></li>
<li class="chapter" data-level="9.2.2" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#GRTS"><i class="fa fa-check"></i><b>9.2.2</b> Generalised random-tessellation stratified sampling</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#BalancedandSpreaded"><i class="fa fa-check"></i><b>9.3</b> Balanced sampling with spreading</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="Modelassisted.html"><a href="Modelassisted.html"><i class="fa fa-check"></i><b>10</b> Model-assisted estimation</a>
<ul>
<li class="chapter" data-level="10.1" data-path="Modelassisted.html"><a href="Modelassisted.html#GREG"><i class="fa fa-check"></i><b>10.1</b> Generalised regression estimator</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="Modelassisted.html"><a href="Modelassisted.html#RegressionEstimator"><i class="fa fa-check"></i><b>10.1.1</b> Simple and multiple regression estimators</a></li>
<li class="chapter" data-level="10.1.2" data-path="Modelassisted.html"><a href="Modelassisted.html#penalised-least-squares-estimation"><i class="fa fa-check"></i><b>10.1.2</b> Penalised least squares estimation</a></li>
<li class="chapter" data-level="10.1.3" data-path="Modelassisted.html"><a href="Modelassisted.html#RegressionEstimatorSTSI"><i class="fa fa-check"></i><b>10.1.3</b> Regression estimator with stratified simple random sampling</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="Modelassisted.html"><a href="Modelassisted.html#RatioEstimator"><i class="fa fa-check"></i><b>10.2</b> Ratio estimator</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="Modelassisted.html"><a href="Modelassisted.html#RatioEstimatorSTSI"><i class="fa fa-check"></i><b>10.2.1</b> Ratio estimators with stratified simple random sampling</a></li>
<li class="chapter" data-level="10.2.2" data-path="Modelassisted.html"><a href="Modelassisted.html#PoststratifiedEstimator"><i class="fa fa-check"></i><b>10.2.2</b> Poststratified estimator</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="Modelassisted.html"><a href="Modelassisted.html#RandomForest"><i class="fa fa-check"></i><b>10.3</b> Model-assisted estimation using machine learning techniques</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="Modelassisted.html"><a href="Modelassisted.html#predicting-with-a-regression-tree"><i class="fa fa-check"></i><b>10.3.1</b> Predicting with a regression tree</a></li>
<li class="chapter" data-level="10.3.2" data-path="Modelassisted.html"><a href="Modelassisted.html#predicting-with-a-random-forest"><i class="fa fa-check"></i><b>10.3.2</b> Predicting with a random forest</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="Modelassisted.html"><a href="Modelassisted.html#big-data-and-volunteer-data"><i class="fa fa-check"></i><b>10.4</b> Big data and volunteer data</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="Twophase.html"><a href="Twophase.html"><i class="fa fa-check"></i><b>11</b> Two-phase random sampling</a>
<ul>
<li class="chapter" data-level="11.1" data-path="Twophase.html"><a href="Twophase.html#TwophaseStratification"><i class="fa fa-check"></i><b>11.1</b> Two-phase random sampling for stratification</a></li>
<li class="chapter" data-level="11.2" data-path="Twophase.html"><a href="Twophase.html#TwophaseRegression"><i class="fa fa-check"></i><b>11.2</b> Two-phase random sampling for regression</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html"><i class="fa fa-check"></i><b>12</b> Computing the required sample size</a>
<ul>
<li class="chapter" data-level="12.1" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#standard-error-of-estimator"><i class="fa fa-check"></i><b>12.1</b> Standard error of estimator</a></li>
<li class="chapter" data-level="12.2" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#ReqSampleSizeLengthCI"><i class="fa fa-check"></i><b>12.2</b> Length of confidence interval</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#length-of-confidence-interval-for-a-proportion"><i class="fa fa-check"></i><b>12.2.1</b> Length of confidence interval for a proportion</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#statistical-testing-of-hypothesis"><i class="fa fa-check"></i><b>12.3</b> Statistical testing of hypothesis</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#sample-size-for-testing-a-proportion"><i class="fa fa-check"></i><b>12.3.1</b> Sample size for testing a proportion</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#DesignEffect"><i class="fa fa-check"></i><b>12.4</b> Accounting for design effect</a></li>
<li class="chapter" data-level="12.5" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#BayesianSampleSize"><i class="fa fa-check"></i><b>12.5</b> Bayesian sample size determination</a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#bayesian-criteria-for-sample-size-computation"><i class="fa fa-check"></i><b>12.5.1</b> Bayesian criteria for sample size computation</a></li>
<li class="chapter" data-level="12.5.2" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#mixed-bayesian-likelihood-approach"><i class="fa fa-check"></i><b>12.5.2</b> Mixed Bayesian-likelihood approach</a></li>
<li class="chapter" data-level="12.5.3" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#estimation-of-population-mean"><i class="fa fa-check"></i><b>12.5.3</b> Estimation of population mean</a></li>
<li class="chapter" data-level="12.5.4" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#estimation-of-a-population-proportion"><i class="fa fa-check"></i><b>12.5.4</b> Estimation of a population proportion</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="MBpredictionofDesignVariance.html"><a href="MBpredictionofDesignVariance.html"><i class="fa fa-check"></i><b>13</b> Model-based optimisation of probability sampling designs</a>
<ul>
<li class="chapter" data-level="13.1" data-path="MBpredictionofDesignVariance.html"><a href="MBpredictionofDesignVariance.html#model-based-optimisation-of-sampling-design-type-and-sample-size"><i class="fa fa-check"></i><b>13.1</b> Model-based optimisation of sampling design type and sample size</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="MBpredictionofDesignVariance.html"><a href="MBpredictionofDesignVariance.html#AnalyticalApproach"><i class="fa fa-check"></i><b>13.1.1</b> Analytical approach</a></li>
<li class="chapter" data-level="13.1.2" data-path="MBpredictionofDesignVariance.html"><a href="MBpredictionofDesignVariance.html#GeostatisticalSimulationApproach"><i class="fa fa-check"></i><b>13.1.2</b> Geostatistical simulation approach</a></li>
<li class="chapter" data-level="13.1.3" data-path="MBpredictionofDesignVariance.html"><a href="MBpredictionofDesignVariance.html#MBpredSamplingVarBayes"><i class="fa fa-check"></i><b>13.1.3</b> Bayesian approach</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="MBpredictionofDesignVariance.html"><a href="MBpredictionofDesignVariance.html#Ospats"><i class="fa fa-check"></i><b>13.2</b> Model-based optimisation of spatial strata</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html"><i class="fa fa-check"></i><b>14</b> Sampling for estimating parameters of (small) domains</a>
<ul>
<li class="chapter" data-level="14.1" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#LargeDomainsDirectEstimator"><i class="fa fa-check"></i><b>14.1</b> Direct estimator for large domains</a></li>
<li class="chapter" data-level="14.2" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#SmallDomainsModelAssisted"><i class="fa fa-check"></i><b>14.2</b> Model-assisted estimators for small domains</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#RegressionestimatorSmallDomain"><i class="fa fa-check"></i><b>14.2.1</b> Regression estimator</a></li>
<li class="chapter" data-level="14.2.2" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#synthetic-estimator"><i class="fa fa-check"></i><b>14.2.2</b> Synthetic estimator</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#SmallAreaModelBased"><i class="fa fa-check"></i><b>14.3</b> Model-based prediction</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#random-intercept-model"><i class="fa fa-check"></i><b>14.3.1</b> Random intercept model</a></li>
<li class="chapter" data-level="14.3.2" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#geostatistical-model"><i class="fa fa-check"></i><b>14.3.2</b> Geostatistical model</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#supplemental-probability-sampling-of-small-domains"><i class="fa fa-check"></i><b>14.4</b> Supplemental probability sampling of small domains</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html"><i class="fa fa-check"></i><b>15</b> Repeated sample surveys for monitoring population parameters</a>
<ul>
<li class="chapter" data-level="15.1" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#space-time-designs"><i class="fa fa-check"></i><b>15.1</b> Space-time designs</a></li>
<li class="chapter" data-level="15.2" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#SpaceTimeparameters"><i class="fa fa-check"></i><b>15.2</b> Space-time population parameters</a></li>
<li class="chapter" data-level="15.3" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#design-based-generalised-least-squares-estimation-of-spatial-means"><i class="fa fa-check"></i><b>15.3</b> Design-based generalised least squares estimation of spatial means</a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#current-mean"><i class="fa fa-check"></i><b>15.3.1</b> Current mean</a></li>
<li class="chapter" data-level="15.3.2" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#change-of-the-spatial-mean"><i class="fa fa-check"></i><b>15.3.2</b> Change of the spatial mean</a></li>
<li class="chapter" data-level="15.3.3" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#trend-of-the-spatial-mean"><i class="fa fa-check"></i><b>15.3.3</b> Trend of the spatial mean</a></li>
<li class="chapter" data-level="15.3.4" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#space-time-mean"><i class="fa fa-check"></i><b>15.3.4</b> Space-time mean</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#case-study-annual-mean-daily-temperature-in-spain"><i class="fa fa-check"></i><b>15.4</b> Case study: annual mean daily temperature in Spain</a>
<ul>
<li class="chapter" data-level="15.4.1" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#static-synchronous-design"><i class="fa fa-check"></i><b>15.4.1</b> Static-synchronous design</a></li>
<li class="chapter" data-level="15.4.2" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#independent-synchonous-design"><i class="fa fa-check"></i><b>15.4.2</b> Independent synchonous design</a></li>
<li class="chapter" data-level="15.4.3" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#serially-alternating-design"><i class="fa fa-check"></i><b>15.4.3</b> Serially alternating design</a></li>
<li class="chapter" data-level="15.4.4" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#supplemented-panel-design"><i class="fa fa-check"></i><b>15.4.4</b> Supplemented panel design</a></li>
<li class="chapter" data-level="15.4.5" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#rotating-panel-design"><i class="fa fa-check"></i><b>15.4.5</b> Rotating panel design</a></li>
</ul></li>
<li class="chapter" data-level="15.5" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#space-time-sampling-with-stratified-random-sampling-in-space"><i class="fa fa-check"></i><b>15.5</b> Space-time sampling with stratified random sampling in space</a></li>
</ul></li>
<li class="part"><span><b>II Sampling for mapping</b></span></li>
<li class="chapter" data-level="16" data-path="IntroSamplingforMapping.html"><a href="IntroSamplingforMapping.html"><i class="fa fa-check"></i><b>16</b> Introduction to sampling for mapping</a>
<ul>
<li class="chapter" data-level="16.1" data-path="IntroSamplingforMapping.html"><a href="IntroSamplingforMapping.html#when-is-probability-sampling-not-required"><i class="fa fa-check"></i><b>16.1</b> When is probability sampling not required?</a></li>
<li class="chapter" data-level="16.2" data-path="IntroSamplingforMapping.html"><a href="IntroSamplingforMapping.html#sampling-for-simultaneously-mapping-and-estimating-means"><i class="fa fa-check"></i><b>16.2</b> Sampling for simultaneously mapping and estimating means</a>
<ul>
<li class="chapter" data-level="16.2.1" data-path="IntroSamplingforMapping.html"><a href="IntroSamplingforMapping.html#balanced-stratified-random-sampling"><i class="fa fa-check"></i><b>16.2.1</b> Balanced stratified random sampling</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="IntroSamplingforMapping.html"><a href="IntroSamplingforMapping.html#broad-overview-of-sampling-designs-for-mapping"><i class="fa fa-check"></i><b>16.3</b> Broad overview of sampling designs for mapping</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="Regulargrid.html"><a href="Regulargrid.html"><i class="fa fa-check"></i><b>17</b> Regular grid sampling</a></li>
<li class="chapter" data-level="18" data-path="SpatialCoverage.html"><a href="SpatialCoverage.html"><i class="fa fa-check"></i><b>18</b> Spatial coverage sampling</a>
<ul>
<li class="chapter" data-level="18.1" data-path="SpatialCoverage.html"><a href="SpatialCoverage.html#SpatialInfill"><i class="fa fa-check"></i><b>18.1</b> Spatial infill sampling</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="kmeans.html"><a href="kmeans.html"><i class="fa fa-check"></i><b>19</b> Covariate space coverage sampling</a>
<ul>
<li class="chapter" data-level="19.1" data-path="kmeans.html"><a href="kmeans.html#covariate-space-infill-sampling"><i class="fa fa-check"></i><b>19.1</b> Covariate space infill sampling</a></li>
<li class="chapter" data-level="19.2" data-path="kmeans.html"><a href="kmeans.html#performance-of-covariate-space-coverage-sampling-in-random-forest-prediction"><i class="fa fa-check"></i><b>19.2</b> Performance of covariate space coverage sampling in random forest prediction</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="cLHS.html"><a href="cLHS.html"><i class="fa fa-check"></i><b>20</b> Conditioned Latin hypercube sampling</a>
<ul>
<li class="chapter" data-level="20.1" data-path="cLHS.html"><a href="cLHS.html#cLHIS"><i class="fa fa-check"></i><b>20.1</b> Conditioned Latin hypercube infill sampling</a></li>
<li class="chapter" data-level="20.2" data-path="cLHS.html"><a href="cLHS.html#performance-of-conditioned-latin-hypercube-sampling-in-random-forest-prediction"><i class="fa fa-check"></i><b>20.2</b> Performance of conditioned Latin hypercube sampling in random forest prediction</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="SpatialResponseSurface.html"><a href="SpatialResponseSurface.html"><i class="fa fa-check"></i><b>21</b> Spatial response surface sampling</a>
<ul>
<li class="chapter" data-level="21.1" data-path="SpatialResponseSurface.html"><a href="SpatialResponseSurface.html#IncreaseSampleSize"><i class="fa fa-check"></i><b>21.1</b> Increasing the sample size</a></li>
<li class="chapter" data-level="21.2" data-path="SpatialResponseSurface.html"><a href="SpatialResponseSurface.html#stratified-spatial-response-surface-sampling"><i class="fa fa-check"></i><b>21.2</b> Stratified spatial response surface sampling</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="Introkriging.html"><a href="Introkriging.html"><i class="fa fa-check"></i><b>22</b> Introduction to kriging</a>
<ul>
<li class="chapter" data-level="22.1" data-path="Introkriging.html"><a href="Introkriging.html#BlockKriging"><i class="fa fa-check"></i><b>22.1</b> Block-kriging</a></li>
<li class="chapter" data-level="22.2" data-path="Introkriging.html"><a href="Introkriging.html#IntroKED"><i class="fa fa-check"></i><b>22.2</b> Kriging with an external drift</a></li>
<li class="chapter" data-level="22.3" data-path="Introkriging.html"><a href="Introkriging.html#VariogramEstimation"><i class="fa fa-check"></i><b>22.3</b> Estimating the semivariogram</a>
<ul>
<li class="chapter" data-level="22.3.1" data-path="Introkriging.html"><a href="Introkriging.html#MoM"><i class="fa fa-check"></i><b>22.3.1</b> Method-of-moments</a></li>
<li class="chapter" data-level="22.3.2" data-path="Introkriging.html"><a href="Introkriging.html#MLestimationVariogram"><i class="fa fa-check"></i><b>22.3.2</b> Maximum likelihood</a></li>
</ul></li>
<li class="chapter" data-level="22.4" data-path="Introkriging.html"><a href="Introkriging.html#ResidualVariogram"><i class="fa fa-check"></i><b>22.4</b> Estimating the residual semivariogram</a>
<ul>
<li class="chapter" data-level="22.4.1" data-path="Introkriging.html"><a href="Introkriging.html#IterativeMoM"><i class="fa fa-check"></i><b>22.4.1</b> Iterative method-of-moments</a></li>
<li class="chapter" data-level="22.4.2" data-path="Introkriging.html"><a href="Introkriging.html#REML"><i class="fa fa-check"></i><b>22.4.2</b> Restricted maximum likelihood</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="23" data-path="MBgridspacing.html"><a href="MBgridspacing.html"><i class="fa fa-check"></i><b>23</b> Model-based optimisation of the grid spacing</a>
<ul>
<li class="chapter" data-level="23.1" data-path="MBgridspacing.html"><a href="MBgridspacing.html#GridspacingOK"><i class="fa fa-check"></i><b>23.1</b> Optimal grid spacing for ordinary kriging</a></li>
<li class="chapter" data-level="23.2" data-path="MBgridspacing.html"><a href="MBgridspacing.html#controlling-the-mean-or-a-quantile-of-the-ordinary-kriging-variance"><i class="fa fa-check"></i><b>23.2</b> Controlling the mean or a quantile of the ordinary kriging variance</a></li>
<li class="chapter" data-level="23.3" data-path="MBgridspacing.html"><a href="MBgridspacing.html#optimal-grid-spacing-for-block-kriging"><i class="fa fa-check"></i><b>23.3</b> Optimal grid spacing for block-kriging</a></li>
<li class="chapter" data-level="23.4" data-path="MBgridspacing.html"><a href="MBgridspacing.html#MBgridspacingKED"><i class="fa fa-check"></i><b>23.4</b> Optimal grid spacing for kriging with an external drift</a></li>
<li class="chapter" data-level="23.5" data-path="MBgridspacing.html"><a href="MBgridspacing.html#BayesianGridSpacing"><i class="fa fa-check"></i><b>23.5</b> Bayesian approach</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="MBSamplePattern.html"><a href="MBSamplePattern.html"><i class="fa fa-check"></i><b>24</b> Model-based optimisation of the sampling pattern</a>
<ul>
<li class="chapter" data-level="24.1" data-path="MBSamplePattern.html"><a href="MBSamplePattern.html#SSA"><i class="fa fa-check"></i><b>24.1</b> Spatial simulated annealing</a></li>
<li class="chapter" data-level="24.2" data-path="MBSamplePattern.html"><a href="MBSamplePattern.html#SamplePatternOK"><i class="fa fa-check"></i><b>24.2</b> Optimising the sampling pattern for ordinary kriging</a></li>
<li class="chapter" data-level="24.3" data-path="MBSamplePattern.html"><a href="MBSamplePattern.html#SamplePatternKED"><i class="fa fa-check"></i><b>24.3</b> Optimising the sampling pattern for kriging with an external drift</a></li>
<li class="chapter" data-level="24.4" data-path="MBSamplePattern.html"><a href="MBSamplePattern.html#model-based-infill-sampling"><i class="fa fa-check"></i><b>24.4</b> Model-based infill sampling</a>
<ul>
<li class="chapter" data-level="24.4.1" data-path="MBSamplePattern.html"><a href="MBSamplePattern.html#model-based-infill-sampling-for-kriging-with-an-external-drift"><i class="fa fa-check"></i><b>24.4.1</b> Model-based infill sampling for kriging with an external drift</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="25" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html"><i class="fa fa-check"></i><b>25</b> Sampling for estimating the semivariogram</a>
<ul>
<li class="chapter" data-level="25.1" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#nested-sampling"><i class="fa fa-check"></i><b>25.1</b> Nested sampling</a></li>
<li class="chapter" data-level="25.2" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#independent-sampling-of-pairs-of-points"><i class="fa fa-check"></i><b>25.2</b> Independent sampling of pairs of points</a></li>
<li class="chapter" data-level="25.3" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#samplingforvariogram"><i class="fa fa-check"></i><b>25.3</b> Model-based optimisation of sampling pattern for semivariogram estimation</a>
<ul>
<li class="chapter" data-level="25.3.1" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#UncertainSemivariogramParameters"><i class="fa fa-check"></i><b>25.3.1</b> Uncertainty about semivariogram parameters</a></li>
<li class="chapter" data-level="25.3.2" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#UncertainKrigingVariance"><i class="fa fa-check"></i><b>25.3.2</b> Uncertainty about the kriging variance</a></li>
</ul></li>
<li class="chapter" data-level="25.4" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#SamplingEstimationandPrediction"><i class="fa fa-check"></i><b>25.4</b> Model-based optimisation of pattern of a single sample for both semivariogram estimation and prediction</a></li>
<li class="chapter" data-level="25.5" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#a-practical-solution"><i class="fa fa-check"></i><b>25.5</b> A practical solution</a></li>
</ul></li>
<li class="chapter" data-level="26" data-path="Validation.html"><a href="Validation.html"><i class="fa fa-check"></i><b>26</b> Sampling for validation of maps</a>
<ul>
<li class="chapter" data-level="26.1" data-path="Validation.html"><a href="Validation.html#map-quality-indices"><i class="fa fa-check"></i><b>26.1</b> Map quality indices</a>
<ul>
<li class="chapter" data-level="26.1.1" data-path="Validation.html"><a href="Validation.html#estimation-of-map-quality-indices"><i class="fa fa-check"></i><b>26.1.1</b> Estimation of map quality indices</a></li>
</ul></li>
<li class="chapter" data-level="26.2" data-path="Validation.html"><a href="Validation.html#real-world-case-study"><i class="fa fa-check"></i><b>26.2</b> Real-world case study</a>
<ul>
<li class="chapter" data-level="26.2.1" data-path="Validation.html"><a href="Validation.html#estimation-of-the-population-mean-error-and-mean-squared-error"><i class="fa fa-check"></i><b>26.2.1</b> Estimation of the population Mean Error and Mean Squared Error</a></li>
<li class="chapter" data-level="26.2.2" data-path="Validation.html"><a href="Validation.html#estimation-of-the-standard-error-of-the-estimated-population-me-and-mse"><i class="fa fa-check"></i><b>26.2.2</b> Estimation of the standard error of the estimated population ME and MSE</a></li>
<li class="chapter" data-level="26.2.3" data-path="Validation.html"><a href="Validation.html#estimation-of-mec"><i class="fa fa-check"></i><b>26.2.3</b> Estimation of MEC</a></li>
<li class="chapter" data-level="26.2.4" data-path="Validation.html"><a href="Validation.html#statistical-testing-of-hypothesis-about-population-me-and-mse"><i class="fa fa-check"></i><b>26.2.4</b> Statistical testing of hypothesis about population ME and MSE</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="27" data-path="Approaches.html"><a href="Approaches.html"><i class="fa fa-check"></i><b>27</b> Design-based, model-based and model-assisted approach for sampling and inference</a>
<ul>
<li class="chapter" data-level="27.1" data-path="Approaches.html"><a href="Approaches.html#two-sources-of-randomness"><i class="fa fa-check"></i><b>27.1</b> Two sources of randomness</a></li>
<li class="chapter" data-level="27.2" data-path="Approaches.html"><a href="Approaches.html#identically-and-independently-distributed-i.i.d."><i class="fa fa-check"></i><b>27.2</b> “Identically and independently distributed” (i.i.d.)</a></li>
<li class="chapter" data-level="27.3" data-path="Approaches.html"><a href="Approaches.html#BiasandVariance"><i class="fa fa-check"></i><b>27.3</b> Bias and variance</a></li>
<li class="chapter" data-level="27.4" data-path="Approaches.html"><a href="Approaches.html#effectivesamplesize"><i class="fa fa-check"></i><b>27.4</b> Effective sample size</a></li>
<li class="chapter" data-level="27.5" data-path="Approaches.html"><a href="Approaches.html#ExploitSpatialStructure"><i class="fa fa-check"></i><b>27.5</b> Exploiting spatial structure in design-based approach</a></li>
<li class="chapter" data-level="27.6" data-path="Approaches.html"><a href="Approaches.html#ModelassistedvsModeldependent"><i class="fa fa-check"></i><b>27.6</b> Model-assisted versus model-dependent</a></li>
</ul></li>
<li class="appendix"><span><b>Appendices</b></span></li>
<li class="chapter" data-level="A" data-path="Answers.html"><a href="Answers.html"><i class="fa fa-check"></i><b>A</b> Answers to exercises</a>
<ul>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#introduction-to-probability-sampling"><i class="fa fa-check"></i>Introduction to probability sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#simple-random-sampling"><i class="fa fa-check"></i>Simple random sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#stratified-random-sampling"><i class="fa fa-check"></i>Stratified random sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#systematic-random-sampling"><i class="fa fa-check"></i>Systematic random sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#cluster-random-sampling"><i class="fa fa-check"></i>Cluster random sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#two-stage-random-sampling"><i class="fa fa-check"></i>Two-stage random sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#sampling-with-probabilities-proportional-to-size"><i class="fa fa-check"></i>Sampling with probabilities proportional to size</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#balanced-and-well-spread-sampling"><i class="fa fa-check"></i>Balanced and well-spread sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#model-assisted-estimation"><i class="fa fa-check"></i>Model-assisted estimation</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#two-phase-random-sampling"><i class="fa fa-check"></i>Two-phase random sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#computing-the-required-sample-size"><i class="fa fa-check"></i>Computing the required sample size</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#model-based-optimisation-of-probability-sampling-designs"><i class="fa fa-check"></i>Model-based optimisation of probability sampling designs</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#repeated-sample-surveys-for-monitoring-population-parameters"><i class="fa fa-check"></i>Repeated sample surveys for monitoring population parameters</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#regular-grid-sampling"><i class="fa fa-check"></i>Regular grid sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#spatial-coverage-sampling"><i class="fa fa-check"></i>Spatial coverage sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#covariate-space-coverage-sampling"><i class="fa fa-check"></i>Covariate space coverage sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#conditioned-latin-hypercube-sampling"><i class="fa fa-check"></i>Conditioned Latin hypercube sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#model-based-optimisation-of-the-grid-spacing"><i class="fa fa-check"></i>Model-based optimisation of the grid spacing</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#model-based-optimisation-of-the-sampling-pattern"><i class="fa fa-check"></i>Model-based optimisation of the sampling pattern</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#sampling-for-estimating-the-semivariogram"><i class="fa fa-check"></i>Sampling for estimating the semivariogram</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#sampling-for-validation-of-maps"><i class="fa fa-check"></i>Sampling for validation of maps</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/DickBrus/">Dick Brus</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Spatial sampling with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="Modelassisted" class="section level1" number="10">
<h1><span class="header-section-number">Chapter 10</span> Model-assisted estimation</h1>
<p>In many cases ancillary information is available that could be useful to increase the accuracy of the estimated mean or total of the study variable. The ancillary variable(s) can be qualitative (i.e. classifications) or quantitative. As we have seen before, both types of ancillary variable can be used at the design stage, i.e. in selecting the sampling units, to improve the performance of the sampling strategy, for instance by stratification (Chapter <a href="STSI.html#STSI">4</a>), selecting sampling units with probabilities proportional to size (Chapter <a href="pps.html#pps">8</a>), or through balancing and/or spreading the sample on the covariates (Chapter <a href="BalancedSpreaded.html#BalancedSpreaded">9</a>). In this chapter I explain how these covariates can be used at the stage of <em>estimation</em>, once the data are collected.</p>
<p>In the design-based approach for sampling various estimators are developed that exploit one or more covariates. These estimators are derived from different superpopulation models of the study variable. A superpopulation model is a statistical model that can be used to generate an infinite number of populations, a superpopulation, through simulation. An example is the simulation of spatial populations using a geostatistical model, see Chapter <a href="MBpredictionofDesignVariance.html#MBpredictionofDesignVariance">13</a>. A superpopulation is a construct, it does not exist in reality. We assume that the population of interest is one of the populations that can be generated with the chosen model. The combination of probability sampling and estimators that are build on a superpopulation model, is referred to as the model-assisted approach. Also in the model-based approach a superpopulation model is used, however, its role is fundamentally different from that in the model-assisted approach, see Chapter <a href="Approaches.html#Approaches">27</a>. To stress the different use of the superpopulation model in the model-assisted approach this model is referred to as the “working model”, i.e. the superpopulation model that is used to derive a model-assisted estimator.</p>
<p><span class="citation"><a href="#ref-Breidt2017" role="doc-biblioref">Breidt and Opsomer</a> (<a href="#ref-Breidt2017" role="doc-biblioref">2017</a>)</span> present an overview of model-assisted estimators derived from a general working model:</p>
<p><span class="math display" id="eq:workingmodel">\[\begin{equation}
Z_k = \mu(\mathbf{x}_k)+\epsilon_k\;,
\tag{10.1}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(\mu(\mathbf{x}_k)\)</span> the model mean for population unit <span class="math inline">\(k\)</span> which is a function of the covariate values of that unit collected in vector <span class="math inline">\(\mathbf{x}_k = (1, x_{1,k}, \dots , x_{J,k})^{\mathrm{T}}\)</span>, and <span class="math inline">\(\epsilon_k\)</span> a random variable with zero mean. Note that I use uppercase <span class="math inline">\(Z\)</span> to distinguish the random variable <span class="math inline">\(Z_k\)</span> of unit <span class="math inline">\(k\)</span> from one realization of this random variable for unit <span class="math inline">\(k\)</span> in the population of interest, <span class="math inline">\(z_k\)</span>. The model mean <span class="math inline">\(\mu(\mathbf{x}_k)\)</span> can be a linear or a non-linear combination of the covariates. If the study variable and the covariate values were observed for all population units, all these data can be used to compute a so-called hypothetical population fit of the model parameters. These model parameters can then be used to compute <em>estimates</em> of the model means <span class="math inline">\(\mu(\mathbf{x}_k)\)</span>, denoted by <span class="math inline">\(m(\mathbf{x}_k)\)</span>, for all population units. For instance, with a (multiple) regression model <span class="math inline">\(m(\mathbf{x}_k)=\mathbf{x}_k^{\text{T}} \mathbf{b}\)</span>, with <span class="math inline">\(\mathbf{b}\)</span> the vector with regression coefficients estimated from observations of the study variable <span class="math inline">\(z\)</span> and the covariates on <em>all</em> population units. In practice we have a sample only, which is used to estimate <span class="math inline">\(m(\mathbf{x}_k)\)</span> by <span class="math inline">\(\hat{m}(\mathbf{x}_k)\)</span>. For the multiple regression model <span class="math inline">\(\hat{m}(\mathbf{x}_k)= \mathbf{x}_k^{\text{T}} \hat{\mathbf{b}}\)</span>, with <span class="math inline">\(\hat{\mathbf{b}}\)</span> the vector with regression coefficients estimated from the sample data. This leads to the generalised difference estimator <span class="citation">(<a href="#ref-Wu2001" role="doc-biblioref">Wu and Sitter 2001</a>)</span>:</p>
<p><span class="math display" id="eq:GeneralizedDifferenceEstimator">\[\begin{equation}
\hat{\bar{z}}_{\mathrm{dif}}=\frac{1}{N} \sum_{k=1}^N \hat{m}(\mathbf{x}_k) + \frac{1}{N} \sum_{k \in \mathcal{S}} \frac{z_k-\hat{m}(\mathbf{x}_k)}{\pi_k}\;,
\tag{10.2}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(\pi_k\)</span> the inclusion probability of unit <span class="math inline">\(k\)</span>. The first term is the population mean of model predictions of the study variable, the second term is the <span class="math inline">\(\pi\)</span> estimator of the population mean of the residuals.</p>
<p>A wide variety of model-assisted estimators have been developed and tested in the past decades. They differ in the working model used to obtain the estimates <span class="math inline">\(\hat{m}(\mathbf{x}_k)\)</span> in Equation <a href="Modelassisted.html#eq:GeneralizedDifferenceEstimator">(10.2)</a>. The best known class of model-assisted estimators is the generalised regression estimator that uses a linear model in prediction <span class="citation">(<a href="#ref-sar92" role="doc-biblioref">Särndal, Swensson, and Wretman 1992</a>)</span>. Alternative model-assisted estimators are the estimators using machine learning techniques for prediction. In the era of big data with a vastly increasing number of exhaustive data sets and a rapid development of machine learning techniques, these estimators have great potentials for spatial sample survey.</p>
<div id="GREG" class="section level2" number="10.1">
<h2><span class="header-section-number">10.1</span> Generalised regression estimator</h2>
<p>The working model of the generalised regression estimator is the heteroscedastic multiple linear regression model:</p>
<p><span class="math display" id="eq:GREGmodel">\[\begin{equation}
Z_k = \mathbf{x}^{\mathrm{T}}_k \pmb{\beta}+\epsilon_k \;,
\tag{10.3}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(\epsilon_k\)</span> uncorrelated residuals, with zero mean and variance <span class="math inline">\(\sigma^2(\epsilon_k)\)</span>. Note that the variance of the residuals <span class="math inline">\(\sigma^2(\epsilon_k)\)</span> need not be constant but may differ among the population units. If <span class="math inline">\(\{z_k,x_{1,k}, \dots , x_{J,k}\}\)</span> were observed for all units <span class="math inline">\(k= 1, \dots , N\)</span> in the population, the regression coefficients <span class="math inline">\(\pmb{\beta}\)</span> would be estimated by</p>
<p><span class="math display" id="eq:populationfitGREG">\[\begin{equation}
\mathbf{b} = \left(\sum_{k=1}^N \frac{\mathbf{x}_k\mathbf{x}_k^{\mathrm{T}}}{\sigma^2(\epsilon_k)}  \right)^{-1} \sum_{k=1}^N \frac{\mathbf{x}_k z_k}{\sigma^2(\epsilon_k)}\;,
\tag{10.4}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(\mathbf{x}_k\)</span> the vector <span class="math inline">\((1, x_{1,k}, \dots , x_{J,k})^{\mathrm{T}}\)</span>, and <span class="math inline">\(\sigma^2(\epsilon_k)\)</span> the variance of the residual of unit <span class="math inline">\(k\)</span>. Similar to the distinction between model mean and population mean (see Chapter <a href="Approaches.html#Approaches">27</a>), here the model regression coefficients <span class="math inline">\(\pmb{\beta}\)</span> are distinguished from the population regression coefficients <span class="math inline">\(\mathbf{b}\)</span>. The means <span class="math inline">\(m(\mathbf{x}_k)\)</span> would then be computed by</p>
<p><span class="math display" id="eq:mxi">\[\begin{equation}
m(\mathbf{x}_k) = \mathbf{x}_k^{\mathrm{T}} \mathbf{b}\;.
\tag{10.5}
\end{equation}\]</span></p>
<p>If we have a probability sample from the population of interest, <span class="math inline">\(\mathbf{b}\)</span> is estimated by replacing the population totals in Equation <a href="Modelassisted.html#eq:populationfitGREG">(10.4)</a> by their <span class="math inline">\(\pi\)</span> estimators:</p>
<p><span class="math display" id="eq:EstimatorGREGCoefficients">\[\begin{equation}
\hat{\mathbf{b}} = \left(\sum_{k \in \mathcal{S}} \frac{\mathbf{x}_k\mathbf{x}_k^{\mathrm{T}}}{\sigma^2(\epsilon_k) \pi_k}  \right)^{-1} \sum_{k \in \mathcal{S}} \frac{\mathbf{x}_k z_k}{\sigma^2(\epsilon_k) \pi_k} \;,
\tag{10.6}
\end{equation}\]</span></p>

<div class="rmdcaution">
With unequal inclusion probabilities, the design-based estimators of the population regression coefficients differ from the usual ordinary least squares (OLS) estimators of the regression coefficients defined as model parameters. The values <span class="math inline">\(\hat{b}_j\)</span> are estimates of the <em>population parameters</em> <span class="math inline">\(b_j\)</span>.
</div>
<p>The mean values <span class="math inline">\(m(\mathbf{x}_k)\)</span> are now estimated by</p>
<p><span class="math display" id="eq:estmxi">\[\begin{equation}
\hat{m}(\mathbf{x}_k) = \mathbf{x}_k^{\mathrm{T}} \hat{\mathbf{b}}\;.
\tag{10.7}
\end{equation}\]</span></p>
<p>Plugging Equation <a href="Modelassisted.html#eq:estmxi">(10.7)</a> into the generalised difference estimator, Equation <a href="Modelassisted.html#eq:GeneralizedDifferenceEstimator">(10.2)</a>, leads to the generalised regression estimator for the population mean:</p>
<p><span class="math display" id="eq:GREG">\[\begin{equation}
\hat{\bar{z}}_{\mathrm{regr}} = \frac{1}{N} \sum_{k=1}^N \mathbf{x}_k^{\mathrm{T}} \hat{\mathbf{b}} + \frac{1}{N} \sum_{k \in \mathcal{S}} \frac{z_k-\mathbf{x}^{\mathrm{T}}_k\hat{\mathbf{b}}} {\pi_k}
  \;.
\tag{10.8}
\end{equation}\]</span></p>
<p>This estimator can also be written as</p>
<p><span class="math display" id="eq:GREG2">\[\begin{equation}
\hat{\bar{z}}_{\text{regr}}= \hat{\bar{z}}_{\pi}+\sum_{j=1}^J \hat{b}_j(\bar{x}_j-\hat{\bar{x}}_{j,\pi})  \;,
\tag{10.9}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(\hat{\bar{z}}_{\pi}\)</span> and <span class="math inline">\(\hat{\bar{x}}_{j,\pi}\)</span> the <span class="math inline">\(\pi\)</span> estimator of the study variable <span class="math inline">\(z\)</span> and the <span class="math inline">\(j\)</span>th covariate, respectively, <span class="math inline">\(\bar{x}_j\)</span> the population mean of the <span class="math inline">\(j\)</span>th covariate, and <span class="math inline">\(\hat{b}_j\)</span> the estimated slope coefficient associated with the <span class="math inline">\(j\)</span>th covariate. So the generalised regression estimate is equal to the <span class="math inline">\(\pi\)</span> estimate when the estimated means of the covariates are equal to the population means. This is the rationale of balanced sampling (Chapter <a href="BalancedSpreaded.html#BalancedSpreaded">9</a>).</p>
<p>The alternative formulation of the regression estimator (Equation <a href="Modelassisted.html#eq:GREG2">(10.9)</a>) shows that we do not need to know the covariate values for all population units. Knowledge of the population means of the covariates is sufficient. This is because a linear relation is assumed between the study variable and the covariates. On the contrary, for non-linear working models such as a random forest model, exhaustive knowledge of the covariates is needed so that the estimated mean <span class="math inline">\(\hat{m}(\mathbf{x}_k)\)</span> in Equation <a href="Modelassisted.html#eq:GeneralizedDifferenceEstimator">(10.2)</a> can be computed for every unit in the population.</p>
<p><span class="citation"><a href="#ref-sar92" role="doc-biblioref">Särndal, Swensson, and Wretman</a> (<a href="#ref-sar92" role="doc-biblioref">1992</a>)</span> worked out the generalised regression estimator for various superpopulation models, such as the simple and multiple linear regression model, the ratio model and the ANOVA model.</p>
<div id="RegressionEstimator" class="section level3" number="10.1.1">
<h3><span class="header-section-number">10.1.1</span> Simple and multiple regression estimators</h3>
<p>The working model of the simple and multiple regression estimator is the homoscedastic linear regression model. The only difference with the heteroscedastic model (Equation <a href="Modelassisted.html#eq:GREGmodel">(10.3)</a>) is that the variance of the residuals is assumed constant: <span class="math inline">\(\sigma^2(\epsilon_k) = \sigma^2(\epsilon), k = 1 , \dots , N\)</span>.</p>
<p>In the simple linear regression model the mean is a linear combination of a single covariate, <span class="math inline">\(\mu(x_k)= \alpha + \beta\;x_k\)</span>. The simple linear regression model leads to the simple regression estimator. With simple random sampling this estimator for the population mean is</p>
<p><span class="math display" id="eq:SimpleRegressionEstimatorSI">\[\begin{equation}
\hat{\bar{z}}_{\text{regr}}= \bar{z}_{\mathcal{S}}+\hat{b}\left( \bar{x}-\bar{x}_{\mathcal{S}}\right) \;,
\tag{10.10}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(\bar{z}_{\mathcal{S}}\)</span> and <span class="math inline">\(\bar{x}_{\mathcal{S}}\)</span> are the sample means of the study variable and the covariate, respectively, <span class="math inline">\(\bar{x}\)</span> is the population mean of the covariate, and <span class="math inline">\(\hat{b}\)</span> is the estimated slope coefficient:</p>
<p><span class="math display" id="eq:OLSSlope">\[\begin{equation}
\hat{b}=\frac{\sum_{k \in \mathcal{S}} (x_k-\bar{x}_{\mathcal{S}})(z_k-\bar{z}_{\mathcal{S}})}{\sum_{k \in \mathcal{S}}(x_k-\bar{x}_{\mathcal{S}})^2} \;.
\tag{10.11}
\end{equation}\]</span></p>
<p>The rationale of the regression estimator is that when the estimated mean of the covariate is, for instance, smaller than the population mean of the covariate, then with a positive correlation between the study variable and covariate, also the estimated mean of the study variable is expected to be smaller than the population mean of the study variable. The difference between the population mean and estimated mean of the covariate can be used to improve the <span class="math inline">\(\pi\)</span> estimate of the mean of <span class="math inline">\(z\)</span> (which is for simple random sampling equal to the sample mean <span class="math inline">\(\bar{z}_{\mathcal{S}}\)</span>), by adding a term proportional to the difference between the estimated mean and population mean of the covariate. As a scaling factor the estimated slope of the fitted regression line is used.</p>
<p>The sampling variance of this regression estimator can be estimated by computing first the regression residuals <span class="math inline">\(e_k= z_k - \hat{z}_k,\, i = 1 \dots n\)</span> at the sampling units. To compute these residuals we also need an estimate of the intercept. With simple random sampling this intercept can be estimated by</p>
<p><span class="math display" id="eq:OLSIntercept">\[\begin{equation}
\hat{a} = \bar{z}_{\mathcal{S}} - \hat{b}\; \bar{x}_{\mathcal{S}}\;.
\tag{10.12}
\end{equation}\]</span></p>
<p>The sampling variance of the regression estimator of the population mean is <em>approximately</em> equal to the sampling variance of the <span class="math inline">\(\pi\)</span> estimator of the mean of the model residuals,</p>
<p><span class="math display" id="eq:VarianceRegressionEstimatorSI">\[\begin{equation}
\widehat{V}\!\left(\hat{\bar{z}}_{\mathrm{regr}}\right)=\left(1-\frac{n}{N}\right)\frac{\widehat{S^{2}}(e)}{n} \;,
\tag{10.13}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(\widehat{S^{2}}(e)\)</span> the estimated population variance of the regression residuals</p>
<p><span class="math display" id="eq:VarianceResiduals">\[\begin{equation}
\widehat{S^{2}}(e)=\frac{1}{n-1}\sum_{k \in \mathcal{S}} e_k^2 \;.
\tag{10.14}
\end{equation}\]</span></p>

<div class="rmdnote">
The variance estimator is an approximation because the regression coefficients are also estimated from the sample, which makes the regression estimator nonlinear. The approximation of the variance is based on a Taylor linearisation of the regression estimator (<span class="citation"><a href="#ref-sar92" role="doc-biblioref">Särndal, Swensson, and Wretman</a> (<a href="#ref-sar92" role="doc-biblioref">1992</a>)</span>, p. 235).
</div>
<p>For simple random sampling with replacement from finite populations and simple random sampling of infinite populations, the finite population correction factor <span class="math inline">\(1-n/N\)</span> must be dropped, see Chapter <a href="SI.html#SI">3</a>.</p>
<p>In the multiple linear regression model the mean is a linear function of multiple covariates. This model leads to the multiple regression estimator . With simple random sampling the population regression coefficients of this estimator can be estimated by</p>
<p><span class="math display" id="eq:EstimatorMultipleRegressionCoefficients">\[\begin{equation}
\hat{\mathbf{b}} = \left(\sum_{k \in \mathcal{S}} \mathbf{x}_k\mathbf{x}_k^{\mathrm{T}} \right)^{-1} \sum_{k \in \mathcal{S}} \mathbf{x}_k z_k \;.
\tag{10.15}
\end{equation}\]</span></p>
<p>Comparison with the general estimator of the population regression coefficients (Equation <a href="Modelassisted.html#eq:EstimatorGREGCoefficients">(10.6)</a>) shows that the variance of the residuals, <span class="math inline">\(\sigma^2(\epsilon_k)\)</span>, is missing as they are assumed constant, as well as the inclusion probabilities <span class="math inline">\(\pi_k\)</span>, which are equal for all population units with simple random sampling without replacement and simple random sampling from infinite populations.</p>
<p>The simple regression estimator is illustrated with Eastern Amazonia, see Section <a href="GeneralIntro.html#Datasets">1.3</a>. The population mean of the aboveground biomass (AGB) is estimated by the simple regression estimator, using natural logarithms of MODIS short-wave infrared radiation (SWIR2) as a covariate.</p>
<p>A simple random sample without replacement of 100 units is selected, and the two population regression coefficients are estimated with Equation <a href="Modelassisted.html#eq:EstimatorMultipleRegressionCoefficients">(10.15)</a>. <code>t(X)</code> computes the transpose of a matrix, function <code>solve</code> computes the inverse of a matrix, and the operator <code>%*%</code> is for multiplying two matrices.</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="Modelassisted.html#cb205-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb205-2"><a href="Modelassisted.html#cb205-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">321</span>)</span>
<span id="cb205-3"><a href="Modelassisted.html#cb205-3" aria-hidden="true" tabindex="-1"></a>units <span class="ot">&lt;-</span> <span class="fu">sample.int</span>(<span class="fu">nrow</span>(gridAmazonia), <span class="at">size=</span>n, <span class="at">replace=</span><span class="cn">FALSE</span>)</span>
<span id="cb205-4"><a href="Modelassisted.html#cb205-4" aria-hidden="true" tabindex="-1"></a>mysample <span class="ot">&lt;-</span> gridAmazonia[units,<span class="fu">c</span>(<span class="st">&quot;AGB&quot;</span>,<span class="st">&quot;lnSWIR2&quot;</span>)]</span>
<span id="cb205-5"><a href="Modelassisted.html#cb205-5" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow=</span>n, <span class="at">ncol=</span><span class="dv">2</span>, <span class="at">data=</span><span class="dv">1</span>)</span>
<span id="cb205-6"><a href="Modelassisted.html#cb205-6" aria-hidden="true" tabindex="-1"></a>X[,<span class="dv">2</span>] <span class="ot">&lt;-</span> mysample<span class="sc">$</span>lnSWIR2</span>
<span id="cb205-7"><a href="Modelassisted.html#cb205-7" aria-hidden="true" tabindex="-1"></a>XXinv <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">t</span>(X) <span class="sc">%*%</span> X)</span>
<span id="cb205-8"><a href="Modelassisted.html#cb205-8" aria-hidden="true" tabindex="-1"></a>Xz <span class="ot">&lt;-</span> <span class="fu">t</span>(X) <span class="sc">%*%</span> mysample<span class="sc">$</span>AGB</span>
<span id="cb205-9"><a href="Modelassisted.html#cb205-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ab <span class="ot">&lt;-</span> <span class="fu">t</span>(XXinv <span class="sc">%*%</span> Xz))</span></code></pre></div>
<pre><code>         [,1]      [,2]
[1,] 1751.636 -237.1379</code></pre>
<p>The same estimates are obtained by ordinary least squares (OLS) fitting of the model with function <code>lm</code>.</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="Modelassisted.html#cb207-1" aria-hidden="true" tabindex="-1"></a>lm_sample <span class="ot">&lt;-</span> <span class="fu">lm</span>(AGB<span class="sc">~</span>lnSWIR2, <span class="at">data=</span>mysample)</span>
<span id="cb207-2"><a href="Modelassisted.html#cb207-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ab_mb <span class="ot">&lt;-</span> <span class="fu">coef</span>(lm_sample))</span></code></pre></div>
<pre><code>(Intercept)     lnSWIR2 
  1751.6363   -237.1379 </code></pre>
<p>As already stressed above, the design-based estimates of the population regression coefficients are only equal to these model-based OLS estimates of the regression coefficients for equal probability sampling designs. Also be aware that the variance of the design-based estimates of the population regression coefficients is not equal to the model-based variance of the model regression coefficients. See Section (11.2.2.1) in <span class="citation"><a href="#ref-loh99" role="doc-biblioref">Lohr</a> (<a href="#ref-loh99" role="doc-biblioref">1999</a>)</span> for how to estimate the variance of the design-based estimates of the population regression coefficients.</p>
<p>Figure <a href="Modelassisted.html#fig:ScatterAGBvsSWIR2">10.1</a> shows the scatter plot for the sample and the fitted simple linear regression model.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:ScatterAGBvsSWIR2"></span>
<img src="SpatialSampling_files/figure-html/ScatterAGBvsSWIR2-1.png" alt="Scatter plot and fitted simple linear regression model for aboveground biomass (AGB), using lnSWIR2 as predictor, for simple random sample." width="80%" />
<p class="caption">
Figure 10.1: Scatter plot and fitted simple linear regression model for aboveground biomass (AGB), using lnSWIR2 as predictor, for simple random sample.
</p>
</div>
<p>The simple random sample is used to estimate the population mean of the study variable AGB by the simple regression estimator, and to approximate the sampling variance of the regression estimator. The residuals of the fitted model can be extracted with function <code>residuals</code> because in this case the OLS estimates of the regression coefficients are equal to the design-based estimates. With unequal inclusion probabilities the residuals must be computed by predicting the study variable for the selected units, using the design-based estimates of the regression coefficients, and subtracting the observations of the study variable.</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="Modelassisted.html#cb209-1" aria-hidden="true" tabindex="-1"></a>mx_pop <span class="ot">&lt;-</span> <span class="fu">mean</span>(gridAmazonia<span class="sc">$</span>lnSWIR2) </span>
<span id="cb209-2"><a href="Modelassisted.html#cb209-2" aria-hidden="true" tabindex="-1"></a>mx_sam <span class="ot">&lt;-</span> <span class="fu">mean</span>(mysample<span class="sc">$</span>lnSWIR2) </span>
<span id="cb209-3"><a href="Modelassisted.html#cb209-3" aria-hidden="true" tabindex="-1"></a>mz_sam <span class="ot">&lt;-</span> <span class="fu">mean</span>(mysample<span class="sc">$</span>AGB)</span>
<span id="cb209-4"><a href="Modelassisted.html#cb209-4" aria-hidden="true" tabindex="-1"></a>mz_regr <span class="ot">&lt;-</span> mz_sam<span class="sc">+</span>ab[<span class="dv">2</span>]<span class="sc">*</span>(mx_pop<span class="sc">-</span>mx_sam)</span>
<span id="cb209-5"><a href="Modelassisted.html#cb209-5" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> <span class="fu">residuals</span>(lm_sample)</span>
<span id="cb209-6"><a href="Modelassisted.html#cb209-6" aria-hidden="true" tabindex="-1"></a>S2e <span class="ot">&lt;-</span> <span class="fu">var</span>(e)</span>
<span id="cb209-7"><a href="Modelassisted.html#cb209-7" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fu">nrow</span>(gridAmazonia)</span>
<span id="cb209-8"><a href="Modelassisted.html#cb209-8" aria-hidden="true" tabindex="-1"></a>se_mz_regr <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((<span class="dv">1</span><span class="sc">-</span>n<span class="sc">/</span>N)<span class="sc">*</span>S2e<span class="sc">/</span>n)</span></code></pre></div>
<p>The difference <span class="math inline">\(\delta(x)\)</span> between the population mean of the covariate lnSWIR2 (6.415) and its estimated mean (6.347) equals 0.068. We may expect the difference between the unknown population mean of the study variable AGB and its sample mean (246.51) to be equal to <span class="math inline">\(\delta(x)\)</span>, multiplied by the estimated slope of the line, which equals -237.1. The result, -16.1039, is added to the simple random sample estimate.</p>
<p>The estimated approximate standard error of the regression estimator equals 4.458. The approximated variance is a simplification of a more complicated approximation derived from writing the regression estimator of the population total as a weighted sum of the <span class="math inline">\(\pi\)</span> expanded observations (<span class="citation"><a href="#ref-sar92" role="doc-biblioref">Särndal, Swensson, and Wretman</a> (<a href="#ref-sar92" role="doc-biblioref">1992</a>)</span>, Equation (6.5.9)),</p>
<p><span class="math display" id="eq:AlternativeRegressionEstimator">\[\begin{equation}
\hat{\bar{z}}_{\mathrm{regr}}=\frac{1}{N}\sum_{k \in \mathcal{S}} g_k \frac{z_k}{\pi_k}\;,
\tag{10.16}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(g_k\)</span> the weight for unit <span class="math inline">\(k\)</span>. For simple random sampling the weights are equal to (<span class="citation"><a href="#ref-sar92" role="doc-biblioref">Särndal, Swensson, and Wretman</a> (<a href="#ref-sar92" role="doc-biblioref">1992</a>)</span>, Equation (6.5.12))</p>
<p><span class="math display" id="eq:RegressionWeights">\[\begin{equation}
g_k = 1+\frac{(\bar{x}-\bar{x}_{\mathcal{S}})(x_k-\bar{x}_{\mathcal{S}})}{\widehat{S^2}(x)}\;.
\tag{10.17}
\end{equation}\]</span></p>
<p>These weights are now computed.</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="Modelassisted.html#cb210-1" aria-hidden="true" tabindex="-1"></a>S2x <span class="ot">&lt;-</span> <span class="fu">sum</span>((mysample<span class="sc">$</span>lnSWIR2<span class="sc">-</span><span class="fu">mean</span>(mysample<span class="sc">$</span>lnSWIR2))<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>n</span>
<span id="cb210-2"><a href="Modelassisted.html#cb210-2" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">+</span>((mx_pop<span class="sc">-</span>mx_sam)<span class="sc">*</span>(mysample<span class="sc">$</span>lnSWIR2<span class="sc">-</span>mx_sam))<span class="sc">/</span>S2x</span></code></pre></div>
<p>The sample mean of the weights equals one,</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="Modelassisted.html#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(g)</span></code></pre></div>
<pre><code>[1] 1</code></pre>
<p>and the sample mean of the product of the weights and the covariate <span class="math inline">\(x\)</span> equals the population mean of the covariate.</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="Modelassisted.html#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">mean</span>(g<span class="sc">*</span>mysample<span class="sc">$</span>lnSWIR2),<span class="fu">mean</span>(gridAmazonia<span class="sc">$</span>lnSWIR2))</span></code></pre></div>
<pre><code>[1] TRUE</code></pre>
<p>In other words, the sample is calibrated on the known population means. The variance of the regression estimator of the population mean can be approximated by (<span class="citation"><a href="#ref-sar92" role="doc-biblioref">Särndal, Swensson, and Wretman</a> (<a href="#ref-sar92" role="doc-biblioref">1992</a>)</span>, Section 6.6)</p>
<p><span class="math display" id="eq:AlternativeVarianceRegressionEstimator">\[\begin{equation}
\widehat{V}\!\left(\hat{\bar{z}}_{\mathrm{regr}}\right)=\left(1-\frac{n}{N}\right)\frac{\sum_{k \in \mathcal{S}} g_k^2e_k^2}{n(n-1)} \;.
\tag{10.18}
\end{equation}\]</span></p>
<p>Comparing this with Equation <a href="Modelassisted.html#eq:VarianceRegressionEstimatorSI">(10.13)</a> shows that in the first approximation we assumed that all weights are equal to one.</p>
<p>The alternative approximate standard error is computed in the next code chunk.</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="Modelassisted.html#cb215-1" aria-hidden="true" tabindex="-1"></a>S2ge <span class="ot">&lt;-</span> <span class="fu">sum</span>(g<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>e<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>(n<span class="dv">-1</span>)</span>
<span id="cb215-2"><a href="Modelassisted.html#cb215-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(se_mz_regr <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((<span class="dv">1</span><span class="sc">-</span>n<span class="sc">/</span>N)<span class="sc">*</span>S2ge<span class="sc">/</span>n))</span></code></pre></div>
<pre><code>[1] 4.546553</code></pre>
<p>The regression estimator and its standard error can be computed with package <strong>survey</strong> <span class="citation">(<a href="#ref-Lumley2020" role="doc-biblioref">Lumley 2020</a>)</span>. After specifying the sampling design with function <code>svydesign</code>, function <code>calibrate</code> is used to calibrate the sample on the known population totals <span class="math inline">\(N\)</span> and <span class="math inline">\(t(x) = \sum_{k=1}^N x_k\)</span>, with <span class="math inline">\(x_k\)</span> the value of covariate lnSWIR2 for unit <span class="math inline">\(k\)</span>.</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="Modelassisted.html#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb217-2"><a href="Modelassisted.html#cb217-2" aria-hidden="true" tabindex="-1"></a>mysample<span class="sc">$</span>fpc <span class="ot">&lt;-</span> N</span>
<span id="cb217-3"><a href="Modelassisted.html#cb217-3" aria-hidden="true" tabindex="-1"></a>design_si <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">id=</span><span class="sc">~</span><span class="dv">1</span>, <span class="at">data=</span>mysample,  <span class="at">fpc=</span><span class="sc">~</span>fpc)</span>
<span id="cb217-4"><a href="Modelassisted.html#cb217-4" aria-hidden="true" tabindex="-1"></a>populationtotals <span class="ot">&lt;-</span> <span class="fu">c</span>(N,<span class="fu">sum</span>(gridAmazonia<span class="sc">$</span>lnSWIR2))</span>
<span id="cb217-5"><a href="Modelassisted.html#cb217-5" aria-hidden="true" tabindex="-1"></a>mysample_cal <span class="ot">&lt;-</span> <span class="fu">calibrate</span>(design_si, <span class="at">formula=</span><span class="sc">~</span>lnSWIR2,</span>
<span id="cb217-6"><a href="Modelassisted.html#cb217-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">population=</span>populationtotals, <span class="at">calfun=</span><span class="st">&quot;linear&quot;</span>)</span></code></pre></div>
<p>The calibrated weights can be extracted with function <code>weights</code>.</p>

<div class="rmdcaution">
These weights are divided by the inclusion probabilities <span class="math inline">\(\pi=n/N\)</span>, so that the sample sum of the weights equals <span class="math inline">\(N\)</span>, and not the sample size <span class="math inline">\(n\)</span> (as in the code chunk above).
</div>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="Modelassisted.html#cb218-1" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">weights</span>(mysample_cal)</span>
<span id="cb218-2"><a href="Modelassisted.html#cb218-2" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">sum</span>(g),N)</span></code></pre></div>
<pre><code>[1] TRUE</code></pre>
<p>The sample sum of the product of the weights and the covariate equals the population total of the covariate.</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="Modelassisted.html#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">sum</span>(g<span class="sc">*</span>mysample<span class="sc">$</span>lnSWIR2),<span class="fu">sum</span>(gridAmazonia<span class="sc">$</span>lnSWIR2))</span></code></pre></div>
<pre><code>[1] TRUE</code></pre>
<p>Finally, the population mean can be estimated with function <code>svymean</code>. This is simply the sample sum of the product of the weights and the study variable AGB, divided by <span class="math inline">\(N\)</span>.</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="Modelassisted.html#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="fu">svymean</span>(<span class="sc">~</span>AGB, mysample_cal)</span></code></pre></div>
<pre><code>      mean     SE
AGB 230.41 4.5466</code></pre>
<p>The standard error is computed with Equation <a href="Modelassisted.html#eq:AlternativeVarianceRegressionEstimator">(10.18)</a>. Figure <a href="Modelassisted.html#fig:SamplingDistributionRegression">10.2</a> shows the sampling distribution of the simple regression estimator along with the distribution of the <span class="math inline">\(\pi\)</span> estimator, obtained by repeating simple random sampling of 100 units and estimation 10,000 times.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:SamplingDistributionRegression"></span>
<img src="SpatialSampling_files/figure-html/SamplingDistributionRegression-1.png" alt="Sampling distribution of simple regression estimator, using lnSWIR2 as a predictor, and $\pi$ estimator of mean aboveground biomass (AGB) in Eastern Amazonia, for simple random sampling without replacement of size 100." width="80%" />
<p class="caption">
Figure 10.2: Sampling distribution of simple regression estimator, using lnSWIR2 as a predictor, and <span class="math inline">\(\pi\)</span> estimator of mean aboveground biomass (AGB) in Eastern Amazonia, for simple random sampling without replacement of size 100.
</p>
</div>
<p>The average of the 10,000 regression estimates equals 224.702. The population mean of the study variable AGB equals 225.048, so the estimated bias of the regression estimator equals -0.347, which is negligibly small related to the estimated population mean. The variance of the 10,000 regression estimates equals 26.936, and the average of the 10,000 estimated approximate variances using Equation <a href="Modelassisted.html#eq:AlternativeVarianceRegressionEstimator">(10.18)</a> equals 27.105. The gain in precision due to the regression estimator, quantified by the ratio of the variance of the <span class="math inline">\(\pi\)</span> estimator to the variance of the regression estimator equals 3.163.</p>
<p>For simple random sampling the ratio of the variances of the simple regression estimator and<span class="math inline">\(\pi\)</span> estimator
is independent of the sample size and equals <span class="math inline">\(1-r^2\)</span>, with <span class="math inline">\(r\)</span> the correlation coefficient of the study variable and covariate (<span class="citation"><a href="#ref-sar92" role="doc-biblioref">Särndal, Swensson, and Wretman</a> (<a href="#ref-sar92" role="doc-biblioref">1992</a>)</span>, p. 274).</p>
<p>Using multiple covariates in the regression estimator is straightforward with the function <code>calibrate</code> of package <strong>survey</strong>. As a first step the best model is selected with function <code>regsubsets</code> of package <strong>leaps</strong> <span class="citation">(<a href="#ref-leaps" role="doc-biblioref">Thomas Lumley (based on Fortran code by Alan Miller) 2020</a>)</span>.</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="Modelassisted.html#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaps)</span>
<span id="cb224-2"><a href="Modelassisted.html#cb224-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb224-3"><a href="Modelassisted.html#cb224-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">321</span>)</span>
<span id="cb224-4"><a href="Modelassisted.html#cb224-4" aria-hidden="true" tabindex="-1"></a>units <span class="ot">&lt;-</span> <span class="fu">sample.int</span>(<span class="fu">nrow</span>(gridAmazonia), <span class="at">size=</span>n, <span class="at">replace=</span><span class="cn">FALSE</span>)</span>
<span id="cb224-5"><a href="Modelassisted.html#cb224-5" aria-hidden="true" tabindex="-1"></a>covars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;AGB&quot;</span>,<span class="st">&quot;lnSWIR2&quot;</span>,<span class="st">&quot;Terra_PP&quot;</span>,<span class="st">&quot;Prec_dm&quot;</span>,<span class="st">&quot;Elevation&quot;</span>,<span class="st">&quot;Clay&quot;</span>)</span>
<span id="cb224-6"><a href="Modelassisted.html#cb224-6" aria-hidden="true" tabindex="-1"></a>mysample <span class="ot">&lt;-</span> gridAmazonia[units,covars]</span>
<span id="cb224-7"><a href="Modelassisted.html#cb224-7" aria-hidden="true" tabindex="-1"></a>models <span class="ot">&lt;-</span> <span class="fu">regsubsets</span>(AGB<span class="sc">~</span>., <span class="at">data=</span>mysample, <span class="at">nvmax=</span><span class="dv">4</span>)</span>
<span id="cb224-8"><a href="Modelassisted.html#cb224-8" aria-hidden="true" tabindex="-1"></a>res.sum <span class="ot">&lt;-</span> <span class="fu">summary</span>(models)</span>
<span id="cb224-9"><a href="Modelassisted.html#cb224-9" aria-hidden="true" tabindex="-1"></a>res.sum<span class="sc">$</span>outmat</span></code></pre></div>
<pre><code>         lnSWIR2 Terra_PP Prec_dm Elevation Clay
1  ( 1 ) &quot;*&quot;     &quot; &quot;      &quot; &quot;     &quot; &quot;       &quot; &quot; 
2  ( 1 ) &quot;*&quot;     &quot;*&quot;      &quot; &quot;     &quot; &quot;       &quot; &quot; 
3  ( 1 ) &quot;*&quot;     &quot;*&quot;      &quot; &quot;     &quot;*&quot;       &quot; &quot; 
4  ( 1 ) &quot;*&quot;     &quot;*&quot;      &quot;*&quot;     &quot;*&quot;       &quot; &quot; </code></pre>
<p>The best model with one predictor is the model with lnSWIR2, the best model with two predictors is the one with lnSWIR2 and Terra_PP, etc. Of these models the third model, i.e. the model with lnSWIR2, Terra_PP and Elevation is the best when using adjusted <span class="math inline">\(R^2\)</span> as a selection criterion.</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="Modelassisted.html#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="fu">which.max</span>(res.sum<span class="sc">$</span>adjr2)</span></code></pre></div>
<pre><code>[1] 3</code></pre>
<p>The standard error of the estimated mean of AGB is somewhat reduced by adding the covariates Terra_PP and Elevation to the regression estimator.</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="Modelassisted.html#cb228-1" aria-hidden="true" tabindex="-1"></a>mysample<span class="sc">$</span>fpc <span class="ot">&lt;-</span> <span class="fu">nrow</span>(gridAmazonia)</span>
<span id="cb228-2"><a href="Modelassisted.html#cb228-2" aria-hidden="true" tabindex="-1"></a>design_si <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">id=</span><span class="sc">~</span><span class="dv">1</span>, <span class="at">data=</span>mysample, <span class="at">fpc=</span><span class="sc">~</span>fpc)</span>
<span id="cb228-3"><a href="Modelassisted.html#cb228-3" aria-hidden="true" tabindex="-1"></a>totals <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">nrow</span>(gridAmazonia),<span class="fu">sum</span>(gridAmazonia<span class="sc">$</span>lnSWIR2),</span>
<span id="cb228-4"><a href="Modelassisted.html#cb228-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(gridAmazonia<span class="sc">$</span>Terra_PP),<span class="fu">sum</span>(gridAmazonia<span class="sc">$</span>Elevation))</span>
<span id="cb228-5"><a href="Modelassisted.html#cb228-5" aria-hidden="true" tabindex="-1"></a>mysample_cal <span class="ot">&lt;-</span> <span class="fu">calibrate</span>(design_si, <span class="at">formula=</span><span class="sc">~</span>lnSWIR2<span class="sc">+</span>Terra_PP<span class="sc">+</span>Elevation,</span>
<span id="cb228-6"><a href="Modelassisted.html#cb228-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">population=</span>totals, <span class="at">calfun=</span><span class="st">&quot;linear&quot;</span>)</span>
<span id="cb228-7"><a href="Modelassisted.html#cb228-7" aria-hidden="true" tabindex="-1"></a><span class="fu">svymean</span>(<span class="sc">~</span>AGB, mysample_cal)</span></code></pre></div>
<pre><code>      mean     SE
AGB 230.54 4.2224</code></pre>
<p>Another interesting package for model-assisted estimation is package <strong>mase</strong> <span class="citation">(<a href="#ref-mase2018" role="doc-biblioref">McConville et al. 2018</a>)</span>. The regression estimate can be computed with function <code>greg</code>.</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="Modelassisted.html#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mase)</span>
<span id="cb230-2"><a href="Modelassisted.html#cb230-2" aria-hidden="true" tabindex="-1"></a>covars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;lnSWIR2&quot;</span>,<span class="st">&quot;Terra_PP&quot;</span>,<span class="st">&quot;Elevation&quot;</span>)</span>
<span id="cb230-3"><a href="Modelassisted.html#cb230-3" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">greg</span>(<span class="at">y=</span>mysample<span class="sc">$</span>AGB, <span class="at">xsample=</span>mysample[covars],</span>
<span id="cb230-4"><a href="Modelassisted.html#cb230-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">xpop=</span>gridAmazonia[covars], <span class="at">pi=</span><span class="fu">rep</span>(n<span class="sc">/</span>N,n),</span>
<span id="cb230-5"><a href="Modelassisted.html#cb230-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">var_est=</span><span class="cn">TRUE</span>, <span class="at">var_method=</span><span class="st">&quot;LinHTSRS&quot;</span>, <span class="at">model=</span><span class="st">&quot;linear&quot;</span>)</span>
<span id="cb230-6"><a href="Modelassisted.html#cb230-6" aria-hidden="true" tabindex="-1"></a>res<span class="sc">$</span>pop_mean</span></code></pre></div>
<pre><code>[1] 230.5407</code></pre>
<p>The multiple regression estimate is equal to the estimate obtained with function <code>calibrate</code> of package <strong>survey</strong>. The estimated standard error equals</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="Modelassisted.html#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(res<span class="sc">$</span>pop_mean_var)</span></code></pre></div>
<pre><code>         [,1]
[1,] 4.207809</code></pre>
<p>which is slightly smaller than the standard error computed with package <strong>survey</strong>. This standard error is computed by ignoring the g-weights <span class="citation">(<a href="#ref-McConville2020" role="doc-biblioref">McConville 2018</a>)</span>. In an exercise the two approximate standard errors are compared in a sampling experiment.</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="Modelassisted.html#cb234-1" aria-hidden="true" tabindex="-1"></a>mlr <span class="ot">&lt;-</span> <span class="fu">lm</span>(AGB<span class="sc">~</span>lnSWIR2<span class="sc">+</span>Terra_PP<span class="sc">+</span>Elevation,<span class="at">data=</span>mysample)</span>
<span id="cb234-2"><a href="Modelassisted.html#cb234-2" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> <span class="fu">residuals</span>(mlr)</span>
<span id="cb234-3"><a href="Modelassisted.html#cb234-3" aria-hidden="true" tabindex="-1"></a>S2e <span class="ot">&lt;-</span> <span class="fu">var</span>(e)</span>
<span id="cb234-4"><a href="Modelassisted.html#cb234-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(se <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((<span class="dv">1</span><span class="sc">-</span>n<span class="sc">/</span>N)<span class="sc">*</span>S2e<span class="sc">/</span>n))</span></code></pre></div>
</div>
<div id="penalised-least-squares-estimation" class="section level3" number="10.1.2">
<h3><span class="header-section-number">10.1.2</span> Penalised least squares estimation</h3>
<p>In the previous section I first selected a best subset of covariates before using these covariates in estimating the population regression coefficients. The alternative is to skip the selection of the best model, and to estimate the population regression coefficients of <em>all</em> covariates by penalised least squares estimation (PLS). In PLS a penalty equal to the sum of the absolute or squared values of the population regression coefficients is added to the minimisation criterion, see <span class="citation"><a href="#ref-McConville2020" role="doc-biblioref">McConville</a> (<a href="#ref-McConville2020" role="doc-biblioref">2018</a>)</span> for details. PLS is implemented in function <code>gregElasticNet</code> of package <strong>mase</strong>.</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="Modelassisted.html#cb235-1" aria-hidden="true" tabindex="-1"></a>covars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;lnSWIR2&quot;</span>,<span class="st">&quot;Terra_PP&quot;</span>,<span class="st">&quot;Prec_dm&quot;</span>,<span class="st">&quot;Elevation&quot;</span>,<span class="st">&quot;Clay&quot;</span>)</span>
<span id="cb235-2"><a href="Modelassisted.html#cb235-2" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">gregElasticNet</span>(</span>
<span id="cb235-3"><a href="Modelassisted.html#cb235-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y=</span>mysample<span class="sc">$</span>AGB, <span class="at">xsample=</span>mysample[covars],</span>
<span id="cb235-4"><a href="Modelassisted.html#cb235-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">xpop=</span>gridAmazonia[covars], <span class="at">pi=</span><span class="fu">rep</span>(n<span class="sc">/</span>N,n),</span>
<span id="cb235-5"><a href="Modelassisted.html#cb235-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">var_est=</span><span class="cn">TRUE</span>, <span class="at">var_method=</span><span class="st">&quot;LinHTSRS&quot;</span>, <span class="at">model=</span><span class="st">&quot;linear&quot;</span>,</span>
<span id="cb235-6"><a href="Modelassisted.html#cb235-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">lambda=</span><span class="st">&quot;lambda.min&quot;</span>, <span class="at">cvfolds=</span><span class="dv">100</span>)</span>
<span id="cb235-7"><a href="Modelassisted.html#cb235-7" aria-hidden="true" tabindex="-1"></a><span class="fu">signif</span>(res<span class="sc">$</span>coefficients,<span class="dv">4</span>)</span></code></pre></div>
<pre><code>(Intercept)     lnSWIR2    Terra_PP     Prec_dm   Elevation        Clay 
  -71.07000    -2.83800     0.02204     0.52710    -0.03507     0.13630 </code></pre>
<p>All five covariates are used in prediction, but the coefficients associated with these predictors are small except for lnSWIR2.</p>
<p>As shown below, the estimated standard error is considerably larger than the standard error obtained with lnSWIR2, Terra_PP and Elevation as predictors. In this case the elastic net regression estimator works not as well as the multiple regression estimator using the best subset of the covariates.</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="Modelassisted.html#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(res<span class="sc">$</span>pop_mean_var)</span></code></pre></div>
<pre><code>         s1
s1 6.207637</code></pre>
<div id="exercises-15" class="section level4 unnumbered">
<h4>Exercises</h4>
<ol style="list-style-type: decimal">
<li>Write an <strong>R</strong> script to
<ul>
<li>Select a simple random sample without replacement of size 50 from Eastern Amazonia. Compute the regression estimator of the population mean of AGB and its standard error “by hand,” using lnSWIR2 as a covariate (so do not not use package <strong>survey</strong>). Use Equation <a href="Modelassisted.html#eq:VarianceRegressionEstimatorSI">(10.13)</a> to estimate the standard error.<br />
</li>
<li>Use the same sample to compute the regression estimator with functions <code>calibrate</code> and <code>svymean</code> of package <strong>survey</strong>. The regression estimate and its standard error can be extracted from the output object of <code>svymean</code> with methods <code>coef</code> and <code>SE</code>, respectively.</li>
<li>Repeat both estimation procedures 1000 times (write a for-loop). Check that the 2 <span class="math inline">\(\times\)</span> 1000 estimated population means obtained with both estimators are all equal (use function <code>all.equal</code>), and compute summary statistics of the two approximated standard errors. Which approximate standard error estimator has the largest mean value?<br />
</li>
</ul></li>
<li>Write an <strong>R</strong> script to
<ul>
<li>Compute the sampling variance of the simple regression estimator of the mean of AGB, using lnSWIR2 as a covariate, for simple random sampling and sample sizes of 10, 25 and 100, assuming that the population regression coefficients are perfectly known. Hint: fit a simple linear regression model on all data, and compute the population variance of the residuals.<br />
</li>
<li>Select 10,000 times a simple random sample with replacement of size 10 (use a for-loop). Use each sample to estimate the population mean of AGB with the simple regression estimator (using sample estimates of the population regression coefficients), and estimate the approximate variance of the estimator of the mean. Compute the variance of the 10,000 regression estimates and the average of the 10,000 approximate variance estimates. Repeat this for sample sizes 25, 100.<br />
</li>
<li>Compute for each sample size the difference between the experimental variance (variance of the 10,000 regression estimates) and the variance obtained with the population fit of the regression model as a proportion of the experimental variance. Explain what you see.<br />
</li>
<li>Compute for each sample size the difference between the average of the 10,000 approximated variances and the experimental variance, as a proportion of the experimental variance. Explain what you see.</li>
</ul></li>
</ol>
</div>
</div>
<div id="RegressionEstimatorSTSI" class="section level3" number="10.1.3">
<h3><span class="header-section-number">10.1.3</span> Regression estimator with stratified simple random sampling</h3>
<p>With stratified simple random sampling there are two regression estimators, the <em>separate</em> and the <em>combined</em> regression estimator. In the first estimator the regression estimator for simple random sampling is applied at the level of the strata. This implies that for each stratum separately a vector with population regression coefficients <span class="math inline">\(\mathbf{b}_h\)</span> is estimated. The regression estimates of the stratum means are then combined by computing the weighted average, using the relative sizes of the strata as weights:</p>
<p><span class="math display" id="eq:SeparateRegressionEstimator">\[\begin{equation}
\hat{\bar{z}}_{\mathrm{sregr}}=\sum_{h=1}^H w_h \hat{\bar{z}}_{\text{regr,}h} \;,
\tag{10.19}
\end{equation}\]</span></p>
<p>with, for the simple linear estimator</p>
<p><span class="math display" id="eq:RegressionEstimatorStratumMean">\[\begin{equation}
\hat{\bar{z}}_{\text{regr,}h} = \bar{z}_{\mathcal{S}h}+\hat{b}_h\left( \bar{x}_h-\bar{x}_{\mathcal{S}h}\right) \;,
\tag{10.20}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(\bar{z}_{\mathcal{S}h}\)</span> and <span class="math inline">\(\bar{x}_{\mathcal{S}h}\)</span> the stratum sample means of the study variable and covariate, respectively, <span class="math inline">\(\bar{x}_h\)</span> the mean of the covariate in stratum <span class="math inline">\(h\)</span>, and <span class="math inline">\(\hat{b}_h\)</span> the estimated slope coefficient for stratum <span class="math inline">\(h\)</span>.</p>
<p>The variance of this separate regression estimator of the population mean can be estimated by first estimating the variances of the regression estimators of the stratum means using Equation <a href="Modelassisted.html#eq:VarianceRegressionEstimatorSI">(10.13)</a>, and then combining these variances using Equation <a href="STSI.html#eq:EstVarMeanSTSI">(4.4)</a>.</p>
<p>The separate regression estimator is illustrated with Eastern Amazonia. Biomes are used as strata. There are four biomes, the levels of which are given short names using function <code>levels</code>.</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="Modelassisted.html#cb239-1" aria-hidden="true" tabindex="-1"></a>gridAmazonia<span class="sc">$</span>Biome <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(gridAmazonia<span class="sc">$</span>Biome)</span>
<span id="cb239-2"><a href="Modelassisted.html#cb239-2" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(gridAmazonia<span class="sc">$</span>Biome)</span></code></pre></div>
<pre><code>[1] &quot;Mangroves&quot;                                               
[2] &quot;Tropical &amp; Subtropical Dry Broadleaf Forests&quot;            
[3] &quot;Tropical &amp; Subtropical Grasslands, Savannas &amp; Shrublands&quot;
[4] &quot;Tropical &amp; Subtropical Moist Broadleaf Forests&quot;          </code></pre>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="Modelassisted.html#cb241-1" aria-hidden="true" tabindex="-1"></a>biomes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Mangrove&quot;</span>, <span class="st">&quot;Forest.dry&quot;</span>,<span class="st">&quot;Grassland&quot;</span>,<span class="st">&quot;Forest.moist&quot;</span>)</span>
<span id="cb241-2"><a href="Modelassisted.html#cb241-2" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(gridAmazonia<span class="sc">$</span>Biome) <span class="ot">&lt;-</span> biomes</span></code></pre></div>
<p>Moist forest is by far the largest stratum, it covers 92% of the area. Mangrove, Forest.dry and Grassland cover 0.4%, 2.3% and 5.5% of the area, respectively. A stratified simple random sample of size 100 is selected using function <code>strata</code> of package <strong>sampling</strong>, see Chapter <a href="STSI.html#STSI">4</a>. I chose five units as a minimum sample size. Note that the stratum sample sizes are not proportional to their size.</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="Modelassisted.html#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sampling)</span>
<span id="cb242-2"><a href="Modelassisted.html#cb242-2" aria-hidden="true" tabindex="-1"></a>ord <span class="ot">&lt;-</span> <span class="fu">unique</span>(gridAmazonia<span class="sc">$</span>Biome)</span>
<span id="cb242-3"><a href="Modelassisted.html#cb242-3" aria-hidden="true" tabindex="-1"></a>N_h <span class="ot">&lt;-</span>  <span class="fu">table</span>(gridAmazonia<span class="sc">$</span>Biome)</span>
<span id="cb242-4"><a href="Modelassisted.html#cb242-4" aria-hidden="true" tabindex="-1"></a>n_h <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">85</span>)</span>
<span id="cb242-5"><a href="Modelassisted.html#cb242-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">314</span>)</span>
<span id="cb242-6"><a href="Modelassisted.html#cb242-6" aria-hidden="true" tabindex="-1"></a>units <span class="ot">&lt;-</span> sampling<span class="sc">::</span><span class="fu">strata</span>(gridAmazonia, <span class="at">stratanames=</span><span class="st">&quot;Biome&quot;</span>,</span>
<span id="cb242-7"><a href="Modelassisted.html#cb242-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">size=</span>n_h[ord], <span class="at">method=</span><span class="st">&quot;srswor&quot;</span>)</span>
<span id="cb242-8"><a href="Modelassisted.html#cb242-8" aria-hidden="true" tabindex="-1"></a>mysample <span class="ot">&lt;-</span> <span class="fu">getdata</span>(gridAmazonia,units)</span></code></pre></div>
<p>As a first step in estimation, for each stratum the mean of the covariate over all units in a stratum (population mean per stratum) and the sample means of the study variable and covariate are computed.</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="Modelassisted.html#cb243-1" aria-hidden="true" tabindex="-1"></a>mx_h_pop <span class="ot">&lt;-</span> <span class="fu">tapply</span>(gridAmazonia<span class="sc">$</span>lnSWIR2, <span class="at">INDEX=</span>gridAmazonia<span class="sc">$</span>Biome, <span class="at">FUN=</span>mean)</span>
<span id="cb243-2"><a href="Modelassisted.html#cb243-2" aria-hidden="true" tabindex="-1"></a>mzh_sam <span class="ot">&lt;-</span> <span class="fu">tapply</span>(mysample<span class="sc">$</span>AGB, <span class="at">INDEX=</span>mysample<span class="sc">$</span>Biome, <span class="at">FUN=</span>mean)</span>
<span id="cb243-3"><a href="Modelassisted.html#cb243-3" aria-hidden="true" tabindex="-1"></a>mx_h_sam <span class="ot">&lt;-</span> <span class="fu">tapply</span>(mysample<span class="sc">$</span>lnSWIR2, <span class="at">INDEX=</span>mysample<span class="sc">$</span>Biome, <span class="at">FUN=</span>mean)</span></code></pre></div>
<p>The next step is to estimate the regression coefficients per stratum. This is done in a for-loop. The estimated slope coefficient is used to compute the regression estimator per stratum. The residuals are extracted to approximate the variance of the regression estimator per stratum.</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="Modelassisted.html#cb244-1" aria-hidden="true" tabindex="-1"></a>b_h <span class="ot">&lt;-</span> mz_h_regr <span class="ot">&lt;-</span> v_mz_h_regr <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="at">length=</span><span class="dv">4</span>)</span>
<span id="cb244-2"><a href="Modelassisted.html#cb244-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) {</span>
<span id="cb244-3"><a href="Modelassisted.html#cb244-3" aria-hidden="true" tabindex="-1"></a>  subsam <span class="ot">&lt;-</span> <span class="fu">subset</span>(mysample, mysample<span class="sc">$</span>Biome<span class="sc">==</span><span class="fu">levels</span>(gridAmazonia<span class="sc">$</span>Biome)[i])</span>
<span id="cb244-4"><a href="Modelassisted.html#cb244-4" aria-hidden="true" tabindex="-1"></a>  lm_sample <span class="ot">&lt;-</span> <span class="fu">lm</span>(AGB<span class="sc">~</span>lnSWIR2, <span class="at">data=</span>subsam)</span>
<span id="cb244-5"><a href="Modelassisted.html#cb244-5" aria-hidden="true" tabindex="-1"></a>  b_h[i] <span class="ot">&lt;-</span> <span class="fu">coef</span>(lm_sample)[<span class="dv">2</span>]</span>
<span id="cb244-6"><a href="Modelassisted.html#cb244-6" aria-hidden="true" tabindex="-1"></a>  mz_h_regr[i] <span class="ot">&lt;-</span> mzh_sam[i]<span class="sc">+</span>b_h[i]<span class="sc">*</span>(mx_h_pop[i]<span class="sc">-</span>mx_h_sam[i])</span>
<span id="cb244-7"><a href="Modelassisted.html#cb244-7" aria-hidden="true" tabindex="-1"></a>  e <span class="ot">&lt;-</span> <span class="fu">residuals</span>(lm_sample)</span>
<span id="cb244-8"><a href="Modelassisted.html#cb244-8" aria-hidden="true" tabindex="-1"></a>  S2e_h <span class="ot">&lt;-</span> <span class="fu">var</span>(e)</span>
<span id="cb244-9"><a href="Modelassisted.html#cb244-9" aria-hidden="true" tabindex="-1"></a>  v_mz_h_regr[i] <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">-</span>n_h[i]<span class="sc">/</span>N_h[i])<span class="sc">*</span>S2e_h<span class="sc">/</span>n_h[i]</span>
<span id="cb244-10"><a href="Modelassisted.html#cb244-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Finally, the separate regression estimate is computed as a weighted average of the regression estimates per stratum.</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="Modelassisted.html#cb245-1" aria-hidden="true" tabindex="-1"></a>w_h <span class="ot">&lt;-</span> N_h<span class="sc">/</span><span class="fu">sum</span>(N_h)</span>
<span id="cb245-2"><a href="Modelassisted.html#cb245-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(mz_sepreg <span class="ot">&lt;-</span> <span class="fu">sum</span>(w_h<span class="sc">*</span>mz_h_regr))</span></code></pre></div>
<pre><code>[1] 223.9426</code></pre>
<p>The standard error of the separate regression estimator is computed by the square root of the pooled variances of the regression estimator per stratum, using the squared relative size of the strata as weights.</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="Modelassisted.html#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(w_h<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>v_mz_h_regr) <span class="sc">%&gt;%</span> <span class="fu">sqrt</span>(.)</span></code></pre></div>
<pre><code>[1] 5.077558</code></pre>
<p>The separate regression estimator can be computed with package <strong>survey</strong>. The computation of the population totals merits special attention. For the simple regression estimator using <em>simple random sampling</em> these totals are the total number of populations units and the population total of the covariate lnSWIR2. These are the population totals associated with the columns of the design matrix that is constructed with function <code>lm</code> to estimate the regression coefficients. The column with ones results in an estimated intercept, the column with lnSWIR2 values in an estimated slope.</p>
<p>We do not have a simple random sample, but a stratified simple random sample. The model that is fitted now is an ANCOVA model with factor Biome and covariate lnSWIR2.</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="Modelassisted.html#cb249-1" aria-hidden="true" tabindex="-1"></a>ancova <span class="ot">&lt;-</span> <span class="fu">lm</span>(AGB<span class="sc">~</span>Biome<span class="sc">*</span>lnSWIR2, <span class="at">data=</span>mysample)</span></code></pre></div>
<p><strong>R</strong> uses the so-called cornerstone representation of the ANCOVA model. The reference level is stratum Mangrove. The question is what population totals must be assigned to the function <code>calibrate</code> with this ANCOVA model. This can be determined by printing the design matrix that is used to fit the ANCOVA model. Only the first two rows are printed.</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="Modelassisted.html#cb250-1" aria-hidden="true" tabindex="-1"></a>designmat <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(ancova, mysample)</span></code></pre></div>
<pre><code>     (Intercept) BiomeForest.dry BiomeGrassland BiomeForest.moist  lnSWIR2
[1,]           1               0              0                 1 6.307024
[2,]           1               0              0                 1 6.236278
     BiomeForest.dry:lnSWIR2 BiomeGrassland:lnSWIR2 BiomeForest.moist:lnSWIR2
[1,]                       0                      0                  6.307024
[2,]                       0                      0                  6.236278</code></pre>
<p>With this model formulation the first population total is the total number of population units. The second, third and fourth population totals are the number of population units in stratum levels 2, 3 and 4. The fifth population total is the population total of covariate lnSWIR2, and the sixth, seventh and eighth population totals are the totals of covariate lnSWIR2 in stratum levels 2, 3 and 4.</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="Modelassisted.html#cb252-1" aria-hidden="true" tabindex="-1"></a>N_h <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(N_h)</span>
<span id="cb252-2"><a href="Modelassisted.html#cb252-2" aria-hidden="true" tabindex="-1"></a>lut <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Biome=</span>biomes,N_h)</span>
<span id="cb252-3"><a href="Modelassisted.html#cb252-3" aria-hidden="true" tabindex="-1"></a>mysample <span class="ot">&lt;-</span> <span class="fu">merge</span>(<span class="at">x=</span>mysample, <span class="at">y=</span>lut)</span>
<span id="cb252-4"><a href="Modelassisted.html#cb252-4" aria-hidden="true" tabindex="-1"></a>design_stsi <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">id=</span><span class="sc">~</span><span class="dv">1</span>, <span class="at">strata=</span><span class="sc">~</span><span class="fu">factor</span>(Biome), <span class="at">data=</span>mysample, <span class="at">fpc=</span><span class="sc">~</span>N_h)</span>
<span id="cb252-5"><a href="Modelassisted.html#cb252-5" aria-hidden="true" tabindex="-1"></a>tx_pop <span class="ot">&lt;-</span> <span class="fu">sum</span>(gridAmazonia<span class="sc">$</span>lnSWIR2)</span>
<span id="cb252-6"><a href="Modelassisted.html#cb252-6" aria-hidden="true" tabindex="-1"></a>tx_h_pop <span class="ot">&lt;-</span> N_h<span class="sc">*</span>mx_h_pop</span>
<span id="cb252-7"><a href="Modelassisted.html#cb252-7" aria-hidden="true" tabindex="-1"></a>totals <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">sum</span>(N_h),N_h[<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>)],tx_pop,tx_h_pop[<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>)])</span>
<span id="cb252-8"><a href="Modelassisted.html#cb252-8" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(totals) <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">coef</span>(ancova))</span>
<span id="cb252-9"><a href="Modelassisted.html#cb252-9" aria-hidden="true" tabindex="-1"></a>mysample_cal <span class="ot">&lt;-</span> <span class="fu">calibrate</span>(</span>
<span id="cb252-10"><a href="Modelassisted.html#cb252-10" aria-hidden="true" tabindex="-1"></a>  design_stsi, <span class="at">formula=</span><span class="sc">~</span>Biome<span class="sc">*</span>lnSWIR2,</span>
<span id="cb252-11"><a href="Modelassisted.html#cb252-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">population=</span>totals, <span class="at">calfun=</span><span class="st">&quot;linear&quot;</span>)</span>
<span id="cb252-12"><a href="Modelassisted.html#cb252-12" aria-hidden="true" tabindex="-1"></a><span class="fu">svymean</span>(<span class="sc">~</span>AGB, mysample_cal)</span></code></pre></div>
<pre><code>      mean     SE
AGB 223.94 5.8686</code></pre>

<div class="rmdnote">
The line <code>names(totals) &lt;- names(coef(ancova))</code> is not strictly needed. This is just to suppress a warning that the names of the numeric with the population totals does not match the names of the columns of the design matrix. As a consequence we do not need to fit the ANCOVA model either.
</div>
<p>Alternatively, we may use the following formula in function <code>lm</code>.</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="Modelassisted.html#cb254-1" aria-hidden="true" tabindex="-1"></a>ancova2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(AGB<span class="sc">~</span><span class="dv">0</span><span class="sc">+</span>Biome<span class="sc">/</span>lnSWIR2, <span class="at">data=</span>mysample)</span>
<span id="cb254-2"><a href="Modelassisted.html#cb254-2" aria-hidden="true" tabindex="-1"></a>designmat <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(ancova, mysample)</span></code></pre></div>
<pre><code>     (Intercept) BiomeForest.dry BiomeGrassland BiomeForest.moist  lnSWIR2
[1,]           1               0              0                 1 6.307024
[2,]           1               0              0                 1 6.236278
     BiomeForest.dry:lnSWIR2 BiomeGrassland:lnSWIR2 BiomeForest.moist:lnSWIR2
[1,]                       0                      0                  6.307024
[2,]                       0                      0                  6.236278</code></pre>
<p>With this formula the population totals are the number of population units in stratum levels 1, 2, 3 and 4, and the population totals of covariate lnSWIR2 per stratum.</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="Modelassisted.html#cb256-1" aria-hidden="true" tabindex="-1"></a>totals <span class="ot">&lt;-</span> <span class="fu">c</span>(N_h,tx_h_pop)</span>
<span id="cb256-2"><a href="Modelassisted.html#cb256-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(totals) <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">coef</span>(ancova2))</span>
<span id="cb256-3"><a href="Modelassisted.html#cb256-3" aria-hidden="true" tabindex="-1"></a>mysample_cal <span class="ot">&lt;-</span> <span class="fu">calibrate</span>(</span>
<span id="cb256-4"><a href="Modelassisted.html#cb256-4" aria-hidden="true" tabindex="-1"></a>  design_stsi, <span class="at">formula=</span><span class="sc">~</span><span class="dv">0</span><span class="sc">+</span>Biome<span class="sc">/</span>lnSWIR2, <span class="at">population=</span>totals,</span>
<span id="cb256-5"><a href="Modelassisted.html#cb256-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">calfun=</span><span class="st">&quot;linear&quot;</span>)</span>
<span id="cb256-6"><a href="Modelassisted.html#cb256-6" aria-hidden="true" tabindex="-1"></a><span class="fu">svymean</span>(<span class="sc">~</span>AGB, mysample_cal)</span></code></pre></div>
<pre><code>      mean     SE
AGB 223.94 5.8686</code></pre>
<p>Recall the alternative formulation of the regression estimator, Equation <a href="Modelassisted.html#eq:AlternativeRegressionEstimator">(10.16)</a>, and that the sample sum of the <span class="math inline">\(\pi\)</span>-expanded <span class="math inline">\(x\)</span>-values multiplied by the calibrated weights <span class="math inline">\(g_k\)</span> are equal to the population totals. This explains why the population totals should match the columns of the design matrix.</p>
<div id="combined-regression-estimator" class="section level4" number="10.1.3.1">
<h4><span class="header-section-number">10.1.3.1</span> Combined regression estimator</h4>
<p>The alternative to the separate simple regression estimator is the combined simple regression estimator</p>
<p><span class="math display" id="eq:CombinedRegressionEstimator">\[\begin{equation}
\hat{\bar{z}}_{\mathrm{cregr}} = \hat{\bar{z}}_{\pi}+\hat{b}\left( \bar{x}-\hat{\bar{x}}_{\pi}\right) \;,
\tag{10.21}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(\hat{b}\)</span> the estimated slope coefficient, estimated by Equation <a href="Modelassisted.html#eq:EstimatorGREGCoefficients">(10.6)</a>, discarding the variance of the residuals <span class="math inline">\(\sigma^2(\epsilon_k)\)</span> as they are assumed constant, and using the appropriate inclusion probabilities which differ among the strata, and <span class="math inline">\(\hat{\bar{z}}_{\pi}\)</span> and <span class="math inline">\(\hat{\bar{x}}_{\pi}\)</span> the <span class="math inline">\(\pi\)</span> estimators of the population mean of the study variable and the covariate with stratified simple random sampling, respectively. Working <a href="Modelassisted.html#eq:EstimatorGREGCoefficients">(10.6)</a> out for stratified simple random sampling yields</p>
<p><span class="math display" id="eq:bCombinedRegressionEstimator">\[\begin{equation}
\hat{b}=\frac{w^2_h \widehat{S^2}_h(z,x)}{w^2_h \widehat{S^2}_h(x)}
\tag{10.22}
\end{equation}\]</span>
with <span class="math inline">\(\widehat{S^2}_h(z,x)\)</span> the estimated covariance of the study variable and teh covariate in strtaum <span class="math inline">\(h\)</span>, and <span class="math inline">\(\widehat{S^2}_h(x)\)</span> the estimated variance of the covariate.</p>
<p>In the combined simple regression estimator only one regression coefficient <span class="math inline">\(b\)</span> is estimated, the slope coefficient for the entire population. This combined regression estimator is recommended when the stratum sample sizes are small as in our case, so that the estimated regression coefficients per stratum, <span class="math inline">\(\hat{b}_h\)</span>, become unreliable.</p>

<div class="rmdcaution">
Estimator <a href="Modelassisted.html#eq:bCombinedRegressionEstimator">(10.22)</a> is for infinite populations and for stratified simple random sampling with replacement of finite populations. For sampling without replacement from finite populations, finite population corrections <span class="math inline">\(1-n_h/N_h\)</span> must be added to the numerator and denominator of <span class="math inline">\(\hat{b}\)</span> (<span class="citation"><a href="#ref-coc77" role="doc-biblioref">Cochran</a> (<a href="#ref-coc77" role="doc-biblioref">1977</a>)</span>, p. 202).
</div>
<p>The approximate variance of the combined regression estimator can be estimated as follows:</p>
<ol style="list-style-type: decimal">
<li>Compute residuals: <span class="math inline">\(e_k = z_k - (\hat{a} + \hat{b} x_k)\)</span>, with <span class="math inline">\(\hat{a}\)</span> and <span class="math inline">\(\hat{b}\)</span> the estimated regression coefficients for the whole population.<br />
</li>
<li>Estimate for each stratum the variance of the estimator of the mean of the residuals: <span class="math inline">\(\widehat{V}\!\left(\hat{\bar{e}}_h\right)=\widehat{S^{2}}_h(e)/n_h\)</span>, with <span class="math inline">\(\widehat{S^{2}}_h(e)\)</span> the estimated variance of the residuals in stratum <span class="math inline">\(h\)</span>.<br />
</li>
<li>Combine the estimated variances per stratum: <span class="math inline">\(\widehat{V}\!\left(\hat{\bar{z}}_{\text{cregr}}\right)=\sum_{h=1}^Hw^2_h\widehat{V}\!\left(\hat{\bar{e}}_h\right)\)</span>.</li>
</ol>
<p>The next code chunks show the estimation procedure. First the population means of the study variable AGB and of the covariate lnSWIR2 are estimated by the <span class="math inline">\(\pi\)</span> estimator, see Chapter <a href="STSI.html#STSI">4</a>.</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="Modelassisted.html#cb258-1" aria-hidden="true" tabindex="-1"></a>mz_h_HT <span class="ot">&lt;-</span> <span class="fu">tapply</span>(mysample<span class="sc">$</span>AGB, <span class="at">INDEX=</span>mysample<span class="sc">$</span>Biome, <span class="at">FUN=</span>mean)</span>
<span id="cb258-2"><a href="Modelassisted.html#cb258-2" aria-hidden="true" tabindex="-1"></a>mx_h_HT <span class="ot">&lt;-</span> <span class="fu">tapply</span>(mysample<span class="sc">$</span>lnSWIR2, <span class="at">INDEX=</span>mysample<span class="sc">$</span>Biome, <span class="at">FUN=</span>mean)</span>
<span id="cb258-3"><a href="Modelassisted.html#cb258-3" aria-hidden="true" tabindex="-1"></a>mz_HT <span class="ot">&lt;-</span> <span class="fu">sum</span>(w_h<span class="sc">*</span>mz_h_HT)</span>
<span id="cb258-4"><a href="Modelassisted.html#cb258-4" aria-hidden="true" tabindex="-1"></a>mx_HT <span class="ot">&lt;-</span> <span class="fu">sum</span>(w_h<span class="sc">*</span>mx_h_HT)</span></code></pre></div>
<p>The next step is to estimate the population regression coefficients, using Equation <a href="Modelassisted.html#eq:EstimatorGREGCoefficients">(10.6)</a> in which the variances <span class="math inline">\(\sigma^2(\epsilon_k)\)</span> can be dropped, as these are assumed constant. The inclusion probabilities are in the column <code>Prob</code> of <code>mysample</code>.</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="Modelassisted.html#cb259-1" aria-hidden="true" tabindex="-1"></a>W <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="at">x=</span><span class="dv">1</span><span class="sc">/</span>mysample<span class="sc">$</span>Prob, <span class="at">nrow=</span>n, <span class="at">ncol=</span>n)</span>
<span id="cb259-2"><a href="Modelassisted.html#cb259-2" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow=</span>n, <span class="at">ncol=</span><span class="dv">2</span>, <span class="at">data=</span><span class="dv">1</span>)</span>
<span id="cb259-3"><a href="Modelassisted.html#cb259-3" aria-hidden="true" tabindex="-1"></a>X[,<span class="dv">2</span>] <span class="ot">&lt;-</span> mysample<span class="sc">$</span>lnSWIR2</span>
<span id="cb259-4"><a href="Modelassisted.html#cb259-4" aria-hidden="true" tabindex="-1"></a>XWXinv <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">t</span>(X) <span class="sc">%*%</span> W <span class="sc">%*%</span> X)</span>
<span id="cb259-5"><a href="Modelassisted.html#cb259-5" aria-hidden="true" tabindex="-1"></a>XWz <span class="ot">&lt;-</span> <span class="fu">t</span>(X) <span class="sc">%*%</span> W <span class="sc">%*%</span> mysample<span class="sc">$</span>AGB</span>
<span id="cb259-6"><a href="Modelassisted.html#cb259-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ab <span class="ot">&lt;-</span> <span class="fu">t</span>(XWXinv <span class="sc">%*%</span> XWz))</span></code></pre></div>
<pre><code>         [,1]      [,2]
[1,] 1678.268 -226.6772</code></pre>
<p>Note that the same estimates are obtained by model-based estimation, using weighted least squares, based on the assumption of that the variances <span class="math inline">\(\sigma^2(\epsilon_k)\)</span> are proportional to the inclusion probabilities (which is a weird assumption).</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="Modelassisted.html#cb261-1" aria-hidden="true" tabindex="-1"></a>lm_wls <span class="ot">&lt;-</span> <span class="fu">lm</span>(AGB<span class="sc">~</span>lnSWIR2, <span class="at">weights=</span><span class="dv">1</span><span class="sc">/</span>Prob, <span class="at">data=</span>mysample)</span>
<span id="cb261-2"><a href="Modelassisted.html#cb261-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(lm_wls)</span></code></pre></div>
<pre><code>(Intercept)     lnSWIR2 
  1678.2684   -226.6772 </code></pre>

<div class="rmdnote">
In model-based estimation the weights differ among the units because of assumed differences in the variance of the residuals, whereas in design-based estimation we assign different weights to the observations because the units have different inclusion probabilities <span class="citation">(<a href="#ref-loh99" role="doc-biblioref">Lohr 1999</a>)</span>.
</div>
<p>Finally the combined regression estimate is computed.</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="Modelassisted.html#cb263-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(mz_combreg <span class="ot">&lt;-</span> mz_HT<span class="sc">+</span>ab[<span class="dv">2</span>]<span class="sc">*</span>(mx_pop<span class="sc">-</span>mx_HT))</span></code></pre></div>
<pre><code>[1] 224.1433</code></pre>
<p>To approximate the variance of the combined regression estimator first the residuals are computed. Then these residuals are used to estimate the spatial variance of the residuals within the strata, <span class="math inline">\(\widehat{S^{2}}_h(e)\)</span>, and the variance of the estimator of the mean of the residuals, <span class="math inline">\(\widehat{V}\!\left(\hat{\bar{e}}_h\right)\)</span>.</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="Modelassisted.html#cb265-1" aria-hidden="true" tabindex="-1"></a>mysample<span class="sc">$</span>e <span class="ot">&lt;-</span> mysample<span class="sc">$</span>AGB<span class="sc">-</span>(ab[<span class="dv">1</span>]<span class="sc">+</span>ab[<span class="dv">2</span>]<span class="sc">*</span>mysample<span class="sc">$</span>lnSWIR2)</span>
<span id="cb265-2"><a href="Modelassisted.html#cb265-2" aria-hidden="true" tabindex="-1"></a>v_me_h <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="at">length=</span><span class="dv">4</span>)</span>
<span id="cb265-3"><a href="Modelassisted.html#cb265-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) {</span>
<span id="cb265-4"><a href="Modelassisted.html#cb265-4" aria-hidden="true" tabindex="-1"></a>  subsam <span class="ot">&lt;-</span> <span class="fu">subset</span>(mysample, mysample<span class="sc">$</span>Biome<span class="sc">==</span><span class="fu">levels</span>(gridAmazonia<span class="sc">$</span>Biome)[i])</span>
<span id="cb265-5"><a href="Modelassisted.html#cb265-5" aria-hidden="true" tabindex="-1"></a>  S2e_h <span class="ot">&lt;-</span> <span class="fu">var</span>(subsam<span class="sc">$</span>e)</span>
<span id="cb265-6"><a href="Modelassisted.html#cb265-6" aria-hidden="true" tabindex="-1"></a>  v_me_h[i] <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">-</span>n_h[i]<span class="sc">/</span>N_h[i])<span class="sc">*</span>S2e_h<span class="sc">/</span>n_h[i]</span>
<span id="cb265-7"><a href="Modelassisted.html#cb265-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb265-8"><a href="Modelassisted.html#cb265-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(se_mz_combreg <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>(w_h<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>v_me_h)))</span></code></pre></div>
<pre><code>[1] 5.122518</code></pre>
<p>Computing the combined regression estimator with package <strong>survey</strong> proceeds as follows.</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="Modelassisted.html#cb267-1" aria-hidden="true" tabindex="-1"></a>design_stsi <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">id=</span><span class="sc">~</span><span class="dv">1</span>, <span class="at">strata=</span><span class="sc">~</span><span class="fu">factor</span>(Biome), <span class="at">data=</span>mysample, <span class="at">fpc=</span><span class="sc">~</span>N_h)</span>
<span id="cb267-2"><a href="Modelassisted.html#cb267-2" aria-hidden="true" tabindex="-1"></a>totals <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">nrow</span>(gridAmazonia),<span class="fu">sum</span>(gridAmazonia<span class="sc">$</span>lnSWIR2))</span>
<span id="cb267-3"><a href="Modelassisted.html#cb267-3" aria-hidden="true" tabindex="-1"></a>mysample_cal <span class="ot">&lt;-</span> <span class="fu">calibrate</span>(</span>
<span id="cb267-4"><a href="Modelassisted.html#cb267-4" aria-hidden="true" tabindex="-1"></a>  design_stsi, <span class="at">formula=</span><span class="sc">~</span>lnSWIR2, <span class="at">population=</span>totals,</span>
<span id="cb267-5"><a href="Modelassisted.html#cb267-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">calfun=</span><span class="st">&quot;linear&quot;</span>)</span>
<span id="cb267-6"><a href="Modelassisted.html#cb267-6" aria-hidden="true" tabindex="-1"></a><span class="fu">svymean</span>(<span class="sc">~</span>AGB, mysample_cal)</span></code></pre></div>
<pre><code>      mean     SE
AGB 224.14 5.8707</code></pre>
<p>Function <code>calibrate</code> computes the regression estimate and its standard error with the calibrated weights <span class="math inline">\(g_k\)</span> (<span class="citation"><a href="#ref-sar92" role="doc-biblioref">Särndal, Swensson, and Wretman</a> (<a href="#ref-sar92" role="doc-biblioref">1992</a>)</span>, Equation (6.5.12)). This explains the difference between the two standard errors.</p>
<pre><code>[1] 5.870737</code></pre>
</div>
</div>
</div>
<div id="RatioEstimator" class="section level2" number="10.2">
<h2><span class="header-section-number">10.2</span> Ratio estimator</h2>
<p>In some cases it is reasonable to assume that the fitted line passes through the origin. An example is the case study on poppy area in Kandahar (Chapter <a href="pps.html#pps">8</a>). The covariate is the agricultural area within the 5 km <span class="math inline">\(\times\)</span> 5 km squares that serve as sampling units. It is reasonable to assume that when the covariate equals zero, also the poppy area is zero. So, if we have an estimate of the ratio of the total poppy area in the population to the total agricultural area in the population, and besides know the total agricultural area in the population, the total poppy area in the population can be estimated by multiplying the estimated ratio with the known population total agricultural area:</p>
<p><span class="math display" id="eq:RatioEstimator">\[\begin{equation}
\hat{t}_{\mathrm{ratio}}(z)=\frac{\hat{t}_{\pi}(z)}{\hat{t}_{\pi}(x)} \;t(x) =  \hat{b} \;t(x)\;,
\tag{10.23}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(\hat{t}_{\pi}(z)\)</span> and <span class="math inline">\(\hat{t}_{\pi}(x)\)</span> the <span class="math inline">\(\pi\)</span> estimators of the total of the study variable (poppy area) and ancillary variable (agricultural area), respectively, and <span class="math inline">\(t(x)\)</span> the total of the ancillary variable, which must be known.</p>
<p>The working model of the ratio estimator is a heteroscedastic model, i.e. a model with non-constant variance, without intercept (see Exercise 3, hereafter):</p>
<p><span class="math display" id="eq:ratiomodel">\[\begin{equation}
\begin{split}
Z(x_k) &amp;= \beta \;x_k  + \epsilon_k \\
\sigma^2(\epsilon_k) &amp;= \sigma^2 x_k
\end{split}
\;,
\tag{10.24}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(\beta\)</span> the slope of the line, and <span class="math inline">\(\sigma^2\)</span> a constant (variance of residual for <span class="math inline">\(x_k = 1\)</span>). The residual variance is assumed proportional to the covariate <span class="math inline">\(x\)</span>.</p>
<p>Equation <a href="Modelassisted.html#eq:RatioEstimator">(10.23)</a> is a general estimator that can be used for any probability sampling design, not only for simple random sampling. For simple random sampling the coefficient <span class="math inline">\(b\)</span> is estimated by the ratio of the sample means of <span class="math inline">\(z\)</span> and <span class="math inline">\(x\)</span>.</p>
<p>For simple random sampling the sampling variance of the ratio estimator of the population total can be approximated by</p>
<p><span class="math display" id="eq:VarianceRatioEstimatorSI">\[\begin{equation}
\widehat{V}\!\left(\hat{t}_{\mathrm{ratio}}(z)\right)=N^2\frac{\widehat{S^{2}}(e)}{n} \;,
\tag{10.25}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(\widehat{S^{2}}(e)\)</span> the estimated variance of the residuals <span class="math inline">\(e_k=z_k-\hat{b}x_k\)</span>:</p>
<p><span class="math display" id="eq:VarianceResidualsRatioEstimator">\[\begin{equation}
\widehat{S^{2}}(e)=\frac{1}{n-1}\sum_{k \in \mathcal{S}}e_k^2 \;.
\tag{10.26}
\end{equation}\]</span></p>
<p>For simple random sampling without replacement from finite populations Equation <a href="Modelassisted.html#eq:VarianceRatioEstimatorSI">(10.25)</a> must be multiplied by <span class="math inline">\(\left(1-\frac{n}{N}\right)\)</span>.</p>
<p>In <strong>R</strong> the ratio estimator for the total poppy area and the estimator of its variance for a simple random sample without replacement can be computed as follows.</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="Modelassisted.html#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;data/Kandahar.RData&quot;</span>)</span>
<span id="cb270-2"><a href="Modelassisted.html#cb270-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb270-3"><a href="Modelassisted.html#cb270-3" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fu">nrow</span>(grdKandahar)</span>
<span id="cb270-4"><a href="Modelassisted.html#cb270-4" aria-hidden="true" tabindex="-1"></a>units <span class="ot">&lt;-</span> <span class="fu">sample.int</span>(N, <span class="at">size=</span>n, <span class="at">replace=</span><span class="cn">FALSE</span>)</span>
<span id="cb270-5"><a href="Modelassisted.html#cb270-5" aria-hidden="true" tabindex="-1"></a>mysample <span class="ot">&lt;-</span> grdKandahar[units,]</span>
<span id="cb270-6"><a href="Modelassisted.html#cb270-6" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">mean</span>(mysample<span class="sc">$</span>poppy)<span class="sc">/</span><span class="fu">mean</span>(mysample<span class="sc">$</span>agri)</span>
<span id="cb270-7"><a href="Modelassisted.html#cb270-7" aria-hidden="true" tabindex="-1"></a>tx_pop <span class="ot">&lt;-</span> <span class="fu">sum</span>(grdKandahar<span class="sc">$</span>agri)</span>
<span id="cb270-8"><a href="Modelassisted.html#cb270-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(tz_ratio <span class="ot">&lt;-</span> b<span class="sc">*</span>tx_pop)</span></code></pre></div>
<pre><code>[1] 55009.69</code></pre>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="Modelassisted.html#cb272-1" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> mysample<span class="sc">$</span>poppy<span class="sc">-</span>b<span class="sc">*</span>mysample<span class="sc">$</span>agri</span>
<span id="cb272-2"><a href="Modelassisted.html#cb272-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(se_tz_ratio <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(N<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>(n<span class="sc">/</span>N))<span class="sc">*</span><span class="fu">var</span>(e)<span class="sc">/</span>n))</span></code></pre></div>
<pre><code>[1] 18847.31</code></pre>
<p>An improved variance approximation is obtained with Equation <a href="Modelassisted.html#eq:AlternativeVarianceRegressionEstimator">(10.18)</a>. For the ratio model and simple random sampling the calibrated weights are equal to (<span class="citation"><a href="#ref-sar92" role="doc-biblioref">Särndal, Swensson, and Wretman</a> (<a href="#ref-sar92" role="doc-biblioref">1992</a>)</span>, p. 248)</p>
<p><span class="math display" id="eq:weightsratiomodel">\[\begin{equation}
g = \frac{t(x)}{\hat{t}_{\pi}(x)} \;,
\tag{10.27}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(t(x)\)</span> the population total of the covariate, and <span class="math inline">\(\hat{t}_{\pi}(x)\)</span> the <span class="math inline">\(\pi\)</span> estimate of the population total of the covariate.</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="Modelassisted.html#cb274-1" aria-hidden="true" tabindex="-1"></a>pi <span class="ot">&lt;-</span> n<span class="sc">/</span>N</span>
<span id="cb274-2"><a href="Modelassisted.html#cb274-2" aria-hidden="true" tabindex="-1"></a>tx_HT <span class="ot">&lt;-</span> <span class="fu">sum</span>(mysample<span class="sc">$</span>agri<span class="sc">/</span>pi)</span>
<span id="cb274-3"><a href="Modelassisted.html#cb274-3" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> tx_pop<span class="sc">/</span>tx_HT</span>
<span id="cb274-4"><a href="Modelassisted.html#cb274-4" aria-hidden="true" tabindex="-1"></a>S2ge <span class="ot">&lt;-</span> <span class="fu">sum</span>(g<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>e<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>(n<span class="dv">-1</span>)</span>
<span id="cb274-5"><a href="Modelassisted.html#cb274-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(se_tz_ratio <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(N<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>n<span class="sc">/</span>N)<span class="sc">*</span>S2ge<span class="sc">/</span>n))</span></code></pre></div>
<pre><code>[1] 17149.62</code></pre>
<p>The ratio estimate and the estimated standard error of the ratio estimator can be computed with package <strong>survey</strong> as follows.</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="Modelassisted.html#cb276-1" aria-hidden="true" tabindex="-1"></a>mysample<span class="sc">$</span>N <span class="ot">&lt;-</span>N</span>
<span id="cb276-2"><a href="Modelassisted.html#cb276-2" aria-hidden="true" tabindex="-1"></a>design_si <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">id=</span><span class="sc">~</span><span class="dv">1</span>, <span class="at">data=</span>mysample, <span class="at">fpc=</span><span class="sc">~</span>N)</span>
<span id="cb276-3"><a href="Modelassisted.html#cb276-3" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">svyratio</span>(<span class="sc">~</span>poppy, <span class="sc">~</span>agri, <span class="at">design=</span>design_si)</span>
<span id="cb276-4"><a href="Modelassisted.html#cb276-4" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(b, <span class="at">total=</span>tx_pop)</span></code></pre></div>
<pre><code>$total
          agri
poppy 55009.69

$se
          agri
poppy 17149.62</code></pre>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:SamplingDistributionRatio"></span>
<img src="SpatialSampling_files/figure-html/SamplingDistributionRatio-1.png" alt="Sampling distribution of ratio estimator and $\pi$ estimator of total poppy area (ha) in Kandahar with simple random sampling of size 50." width="80%" />
<p class="caption">
Figure 10.3: Sampling distribution of ratio estimator and <span class="math inline">\(\pi\)</span> estimator of total poppy area (ha) in Kandahar with simple random sampling of size 50.
</p>
</div>
<p>Figure <a href="Modelassisted.html#fig:SamplingDistributionRatio">10.3</a> shows the sampling distribution of the ratio estimator and <span class="math inline">\(\pi\)</span> estimator, obtained by repeating simple random sampling of size 50 and estimation 10,000 times. The average of the 10,000 ratio estimates of the total poppy area equals 62512. The population total of poppy equals 63038, so the estimated bias of the ratio estimator equals -526. The boxplots in Figure <a href="Modelassisted.html#fig:SamplingDistributionRatio">10.3</a> show that the ratio estimator has less extreme outliers. The standard deviation of the 10,000 ratio estimates equals 24177. The gain in precision due to the ratio estimator, quantified by the ratio of the variance of the <span class="math inline">\(\pi\)</span> estimator to the variance of the ratio estimator equals 1.5.</p>
<div id="exercises-16" class="section level4 unnumbered">
<h4>Exercises</h4>
<ol start="3" style="list-style-type: decimal">
<li>Write an <strong>R</strong> script to compute the ratio of the population total poppy area and population total agricultural area (<span class="math inline">\(t(z)/t(x)\)</span>). Then use all data to fit a linear model without intercept for the poppy area, using the agricultural area as a covariate, assuming that the variance of the residuals is proportional to the agricultural area (heteroscedastic model). Hint: use function <code>lm</code> with argument <code>formula = poppy ~ agri-1</code> and argument <code>weights=1/agri</code>. Also fit a model without intercept, assuming a constant variance of the residuals (homoscedastic model). Compare the estimated slopes of the two models with the ratio of the total poppy area and total agricultural area.</li>
</ol>
</div>
<div id="RatioEstimatorSTSI" class="section level3" number="10.2.1">
<h3><span class="header-section-number">10.2.1</span> Ratio estimators with stratified simple random sampling</h3>
<p>With stratified simple random sampling, there are, similar to the regression estimator, two options: either estimate the ratios separately for the strata, or estimate a combined ratio. The separate ratio estimator of the population total is</p>
<p><span class="math display" id="eq:SeparateRatioEstimatorSTSI">\[\begin{equation}
\hat{t}_{\mathrm{sratio}}(z)=\sum_{h=1}^H \hat{t}_{\mathrm{ratio},h}(z) \;,
\tag{10.28}
\end{equation}\]</span></p>
<p>with</p>
<p><span class="math display" id="eq:RatioEstimatorStratumTotal">\[\begin{equation}
\hat{t}_{\mathrm{ratio},h}(z)=\frac{\hat{t}_{\pi,h}(z)}{\hat{t}_{\pi,h}(x)} t_h(x) \;,
\tag{10.29}
\end{equation}\]</span></p>
<p>in which <span class="math inline">\(\hat{t}_{\pi,h}(z)\)</span> and <span class="math inline">\(\hat{t}_{\pi,h}(x)\)</span> are the <span class="math inline">\(\pi\)</span> estimators of the population total of the study variable and the covariate for stratum <span class="math inline">\(h\)</span>, respectively.</p>
<p>The combined ratio estimator is</p>
<p><span class="math display" id="eq:CombinedRatioEstimatorSTSI">\[\begin{equation}
\hat{t}_{\mathrm{cratio}}(z)=\frac{\sum_{h=1}^H\hat{t}_{\pi,h}(z)}{\sum_{h=1}^H\hat{t}_{\pi,h}(x)} t(x) \;.
\tag{10.30}
\end{equation}\]</span></p>
<p>The code chunks below show how the combined and separate regression estimate can be computed with package <strong>survey</strong>. First two equal-sized strata are computed using the median of the covariate <code>agri</code> as a stratum break. Stratum sample sizes are computed, and a stratified simple random sample without replacement is selected.</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="Modelassisted.html#cb278-1" aria-hidden="true" tabindex="-1"></a>breaks <span class="ot">&lt;-</span> <span class="fu">quantile</span>(grdKandahar<span class="sc">$</span>agri,<span class="at">probs=</span><span class="fl">0.5</span>)</span>
<span id="cb278-2"><a href="Modelassisted.html#cb278-2" aria-hidden="true" tabindex="-1"></a>grdKandahar<span class="sc">$</span>stratum <span class="ot">&lt;-</span> <span class="fu">findInterval</span>(grdKandahar<span class="sc">$</span>agri,breaks)<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb278-3"><a href="Modelassisted.html#cb278-3" aria-hidden="true" tabindex="-1"></a>N_h <span class="ot">&lt;-</span>  <span class="fu">table</span>(grdKandahar<span class="sc">$</span>stratum)</span>
<span id="cb278-4"><a href="Modelassisted.html#cb278-4" aria-hidden="true" tabindex="-1"></a>n_h <span class="ot">&lt;-</span> <span class="fu">round</span>(n<span class="sc">*</span>N_h<span class="sc">/</span><span class="fu">sum</span>(N_h))</span>
<span id="cb278-5"><a href="Modelassisted.html#cb278-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">314</span>)</span>
<span id="cb278-6"><a href="Modelassisted.html#cb278-6" aria-hidden="true" tabindex="-1"></a>units <span class="ot">&lt;-</span> sampling<span class="sc">::</span><span class="fu">strata</span>(grdKandahar, <span class="at">stratanames=</span><span class="st">&quot;stratum&quot;</span>,</span>
<span id="cb278-7"><a href="Modelassisted.html#cb278-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">size=</span>n_h, <span class="at">method=</span><span class="st">&quot;srswor&quot;</span>)</span>
<span id="cb278-8"><a href="Modelassisted.html#cb278-8" aria-hidden="true" tabindex="-1"></a>mysample <span class="ot">&lt;-</span> <span class="fu">getdata</span>(grdKandahar,units)</span></code></pre></div>
<p>The stratum sizes <code>N_h</code> are added to <code>mysample</code>, function <code>svydesign</code> specifies the sampling design, function <code>svyratio</code> estimates the population ratio and its variance, and finally function <code>predict</code> estimates the population total.</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="Modelassisted.html#cb279-1" aria-hidden="true" tabindex="-1"></a>lut <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">stratum=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),N_h)</span>
<span id="cb279-2"><a href="Modelassisted.html#cb279-2" aria-hidden="true" tabindex="-1"></a>mysample <span class="ot">&lt;-</span> <span class="fu">merge</span>(<span class="at">x=</span>mysample, <span class="at">y=</span>lut)</span>
<span id="cb279-3"><a href="Modelassisted.html#cb279-3" aria-hidden="true" tabindex="-1"></a>design_stsi <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">id=</span><span class="sc">~</span><span class="dv">1</span>,<span class="at">strata=</span><span class="sc">~</span>stratum, <span class="at">data=</span>mysample, <span class="at">fpc=</span><span class="sc">~</span>Freq)</span>
<span id="cb279-4"><a href="Modelassisted.html#cb279-4" aria-hidden="true" tabindex="-1"></a>common <span class="ot">&lt;-</span> <span class="fu">svyratio</span>(<span class="sc">~</span>poppy, <span class="sc">~</span>agri, design_stsi, <span class="at">separate=</span><span class="cn">FALSE</span>)</span>
<span id="cb279-5"><a href="Modelassisted.html#cb279-5" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(common, <span class="at">total=</span><span class="fu">sum</span>(grdKandahar<span class="sc">$</span>agri))</span></code></pre></div>
<pre><code>$total
          agri
poppy 28389.02

$se
          agri
poppy 8845.847</code></pre>
<p>The same estimate is obtained with function <code>calibrate</code>.</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="Modelassisted.html#cb281-1" aria-hidden="true" tabindex="-1"></a>mysample_cal <span class="ot">&lt;-</span> <span class="fu">calibrate</span>(design_stsi, <span class="sc">~</span>agri<span class="dv">-1</span>, <span class="at">population=</span>tx_pop, <span class="at">variance=</span><span class="dv">1</span>)</span>
<span id="cb281-2"><a href="Modelassisted.html#cb281-2" aria-hidden="true" tabindex="-1"></a><span class="fu">svytotal</span>(<span class="sc">~</span>poppy, mysample_cal)</span></code></pre></div>
<pre><code>      total     SE
poppy 28389 8845.8</code></pre>
<p>Computing the separate ratio estimator goes along the same lines. Function <code>svyratio</code> with argument <code>separate = TRUE</code> estimates the ratio and its variance for each stratum separately. To predict the population total the stratum totals of the covariate must be assigned to argument <code>total</code> of function <code>predict</code>.</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="Modelassisted.html#cb283-1" aria-hidden="true" tabindex="-1"></a>separate <span class="ot">&lt;-</span> <span class="fu">svyratio</span>(<span class="sc">~</span>poppy, <span class="sc">~</span>agri, design_stsi, <span class="at">separate=</span><span class="cn">TRUE</span>)</span>
<span id="cb283-2"><a href="Modelassisted.html#cb283-2" aria-hidden="true" tabindex="-1"></a>tx_h_pop <span class="ot">&lt;-</span> <span class="fu">tapply</span>(grdKandahar<span class="sc">$</span>agri, <span class="at">INDEX=</span>grdKandahar<span class="sc">$</span>stratum, <span class="at">FUN=</span>sum)</span>
<span id="cb283-3"><a href="Modelassisted.html#cb283-3" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(separate, <span class="at">total=</span>tx_h_pop)</span></code></pre></div>
<pre><code>$total
          agri
poppy 28331.32

$se
          agri
poppy 8882.492</code></pre>
</div>
<div id="PoststratifiedEstimator" class="section level3" number="10.2.2">
<h3><span class="header-section-number">10.2.2</span> Poststratified estimator</h3>
<p>In stratified random sampling (Chapter <a href="STSI.html#STSI">4</a>) the population is divided into several disjoint subpopulations, and from each subpopulation a probability sample is selected. The subpopulations then serve as strata. The larger the difference in the stratum means and the smaller the variance within the strata, the larger the gain in precision compared to simple random sampling, see Section <a href="STSI.html#WhyStratify">4.1.2</a>.</p>
<p>The alternative to using the subpopulations as strata at the stage of sampling is to use them as poststrata in estimating the population mean. For instance, if we have selected a simple random sample from a spatial population, and we have a map of subpopulations possibly related to the study variable, then these subpopulations still can be used in the poststratified estimator. What only needs to be done is to classify the selected units. Hereafter the subpopulations that serve as poststrata are referred to as groups.</p>
<p>For any probability sampling design the population mean can be estimated by</p>
<p><span class="math display" id="eq:PostStratifiedEstimator">\[\begin{equation}
\hat{\bar{z}}_{\text{pos}}=
\sum_{g=1}^{G} w_{g}\frac{\hat{t}_g(z)}{\widehat{N}_{g}} =
\sum_{g=1}^{G} w_{g}\frac{\sum_{k \in \mathcal{S}_g}\frac{z_{k}}{\pi_k}}
{\sum_{k \in \mathcal{S}_g}\frac{1}{\pi_k}} \;,
\tag{10.31}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(\mathcal{S}_g\)</span> is the sample from group <span class="math inline">\(g\)</span>, <span class="math inline">\(w_{g}=N_g/N\)</span> is the relative size of group <span class="math inline">\(g\)</span>, <span class="math inline">\(\hat{t}_g(z)\)</span> is the estimated total of the study variable for group <span class="math inline">\(g\)</span>, <span class="math inline">\(\widehat{N}_{g}\)</span> is the estimator of the size of group <span class="math inline">\(g\)</span>, <span class="math inline">\(n_{g}\)</span> is the number of sampling units in group <span class="math inline">\(g\)</span> and <span class="math inline">\(\pi_{k}\)</span> is the inclusion probability of unit <span class="math inline">\(k\)</span>. The estimated group means are weighted by their relative sizes <span class="math inline">\(w_{g}\)</span>, which are assumed to be known. In spite of this, the group means are estimated by dividing the estimated group totals by their  size, <span class="math inline">\(\widehat{N}_{g}\)</span>, because this ratio estimator is more precise than the <span class="math inline">\(\pi\)</span> estimator of the group mean.</p>
<p>The poststratified estimator is the natural estimator for the one-way ANOVA model,</p>
<p><span class="math display" id="eq:ANOVAmodel">\[\begin{equation}
\begin{split}
Z_k &amp;= \mu_g  + \epsilon_k \\
\sigma^2_k &amp;= \sigma^2_g
\end{split}
\;,
\tag{10.32}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(\mu_g\)</span> the mean for group (subpopulation) <span class="math inline">\(g=1, \dots , G\)</span>, and <span class="math inline">\(\sigma^2_g\)</span> the variance of the study variable of group <span class="math inline">\(g\)</span>.</p>
<p>For simple random sampling, the poststratified estimator reduces to</p>
<p><span class="math display" id="eq:PostStratifiedEstimatorSI">\[\begin{equation}
\hat{\bar{z}}_{\text{pos}}=\sum_{g=1}^{G}w_{g}\,\bar{z}_{\mathcal{S}_g} \;,
\tag{10.33}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(\bar{z}_{\mathcal{S}_g}\)</span> is the sample mean of group <span class="math inline">\(g\)</span>. If for all groups we have at least two sampling units, <span class="math inline">\(n_g \geq 2\)</span>, the variance of this poststratified estimator of the mean can be estimated by</p>
<p><span class="math display" id="eq:CondVarPostStratifiedEstimator">\[\begin{equation}
\widehat{V}\!\left(\hat{\bar{z}}_{\text{pos}}|\mathbf{n}_g\right)=
\sum_{g=1}^{G}w_{g}^{2}\frac{\widehat{S_{g}^{2}}}{n_{g}} \;,
\tag{10.34}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(\widehat{S_{g}^{2}}\)</span> is the estimated spatial variance of <span class="math inline">\(z\)</span> in
group <span class="math inline">\(g\)</span>, which for simple random sampling can be estimated by</p>
<p><span class="math display" id="eq:S2g">\[\begin{equation}
\widehat{S_{g}^{2}}=\frac{1}{n_{g}-1}\sum_{k \in \mathcal{S}_g}(z_{k}-\bar{z}_{\mathcal{S}_g})^{2} \;.
\tag{10.35}
\end{equation}\]</span></p>
<p>This is an estimator of the <em>conditional</em> sampling variance, i.e. the variance of the poststratified estimator over all simple random samples with group sample sizes, collected in the vector <span class="math inline">\(\mathbf{n}_g\)</span>, equal to the group sample sizes in the sample actually selected. The poststratified estimator requires that the sizes (area) of the strata are known. See Section <a href="Twophase.html#TwophaseStratification">11.1</a> for a sampling strategy that does not require known stratum sizes.</p>
<p>The poststratified estimator is illustrated with study area Voorst. We consider the situation that we do not have the map with the five combinations of soil type and land use that served as strata in Chapter <a href="STSI.html#STSI">4</a>. The soil type - land use classes (groups) used in the poststratified estimator are only observed at the selected sampling units. Only three poststrata are distinguished: the original strata BA, EA and PA are merged into one stratum SA with function <code>fct_collapse</code> of package <strong>forcats</strong> <span class="citation">(<a href="#ref-forcats" role="doc-biblioref">Wickham 2020</a>)</span>. The sizes of these poststrata must be known.</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="Modelassisted.html#cb285-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;data/Voorst.RData&quot;</span>)</span>
<span id="cb285-2"><a href="Modelassisted.html#cb285-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats)</span>
<span id="cb285-3"><a href="Modelassisted.html#cb285-3" aria-hidden="true" tabindex="-1"></a>grdVoorst<span class="sc">$</span>poststratum <span class="ot">&lt;-</span> <span class="fu">fct_collapse</span>(grdVoorst<span class="sc">$</span>stratum, <span class="at">SA=</span><span class="fu">c</span>(<span class="st">&quot;BA&quot;</span>,<span class="st">&quot;EA&quot;</span>,<span class="st">&quot;PA&quot;</span>))</span>
<span id="cb285-4"><a href="Modelassisted.html#cb285-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(N_g <span class="ot">&lt;-</span> <span class="fu">tapply</span>(grdVoorst<span class="sc">$</span>z, <span class="at">INDEX=</span>grdVoorst<span class="sc">$</span>poststratum, <span class="at">FUN=</span>length))</span></code></pre></div>
<pre><code>  SA   RA   XF 
5523  659 1346 </code></pre>
<p>One hundred points are selected by simple random sampling with replacement. The expected sample sizes per group are proportional to the size of the groups, <span class="math inline">\(E(n_g/n) = N_g/N\)</span>), but for a single sample the sample proportions may deviate considerably from the population proportions.</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="Modelassisted.html#cb287-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb287-2"><a href="Modelassisted.html#cb287-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fu">nrow</span>(grdVoorst)</span>
<span id="cb287-3"><a href="Modelassisted.html#cb287-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">314</span>)</span>
<span id="cb287-4"><a href="Modelassisted.html#cb287-4" aria-hidden="true" tabindex="-1"></a>units <span class="ot">&lt;-</span> <span class="fu">sample.int</span>(N, <span class="at">size=</span>n, <span class="at">replace=</span><span class="cn">TRUE</span>)</span>
<span id="cb287-5"><a href="Modelassisted.html#cb287-5" aria-hidden="true" tabindex="-1"></a>mysample <span class="ot">&lt;-</span> grdVoorst[units,]</span>
<span id="cb287-6"><a href="Modelassisted.html#cb287-6" aria-hidden="true" tabindex="-1"></a>n_g <span class="ot">&lt;-</span> <span class="fu">tapply</span>(mysample<span class="sc">$</span>z, <span class="at">INDEX=</span>mysample<span class="sc">$</span>poststratum, <span class="at">FUN=</span>length)</span>
<span id="cb287-7"><a href="Modelassisted.html#cb287-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(n_g)</span></code></pre></div>
<pre><code>SA RA XF 
71  6 23 </code></pre>
<p>The population mean is estimated by first computing the sample means per group, followed by computing the weighted average of the sample means, using the relative sizes of the groups as weights.</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="Modelassisted.html#cb289-1" aria-hidden="true" tabindex="-1"></a>mz_g <span class="ot">&lt;-</span> <span class="fu">tapply</span>(mysample<span class="sc">$</span>z, <span class="at">INDEX=</span>mysample<span class="sc">$</span>poststratum, <span class="at">FUN=</span>mean)</span>
<span id="cb289-2"><a href="Modelassisted.html#cb289-2" aria-hidden="true" tabindex="-1"></a>w_g <span class="ot">&lt;-</span> N_g<span class="sc">/</span>N</span>
<span id="cb289-3"><a href="Modelassisted.html#cb289-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(mz_pst <span class="ot">&lt;-</span> <span class="fu">sum</span>(w_g<span class="sc">*</span>mz_g))</span></code></pre></div>
<pre><code>[1] 8.049562</code></pre>
<p>The variance of the estimator of the mean is estimated by computing the sample variances per group, dividing these by the sample sizes per group, and computing the weighted average, using as weights the squared relative group sizes. This estimated sampling variance is the variance of the estimator of the mean over all simple random samples with 71 units of group SA, 6 units of group RA and 23 units of XF.</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="Modelassisted.html#cb291-1" aria-hidden="true" tabindex="-1"></a>S2z_g <span class="ot">&lt;-</span> <span class="fu">tapply</span>(mysample<span class="sc">$</span>z, <span class="at">INDEX=</span>mysample<span class="sc">$</span>poststratum, <span class="at">FUN=</span>var)</span>
<span id="cb291-2"><a href="Modelassisted.html#cb291-2" aria-hidden="true" tabindex="-1"></a>v_mz_g <span class="ot">&lt;-</span> S2z_g<span class="sc">/</span><span class="fu">as.numeric</span>(n_g)</span>
<span id="cb291-3"><a href="Modelassisted.html#cb291-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(condse_mz_pst <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>(w_g<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>v_mz_g)))</span></code></pre></div>
<pre><code>[1] 0.3540979</code></pre>
<p>Note that this variance estimator can only be computed with at least two units per group. For that reason, I recommend to use a limited number of groups, especially for small sample sizes.</p>
<p>Function <code>postStratify</code> of package <strong>survey</strong> can be used to compute the poststratified estimator, and its standard error.</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="Modelassisted.html#cb293-1" aria-hidden="true" tabindex="-1"></a>mysample<span class="sc">$</span>weights <span class="ot">&lt;-</span> N<span class="sc">/</span>n</span>
<span id="cb293-2"><a href="Modelassisted.html#cb293-2" aria-hidden="true" tabindex="-1"></a>design_si <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">id=</span><span class="sc">~</span><span class="dv">1</span>, <span class="at">weights=</span><span class="sc">~</span>weights, <span class="at">data=</span>mysample)</span>
<span id="cb293-3"><a href="Modelassisted.html#cb293-3" aria-hidden="true" tabindex="-1"></a>pop <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">poststratum=</span><span class="fu">c</span>(<span class="st">&quot;SA&quot;</span>,<span class="st">&quot;RA&quot;</span>,<span class="st">&quot;XF&quot;</span>), <span class="at">Freq=</span>N_g)</span>
<span id="cb293-4"><a href="Modelassisted.html#cb293-4" aria-hidden="true" tabindex="-1"></a>mysample_pst <span class="ot">&lt;-</span> <span class="fu">postStratify</span>(design_si, <span class="at">strata=</span><span class="sc">~</span>poststratum, <span class="at">population=</span>pop)</span>
<span id="cb293-5"><a href="Modelassisted.html#cb293-5" aria-hidden="true" tabindex="-1"></a><span class="fu">svymean</span>(<span class="sc">~</span>z, mysample_pst)</span></code></pre></div>
<pre><code>    mean     SE
z 8.0496 0.3492</code></pre>

<div class="rmdwarning">
<span class="citation"><a href="#ref-loh99" role="doc-biblioref">Lohr</a> (<a href="#ref-loh99" role="doc-biblioref">1999</a>)</span> warns for data snooping. By defining groups after analyzing the data, arbitrarily small sampling variances of the estimated mean can be obtained.
</div>
</div>
</div>
<div id="RandomForest" class="section level2" number="10.3">
<h2><span class="header-section-number">10.3</span> Model-assisted estimation using machine learning techniques</h2>
<p><span class="citation"><a href="#ref-Breidt2017" role="doc-biblioref">Breidt and Opsomer</a> (<a href="#ref-Breidt2017" role="doc-biblioref">2017</a>)</span> review model-assisted estimators based on machine learning techniques. Of special interest is the general approach proposed by <span class="citation"><a href="#ref-Wu2001" role="doc-biblioref">Wu and Sitter</a> (<a href="#ref-Wu2001" role="doc-biblioref">2001</a>)</span> for incorporating non-linear predictions in the model-assisted estimator. They show how non-linear predictions of the study variable, for instance obtained by a regression tree or random forest, can be used in the model-calibration estimator,</p>
<p><span class="math display" id="eq:ModelCalibrationEstimator">\[\begin{equation}
\hat{\bar{z}}_{\mathrm{MC}}= \hat{\bar{z}}_{\pi} + \hat{a}\left(1-\frac{1}{N}\sum_{k \in \mathcal{S}}\frac{1}{\pi_k}\right)+ \hat{b}\left(\frac{1}{N}\sum_{k=1}^N \hat{m}(\mathbf{x}_k) - \frac{1}{N}\sum_{k \in \mathcal{S}} \frac{\hat{m}(\mathbf{x}_k)}{\pi_k} \right)
\;,
\tag{10.36}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(\hat{b}\)</span> a slope coefficient estimated by</p>
<p><span class="math display" id="eq:SlopeCalibrationEstimator">\[\begin{equation}
\hat{b} = \frac{\sum_{k \in \mathcal{S}} 1/\pi_k \{\hat{m}(\mathbf{x}_k)-\hat{\bar{m}}_{\pi}\} \{z_k-\hat{\bar{z}}_{\pi}\}}{\sum_{k \in \mathcal{S}} 1/\pi_k \{\hat{m}(\mathbf{x}_k)-\hat{\bar{m}}_{\pi}\}^2}\;,
\tag{10.37}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(\hat{\bar{z}}_{\pi}\)</span> the <span class="math inline">\(\pi\)</span> estimator of the population mean of the study variable, <span class="math inline">\(\hat{\bar{m}}_{\pi}\)</span> the <span class="math inline">\(\pi\)</span> estimator of the population mean of the predicted values, and <span class="math inline">\(\hat{a}\)</span> an intercept estimated by</p>
<p><span class="math display" id="eq:InterceptCalibrationEstimator">\[\begin{equation}
\hat{a} = (1-\hat{b})\left(\frac{1}{N}\sum_{k \in \mathcal{S}}\frac{z_k}{\pi_k}\right)\;.
\tag{10.38}
\end{equation}\]</span></p>
<p>The second term in Equation <a href="Modelassisted.html#eq:ModelCalibrationEstimator">(10.36)</a> cancels for all sampling designs for which the sum of the design weights, i.e. the sum of the reciprocal of the inclusion probabilities, equals the population size: <span class="math inline">\(\sum_{k \in \mathcal{S}} 1/\pi_k=N\)</span>. Only for some unequal probability sampling designs this may not be the case.</p>
<p>The alternative is to plug the fitted values <span class="math inline">\(\hat{m}(\mathbf{x}_k)\)</span> into the generalised difference estimator, Equation <a href="Modelassisted.html#eq:GeneralizedDifferenceEstimator">(10.2)</a>. If we drop the second term, the model-calibration estimator can be rewritten as</p>
<p><span class="math display" id="eq:ModelCalibrationEstimator2">\[\begin{equation}
\hat{\bar{z}}_{\mathrm{MC}}=\frac{1}{N}\sum_{k=1}^N\hat{b}\;\hat{m}(\mathbf{x}_k)+\frac{1}{N}\sum_{k \in \mathcal{S}}\frac{z_k-\hat{b}\;\hat{m}(\mathbf{x}_k)}{\pi_k}
\;.
\tag{10.39}
\end{equation}\]</span></p>
<p>Comparison with the generalised difference estimator, Equation <a href="Modelassisted.html#eq:GeneralizedDifferenceEstimator">(10.2)</a>, shows that these two estimators are equivalent when <span class="math inline">\(\hat{b}=1\)</span>. For non-linear working models, generally <span class="math inline">\(\hat{b} \neq 1\)</span>, so that these two estimators are not the same. <span class="citation"><a href="#ref-Wu2003" role="doc-biblioref">Wu</a> (<a href="#ref-Wu2003" role="doc-biblioref">2003</a>)</span> shows that the calibration estimator has a general optimality property.</p>
<p>In case you are confused by all these model-assisted estimators, let me clarify. The most general estimator is the model-calibration estimator. If we take for <span class="math inline">\(\hat{b}\)</span> the value 1, this estimator is equivalent to the generalised difference estimator (Equation <a href="Modelassisted.html#eq:GeneralizedDifferenceEstimator">(10.2)</a>). The predictions <span class="math inline">\(\hat{m}(\mathbf{x}_k)\)</span> in these estimators can be computed either by a linear model or a non-linear model. If a linear model is used in the generalised difference estimator, this estimator is equal to the generalised regression estimator. With linear models <span class="math inline">\(\hat{b}\)</span> in Equation <a href="Modelassisted.html#eq:ModelCalibrationEstimator">(10.36)</a> equals 1, so that all three estimators are equal.</p>
<p>For simple random sampling the inclusion probabilities of the units are the same for all units: <span class="math inline">\(\pi_k = n/N\)</span>, reducing Equations <a href="Modelassisted.html#eq:ModelCalibrationEstimator">(10.36)</a> and <a href="Modelassisted.html#eq:SlopeCalibrationEstimator">(10.37)</a> to</p>
<p><span class="math display" id="eq:ModelCalibrationEstimatorSI">\[\begin{equation}
\hat{\bar{z}}_{\mathrm{MC}}= \frac{1}{n}\sum_{k \in \mathcal{S}} z_k + \hat{b}_{\mathrm{SI}}\left(\frac{1}{N}\sum_{k=1}^N \hat{m}(\mathbf{x}_k) - \frac{1}{n}\sum_{j \in \mathcal{S}} \hat{m}(\mathbf{x}_j) \right)\;,
\tag{10.40}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(\hat{b}_{\mathrm{SI}}\)</span> equal to</p>
<p><span class="math display" id="eq:RegressionCoefficientCalibrationEstimatorSI">\[\begin{equation}
\hat{b}_{\mathrm{SI}} = \frac{\sum_{k \in \mathcal{S}} \{\hat{m}(\mathbf{x}_k)-\bar{m}(\mathbf{x}_k)\}\{z_k-\bar{z}_{\mathcal{S}}\}}{\sum_{k \in \mathcal{S}} \{\hat{m}(\mathbf{x}_k)-\bar{m}(\mathbf{x}_k)\}^2}\;.
\tag{10.41}
\end{equation}\]</span></p>
<p>The variance of the model-assisted calibration estimator equals
<span class="math display" id="eq:VarianceCalibrationestimator">\[\begin{equation}
V(\hat{\bar{z}}_{\mathrm{MC}})=V(\hat{\bar{\epsilon}}_{\pi})\;,
\tag{10.42}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(\hat{\bar{\epsilon}}_{\pi}\)</span> the <span class="math inline">\(\pi\)</span> estimator of the population mean of the residuals <span class="math inline">\(\epsilon\)</span>. For sampling designs with fixed sample size these residuals are equal to <span class="math inline">\(\epsilon_k=z_k-b\;m(\mathbf{x}_k)\)</span>, with <span class="math inline">\(m(\mathbf{x}_k)\)</span> the fitted values based on all population units, and <span class="math inline">\(b\)</span> the population fit of the (superpopulation) regression coefficient,</p>
<p><span class="math display" id="eq:SlopeCalibrationEstimatorPopulationfit">\[\begin{equation}
b = \frac{\sum_{k=1}^N \hat{m}(\mathbf{x}_k)z_k}{\sum_{k=1}^N \hat{m}(\mathbf{x}_k)^2}\;.
\tag{10.43}
\end{equation}\]</span></p>
<p>An estimator of the variance is obtained by replacing the population fits <span class="math inline">\(m(\mathbf{x}_k)\)</span> by their sample estimates <span class="math inline">\(\hat{m}(\mathbf{x}_k)\)</span>, and <span class="math inline">\(b\)</span> by its estimator, Equation <a href="Modelassisted.html#eq:SlopeCalibrationEstimator">(10.37)</a>. For simple random sampling with replacement from finite populations and simple random sampling from infinite populations the variance equals</p>
<p><span class="math display" id="eq:VarianceCalibrationestimatorSI">\[\begin{equation}
V(\hat{\bar{z}}_{\mathrm{MC}})=\frac{S^2(\epsilon)}{n}\;,
\tag{10.44}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(S^2(\epsilon)\)</span> the population variance of the residuals <span class="math inline">\(\epsilon\)</span>.</p>
<p>The variance of the generalised difference estimator equals</p>
<p><span class="math display" id="eq:VarianceDifferenceestimator">\[\begin{equation}
V(\hat{\bar{z}}_{\mathrm{dif}})=V(\hat{\bar{d}}_{\pi})\;,
\tag{10.45}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(\hat{\bar{d}}_{\pi}\)</span> the <span class="math inline">\(\pi\)</span> estimator of the population mean of the differences <span class="math inline">\(d_k=z_k-m(\mathbf{x}_k)\)</span>. An estimator is obtained by substituting <span class="math inline">\(\hat{m}(\mathbf{x}_k)\)</span> for <span class="math inline">\(m(\mathbf{x}_k)\)</span> to compute the differences.</p>
<p>The data of Eastern Amazonia are used to illustrate model-assisted estimation of AGB, using five environmental covariates in predicting AGB. First a regression tree is used as a machine learning technique for prediction, after that a random forest. For an introduction to regression trees and random forest modelling, see this <a href="https://victorzhou.com/blog/intro-to-random-forests/">blog</a>. In this blog the study variable is a categorical variable, whereas in our example the study variable is quantitative (continuous). This is not essential. The only difference is the measure for quantifying how good a split is. With a quantitative study variable this is quantified by the following sum of squares,</p>
<p><span class="math display" id="eq:sumofsquaresbinarysplit">\[\begin{equation}
SS=\sum_{k=1}^2\sum_{k=1}^{N_k}(z_{ki}-\bar{z}_k)^2 \;,
\tag{10.46}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(\bar{z}_k\)</span> the sample mean of group <span class="math inline">\(k\)</span>.</p>
<div id="predicting-with-a-regression-tree" class="section level3" number="10.3.1">
<h3><span class="header-section-number">10.3.1</span> Predicting with a regression tree</h3>
<p>A simple random sample without replacement of size 100 is selected.</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="Modelassisted.html#cb295-1" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fu">nrow</span>(gridAmazonia)</span>
<span id="cb295-2"><a href="Modelassisted.html#cb295-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb295-3"><a href="Modelassisted.html#cb295-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">314</span>)</span>
<span id="cb295-4"><a href="Modelassisted.html#cb295-4" aria-hidden="true" tabindex="-1"></a>units <span class="ot">&lt;-</span> <span class="fu">sample.int</span>(N, <span class="at">size=</span>n, <span class="at">replace=</span><span class="cn">FALSE</span>)</span>
<span id="cb295-5"><a href="Modelassisted.html#cb295-5" aria-hidden="true" tabindex="-1"></a>covs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;SWIR2&quot;</span>,<span class="st">&quot;Terra_PP&quot;</span>,<span class="st">&quot;Prec_dm&quot;</span>,<span class="st">&quot;Elevation&quot;</span>,<span class="st">&quot;Clay&quot;</span>)</span>
<span id="cb295-6"><a href="Modelassisted.html#cb295-6" aria-hidden="true" tabindex="-1"></a>mysample <span class="ot">&lt;-</span> gridAmazonia[units,<span class="fu">c</span>(<span class="st">&quot;AGB&quot;</span>,covs)]</span></code></pre></div>
<p>Package <strong>rpms</strong> <span class="citation">(<a href="#ref-rpms" role="doc-biblioref">Toth 2019</a>)</span> is used to build a regression tree for AGB, using all five covariates as predictors. Note that I now use the original untransformed SWIR2 as a predictor. Transformation of predictors so that the relation with the study variable becomes linear is not needed when fitting a non-linear model such as a regression tree. Using the default value of 0.05 for argument <code>pval</code> leads to the following tree.</p>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="Modelassisted.html#cb296-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpms)</span>
<span id="cb296-2"><a href="Modelassisted.html#cb296-2" aria-hidden="true" tabindex="-1"></a>tree <span class="ot">&lt;-</span> <span class="fu">rpms</span>(</span>
<span id="cb296-3"><a href="Modelassisted.html#cb296-3" aria-hidden="true" tabindex="-1"></a>  AGB<span class="sc">~</span>SWIR2<span class="sc">+</span>Terra_PP<span class="sc">+</span>Prec_dm<span class="sc">+</span>Elevation<span class="sc">+</span>Clay,</span>
<span id="cb296-4"><a href="Modelassisted.html#cb296-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data=</span>mysample, <span class="at">pval=</span><span class="fl">0.05</span>)</span></code></pre></div>
<p><img src="images/TreeAGB_Amazonia.png" width="80%" style="display: block; margin: auto;" /></p>
<p>The regression tree is used to predict AGB for all population units.</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="Modelassisted.html#cb297-1" aria-hidden="true" tabindex="-1"></a>AGBpred <span class="ot">&lt;-</span> <span class="fu">predict</span>(tree, <span class="at">newdata=</span>gridAmazonia)</span></code></pre></div>
<p>The population mean is then estimated by the generalised difference estimator.</p>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="Modelassisted.html#cb298-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> gridAmazonia<span class="sc">$</span>AGB[units]<span class="sc">-</span>AGBpred[units]</span>
<span id="cb298-2"><a href="Modelassisted.html#cb298-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(AGBpred) <span class="sc">+</span> <span class="fu">mean</span>(d)</span></code></pre></div>
<pre><code>[1] 226.7433</code></pre>
<p>Its standard error is estimated by the square root of the variance of the estimator of the mean differences.</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="Modelassisted.html#cb300-1" aria-hidden="true" tabindex="-1"></a>S2d <span class="ot">&lt;-</span> <span class="fu">var</span>(d)</span>
<span id="cb300-2"><a href="Modelassisted.html#cb300-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>((<span class="dv">1</span><span class="sc">-</span>n<span class="sc">/</span>N)<span class="sc">*</span>S2d<span class="sc">/</span>n)</span></code></pre></div>
<pre><code>[1] 3.212222</code></pre>
<p>This estimation procedure is implemented in function <code>gregTree</code> of package <strong>mase</strong> <span class="citation">(<a href="#ref-mase2018" role="doc-biblioref">McConville et al. 2018</a>)</span>.</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="Modelassisted.html#cb302-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mase)</span>
<span id="cb302-2"><a href="Modelassisted.html#cb302-2" aria-hidden="true" tabindex="-1"></a>pi <span class="ot">&lt;-</span> <span class="fu">rep</span>(n<span class="sc">/</span>N,n)</span>
<span id="cb302-3"><a href="Modelassisted.html#cb302-3" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">gregTree</span>(</span>
<span id="cb302-4"><a href="Modelassisted.html#cb302-4" aria-hidden="true" tabindex="-1"></a>  mysample<span class="sc">$</span>AGB, <span class="at">xsample=</span>mysample[,covs],</span>
<span id="cb302-5"><a href="Modelassisted.html#cb302-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">xpop=</span>gridAmazonia[,covs], <span class="at">pi=</span>pi,</span>
<span id="cb302-6"><a href="Modelassisted.html#cb302-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">var_est=</span><span class="cn">TRUE</span>, <span class="at">var_method=</span><span class="st">&quot;LinHTSRS&quot;</span>)</span>
<span id="cb302-7"><a href="Modelassisted.html#cb302-7" aria-hidden="true" tabindex="-1"></a>res<span class="sc">$</span>pop_mean</span></code></pre></div>
<pre><code>[1] 226.7433</code></pre>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="Modelassisted.html#cb304-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(res<span class="sc">$</span>pop_mean_var)</span></code></pre></div>
<pre><code>[1] 3.212222</code></pre>
<p>The variance of the estimator of the mean can also be estimated by bootstrapping the sample (<span class="citation"><a href="#ref-loh99" role="doc-biblioref">Lohr</a> (<a href="#ref-loh99" role="doc-biblioref">1999</a>)</span>, Section 9.3.3).</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="Modelassisted.html#cb306-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">gregTree</span>(</span>
<span id="cb306-2"><a href="Modelassisted.html#cb306-2" aria-hidden="true" tabindex="-1"></a>  mysample<span class="sc">$</span>AGB, <span class="at">xsample=</span>mysample[,covs],</span>
<span id="cb306-3"><a href="Modelassisted.html#cb306-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">xpop=</span>gridAmazonia[,covs], <span class="at">pi=</span>pi,</span>
<span id="cb306-4"><a href="Modelassisted.html#cb306-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">var_est=</span><span class="cn">TRUE</span>, <span class="at">var_method=</span><span class="st">&quot;bootstrapSRS&quot;</span>, <span class="at">B=</span><span class="dv">100</span>)</span></code></pre></div>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="Modelassisted.html#cb307-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(res<span class="sc">$</span>pop_mean_var)</span></code></pre></div>
<pre><code>         [,1]
[1,] 4.405042</code></pre>
<p>The standard error obtained by the bootstrap is considerably larger than the previous standard error based on a Taylor linearisation of the estimator of the mean. As we will see hereafter, the Taylor linearisation seriously underestimates the true standard error.</p>
<p>The simple random sampling of 100 units and the model-assisted estimation is repeated 500 times, using a regression tree for prediction. The variance is estimated by Taylor linearisation (<code>var_method=LinHTSRS</code>) and by bootstrapping (<code>var_method=bootstrapSRS</code>) using 100 bootstrap samples.</p>
<p>The variance of the 500 estimated population means of AGB is 20.8. Estimation of the variance through Taylor linearisation strongly underestimates the variance: the average of the 500 estimated variances equals 14.5. On the contrary, the bootstrap variance estimator overestimates the variance: the average of the 500 estimated variances equals 23.4. I prefer to overestimate my uncertainty about the mean instead of being overoptimistic, and so I would recommend to report the bootstrap variance.</p>
</div>
<div id="predicting-with-a-random-forest" class="section level3" number="10.3.2">
<h3><span class="header-section-number">10.3.2</span> Predicting with a random forest</h3>
<p>The package <strong>ranger</strong> <span class="citation">(<a href="#ref-Wright2017" role="doc-biblioref">Wright and Ziegler 2017</a>)</span> is used to fit a random forest model for AGB using the five environmental covariates as predictors and the simple random sample of size 100 selected in the previous section. Function <code>importance</code> shows how often the covariates are used in a binary splitting. All five covariates are used, SWIR2 by far most often.</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="Modelassisted.html#cb309-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ranger)</span>
<span id="cb309-2"><a href="Modelassisted.html#cb309-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">314</span>)</span>
<span id="cb309-3"><a href="Modelassisted.html#cb309-3" aria-hidden="true" tabindex="-1"></a>forest.sample <span class="ot">&lt;-</span> <span class="fu">ranger</span>(</span>
<span id="cb309-4"><a href="Modelassisted.html#cb309-4" aria-hidden="true" tabindex="-1"></a>  AGB<span class="sc">~</span>., <span class="at">data=</span>mysample, <span class="at">num.trees=</span><span class="dv">1000</span>, <span class="at">importance=</span><span class="st">&quot;impurity&quot;</span>)</span>
<span id="cb309-5"><a href="Modelassisted.html#cb309-5" aria-hidden="true" tabindex="-1"></a><span class="fu">importance</span>(forest.sample)</span></code></pre></div>
<pre><code>    SWIR2  Terra_PP   Prec_dm Elevation      Clay 
466318.39 214716.35 136505.65  62429.66  34612.68 </code></pre>
<p>Out-of-bag predictions for the selected units are saved in the element <code>predictions</code> of the output-object of the function <code>ranger</code>. The fitted model is also used to predict AGB at all units (raster cells), using function <code>predict</code>.</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="Modelassisted.html#cb311-1" aria-hidden="true" tabindex="-1"></a>AGBpred_OOB <span class="ot">&lt;-</span> forest.sample<span class="sc">$</span>predictions </span>
<span id="cb311-2"><a href="Modelassisted.html#cb311-2" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">predict</span>(forest.sample, <span class="at">data=</span>gridAmazonia, <span class="at">type=</span><span class="st">&quot;response&quot;</span>)</span>
<span id="cb311-3"><a href="Modelassisted.html#cb311-3" aria-hidden="true" tabindex="-1"></a>AGBpred <span class="ot">&lt;-</span> res<span class="sc">$</span>predictions</span></code></pre></div>
<p>Finally, the model-calibration estimate and the generalised difference estimate are computed. Both estimators and their variances are computed in two ways. They differ in how the study variable AGB is predicted for the sampling units:</p>
<ol style="list-style-type: decimal">
<li>Using all trees of the forest (the predictions obtained with function <code>predict</code>).<br />
</li>
<li>Using only the trees calibrated on bootstrap samples that do not include the sampling unit used as a prediction unit. These out-of-bag predictions are stored in the element <code>predictions</code> of the output object of function <code>ranger</code>.</li>
</ol>
<p>The next code chunk shows how the model-calibration estimate can be computed with the AGB data of the simple random sample and the random forest predictions of AGB. First use all trees.</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="Modelassisted.html#cb312-1" aria-hidden="true" tabindex="-1"></a>numer <span class="ot">&lt;-</span> <span class="fu">sum</span>((AGBpred[units]<span class="sc">-</span><span class="fu">mean</span>(AGBpred[units]))<span class="sc">*</span></span>
<span id="cb312-2"><a href="Modelassisted.html#cb312-2" aria-hidden="true" tabindex="-1"></a>             (mysample<span class="sc">$</span>AGB<span class="sc">-</span><span class="fu">mean</span>(mysample<span class="sc">$</span>AGB))) </span>
<span id="cb312-3"><a href="Modelassisted.html#cb312-3" aria-hidden="true" tabindex="-1"></a>denom <span class="ot">&lt;-</span> <span class="fu">sum</span>((AGBpred[units]<span class="sc">-</span><span class="fu">mean</span>(AGBpred[units]))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb312-4"><a href="Modelassisted.html#cb312-4" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> numer<span class="sc">/</span>denom</span>
<span id="cb312-5"><a href="Modelassisted.html#cb312-5" aria-hidden="true" tabindex="-1"></a>mz_MC <span class="ot">&lt;-</span> <span class="fu">mean</span>(mysample<span class="sc">$</span>AGB)<span class="sc">+</span>b<span class="sc">*</span>(<span class="fu">mean</span>(AGBpred)<span class="sc">-</span><span class="fu">mean</span>(AGBpred[units]))</span>
<span id="cb312-6"><a href="Modelassisted.html#cb312-6" aria-hidden="true" tabindex="-1"></a>u <span class="ot">&lt;-</span> mysample<span class="sc">$</span>AGB<span class="sc">-</span>AGBpred[units]<span class="sc">*</span>b</span>
<span id="cb312-7"><a href="Modelassisted.html#cb312-7" aria-hidden="true" tabindex="-1"></a>v_mz_MC <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">-</span>n<span class="sc">/</span>N)<span class="sc">*</span><span class="fu">var</span>(u)<span class="sc">/</span>n</span></code></pre></div>
<p>Next, use the out-of-bag predictions.</p>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="Modelassisted.html#cb313-1" aria-hidden="true" tabindex="-1"></a>numer <span class="ot">&lt;-</span> <span class="fu">sum</span>((AGBpred_OOB<span class="sc">-</span><span class="fu">mean</span>(AGBpred_OOB))<span class="sc">*</span></span>
<span id="cb313-2"><a href="Modelassisted.html#cb313-2" aria-hidden="true" tabindex="-1"></a>             (mysample<span class="sc">$</span>AGB<span class="sc">-</span><span class="fu">mean</span>(mysample<span class="sc">$</span>AGB)))</span>
<span id="cb313-3"><a href="Modelassisted.html#cb313-3" aria-hidden="true" tabindex="-1"></a>denom <span class="ot">&lt;-</span> <span class="fu">sum</span>((AGBpred_OOB<span class="sc">-</span><span class="fu">mean</span>(AGBpred_OOB))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb313-4"><a href="Modelassisted.html#cb313-4" aria-hidden="true" tabindex="-1"></a>b_OOB <span class="ot">&lt;-</span> numer<span class="sc">/</span>denom</span>
<span id="cb313-5"><a href="Modelassisted.html#cb313-5" aria-hidden="true" tabindex="-1"></a>mz_MC_OOB <span class="ot">&lt;-</span> <span class="fu">mean</span>(mysample<span class="sc">$</span>AGB)<span class="sc">+</span>b_OOB<span class="sc">*</span>(<span class="fu">mean</span>(AGBpred)<span class="sc">-</span><span class="fu">mean</span>(AGBpred_OOB))</span>
<span id="cb313-6"><a href="Modelassisted.html#cb313-6" aria-hidden="true" tabindex="-1"></a>u_OOB <span class="ot">&lt;-</span> mysample<span class="sc">$</span>AGB<span class="sc">-</span>AGBpred_OOB<span class="sc">*</span>b_OOB</span>
<span id="cb313-7"><a href="Modelassisted.html#cb313-7" aria-hidden="true" tabindex="-1"></a>v_mz_MC_OOB <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">-</span>n<span class="sc">/</span>N)<span class="sc">*</span><span class="fu">var</span>(u_OOB)<span class="sc">/</span>n</span></code></pre></div>
<p>The two calibration estimates are about equal: 226.8 using sample predictions obtained with function <code>predict</code>, and 227.3 with the out-of-bag sample predictions. However, their estimated variances are largely different: 2.35 and 12.46, respectively.</p>
<p>In the next code chunk the generalised difference estimate (Equation <a href="Modelassisted.html#eq:GeneralizedDifferenceEstimator">(10.2)</a>) is computed. Similar to the model-calibration estimate, this difference estimate is computed from predictions based on all trees, and from the out-of-bag predictions.</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="Modelassisted.html#cb314-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> mysample<span class="sc">$</span>AGB<span class="sc">-</span>AGBpred[units]</span>
<span id="cb314-2"><a href="Modelassisted.html#cb314-2" aria-hidden="true" tabindex="-1"></a>mz_MD <span class="ot">&lt;-</span> <span class="fu">mean</span>(AGBpred)<span class="sc">+</span><span class="fu">mean</span>(d)</span>
<span id="cb314-3"><a href="Modelassisted.html#cb314-3" aria-hidden="true" tabindex="-1"></a>v_mz_MD <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">-</span>n<span class="sc">/</span>N)<span class="sc">*</span><span class="fu">var</span>(d)<span class="sc">/</span>n</span>
<span id="cb314-4"><a href="Modelassisted.html#cb314-4" aria-hidden="true" tabindex="-1"></a><span class="co">#using out-of-bag predictions</span></span>
<span id="cb314-5"><a href="Modelassisted.html#cb314-5" aria-hidden="true" tabindex="-1"></a>d_OOB <span class="ot">&lt;-</span> mysample<span class="sc">$</span>AGB<span class="sc">-</span>AGBpred_OOB</span>
<span id="cb314-6"><a href="Modelassisted.html#cb314-6" aria-hidden="true" tabindex="-1"></a>mz_MD_OOB <span class="ot">&lt;-</span> <span class="fu">mean</span>(AGBpred)<span class="sc">+</span><span class="fu">mean</span>(d_OOB)</span>
<span id="cb314-7"><a href="Modelassisted.html#cb314-7" aria-hidden="true" tabindex="-1"></a>v_mz_MD_OOB <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">-</span>n<span class="sc">/</span>N)<span class="sc">*</span><span class="fu">var</span>(d_OOB)<span class="sc">/</span>n</span></code></pre></div>
<p>For the difference estimator the results are very similar. The two difference estimates are 226.6 and 227, and their estimated variances are 2.7 and 12.8. The model-calibration estimate and the generalised difference estimate are nearly equal.</p>
<p>The sampling and estimation is repeated 1,000 times: 1,000 times a simple random sample without replacement of size 100 is selected. Each sample is used to calibrate a random forest, each forest consisting of 1,000 trees. This resulted in 2 <span class="math inline">\(\times\)</span> 1,000 model-calibration estimates and their estimated variances, and 2 <span class="math inline">\(\times\)</span> 1,000 difference estimates and their estimated variances. To limit the computing time a 5 km <span class="math inline">\(\times\)</span> 5 km subgrid is used for selecting the simple random samples and for predicting AGB with the random forest.</p>
<p>For each estimator the 1,000 estimated means are used to compute the relative bias,</p>
<p><span class="math display" id="eq:relativebias">\[\begin{equation}
bias = \frac{\frac{1}{1000}\sum_{i=1}^{1000}\hat{\bar{z}}_i-\bar{z}}{\bar{z}}\;.
\tag{10.47}
\end{equation}\]</span></p>
<p>Besides, for each estimator the variance of the 1,000 estimates is computed, which can be compared with the mean of the 1,000 estimated variances. The mean of the estimated variances is used to compute the variance to mean squared error ratio,</p>
<p><span class="math display" id="eq:VariancetoMSEratio">\[\begin{equation}
R = \frac{\frac{1}{1000}\sum_{i=1}^{1000}\hat{V}(\hat{\bar{z}}_i)}{MSE}\;,
\tag{10.48}
\end{equation}\]</span></p>
<p>with</p>
<p><span class="math display" id="eq:MSE">\[\begin{equation}
MSE= \frac{1}{1000}\sum_{i=1}^{1000}(\hat{\bar{z}}_i-\bar{z})^2\;.
\tag{10.49}
\end{equation}\]</span></p>
<p>Ideally this ratio equals 1. If it is smaller than 1, the variance estimator underestimates the mean squared error.</p>
<p>Finally, the relative efficiency is computed as the ratio of the MSE of the <span class="math inline">\(\pi\)</span> estimator and the MSE of a model-assisted estimator. The <span class="math inline">\(\pi\)</span> estimator is unbiased, so the MSE equals the variance, which can be computed without error by the population variance divided by the sample size. If the relative efficiency is larger than 1, the model-assisted estimator is more accurate than the <span class="math inline">\(\pi\)</span> estimator.</p>
<p>The variance of the 1,000 model-calibration estimates (experimental variance), using all trees to predict AGB for the sample units, equals 15.0281. This is 5.6 times larger than the average of the 1,000 estimated variances, which equals 2.6612. When using the out-of-bag sample predictions, the experimental variance is about equal to the average of the 1,000 variance estimates: 15.5255 versus 14.975.</p>
<p>The reason of underestimation of the variance when predicting AGB at sample units with function <code>predict</code> is that all 1,000 trees are used in prediction, including the trees calibrated on bootstrap samples that contain the unit in the sample to be predicted. On the contrary, the out-of-bag predicted values are computed as the average of predictions from the trees calibrated on bootstrap samples that do not contain the sample unit to be predicted. The default sample fraction is 0.632, see argument <code>sample.fraction</code> of function <code>ranger</code>, so with 1,000 trees these predictions are the average of, on average, 368 tree predictions. This explains why the out-of-bag prediction errors are larger than the prediction errors obtained with function <code>predict</code>. In other words, the variance of the out-of-bag differences <span class="math inline">\(d\)</span> and of the out-of-bag residuals <span class="math inline">\(u\)</span> are larger than those obtained with predicting using all trees.</p>
<p>Hereafter I report the results obtained with the out-of-bag samples only.</p>
<p>The relative bias is negligibly small for all sample sizes (Table <a href="Modelassisted.html#tab:CalibrationEstimatesAmazoniaOOB">10.1</a>). For <span class="math inline">\(n=250\)</span> and 100 the average of the 1,000 variance estimates is smaller than the variance of the 1,000 estimated means, whereas for <span class="math inline">\(n=50\)</span> the average of the 1,000 variance estimates is larger than the experimental variance of the estimated means. The variance to MSE ratio is smaller than 1 for <span class="math inline">\(n=250\)</span> and 100, but larger than 1 for <span class="math inline">\(n=50\)</span>. The model-calibration estimator is much more accurate than the <span class="math inline">\(\pi\)</span> estimator for all three sample sizes. The relative efficiency increases with the sample size.</p>
<table class=" lightable-classic" style="font-family: &quot;Arial Narrow&quot;, &quot;Source Sans Pro&quot;, sans-serif; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:CalibrationEstimatesAmazoniaOOB">Table 10.1: </span>Summary statistics of 1,000 repeated calibration estimates of mean of aboveground biomass in Eastern Amazonia and their variance, using random forest model with five covariates as a working model and out-of-bag sample predictions, for simple random sampling without replacement.
</caption>
<thead>
<tr>
<th style="text-align:left;">
Sample size:
</th>
<th style="text-align:right;">
50
</th>
<th style="text-align:right;">
100
</th>
<th style="text-align:right;">
250
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Relative bias
</td>
<td style="text-align:right;">
-0.0014
</td>
<td style="text-align:right;">
-0.0006
</td>
<td style="text-align:right;">
-0.0012
</td>
</tr>
<tr>
<td style="text-align:left;">
Experimental variance
</td>
<td style="text-align:right;">
33.9075
</td>
<td style="text-align:right;">
15.5255
</td>
<td style="text-align:right;">
5.6111
</td>
</tr>
<tr>
<td style="text-align:left;">
Mean variance estimates
</td>
<td style="text-align:right;">
36.1512
</td>
<td style="text-align:right;">
14.9750
</td>
<td style="text-align:right;">
5.0467
</td>
</tr>
<tr>
<td style="text-align:left;">
Variance to MSE ratio
</td>
<td style="text-align:right;">
1.0642
</td>
<td style="text-align:right;">
0.9642
</td>
<td style="text-align:right;">
0.8882
</td>
</tr>
<tr>
<td style="text-align:left;">
Relative efficiency
</td>
<td style="text-align:right;">
5.0066
</td>
<td style="text-align:right;">
5.4755
</td>
<td style="text-align:right;">
5.9866
</td>
</tr>
</tbody>
</table>
<p>The performance statistics of the generalised difference estimator are very similar to those of the model-calibration estimator (Table <a href="Modelassisted.html#tab:DifferenceEstimatesAmazoniaOOB">10.2</a>).</p>
<table class=" lightable-classic" style="font-family: &quot;Arial Narrow&quot;, &quot;Source Sans Pro&quot;, sans-serif; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:DifferenceEstimatesAmazoniaOOB">Table 10.2: </span>Summary statistics of 1,000 repeated generalised difference estimates of aboveground biomass in Eastern Amazonia and their variance, using random forest model with five covariates as a working model and out-of-bag sample predictions, for simple random sampling without replacement.
</caption>
<thead>
<tr>
<th style="text-align:left;">
Sample size:
</th>
<th style="text-align:right;">
50
</th>
<th style="text-align:right;">
100
</th>
<th style="text-align:right;">
250
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Relative bias
</td>
<td style="text-align:right;">
-0.0008
</td>
<td style="text-align:right;">
-0.0006
</td>
<td style="text-align:right;">
-0.0013
</td>
</tr>
<tr>
<td style="text-align:left;">
Experimental variance
</td>
<td style="text-align:right;">
34.5188
</td>
<td style="text-align:right;">
16.2339
</td>
<td style="text-align:right;">
5.6891
</td>
</tr>
<tr>
<td style="text-align:left;">
Mean variance estimates
</td>
<td style="text-align:right;">
38.4629
</td>
<td style="text-align:right;">
15.4568
</td>
<td style="text-align:right;">
5.1125
</td>
</tr>
<tr>
<td style="text-align:left;">
Variance to MSE ratio
</td>
<td style="text-align:right;">
1.1144
</td>
<td style="text-align:right;">
0.9520
</td>
<td style="text-align:right;">
0.8867
</td>
</tr>
<tr>
<td style="text-align:left;">
Relative efficiency
</td>
<td style="text-align:right;">
4.9275
</td>
<td style="text-align:right;">
5.2379
</td>
<td style="text-align:right;">
5.8997
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="big-data-and-volunteer-data" class="section level2" number="10.4">
<h2><span class="header-section-number">10.4</span> Big data and volunteer data</h2>
<p>In the past decades numerous large data sets became available, and this number will further increase in the future, think of data sets collected by the numerous satellites. These data sets may contain valuable information about the study variables, so that they can be used in model-assisted estimation of global (this chapter) or local means and totals (Chapter <a href="SmallAreaEstimation.html#SmallAreaEstimation">14</a>).</p>
<p>Another interesting source of information are the geographic data collected by volunteers. These data typically are from non-probability samples. Despite this, there can be valuable information in these data about the global or local means of the study variable.</p>
<p>When the volunteer data are supplemented by a probability sample with observations on the study variable, the volunteer data can be used at the design stage and/or at the estimation stage. As an example of the first approach, the volunteer data are used to predict the study variable at a fine discretisation grid. These predictions are then used to construct strata for supplemental sampling, for instance by the <em>cum-root-f</em> method (Section <a href="STSI.html#cumrootf">4.4</a>), or using the approach described in Section <a href="MBpredictionofDesignVariance.html#Ospats">13.2</a>.</p>
<p>At the estimation stage the volunteer data are used to predict the study variable at points of the supplemental probability sample and at the nodes of a discretisation grid. These predictions are then used in model-assisted estimation, using the generalised difference or regression estimator, as explained in this chapter. For more details and a simulation study, see <span class="citation"><a href="#ref-bru03a" role="doc-biblioref">Brus and de Gruijter</a> (<a href="#ref-bru03a" role="doc-biblioref">2003</a>)</span>.</p>
<p><span class="citation"><a href="#ref-Stehman2018" role="doc-biblioref">Stehman et al.</a> (<a href="#ref-Stehman2018" role="doc-biblioref">2018</a>)</span> compared this model-assisted estimation approach with a certainty stratum approach for estimating the area covered by land cover classes and the accuracy of land cover maps. The volunteer data are treated as the data of a stratum of which all units are observed. A probability sample is selected from the remaining units not observed by the volunteers. The total (area of a land cover class) of the certainty stratum is added to the estimated total of the subpopulation not observed by the volunteers.</p>
<p>The model-assisted approach requires a supplemental sample with observations of the study variable <span class="math inline">\(z\)</span>. <span class="citation"><a href="#ref-Kim2019" role="doc-biblioref">Kim and Wang</a> (<a href="#ref-Kim2019" role="doc-biblioref">2019</a>)</span> described an approach in which the big data sample is combined with a probability sample with observations of one or more ancillary variables <span class="math inline">\(x\)</span>.</p>
<p><span class="citation"><a href="#ref-Kim2019" role="doc-biblioref">Kim and Wang</a> (<a href="#ref-Kim2019" role="doc-biblioref">2019</a>)</span> also describe an alternative approach that does not require a probability sample at all. In this approach the big data sample is subsampled to correct the selection bias in the big data sample. The subsample is selected by inverse sampling, using data on an ancillary variable <span class="math inline">\(x\)</span>, either from a census or a probability sample. The subsample is selected with conditional inclusion probabilities equal to the subsample size multiplied by an importance weight (<span class="citation"><a href="#ref-Kim2019" role="doc-biblioref">Kim and Wang</a> (<a href="#ref-Kim2019" role="doc-biblioref">2019</a>)</span>, Equation 4).</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Breidt2017" class="csl-entry">
Breidt, F. J., and J. D. Opsomer. 2017. <span>“Model-Assisted Survey Estimation with Modern Prediction Techniques.”</span> <em>Statistical Science</em> 32 (2): 190–205. <a href="https://doi.org/10.1214/16-STS589">https://doi.org/10.1214/16-STS589</a>.
</div>
<div id="ref-bru03a" class="csl-entry">
———. 2003. <span>“A Method to Combine Non-Probability Sample Data with Probability Sample Data in Estimating Spatial Means of Environmental Variables.”</span> <em>Environmental Monitoring and Assessment</em> 83: 303–17.
</div>
<div id="ref-coc77" class="csl-entry">
Cochran, W. G. 1977. <em>Sampling Techniques</em>. New York: Wiley.
</div>
<div id="ref-Kim2019" class="csl-entry">
Kim, J. K., and Z. Wang. 2019. <span>“Sampling Techniques for Big Data Analysis.”</span> <em>International Statistical Review</em> 87 (S1): S177–91.
</div>
<div id="ref-loh99" class="csl-entry">
Lohr, S. L. 1999. <em>Sampling: Design and Analysis</em>. Pacific Grove, USA: Duxbury Press.
</div>
<div id="ref-Lumley2020" class="csl-entry">
Lumley, T. 2020. <em><span class="nocase">survey: analysis of complex survey samples</span></em>.
</div>
<div id="ref-McConville2020" class="csl-entry">
McConville, Kelly. 2018. <span>“A Tutorial on Model-Assisted Estimation with Application to Forest Inventory.”</span> <em>Forests</em> 11 (244). <a href="https://doi.org/10.3390/f11020244">https://doi.org/10.3390/f11020244</a>.
</div>
<div id="ref-mase2018" class="csl-entry">
McConville, Kelly, Becky Tang, George Zhu, Shirley Cheung, and Sida Li. 2018. <em><span class="nocase">mase: Model-Assisted Survey Estimation</span></em>. <a href="https://cran.r-project.org/package=mase">https://cran.r-project.org/package=mase</a>.
</div>
<div id="ref-sar92" class="csl-entry">
Särndal, C. E., B. Swensson, and J. Wretman. 1992. <em>Model Assisted Survey Sampling</em>. New York: Springer.
</div>
<div id="ref-Stehman2018" class="csl-entry">
Stehman, S. V., C. C. Fonte, G. M. Foody, and L. See. 2018. <span>“<span class="nocase">Using volunteered geographic information (VGI) in design-based statistical inference for area estimation and accuracy assessment of land cover</span>.”</span> <em>Remote Sensing of Environment</em> 212: 47–59. <a href="https://doi.org/10.1016/j.rse.2018.04.014">https://doi.org/10.1016/j.rse.2018.04.014</a>.
</div>
<div id="ref-leaps" class="csl-entry">
Thomas Lumley (based on Fortran code by Alan Miller). 2020. <em><span class="nocase">leaps: Regression Subset Selection</span></em>. <a href="https://CRAN.R-project.org/package=leaps">https://CRAN.R-project.org/package=leaps</a>.
</div>
<div id="ref-rpms" class="csl-entry">
Toth, Daniell. 2019. <em><span class="nocase">rpms: Recursive Partitioning for Modeling Survey Data</span></em>. <a href="https://CRAN.R-project.org/package=rpms">https://CRAN.R-project.org/package=rpms</a>.
</div>
<div id="ref-forcats" class="csl-entry">
Wickham, Hadley. 2020. <em><span class="nocase">forcats: Tools for Working with Categorical Variables (Factors)</span></em>. <a href="https://CRAN.R-project.org/package=forcats">https://CRAN.R-project.org/package=forcats</a>.
</div>
<div id="ref-Wright2017" class="csl-entry">
Wright, Marvin N., and Andreas Ziegler. 2017. <span>“<span class="nocase"><span class="nocase">ranger</span>: A Fast Implementation of Random Forests for High Dimensional Data in <span>C++</span> and <span>R</span></span>.”</span> <em>Journal of Statistical Software</em> 77 (1). <a href="https://doi.org/10.18637/jss.v077.i01">https://doi.org/10.18637/jss.v077.i01</a>.
</div>
<div id="ref-Wu2003" class="csl-entry">
Wu, C. 2003. <span>“Optimal Calibration Estimators in Survey Sampling.”</span> <em>Biometrika</em> 90 (4): 937–51.
</div>
<div id="ref-Wu2001" class="csl-entry">
Wu, C., and R. R. Sitter. 2001. <span>“A Model-Calibration Approach to Using Complete Auxiliary Information from Survey Data.”</span> <em>Journal of the American Statistical Association</em> 96 (453): 185–93.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="BalancedSpreaded.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="Twophase.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/DickBrus/SpatialSamplingwithR/edit/master/10-ModelAssisted.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["SpatialSampling.epub"],
"search": {
"engine": "lunr",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
