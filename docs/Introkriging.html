<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 21 Introduction to kriging | Spatial sampling with R</title>
  <meta name="description" content="This book is for students, scientists, researchers and consultants who want to know how to collect spatial data, either for estimating parameters for the population or several subpopulations, or for mapping. How many data do we need, and how to select the population units? The book presents a wide overview of spatial sampling designs. Besides there is a chapter on designs for sampling in space and time for monitoring. The emphasis is not on the theory, but on how to implement sampling designs in R and on how the (sub)population parameters can be estimated from the sample." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 21 Introduction to kriging | Spatial sampling with R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="/images/cover.pdf" />
  <meta property="og:description" content="This book is for students, scientists, researchers and consultants who want to know how to collect spatial data, either for estimating parameters for the population or several subpopulations, or for mapping. How many data do we need, and how to select the population units? The book presents a wide overview of spatial sampling designs. Besides there is a chapter on designs for sampling in space and time for monitoring. The emphasis is not on the theory, but on how to implement sampling designs in R and on how the (sub)population parameters can be estimated from the sample." />
  <meta name="github-repo" content="DickBrus/SpatialSamplingwithR" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 21 Introduction to kriging | Spatial sampling with R" />
  
  <meta name="twitter:description" content="This book is for students, scientists, researchers and consultants who want to know how to collect spatial data, either for estimating parameters for the population or several subpopulations, or for mapping. How many data do we need, and how to select the population units? The book presents a wide overview of spatial sampling designs. Besides there is a chapter on designs for sampling in space and time for monitoring. The emphasis is not on the theory, but on how to implement sampling designs in R and on how the (sub)population parameters can be estimated from the sample." />
  <meta name="twitter:image" content="/images/cover.pdf" />

<meta name="author" content="Dick J. Brus" />


<meta name="date" content="2021-11-09" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="SpatialResponseSurface.html"/>
<link rel="next" href="MBgridspacing.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Spatial sampling with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="GeneralIntro.html"><a href="GeneralIntro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="GeneralIntro.html"><a href="GeneralIntro.html#BasicConcepts"><i class="fa fa-check"></i><b>1.1</b> Basic sampling concepts</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="GeneralIntro.html"><a href="GeneralIntro.html#PopulationParameters"><i class="fa fa-check"></i><b>1.1.1</b> Population parameters</a></li>
<li class="chapter" data-level="1.1.2" data-path="GeneralIntro.html"><a href="GeneralIntro.html#descriptive-statistics-versus-inference-about-a-population"><i class="fa fa-check"></i><b>1.1.2</b> Descriptive statistics versus inference about a population</a></li>
<li class="chapter" data-level="1.1.3" data-path="GeneralIntro.html"><a href="GeneralIntro.html#random-sampling-versus-probability-sampling"><i class="fa fa-check"></i><b>1.1.3</b> Random sampling versus probability sampling</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="GeneralIntro.html"><a href="GeneralIntro.html#DBvsMB"><i class="fa fa-check"></i><b>1.2</b> Design-based versus model-based approach</a></li>
<li class="chapter" data-level="1.3" data-path="GeneralIntro.html"><a href="GeneralIntro.html#Datasets"><i class="fa fa-check"></i><b>1.3</b> Populations used in sampling experiments</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="GeneralIntro.html"><a href="GeneralIntro.html#Voorst"><i class="fa fa-check"></i><b>1.3.1</b> Soil organic matter in Voorst (Netherlands)</a></li>
<li class="chapter" data-level="1.3.2" data-path="GeneralIntro.html"><a href="GeneralIntro.html#Poppy"><i class="fa fa-check"></i><b>1.3.2</b> Poppy fields in Kandahar (Afghanistan)</a></li>
<li class="chapter" data-level="1.3.3" data-path="GeneralIntro.html"><a href="GeneralIntro.html#Amazonia"><i class="fa fa-check"></i><b>1.3.3</b> Aboveground biomass in Eastern Amazonia (Brazil)</a></li>
<li class="chapter" data-level="1.3.4" data-path="GeneralIntro.html"><a href="GeneralIntro.html#TASSpainPortugal"><i class="fa fa-check"></i><b>1.3.4</b> Annual mean air temperature in Spain and Portugal</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>I Probability sampling for estimating (sub)population parameters</b></span></li>
<li class="chapter" data-level="2" data-path="IntroProbabilitySampling.html"><a href="IntroProbabilitySampling.html"><i class="fa fa-check"></i><b>2</b> Introduction to probability sampling</a>
<ul>
<li class="chapter" data-level="2.1" data-path="IntroProbabilitySampling.html"><a href="IntroProbabilitySampling.html#HTestimator"><i class="fa fa-check"></i><b>2.1</b> Horvitz-Thompson estimator</a></li>
<li class="chapter" data-level="2.2" data-path="IntroProbabilitySampling.html"><a href="IntroProbabilitySampling.html#hansen-hurwitz-estimator"><i class="fa fa-check"></i><b>2.2</b> Hansen-Hurwitz estimator</a></li>
<li class="chapter" data-level="2.3" data-path="IntroProbabilitySampling.html"><a href="IntroProbabilitySampling.html#using-models-in-design-based-approach"><i class="fa fa-check"></i><b>2.3</b> Using models in design-based approach</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="SI.html"><a href="SI.html"><i class="fa fa-check"></i><b>3</b> Simple random sampling</a>
<ul>
<li class="chapter" data-level="3.1" data-path="SI.html"><a href="SI.html#HTestimatorSI"><i class="fa fa-check"></i><b>3.1</b> Estimation of population parameters</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="SI.html"><a href="SI.html#PopProportion"><i class="fa fa-check"></i><b>3.1.1</b> Population proportion</a></li>
<li class="chapter" data-level="3.1.2" data-path="SI.html"><a href="SI.html#CDF"><i class="fa fa-check"></i><b>3.1.2</b> Cumulative distribution function and quantiles</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="SI.html"><a href="SI.html#VarMeanSI"><i class="fa fa-check"></i><b>3.2</b> Sampling variance of estimator of population parameters</a></li>
<li class="chapter" data-level="3.3" data-path="SI.html"><a href="SI.html#ConfidenceInterval"><i class="fa fa-check"></i><b>3.3</b> Confidence interval estimate</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="SI.html"><a href="SI.html#ConfidenceIntervalProportion"><i class="fa fa-check"></i><b>3.3.1</b> Confidence interval for proportion</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="SI.html"><a href="SI.html#SIcircularplots"><i class="fa fa-check"></i><b>3.4</b> Simple random sampling of circular plots</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="SI.html"><a href="SI.html#sampling-from-a-finite-set-of-fixed-circles"><i class="fa fa-check"></i><b>3.4.1</b> Sampling from a finite set of fixed circles</a></li>
<li class="chapter" data-level="3.4.2" data-path="SI.html"><a href="SI.html#sampling-from-an-infinite-set-of-floating-circles"><i class="fa fa-check"></i><b>3.4.2</b> Sampling from an infinite set of floating circles</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="STSI.html"><a href="STSI.html"><i class="fa fa-check"></i><b>4</b> Stratified simple random sampling</a>
<ul>
<li class="chapter" data-level="4.1" data-path="STSI.html"><a href="STSI.html#EstimatorsSTSI"><i class="fa fa-check"></i><b>4.1</b> Estimation of population parameters</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="STSI.html"><a href="STSI.html#population-proportion-cumulative-distribution-function-and-quantiles"><i class="fa fa-check"></i><b>4.1.1</b> Population proportion, cumulative distribution function, and quantiles</a></li>
<li class="chapter" data-level="4.1.2" data-path="STSI.html"><a href="STSI.html#WhyStratify"><i class="fa fa-check"></i><b>4.1.2</b> When should we stratify?</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="STSI.html"><a href="STSI.html#CISTSI"><i class="fa fa-check"></i><b>4.2</b> Confidence interval estimate</a></li>
<li class="chapter" data-level="4.3" data-path="STSI.html"><a href="STSI.html#STSIallocation"><i class="fa fa-check"></i><b>4.3</b> Allocation of sample size to strata</a></li>
<li class="chapter" data-level="4.4" data-path="STSI.html"><a href="STSI.html#cumrootf"><i class="fa fa-check"></i><b>4.4</b> <em>Cum-root-f</em> stratification</a></li>
<li class="chapter" data-level="4.5" data-path="STSI.html"><a href="STSI.html#kmeansstratification"><i class="fa fa-check"></i><b>4.5</b> Stratification with multiple covariates</a></li>
<li class="chapter" data-level="4.6" data-path="STSI.html"><a href="STSI.html#geostrata"><i class="fa fa-check"></i><b>4.6</b> Geographical stratification</a></li>
<li class="chapter" data-level="4.7" data-path="STSI.html"><a href="STSI.html#multi-way-stratification"><i class="fa fa-check"></i><b>4.7</b> Multi-way stratification</a></li>
<li class="chapter" data-level="4.8" data-path="STSI.html"><a href="STSI.html#MultivariateStratification"><i class="fa fa-check"></i><b>4.8</b> Multivariate stratification</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="SY.html"><a href="SY.html"><i class="fa fa-check"></i><b>5</b> Systematic random sampling</a>
<ul>
<li class="chapter" data-level="5.1" data-path="SY.html"><a href="SY.html#EstVarSY"><i class="fa fa-check"></i><b>5.1</b> Estimation of population parameters</a></li>
<li class="chapter" data-level="5.2" data-path="SY.html"><a href="SY.html#approximating-the-sampling-variance-of-the-estimator-of-the-mean"><i class="fa fa-check"></i><b>5.2</b> Approximating the sampling variance of the estimator of the mean</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="Cl.html"><a href="Cl.html"><i class="fa fa-check"></i><b>6</b> Cluster random sampling</a>
<ul>
<li class="chapter" data-level="6.1" data-path="Cl.html"><a href="Cl.html#clustersamplingestimators"><i class="fa fa-check"></i><b>6.1</b> Estimation of population parameters</a></li>
<li class="chapter" data-level="6.2" data-path="Cl.html"><a href="Cl.html#clusters-selected-with-probabilities-proportional-to-size-without-replacement"><i class="fa fa-check"></i><b>6.2</b> Clusters selected with probabilities proportional to size, without replacement</a></li>
<li class="chapter" data-level="6.3" data-path="Cl.html"><a href="Cl.html#SIC"><i class="fa fa-check"></i><b>6.3</b> Simple random sampling of clusters</a></li>
<li class="chapter" data-level="6.4" data-path="Cl.html"><a href="Cl.html#StratifiedCl"><i class="fa fa-check"></i><b>6.4</b> Stratified cluster random sampling</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="Twostage.html"><a href="Twostage.html"><i class="fa fa-check"></i><b>7</b> Two-stage cluster random sampling</a>
<ul>
<li class="chapter" data-level="7.1" data-path="Twostage.html"><a href="Twostage.html#twostagesamplingestimators"><i class="fa fa-check"></i><b>7.1</b> Estimation of population parameters</a></li>
<li class="chapter" data-level="7.2" data-path="Twostage.html"><a href="Twostage.html#primary-sampling-units-selected-without-replacement"><i class="fa fa-check"></i><b>7.2</b> Primary sampling units selected without replacement</a></li>
<li class="chapter" data-level="7.3" data-path="Twostage.html"><a href="Twostage.html#TwostageSISI"><i class="fa fa-check"></i><b>7.3</b> Simple random sampling of primary sampling units</a></li>
<li class="chapter" data-level="7.4" data-path="Twostage.html"><a href="Twostage.html#StratifiedTwostage"><i class="fa fa-check"></i><b>7.4</b> Stratified two-stage cluster random sampling</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="pps.html"><a href="pps.html"><i class="fa fa-check"></i><b>8</b> Sampling with probabilities proportional to size</a>
<ul>
<li class="chapter" data-level="8.1" data-path="pps.html"><a href="pps.html#ppswr"><i class="fa fa-check"></i><b>8.1</b> Probability-proportional-to-size sampling with replacement</a></li>
<li class="chapter" data-level="8.2" data-path="pps.html"><a href="pps.html#ppswor"><i class="fa fa-check"></i><b>8.2</b> Probability-proportional-to-size sampling without replacement</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="pps.html"><a href="pps.html#Systematicpps"><i class="fa fa-check"></i><b>8.2.1</b> Systematic pps sampling without replacement</a></li>
<li class="chapter" data-level="8.2.2" data-path="pps.html"><a href="pps.html#pivotalmethod"><i class="fa fa-check"></i><b>8.2.2</b> The pivotal method</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html"><i class="fa fa-check"></i><b>9</b> Balanced and well-spread sampling</a>
<ul>
<li class="chapter" data-level="9.1" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#Balanced"><i class="fa fa-check"></i><b>9.1</b> Balanced sampling</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#balanced-sample-versus-balanced-sampling-design"><i class="fa fa-check"></i><b>9.1.1</b> Balanced sample versus balanced sampling design</a></li>
<li class="chapter" data-level="9.1.2" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#unequal-inclusion-probabilities"><i class="fa fa-check"></i><b>9.1.2</b> Unequal inclusion probabilities</a></li>
<li class="chapter" data-level="9.1.3" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#StratifiedsamplingasBalancedsampling"><i class="fa fa-check"></i><b>9.1.3</b> Stratified random sampling</a></li>
<li class="chapter" data-level="9.1.4" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#Multiwaystratification"><i class="fa fa-check"></i><b>9.1.4</b> Multi-way stratification</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#Spreaded"><i class="fa fa-check"></i><b>9.2</b> Well-spread sampling</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#LPM"><i class="fa fa-check"></i><b>9.2.1</b> Local pivotal method</a></li>
<li class="chapter" data-level="9.2.2" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#GRTS"><i class="fa fa-check"></i><b>9.2.2</b> Generalised random-tessellation stratified sampling</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#BalancedandSpreaded"><i class="fa fa-check"></i><b>9.3</b> Balanced sampling with spreading</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="Modelassisted.html"><a href="Modelassisted.html"><i class="fa fa-check"></i><b>10</b> Model-assisted estimation</a>
<ul>
<li class="chapter" data-level="10.1" data-path="Modelassisted.html"><a href="Modelassisted.html#GREG"><i class="fa fa-check"></i><b>10.1</b> Generalised regression estimator</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="Modelassisted.html"><a href="Modelassisted.html#RegressionEstimator"><i class="fa fa-check"></i><b>10.1.1</b> Simple and multiple regression estimators</a></li>
<li class="chapter" data-level="10.1.2" data-path="Modelassisted.html"><a href="Modelassisted.html#penalised-least-squares-estimation"><i class="fa fa-check"></i><b>10.1.2</b> Penalised least squares estimation</a></li>
<li class="chapter" data-level="10.1.3" data-path="Modelassisted.html"><a href="Modelassisted.html#RegressionEstimatorSTSI"><i class="fa fa-check"></i><b>10.1.3</b> Regression estimator with stratified simple random sampling</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="Modelassisted.html"><a href="Modelassisted.html#RatioEstimator"><i class="fa fa-check"></i><b>10.2</b> Ratio estimator</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="Modelassisted.html"><a href="Modelassisted.html#RatioEstimatorSTSI"><i class="fa fa-check"></i><b>10.2.1</b> Ratio estimators with stratified simple random sampling</a></li>
<li class="chapter" data-level="10.2.2" data-path="Modelassisted.html"><a href="Modelassisted.html#PoststratifiedEstimator"><i class="fa fa-check"></i><b>10.2.2</b> Poststratified estimator</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="Modelassisted.html"><a href="Modelassisted.html#RandomForest"><i class="fa fa-check"></i><b>10.3</b> Model-assisted estimation using machine learning techniques</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="Modelassisted.html"><a href="Modelassisted.html#predicting-with-a-regression-tree"><i class="fa fa-check"></i><b>10.3.1</b> Predicting with a regression tree</a></li>
<li class="chapter" data-level="10.3.2" data-path="Modelassisted.html"><a href="Modelassisted.html#predicting-with-a-random-forest"><i class="fa fa-check"></i><b>10.3.2</b> Predicting with a random forest</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="Modelassisted.html"><a href="Modelassisted.html#big-data-and-volunteer-data"><i class="fa fa-check"></i><b>10.4</b> Big data and volunteer data</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="Twophase.html"><a href="Twophase.html"><i class="fa fa-check"></i><b>11</b> Two-phase random sampling</a>
<ul>
<li class="chapter" data-level="11.1" data-path="Twophase.html"><a href="Twophase.html#TwophaseStratification"><i class="fa fa-check"></i><b>11.1</b> Two-phase random sampling for stratification</a></li>
<li class="chapter" data-level="11.2" data-path="Twophase.html"><a href="Twophase.html#TwophaseRegression"><i class="fa fa-check"></i><b>11.2</b> Two-phase random sampling for regression</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html"><i class="fa fa-check"></i><b>12</b> Computing the required sample size</a>
<ul>
<li class="chapter" data-level="12.1" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#standard-error-of-estimator"><i class="fa fa-check"></i><b>12.1</b> Standard error of estimator</a></li>
<li class="chapter" data-level="12.2" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#ReqSampleSizeLengthCI"><i class="fa fa-check"></i><b>12.2</b> Length of confidence interval</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#length-of-confidence-interval-for-a-proportion"><i class="fa fa-check"></i><b>12.2.1</b> Length of confidence interval for a proportion</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#statistical-testing-of-hypothesis"><i class="fa fa-check"></i><b>12.3</b> Statistical testing of hypothesis</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#sample-size-for-testing-a-proportion"><i class="fa fa-check"></i><b>12.3.1</b> Sample size for testing a proportion</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#DesignEffect"><i class="fa fa-check"></i><b>12.4</b> Accounting for design effect</a></li>
<li class="chapter" data-level="12.5" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#BayesianSampleSize"><i class="fa fa-check"></i><b>12.5</b> Bayesian sample size determination</a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#bayesian-criteria-for-sample-size-computation"><i class="fa fa-check"></i><b>12.5.1</b> Bayesian criteria for sample size computation</a></li>
<li class="chapter" data-level="12.5.2" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#mixed-bayesian-likelihood-approach"><i class="fa fa-check"></i><b>12.5.2</b> Mixed Bayesian-likelihood approach</a></li>
<li class="chapter" data-level="12.5.3" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#estimation-of-population-mean"><i class="fa fa-check"></i><b>12.5.3</b> Estimation of population mean</a></li>
<li class="chapter" data-level="12.5.4" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#estimation-of-a-population-proportion"><i class="fa fa-check"></i><b>12.5.4</b> Estimation of a population proportion</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="MBpredictionofDesignVariance.html"><a href="MBpredictionofDesignVariance.html"><i class="fa fa-check"></i><b>13</b> Model-based optimisation of probability sampling designs</a>
<ul>
<li class="chapter" data-level="13.1" data-path="MBpredictionofDesignVariance.html"><a href="MBpredictionofDesignVariance.html#model-based-optimisation-of-sampling-design-type-and-sample-size"><i class="fa fa-check"></i><b>13.1</b> Model-based optimisation of sampling design type and sample size</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="MBpredictionofDesignVariance.html"><a href="MBpredictionofDesignVariance.html#AnalyticalApproach"><i class="fa fa-check"></i><b>13.1.1</b> Analytical approach</a></li>
<li class="chapter" data-level="13.1.2" data-path="MBpredictionofDesignVariance.html"><a href="MBpredictionofDesignVariance.html#GeostatisticalSimulationApproach"><i class="fa fa-check"></i><b>13.1.2</b> Geostatistical simulation approach</a></li>
<li class="chapter" data-level="13.1.3" data-path="MBpredictionofDesignVariance.html"><a href="MBpredictionofDesignVariance.html#MBpredSamplingVarBayes"><i class="fa fa-check"></i><b>13.1.3</b> Bayesian approach</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="MBpredictionofDesignVariance.html"><a href="MBpredictionofDesignVariance.html#Ospats"><i class="fa fa-check"></i><b>13.2</b> Model-based optimisation of spatial strata</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html"><i class="fa fa-check"></i><b>14</b> Sampling for estimating parameters of (small) domains</a>
<ul>
<li class="chapter" data-level="14.1" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#LargeDomainsDirectEstimator"><i class="fa fa-check"></i><b>14.1</b> Direct estimator for large domains</a></li>
<li class="chapter" data-level="14.2" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#SmallDomainsModelAssisted"><i class="fa fa-check"></i><b>14.2</b> Model-assisted estimators for small domains</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#RegressionestimatorSmallDomain"><i class="fa fa-check"></i><b>14.2.1</b> Regression estimator</a></li>
<li class="chapter" data-level="14.2.2" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#SyntheticestimatorSmallDomain"><i class="fa fa-check"></i><b>14.2.2</b> Synthetic estimator</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#SmallAreaModelBased"><i class="fa fa-check"></i><b>14.3</b> Model-based prediction</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#random-intercept-model"><i class="fa fa-check"></i><b>14.3.1</b> Random intercept model</a></li>
<li class="chapter" data-level="14.3.2" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#geostatistical-model"><i class="fa fa-check"></i><b>14.3.2</b> Geostatistical model</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#supplemental-probability-sampling-of-small-domains"><i class="fa fa-check"></i><b>14.4</b> Supplemental probability sampling of small domains</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html"><i class="fa fa-check"></i><b>15</b> Repeated sample surveys for monitoring population parameters</a>
<ul>
<li class="chapter" data-level="15.1" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#space-time-designs"><i class="fa fa-check"></i><b>15.1</b> Space-time designs</a></li>
<li class="chapter" data-level="15.2" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#SpaceTimeparameters"><i class="fa fa-check"></i><b>15.2</b> Space-time population parameters</a></li>
<li class="chapter" data-level="15.3" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#design-based-generalised-least-squares-estimation-of-spatial-means"><i class="fa fa-check"></i><b>15.3</b> Design-based generalised least squares estimation of spatial means</a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#current-mean"><i class="fa fa-check"></i><b>15.3.1</b> Current mean</a></li>
<li class="chapter" data-level="15.3.2" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#change-of-the-spatial-mean"><i class="fa fa-check"></i><b>15.3.2</b> Change of the spatial mean</a></li>
<li class="chapter" data-level="15.3.3" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#temporal-trend-of-the-spatial-mean"><i class="fa fa-check"></i><b>15.3.3</b> Temporal trend of the spatial mean</a></li>
<li class="chapter" data-level="15.3.4" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#space-time-mean"><i class="fa fa-check"></i><b>15.3.4</b> Space-time mean</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#case-study-annual-mean-daily-temperature-in-spain"><i class="fa fa-check"></i><b>15.4</b> Case study: annual mean daily temperature in Spain</a>
<ul>
<li class="chapter" data-level="15.4.1" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#static-synchronous-design"><i class="fa fa-check"></i><b>15.4.1</b> Static-synchronous design</a></li>
<li class="chapter" data-level="15.4.2" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#independent-synchronous-design"><i class="fa fa-check"></i><b>15.4.2</b> Independent synchronous design</a></li>
<li class="chapter" data-level="15.4.3" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#serially-alternating-design"><i class="fa fa-check"></i><b>15.4.3</b> Serially alternating design</a></li>
<li class="chapter" data-level="15.4.4" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#supplemented-panel-design"><i class="fa fa-check"></i><b>15.4.4</b> Supplemented panel design</a></li>
<li class="chapter" data-level="15.4.5" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#rotating-panel-design"><i class="fa fa-check"></i><b>15.4.5</b> Rotating panel design</a></li>
<li class="chapter" data-level="15.4.6" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#sampling-experiment"><i class="fa fa-check"></i><b>15.4.6</b> Sampling experiment</a></li>
</ul></li>
<li class="chapter" data-level="15.5" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#space-time-sampling-with-stratified-random-sampling-in-space"><i class="fa fa-check"></i><b>15.5</b> Space-time sampling with stratified random sampling in space</a></li>
</ul></li>
<li class="part"><span><b>II Sampling for mapping</b></span></li>
<li class="chapter" data-level="16" data-path="IntroSamplingforMapping.html"><a href="IntroSamplingforMapping.html"><i class="fa fa-check"></i><b>16</b> Introduction to sampling for mapping</a>
<ul>
<li class="chapter" data-level="16.1" data-path="IntroSamplingforMapping.html"><a href="IntroSamplingforMapping.html#when-is-probability-sampling-not-required"><i class="fa fa-check"></i><b>16.1</b> When is probability sampling not required?</a></li>
<li class="chapter" data-level="16.2" data-path="IntroSamplingforMapping.html"><a href="IntroSamplingforMapping.html#sampling-for-simultaneously-mapping-and-estimating-means"><i class="fa fa-check"></i><b>16.2</b> Sampling for simultaneously mapping and estimating means</a>
<ul>
<li class="chapter" data-level="16.2.1" data-path="IntroSamplingforMapping.html"><a href="IntroSamplingforMapping.html#balanced-stratified-random-sampling"><i class="fa fa-check"></i><b>16.2.1</b> Balanced stratified random sampling</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="IntroSamplingforMapping.html"><a href="IntroSamplingforMapping.html#broad-overview-of-sampling-designs-for-mapping"><i class="fa fa-check"></i><b>16.3</b> Broad overview of sampling designs for mapping</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="RegularGridSpatialCoverage.html"><a href="RegularGridSpatialCoverage.html"><i class="fa fa-check"></i><b>17</b> Regular grid and spatial coverage sampling</a>
<ul>
<li class="chapter" data-level="17.1" data-path="RegularGridSpatialCoverage.html"><a href="RegularGridSpatialCoverage.html#Regulargrid"><i class="fa fa-check"></i><b>17.1</b> Regular grid sampling</a></li>
<li class="chapter" data-level="17.2" data-path="RegularGridSpatialCoverage.html"><a href="RegularGridSpatialCoverage.html#SpatialCoverage"><i class="fa fa-check"></i><b>17.2</b> Spatial coverage sampling</a></li>
<li class="chapter" data-level="17.3" data-path="RegularGridSpatialCoverage.html"><a href="RegularGridSpatialCoverage.html#SpatialInfill"><i class="fa fa-check"></i><b>17.3</b> Spatial infill sampling</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="kmeans.html"><a href="kmeans.html"><i class="fa fa-check"></i><b>18</b> Covariate space coverage sampling</a>
<ul>
<li class="chapter" data-level="18.1" data-path="kmeans.html"><a href="kmeans.html#covariate-space-infill-sampling"><i class="fa fa-check"></i><b>18.1</b> Covariate space infill sampling</a></li>
<li class="chapter" data-level="18.2" data-path="kmeans.html"><a href="kmeans.html#PerformanceCSC"><i class="fa fa-check"></i><b>18.2</b> Performance of covariate space coverage sampling in random forest prediction</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="cLHS.html"><a href="cLHS.html"><i class="fa fa-check"></i><b>19</b> Conditioned Latin hypercube sampling</a>
<ul>
<li class="chapter" data-level="19.1" data-path="cLHS.html"><a href="cLHS.html#cLHIS"><i class="fa fa-check"></i><b>19.1</b> Conditioned Latin hypercube infill sampling</a></li>
<li class="chapter" data-level="19.2" data-path="cLHS.html"><a href="cLHS.html#performance-of-conditioned-latin-hypercube-sampling-in-random-forest-prediction"><i class="fa fa-check"></i><b>19.2</b> Performance of conditioned Latin hypercube sampling in random forest prediction</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="SpatialResponseSurface.html"><a href="SpatialResponseSurface.html"><i class="fa fa-check"></i><b>20</b> Spatial response surface sampling</a>
<ul>
<li class="chapter" data-level="20.1" data-path="SpatialResponseSurface.html"><a href="SpatialResponseSurface.html#IncreaseSampleSize"><i class="fa fa-check"></i><b>20.1</b> Increasing the sample size</a></li>
<li class="chapter" data-level="20.2" data-path="SpatialResponseSurface.html"><a href="SpatialResponseSurface.html#stratified-spatial-response-surface-sampling"><i class="fa fa-check"></i><b>20.2</b> Stratified spatial response surface sampling</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="Introkriging.html"><a href="Introkriging.html"><i class="fa fa-check"></i><b>21</b> Introduction to kriging</a>
<ul>
<li class="chapter" data-level="21.1" data-path="Introkriging.html"><a href="Introkriging.html#ordinary-kriging"><i class="fa fa-check"></i><b>21.1</b> Ordinary kriging</a></li>
<li class="chapter" data-level="21.2" data-path="Introkriging.html"><a href="Introkriging.html#BlockKriging"><i class="fa fa-check"></i><b>21.2</b> Block-kriging</a></li>
<li class="chapter" data-level="21.3" data-path="Introkriging.html"><a href="Introkriging.html#IntroKED"><i class="fa fa-check"></i><b>21.3</b> Kriging with an external drift</a></li>
<li class="chapter" data-level="21.4" data-path="Introkriging.html"><a href="Introkriging.html#VariogramEstimation"><i class="fa fa-check"></i><b>21.4</b> Estimating the semivariogram</a>
<ul>
<li class="chapter" data-level="21.4.1" data-path="Introkriging.html"><a href="Introkriging.html#MoM"><i class="fa fa-check"></i><b>21.4.1</b> Method-of-moments</a></li>
<li class="chapter" data-level="21.4.2" data-path="Introkriging.html"><a href="Introkriging.html#MLestimationVariogram"><i class="fa fa-check"></i><b>21.4.2</b> Maximum likelihood</a></li>
</ul></li>
<li class="chapter" data-level="21.5" data-path="Introkriging.html"><a href="Introkriging.html#ResidualVariogram"><i class="fa fa-check"></i><b>21.5</b> Estimating the residual semivariogram</a>
<ul>
<li class="chapter" data-level="21.5.1" data-path="Introkriging.html"><a href="Introkriging.html#IterativeMoM"><i class="fa fa-check"></i><b>21.5.1</b> Iterative method-of-moments</a></li>
<li class="chapter" data-level="21.5.2" data-path="Introkriging.html"><a href="Introkriging.html#REML"><i class="fa fa-check"></i><b>21.5.2</b> Restricted maximum likelihood</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="22" data-path="MBgridspacing.html"><a href="MBgridspacing.html"><i class="fa fa-check"></i><b>22</b> Model-based optimisation of the grid spacing</a>
<ul>
<li class="chapter" data-level="22.1" data-path="MBgridspacing.html"><a href="MBgridspacing.html#GridspacingOK"><i class="fa fa-check"></i><b>22.1</b> Optimal grid spacing for ordinary kriging</a></li>
<li class="chapter" data-level="22.2" data-path="MBgridspacing.html"><a href="MBgridspacing.html#controlling-the-mean-or-a-quantile-of-the-ordinary-kriging-variance"><i class="fa fa-check"></i><b>22.2</b> Controlling the mean or a quantile of the ordinary kriging variance</a></li>
<li class="chapter" data-level="22.3" data-path="MBgridspacing.html"><a href="MBgridspacing.html#optimal-grid-spacing-for-block-kriging"><i class="fa fa-check"></i><b>22.3</b> Optimal grid spacing for block-kriging</a></li>
<li class="chapter" data-level="22.4" data-path="MBgridspacing.html"><a href="MBgridspacing.html#MBgridspacingKED"><i class="fa fa-check"></i><b>22.4</b> Optimal grid spacing for kriging with an external drift</a></li>
<li class="chapter" data-level="22.5" data-path="MBgridspacing.html"><a href="MBgridspacing.html#BayesianGridSpacing"><i class="fa fa-check"></i><b>22.5</b> Bayesian approach</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="MBSamplePattern.html"><a href="MBSamplePattern.html"><i class="fa fa-check"></i><b>23</b> Model-based optimisation of the sampling pattern</a>
<ul>
<li class="chapter" data-level="23.1" data-path="MBSamplePattern.html"><a href="MBSamplePattern.html#SSA"><i class="fa fa-check"></i><b>23.1</b> Spatial simulated annealing</a></li>
<li class="chapter" data-level="23.2" data-path="MBSamplePattern.html"><a href="MBSamplePattern.html#SamplePatternOK"><i class="fa fa-check"></i><b>23.2</b> Optimising the sampling pattern for ordinary kriging</a></li>
<li class="chapter" data-level="23.3" data-path="MBSamplePattern.html"><a href="MBSamplePattern.html#SamplePatternKED"><i class="fa fa-check"></i><b>23.3</b> Optimising the sampling pattern for kriging with an external drift</a></li>
<li class="chapter" data-level="23.4" data-path="MBSamplePattern.html"><a href="MBSamplePattern.html#model-based-infill-sampling-for-ordinary-kriging"><i class="fa fa-check"></i><b>23.4</b> Model-based infill sampling for ordinary kriging</a></li>
<li class="chapter" data-level="23.5" data-path="MBSamplePattern.html"><a href="MBSamplePattern.html#model-based-infill-sampling-for-kriging-with-an-external-drift"><i class="fa fa-check"></i><b>23.5</b> Model-based infill sampling for kriging with an external drift</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html"><i class="fa fa-check"></i><b>24</b> Sampling for estimating the semivariogram</a>
<ul>
<li class="chapter" data-level="24.1" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#nested-sampling"><i class="fa fa-check"></i><b>24.1</b> Nested sampling</a></li>
<li class="chapter" data-level="24.2" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#independent-sampling-of-pairs-of-points"><i class="fa fa-check"></i><b>24.2</b> Independent sampling of pairs of points</a></li>
<li class="chapter" data-level="24.3" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#samplingforvariogram"><i class="fa fa-check"></i><b>24.3</b> Optimisation of sampling pattern for semivariogram estimation</a>
<ul>
<li class="chapter" data-level="24.3.1" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#UncertainSemivariogramParameters"><i class="fa fa-check"></i><b>24.3.1</b> Uncertainty about semivariogram parameters</a></li>
<li class="chapter" data-level="24.3.2" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#UncertainKrigingVariance"><i class="fa fa-check"></i><b>24.3.2</b> Uncertainty about the kriging variance</a></li>
</ul></li>
<li class="chapter" data-level="24.4" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#SamplingEstimationandPrediction"><i class="fa fa-check"></i><b>24.4</b> Optimisation of sampling pattern for semivariogram estimation and mapping</a></li>
<li class="chapter" data-level="24.5" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#a-practical-solution"><i class="fa fa-check"></i><b>24.5</b> A practical solution</a></li>
</ul></li>
<li class="chapter" data-level="25" data-path="Validation.html"><a href="Validation.html"><i class="fa fa-check"></i><b>25</b> Sampling for validation of maps</a>
<ul>
<li class="chapter" data-level="25.1" data-path="Validation.html"><a href="Validation.html#map-quality-indices"><i class="fa fa-check"></i><b>25.1</b> Map quality indices</a>
<ul>
<li class="chapter" data-level="25.1.1" data-path="Validation.html"><a href="Validation.html#estimation-of-map-quality-indices"><i class="fa fa-check"></i><b>25.1.1</b> Estimation of map quality indices</a></li>
</ul></li>
<li class="chapter" data-level="25.2" data-path="Validation.html"><a href="Validation.html#real-world-case-study"><i class="fa fa-check"></i><b>25.2</b> Real-world case study</a>
<ul>
<li class="chapter" data-level="25.2.1" data-path="Validation.html"><a href="Validation.html#estimation-of-the-population-mean-error-and-mean-squared-error"><i class="fa fa-check"></i><b>25.2.1</b> Estimation of the population Mean Error and Mean Squared Error</a></li>
<li class="chapter" data-level="25.2.2" data-path="Validation.html"><a href="Validation.html#estimation-of-the-standard-error-of-the-estimated-population-me-and-mse"><i class="fa fa-check"></i><b>25.2.2</b> Estimation of the standard error of the estimated population ME and MSE</a></li>
<li class="chapter" data-level="25.2.3" data-path="Validation.html"><a href="Validation.html#estimation-of-mec"><i class="fa fa-check"></i><b>25.2.3</b> Estimation of MEC</a></li>
<li class="chapter" data-level="25.2.4" data-path="Validation.html"><a href="Validation.html#statistical-testing-of-hypothesis-about-population-me-and-mse"><i class="fa fa-check"></i><b>25.2.4</b> Statistical testing of hypothesis about population ME and MSE</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="26" data-path="Approaches.html"><a href="Approaches.html"><i class="fa fa-check"></i><b>26</b> Design-based, model-based, and model-assisted approach for sampling and inference</a>
<ul>
<li class="chapter" data-level="26.1" data-path="Approaches.html"><a href="Approaches.html#two-sources-of-randomness"><i class="fa fa-check"></i><b>26.1</b> Two sources of randomness</a></li>
<li class="chapter" data-level="26.2" data-path="Approaches.html"><a href="Approaches.html#iid"><i class="fa fa-check"></i><b>26.2</b> “Identically and independently distributed” (i.i.d.)</a></li>
<li class="chapter" data-level="26.3" data-path="Approaches.html"><a href="Approaches.html#BiasandVariance"><i class="fa fa-check"></i><b>26.3</b> Bias and variance</a></li>
<li class="chapter" data-level="26.4" data-path="Approaches.html"><a href="Approaches.html#effectivesamplesize"><i class="fa fa-check"></i><b>26.4</b> Effective sample size</a></li>
<li class="chapter" data-level="26.5" data-path="Approaches.html"><a href="Approaches.html#ExploitSpatialStructure"><i class="fa fa-check"></i><b>26.5</b> Exploiting spatial structure in design-based approach</a></li>
<li class="chapter" data-level="26.6" data-path="Approaches.html"><a href="Approaches.html#ModelassistedvsModeldependent"><i class="fa fa-check"></i><b>26.6</b> Model-assisted versus model-dependent</a></li>
</ul></li>
<li class="appendix"><span><b>Appendices</b></span></li>
<li class="chapter" data-level="A" data-path="Answers.html"><a href="Answers.html"><i class="fa fa-check"></i><b>A</b> Answers to exercises</a>
<ul>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#introduction-to-probability-sampling"><i class="fa fa-check"></i>Introduction to probability sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#simple-random-sampling-1"><i class="fa fa-check"></i>Simple random sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#stratified-random-sampling"><i class="fa fa-check"></i>Stratified random sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#systematic-random-sampling-2"><i class="fa fa-check"></i>Systematic random sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#cluster-random-sampling"><i class="fa fa-check"></i>Cluster random sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#two-stage-random-sampling"><i class="fa fa-check"></i>Two-stage random sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#sampling-with-probabilities-proportional-to-size"><i class="fa fa-check"></i>Sampling with probabilities proportional to size</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#balanced-and-well-spread-sampling"><i class="fa fa-check"></i>Balanced and well-spread sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#model-assisted-estimation"><i class="fa fa-check"></i>Model-assisted estimation</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#two-phase-random-sampling"><i class="fa fa-check"></i>Two-phase random sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#computing-the-required-sample-size"><i class="fa fa-check"></i>Computing the required sample size</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#model-based-optimisation-of-probability-sampling-designs"><i class="fa fa-check"></i>Model-based optimisation of probability sampling designs</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#repeated-sample-surveys-for-monitoring-population-parameters"><i class="fa fa-check"></i>Repeated sample surveys for monitoring population parameters</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#regular-grid-and-spatial-coverage-sampling"><i class="fa fa-check"></i>Regular grid and spatial coverage sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#covariate-space-coverage-sampling"><i class="fa fa-check"></i>Covariate space coverage sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#conditioned-latin-hypercube-sampling"><i class="fa fa-check"></i>Conditioned Latin hypercube sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#model-based-optimisation-of-the-grid-spacing"><i class="fa fa-check"></i>Model-based optimisation of the grid spacing</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#model-based-optimisation-of-the-sampling-pattern"><i class="fa fa-check"></i>Model-based optimisation of the sampling pattern</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#sampling-for-estimating-the-semivariogram"><i class="fa fa-check"></i>Sampling for estimating the semivariogram</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#sampling-for-validation-of-maps"><i class="fa fa-check"></i>Sampling for validation of maps</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/DickBrus/">Dick Brus</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Spatial sampling with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="Introkriging" class="section level1" number="21">
<h1><span class="header-section-number">Chapter 21</span> Introduction to kriging</h1>
<p>In the following chapters a geostatistical model, i.e. a statistical model of the spatial variation of the study variable, is used to optimise the sample size and/or spatial pattern of the sampling units. This chapter is a short introduction to geostatistical modelling.</p>
<p>In Chapter <a href="MBpredictionofDesignVariance.html#MBpredictionofDesignVariance">13</a> we have already seen how a geostatistical model can be used to optimise probability sampling designs for estimating the population mean or total. In the following chapters the focus is on mapping. A map of the study variable is obtained by predicting the study variable at the nodes of a fine discretisation grid. Spatial prediction using a geostatistical model is referred to as kriging <span class="citation">(<a href="#ref-webster2007" role="doc-biblioref">Webster and Oliver 2007</a>)</span>.</p>
<p>With this prediction method besides a map of the kriging predictions, a map of the variance of the prediction error is obtained. I show hereafter that this prediction error variance is not influenced by the values of the study variable at the sampling units. For this reason it is possible to search, before the start of the survey, for the sampling locations that lead to the minimum prediction error variance averaged over all nodes of a fine prediction grid, provided that the geostatistical model is known up to some extent.</p>
<div id="ordinary-kriging" class="section level2" number="21.1">
<h2><span class="header-section-number">21.1</span> Ordinary kriging</h2>
<p>The kriging predictions and prediction error variances are derived from a statistical model of the spatial variation of the study variable. There are several versions of kriging, building on different models of the spatial variation. In <em>ordinary kriging</em> (OK) it is assumed that the mean of the study variable is constant, i.e. the same everywhere <span class="citation">(<a href="#ref-webster2007" role="doc-biblioref">Webster and Oliver 2007</a>)</span>:</p>
<p><span class="math display" id="eq:OKmodel">\[\begin{equation}
\begin{split}
Z(\mathbf{s}) &amp;= \mu + \epsilon(\mathbf{s}) \\
\epsilon(\mathbf{s}) &amp;\sim \mathcal{N}(0,\sigma^2) \\
\mathrm{Cov}(\epsilon(\mathbf{s}),\epsilon(\mathbf{s}^{\prime})) &amp;= C(\mathbf{h})\;,
\end{split}
\tag{21.1}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(Z(\mathbf{s})\)</span> the study variable at location <span class="math inline">\(\mathbf{s}\)</span>, <span class="math inline">\(\mu\)</span> the constant mean, independent of the location <span class="math inline">\(\mathbf{s}\)</span>, <span class="math inline">\(\epsilon(\mathbf{s})\)</span> the error or residual (difference between study variable <span class="math inline">\(z\)</span> and mean <span class="math inline">\(\mu\)</span>) at location <span class="math inline">\(\mathbf{s}\)</span> and <span class="math inline">\(C(\mathbf{h})\)</span> the covariance of <span class="math inline">\(\epsilon\)</span> at two points separated by vector <span class="math inline">\(\mathbf{h} = \mathbf{s} - \mathbf{s}^{\prime}\)</span>. <span class="math inline">\(C(\cdot)\)</span> is the covariance function, also referred to as the covariogram, and a scaled version of it obtained by dividing <span class="math inline">\(C(\cdot)\)</span> by the variance <span class="math inline">\(C(0)\)</span>, is the correlation function or correlogram. Stated otherwise, in OK we assume <em>stationarity in the mean</em> over the area to be mapped. The residuals are not independent, but spatially correlated. If we have, for instance, a large positive residual at some location <span class="math inline">\(\mathbf{s}\)</span>, then in many cases we also have a positive residual at a nearby location <span class="math inline">\(\mathbf{s}^{\prime}\)</span>.</p>
<p>If the data set is of substantial size, it is possible to define a neighbourhood: not all sample data are used to predict the study variable at a prediction location, but only the sample data in this neighbourhood. This implies that the stationarity assumption is relaxed to the often more realistic assumption of a constant mean within neighbourhoods.</p>
<p>In OK, the study variable at a prediction location <span class="math inline">\(\mathbf{s}_0\)</span>, <span class="math inline">\(\widehat{Z}(\mathbf{s}_0)\)</span>, is predicted as a weighted average of the observations at the sampling locations (within the neighbourhood):</p>
<p><span class="math display" id="eq:weightedsumkriging">\[\begin{equation}
\widehat{Z}_{\mathrm{OK}}(\mathbf{s}_0)=\sum_{i=1}^{n}\lambda_i \,Z(\mathbf{s}_i) \;,
\tag{21.2}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(Z(\mathbf{s}_i)\)</span> is the study variable at the <span class="math inline">\(i^{\mathrm{th}}\)</span> sampling location and <span class="math inline">\(\lambda _{i}\)</span> is the weight attached to this location. The weights should be related to the correlation of the study variable at the sampling location and the prediction location. Note that as the mean is assumed constant (Equation <a href="Introkriging.html#eq:OKmodel">(21.1)</a>), the correlation of the study variable <span class="math inline">\(Z\)</span> is equal to the correlation of the residual <span class="math inline">\(\epsilon\)</span>. Roughly speaking, the stronger this correlation, the larger the weight must be. If we have a model for this correlation, then we can use this model to find the optimal weights. Further, if two sampling locations are very close, the weight attached to these two locations should not be twice the weight attached to a single, isolated sampling location at the same distance of the prediction location. This explains that in computing the kriging weights, besides the covariances of the <span class="math inline">\(n\)</span> pairs of prediction location and sampling location, also the covariances of the <span class="math inline">\(n\cdot(n-1)/2\)</span> pairs that can be formed with the <span class="math inline">\(n\)</span> sampling units are used. For OK, the optimal weights, i.e. the weights that lead to the model-unbiased<a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a> predictor with minimum error variance (best linear unbiased predictor) can be found by solving the following <span class="math inline">\(n+1\)</span> equations:</p>
<p><span class="math display" id="eq:krigingequations">\[\begin{equation}
\begin{array}{ccccc}
\sum\limits_{j=1}^{n}\lambda _{j}\,C(\mathbf{s}_1,\mathbf{s}_j)&amp;+&amp;\nu &amp;=&amp;C(\mathbf{s}_1,\mathbf{s}_0)\\
\sum\limits_{j=1}^{n}\lambda _{j}\,C(\mathbf{s}_2,\mathbf{s}_j)&amp;+&amp;\nu &amp;=&amp;C(\mathbf{s}_2,\mathbf{s}_0)\\
&amp;&amp;&amp;\vdots\\
\sum\limits_{j=1}^{n}\lambda _{j}\,C(\mathbf{s}_n,\mathbf{s}_j)&amp;+&amp;\nu &amp;=&amp;C(\mathbf{s}_n,\mathbf{s}_0)\\
\sum\limits_{j=1}^{n}\lambda _{j}&amp;&amp;&amp;=&amp;1
\end{array} \;,
\tag{21.3}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(C(\mathbf{s}_i,\mathbf{s}_j)\)</span> is the covariance of the <span class="math inline">\(i\)</span>th and <span class="math inline">\(j\)</span>th sampling location, <span class="math inline">\(C(\mathbf{s}_i,\mathbf{s}_0)\)</span> is the covariance of the <span class="math inline">\(i\)</span>th sampling location and the prediction location <span class="math inline">\(s_0\)</span> and <span class="math inline">\(\nu\)</span> is an extra parameter to be estimated, referred to as the Lagrange multiplier. This Lagrange multiplier must be included in the set of equations because the error variance is minimised under the constraint that the kriging weights sum to 1, see the final line in Equation <a href="Introkriging.html#eq:krigingequations">(21.3)</a>. This constraint ensures that the OK-predictor is model-unbiased. It is convenient to write this system of equations in matrix form:</p>
<p><span class="math display" id="eq:krigingeqsmatrix">\[\begin{eqnarray}
\left[
\begin{array}{ccccc}
C_{11}&amp;C_{12}&amp;\dots&amp;C_{1n}&amp;1\\
C_{21}&amp;C_{22}&amp;\dots&amp;C_{2n}&amp;1\\
\vdots&amp;\vdots&amp;\dots&amp;\vdots&amp;\vdots\\
C_{n1}&amp;C_{n2}&amp;\dots&amp;C_{nn}&amp;1\\
1&amp;1&amp;\dots&amp;1&amp;0\\
\end{array}
\right]
\left[
\begin{array}{c}
\lambda_1\\
\lambda_2\\
\vdots\\
\lambda_n\\
\nu\\
\end{array}
\right]
=
\left[
\begin{array}{c}
C_{10}\\
C_{20}\\
\vdots\\
C_{n0}\\
1\\
\end{array}
\right]\;.
\tag{21.4}
\end{eqnarray}\]</span></p>
<p>Replacing submatrices by single symbols results in the shorthand matrix equation:</p>
<p><span class="math display" id="eq:OKsystemshort">\[\begin{eqnarray}
\left[
\begin{array}{cc}
\mathbf{C} &amp; \mathbf{1} \\
\mathbf{1}^{\mathrm{T}} &amp; 0 \\
\end{array}
\right]
\left[
\begin{array}{c}
\pmb{\lambda}\\
\nu\\
\end{array}
\right]
=
\left[
\begin{array}{c}
\mathbf{c}_0\\
1\\
\end{array}
\right]\;.
\tag{21.5}
\end{eqnarray}\]</span></p>
<p>The kriging weights <span class="math inline">\(\pmb{\lambda}\)</span> and the Lagrange multiplier <span class="math inline">\(\nu\)</span> can then be computed by premultiplying both sides of Equation <a href="Introkriging.html#eq:OKsystemshort">(21.5)</a> with the inverse of the first matrix of this equation:</p>
<p><span class="math display" id="eq:krigingweights">\[\begin{eqnarray}
\left[
\begin{array}{c}
\lambda\\
\nu\\
\end{array}
\right]
=
\left[
\begin{array}{cc}
\mathbf{C} &amp; \mathbf{1} \\
\mathbf{1}^{\mathrm{T}} &amp; 0 \\
\end{array}
\right]^{-1}
\left[
\begin{array}{c}
\mathbf{c}_0\\
1\\
\end{array}
\right]\;.
\tag{21.6}
\end{eqnarray}\]</span></p>
<p>The variance of the prediction error (ordinary kriging variance, OK variance) at a prediction location equals</p>
<p><span class="math display" id="eq:OKvariance">\[\begin{equation}
V_{\mathrm{OK}}(\widehat{Z}(\mathbf{s}_0))= \sigma^2 - \lambda^{\mathrm{T}}\mathbf{c}_0 - \nu \;,
\tag{21.7}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(\sigma^2\)</span> the a priori variance, see Equation <a href="Introkriging.html#eq:OKmodel">(21.1)</a>. This equation shows that the OK variance is not a function of the data at the sampling locations. Given a covariance function it is fully determined by the coordinates of the sampling locations and of the prediction location. It is this property of kriging that makes it possible to optimise the grid-spacing (Chapter <a href="MBgridspacing.html#MBgridspacing">22</a>) and, as we will see in Chapter <a href="MBSamplePattern.html#MBSamplePattern">23</a>, to optimise the spatial pattern of the sampling units, given a requirement on the kriging variance. If the kriging variance were a function of the data at the sampling locations, optimisation would be much more complicated.</p>
<p>In general practice, the covariance function is not used in kriging, rather, a semivariogram. A semivariogram <span class="math inline">\(\gamma(\mathbf{h})\)</span> is a model of the <em>dissimilarity</em> of the study variable at two locations, as a function of the vector <span class="math inline">\(\mathbf{h}\)</span> separating the two locations. The dissimilarity is quantified by half the variance of the difference of the study variable <span class="math inline">\(Z\)</span> at two locations. Under the assumption that the expectation of <span class="math inline">\(Z\)</span> is constant throughout the study area (stationarity in the mean), half the variance of the difference is equal to half the expectation of the squared difference:</p>
<p><span class="math display" id="eq:semivariogram">\[\begin{equation}
\gamma(\mathbf{h}) = 0.5V[Z(\mathbf{s})-Z(\mathbf{s}+\mathbf{h})]=0.5E[\{Z(\mathbf{s})-Z(\mathbf{s}+\mathbf{h})\}^2]\;.
\tag{21.8}
\end{equation}\]</span></p>
<p>A covariance function and semivariogram are related by (see Figure <a href="Introkriging.html#fig:CovFunctionVariogram">21.1</a>)</p>
<p><span class="math display" id="eq:gammavscov">\[\begin{equation}
\gamma(\mathbf{h}) = \sigma^2 - C(\mathbf{h})\;.
\tag{21.9}
\end{equation}\]</span></p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:CovFunctionVariogram"></span>
<img src="SpatialSampling_files/figure-html/CovFunctionVariogram-1.png" alt="Spherical covariance function (red line and dot) and semivariogram (black line and dot)." width="80%" />
<p class="caption">
Figure 21.1: Spherical covariance function (red line and dot) and semivariogram (black line and dot).
</p>
</div>
<p>Expressed in terms of the <em>semivariances</em> between the sampling points and a prediction point, the OK variance is</p>
<p><span class="math display" id="eq:OKvariancesemivariances">\[\begin{equation}
V_{\mathrm{OK}}(\widehat{Z}(\mathbf{s}_0))= \lambda^{\mathrm{T}}\pmb{\gamma}_0 + \nu \;,
\tag{21.10}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(\pmb{\gamma}_0\)</span> the vector with semivariances between the sampling points and a prediction point.</p>
<p>Computing the kriging predictor requires a model for the covariance (or semivariance) as a function of the vector separating two locations. Often the covariance is modelled as a function of the length of the separation vector only, so as a function of the Euclidian distance between two locations. We then assume isotropy.
Only authorised functions are allowed for modelling the semivariance, ensuring that the variance of any linear combination of random variables, like the kriging predictor, is positive. Commonly used functions are an exponential, spherical and Mat<span class="math inline">\(\acute{\text{e}}\)</span>rn model.</p>
<p>The spherical semivariogram model has three parameters:</p>
<ol style="list-style-type: decimal">
<li>nugget (<span class="math inline">\(c_0\)</span>): this is where the semivariogram crosses the y-axis (in Figure <a href="Introkriging.html#fig:CovFunctionVariogram">21.1</a>: 25);</li>
<li>partial sill (<span class="math inline">\(c_1\)</span>): the difference between the maximum semivariance and the nugget (in Figure <a href="Introkriging.html#fig:CovFunctionVariogram">21.1</a>: 75); and</li>
<li>Range (<span class="math inline">\(\phi\)</span>): this is the distance at which the semivariance reaches its maximum (in Figure <a href="Introkriging.html#fig:CovFunctionVariogram">21.1</a>: 250 m).</li>
</ol>
<p>The formula for the spherical semivariogram is</p>
<p><span class="math display" id="eq:spherical">\[\begin{equation}
\gamma(h)=\left \{
\begin{array}{ll}
0      &amp;\,\,\,\mathrm{if}\,\,\, h=0 \\
c_0+c_1\left[ 1-\frac{3}{2}\left( \frac{h}{\phi}\right) +\frac{1}{2}\left( \frac{h}{\phi}\right) ^{3}\right] &amp;\,\,\,\mathrm{if}\,\,\, 0 &lt; h \leq \phi \\
c_0+c_1     &amp; \,\,\,\mathrm{if}\,\,\, h&gt;\phi
\end{array}
\right.
\tag{21.11}
\end{equation}\]</span></p>
<p>The sum of the nugget and the partial sill is referred to as the sill (or sill variance, or a priori variance). An exponential semivariogram model also has three parameters. Its formula is</p>
<p><span class="math display" id="eq:exponential">\[\begin{equation}
\gamma(h)=\left \{
\begin{array}{ll}
0      &amp;\,\,\,\text{if}\,\,\, h=0 \\
c_0+c_1\; \mathrm{exp}(-h/\phi) &amp;\,\,\,\text{if}\,\,\, h &gt; 0 \\
\end{array}
\right.
\tag{21.12}
\end{equation}\]</span></p>
<p>In an exponential semivariogram the semivariance goes asymptotically to a maximum; it never reaches it. In an exponential semivariogram the range parameter is replaced by the distance parameter. In an exponential semivariogram without nugget the semivariance at three times the distance parameter is at 95% of the sill. Three times the distance parameter is referred to as the <em>effective</em> or <em>practical</em> range.</p>
<p>In following chapters I also use a correlogram, which is a scaled covariance function, such that the sill of the correlogram equals 1:</p>
<p><span class="math display" id="eq:correlogram">\[\begin{equation}
\rho(\mathbf{h}) = \frac{C(\mathbf{h})}{\sigma^2} \;.
\tag{21.13}
\end{equation}\]</span></p>
<p>To illustrate that the OK variance is independent of the values of the study variable at the sampling locations, I simulated a spatial population of 50 <span class="math inline">\(\times\)</span> 50 units. At each unit a value of the study variable is simulated, using the semivariogram of Figure <a href="Introkriging.html#fig:CovFunctionVariogram">21.1</a>. This is repeated ten times, resulting in ten simulated populations of 2500 units. Figure <a href="Introkriging.html#fig:Twokrigingsimulations">21.2</a> shows two of the ten simulated populations. Note that the two simulations clearly show spatial structure (patches of similar values).</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:Twokrigingsimulations"></span>
<img src="SpatialSampling_files/figure-html/Twokrigingsimulations-1.png" alt="Two maps simulated with the spherical semivariogram of Figure 21.1, the centred square grid of sampling units and the prediction unit (red cell with coordinates (590,670))." width="100%" />
<p class="caption">
Figure 21.2: Two maps simulated with the spherical semivariogram of Figure 21.1, the centred square grid of sampling units and the prediction unit (red cell with coordinates (590,670)).
</p>
</div>
<p>The simulated fields are sampled on a centred square grid with a spacing of 100 distance units, resulting in a sample of 100 units. Each sample is used one-by-one to predict the study variable at one prediction location (see Figure <a href="Introkriging.html#fig:Twokrigingsimulations">21.2</a>), using again the semivariogram of Figure <a href="Introkriging.html#fig:CovFunctionVariogram">21.1</a>. The semivariogram is specified by function <code>vgm</code> of package <strong>gstat</strong> <span class="citation">(<a href="#ref-peb04" role="doc-biblioref">E. J. Pebesma 2004</a>)</span>. Usually this semivariogram is estimated from a sample, see Chapter <a href="SamplingVariogram.html#SamplingVariogram">24</a>, but here we assume that it is known. Function <code>krige</code> of package <strong>gstat</strong> is used for kriging. The formula argument specifies the dependent (study variable) and independent variables (covariates). The formula <code>z ~ 1</code> means that we do not have covariates and that predictions are done by OK (or simple kriging, see Section <a href="Introkriging.html#IntroKED">21.3</a>). Argument <code>locations</code> is a file of class <code>SpatialPointsDataFrame</code> with the spatial coordinates and observations. Argument <code>newdata</code> is a file of class <code>SpatialPoints</code> with the locations where we want to predict. Argument <code>nmax</code> can be used to specify the neighbourhood in terms of the number of nearest observations to be used in kriging.</p>
<div class="sourceCode" id="cb464"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb464-1"><a href="Introkriging.html#cb464-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb464-2"><a href="Introkriging.html#cb464-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gstat)</span>
<span id="cb464-3"><a href="Introkriging.html#cb464-3" aria-hidden="true" tabindex="-1"></a>vgmodel <span class="ot">&lt;-</span> <span class="fu">vgm</span>(<span class="at">model=</span><span class="st">&quot;Sph&quot;</span>, <span class="at">nugget=</span><span class="dv">25</span>, <span class="at">psill=</span><span class="dv">75</span>, <span class="at">range=</span><span class="dv">250</span>)</span>
<span id="cb464-4"><a href="Introkriging.html#cb464-4" aria-hidden="true" tabindex="-1"></a><span class="fu">gridded</span>(mypop) <span class="ot">&lt;-</span> <span class="er">~</span>s1<span class="sc">+</span>s2</span>
<span id="cb464-5"><a href="Introkriging.html#cb464-5" aria-hidden="true" tabindex="-1"></a>mysample <span class="ot">&lt;-</span> <span class="fu">spsample</span>(<span class="at">x=</span>mypop, <span class="at">type=</span><span class="st">&quot;regular&quot;</span>, <span class="at">cellsize=</span><span class="fu">c</span>(<span class="dv">100</span>,<span class="dv">100</span>),</span>
<span id="cb464-6"><a href="Introkriging.html#cb464-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">offset=</span><span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fl">0.5</span>))</span>
<span id="cb464-7"><a href="Introkriging.html#cb464-7" aria-hidden="true" tabindex="-1"></a>zsim_sample <span class="ot">&lt;-</span> <span class="fu">over</span>(mysample, mypop)</span>
<span id="cb464-8"><a href="Introkriging.html#cb464-8" aria-hidden="true" tabindex="-1"></a><span class="fu">coordinates</span>(s_0) <span class="ot">&lt;-</span> <span class="er">~</span>s1<span class="sc">+</span>s2</span>
<span id="cb464-9"><a href="Introkriging.html#cb464-9" aria-hidden="true" tabindex="-1"></a>zpred_OK <span class="ot">&lt;-</span> v_zpred_OK <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb464-10"><a href="Introkriging.html#cb464-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(Z)) {</span>
<span id="cb464-11"><a href="Introkriging.html#cb464-11" aria-hidden="true" tabindex="-1"></a>  mysample<span class="sc">$</span>z <span class="ot">&lt;-</span> zsim_sample[,i]</span>
<span id="cb464-12"><a href="Introkriging.html#cb464-12" aria-hidden="true" tabindex="-1"></a>  predictions <span class="ot">&lt;-</span> <span class="fu">krige</span>(</span>
<span id="cb464-13"><a href="Introkriging.html#cb464-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula=</span>z<span class="sc">~</span><span class="dv">1</span>,</span>
<span id="cb464-14"><a href="Introkriging.html#cb464-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">locations=</span>mysample,</span>
<span id="cb464-15"><a href="Introkriging.html#cb464-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata=</span>s_0,</span>
<span id="cb464-16"><a href="Introkriging.html#cb464-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">model=</span>vgmodel,</span>
<span id="cb464-17"><a href="Introkriging.html#cb464-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">debug.level=</span><span class="dv">0</span>)</span>
<span id="cb464-18"><a href="Introkriging.html#cb464-18" aria-hidden="true" tabindex="-1"></a>  zpred_OK[i] <span class="ot">&lt;-</span> predictions<span class="sc">$</span>var1.pred</span>
<span id="cb464-19"><a href="Introkriging.html#cb464-19" aria-hidden="true" tabindex="-1"></a>  v_zpred_OK[i] <span class="ot">&lt;-</span> predictions<span class="sc">$</span>var1.var</span>
<span id="cb464-20"><a href="Introkriging.html#cb464-20" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>As can be seen below, unlike the predicted value, the OK variance produced from the different simulations is constant.</p>
<table class=" lightable-classic" style="font-family: &quot;Arial Narrow&quot;, &quot;Source Sans Pro&quot;, sans-serif; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:OKpredandvar">Table 21.1: </span>Ordinary kriging predictions and kriging variance at a fixed prediction location for ten data sets with simulated values at a square sampling grid.
</caption>
<thead>
<tr>
<th style="text-align:right;">
Kriging prediction
</th>
<th style="text-align:right;">
Kriging variance
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
51.44286
</td>
<td style="text-align:right;">
55.30602
</td>
</tr>
<tr>
<td style="text-align:right;">
57.29272
</td>
<td style="text-align:right;">
55.30602
</td>
</tr>
<tr>
<td style="text-align:right;">
52.44407
</td>
<td style="text-align:right;">
55.30602
</td>
</tr>
<tr>
<td style="text-align:right;">
51.40719
</td>
<td style="text-align:right;">
55.30602
</td>
</tr>
<tr>
<td style="text-align:right;">
63.09248
</td>
<td style="text-align:right;">
55.30602
</td>
</tr>
<tr>
<td style="text-align:right;">
40.57517
</td>
<td style="text-align:right;">
55.30602
</td>
</tr>
<tr>
<td style="text-align:right;">
54.48507
</td>
<td style="text-align:right;">
55.30602
</td>
</tr>
<tr>
<td style="text-align:right;">
47.42828
</td>
<td style="text-align:right;">
55.30602
</td>
</tr>
<tr>
<td style="text-align:right;">
43.65313
</td>
<td style="text-align:right;">
55.30602
</td>
</tr>
<tr>
<td style="text-align:right;">
44.52740
</td>
<td style="text-align:right;">
55.30602
</td>
</tr>
</tbody>
</table>
</div>
<div id="BlockKriging" class="section level2" number="21.2">
<h2><span class="header-section-number">21.2</span> Block-kriging</h2>
<p>In the previous section the support of the prediction units is equal to that of the sampling units. So, if the observations are done at points (point support), the support of the predictions are also points, and if means of small blocks are observed, the predictions are predicted means of blocks of the same size and shape. There is no change of support. In some cases we may prefer predictions at a larger support than that of the observations. For instance, we may prefer predictions of the average concentration of some soil property of blocks of 5 m <span class="math inline">\(\times\)</span> 5 m, instead of predictions at points, simply because of practical relevance. If the observations are at points, there is a change of support, from points to blocks. Kriging with a prediction support that is larger than the support of the sample data is referred to as block-kriging. Kriging without change of support, the sample support and prediction support are equal, is referred to as point-kriging. Note that point-kriging does not necessarily imply that the support is a point, it can be, for instance, a small block.</p>
<p>In block-kriging the mean of a prediction block <span class="math inline">\(\mathcal{B}_0\)</span> is predicted as a weighted average of the observations at the sampling units. The kriging weights are derived much in the same way as in point-kriging (Equations <a href="Introkriging.html#eq:krigingequations">(21.3)</a> to <a href="Introkriging.html#eq:krigingweights">(21.6)</a>). In block-kriging the covariance between a sampling point <span class="math inline">\(i\)</span> and a prediction point, <span class="math inline">\(C(\mathbf{s}_i,\mathbf{s}_0)\)</span> is replaced by the <em>mean</em> covariance between the sampling point and a prediction block <span class="math inline">\(\overline{C}(\mathbf{s}_i,\mathcal{B}_0)\)</span> (Equation <a href="Introkriging.html#eq:krigingequations">(21.3)</a>). This mean covariance can be approximated by discretising the prediction block by a fine grid, computing the covariance between a sampling point <span class="math inline">\(i\)</span> and each of the discretisation points and averaging.</p>
<p>The variance of the prediction error of the block-mean (block-kriging variance) equals</p>
<p><span class="math display" id="eq:OBKvariance">\[\begin{equation}
V_{\mathrm{OBK}}(\widehat{\overline{Z}}(\mathcal{B}_0)) = \lambda^{\mathrm{T}}\bar{\pmb{\gamma}}(\mathcal{B}_0) + \nu - \bar{\gamma}(\mathcal{B}_0,\mathcal{B}_0)\;,
\tag{21.14}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(\bar{\pmb{\gamma}}(\mathcal{B}_0)\)</span> the vector with mean semivariances between the sampling points and a prediction block and <span class="math inline">\(\bar{\gamma}(\mathcal{B}_0,\mathcal{B}_0)\)</span> the mean semivariance within the prediction block. Comparing this with Equation <a href="Introkriging.html#eq:OKvariancesemivariances">(21.10)</a> shows that the block-kriging variance is smaller than the point-kriging variance by an amount approximately equal to the mean semivariance within a prediction block. Recall from Chapter <a href="MBpredictionofDesignVariance.html#MBpredictionofDesignVariance">13</a> that the mean semivariance within a block is a model-based prediction of the variance within a block (Equation <a href="MBpredictionofDesignVariance.html#eq:meansemivariance">(13.3)</a>).</p>
</div>
<div id="IntroKED" class="section level2" number="21.3">
<h2><span class="header-section-number">21.3</span> Kriging with an external drift</h2>
<p>In kriging with an external drift (KED) the spatial variation of the study variable is modelled as the sum of a linear combination of covariates and a spatially correlated residual:</p>
<p><span class="math display" id="eq:KEDmodel2">\[\begin{equation}
\begin{split}
Z(\mathbf{s}) &amp; = \sum_{k=0}^p \beta_k x_k(\mathbf{s}) + \epsilon(\mathbf{s}) \\
\epsilon(\mathbf{s}) &amp; \sim \mathcal{N}(0,\sigma^2) \\
\mathrm{Cov}(\epsilon(\mathbf{s}),\epsilon(\mathbf{s}^{\prime})) &amp; = C(\mathbf{h}) \;,
\end{split}
\tag{21.15}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(x_k(\mathbf{s})\)</span> the value of the <span class="math inline">\(k\)</span>th covariate at location <span class="math inline">\(\mathbf{s}\)</span> (<span class="math inline">\(x_0\)</span> = 1 for all locations), <span class="math inline">\(p\)</span> the number of covariates and <span class="math inline">\(C(\mathbf{h})\)</span> the covariance of the residuals at two points separated by vector <span class="math inline">\(\mathbf{h} = \mathbf{s}-\mathbf{s}^{\prime}\)</span>. The constant mean <span class="math inline">\(\mu\)</span> in Equation <a href="Introkriging.html#eq:OKmodel">(21.1)</a> is replaced by a linear combination of covariates and, as a consequence, the mean is not constant anymore but varies in space.</p>
<p>With KED the study variable at a prediction location <span class="math inline">\(\mathbf{s}_0\)</span> is predicted by</p>
<p><span class="math display" id="eq:KEDpredictor">\[\begin{equation}
\hat{Z}_{\mathrm{KED}}(\mathbf{s}_0)=\sum_{k=0}^p \hat{\beta}_k x_k(\mathbf{s}_0)+\sum_{i=1}^n \lambda_i\left\{Z(\mathbf{s}_i)-\sum_{k=0}^p \hat{\beta}_k x_k(\mathbf{s}_i)\right\}\;,
\tag{21.16}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(\hat{\beta}_k\)</span> the estimated regression coefficient associated with covariate <span class="math inline">\(x_k\)</span>. The first component of this predictor is the estimated expectation at the new location using the covariate values at this location and the estimated regression coefficients, and the second component is a weighted sum of the residuals at the sampling locations.</p>
<p>The optimal kriging weights <span class="math inline">\(\lambda_i,\; i = 1, \cdots ,n\)</span> are obtained in a similar way as in OK. The difference is that additional constraints on the weights are needed, to ensure unbiased predictions. Not only the weights must sum to 1, but also for all <span class="math inline">\(p\)</span> covariates the weighted sum of the covariate values at the sampling locations must equal the covariate value at the target location: <span class="math inline">\(\sum_{i=1}^n \lambda_i x_k(\mathbf{s}_i) = x_k(\mathbf{s}_0)\)</span> for all <span class="math inline">\(k=1, \cdots , p\)</span>. This leads to a system of <span class="math inline">\(n+p+1\)</span> simultaneous equations that must be solved. In matrix notation this system is</p>
<p><span class="math display" id="eq:KEDsystem">\[\begin{eqnarray}
\left[
\begin{array}{cc}
\mathbf{C} &amp; \mathbf{X} \\
\mathbf{X}^{\mathrm{T}} &amp; \mathbf{0} \\
\end{array}
\right]
\left[
\begin{array}{c}
\pmb{\lambda}\\
\nu\\
\end{array}
\right]
=
\left[
\begin{array}{c}
\mathbf{c}_0\\
\mathbf{x}_0\\
\end{array}
\right]\;,
\tag{21.17}
\end{eqnarray}\]</span></p>
<p>with</p>
<p><span class="math display" id="eq:MatrixXinKEDsystem">\[\begin{eqnarray}
\mathbf{X}=
\left[
\begin{array}{ccccc}
1&amp;x_{11}&amp;x_{12}&amp;\dots&amp;x_{1p}\\
1&amp;x_{21}&amp;x_{22}&amp;\dots&amp;x_{2p}\\
\vdots&amp;\vdots&amp;\dots&amp;\vdots\\
1&amp;x_{n1}&amp;x_{n2}&amp;\dots&amp;x_{np}\\
\end{array}
\right]\;.
\tag{21.18}
\end{eqnarray}\]</span></p>
<p>The submatrix <span class="math inline">\(\mathbf{O}\)</span> is a <span class="math inline">\(((p+1) \times (p+1))\)</span> matrix with zeroes, <span class="math inline">\(\nu\)</span> a (<span class="math inline">\(p+1\)</span>) vector with Lagrange multipliers and <span class="math inline">\(\mathbf{x}_0\)</span> a <span class="math inline">\((p+1)\)</span> vector with covariate values at the prediction location (including a 1 as the first entry).</p>
<p>The kriging variance with KED equals</p>
<p><span class="math display" id="eq:KEDvariance">\[\begin{equation}
V_{\mathrm{KED}}(\widehat{Z}(\mathbf{s}_0))= \sigma^2 - \lambda^{\mathrm{T}}\mathbf{c}_0 - \nu^{\mathrm{T}} \mathbf{x}_0 \;.
\tag{21.19}
\end{equation}\]</span></p>
<p>The prediction error variance with KED can also be written as the sum of the variance of the predictor of the mean and the variance of the error in the interpolated residuals <span class="citation">(<a href="#ref-chr91" role="doc-biblioref">Christensen 1991</a>)</span>:</p>
<p><span class="math display" id="eq:KEDvariance2">\[\begin{equation}
\begin{split}
V_{\mathrm{KED}}(\widehat{Z}(\mathbf{s}_0))= \sigma^2 - \mathbf{c}_0^{\mathrm{T}}\mathbf{C}^{-1}\mathbf{c}_0 +\\
&amp;(\mathbf{x}_0-\mathbf{X}^{\mathrm{T}}\mathbf{C}^{-1}\mathbf{c}_0)^{\mathrm{T}}(\mathbf{X}^{\mathrm{T}}\mathbf{C}^{-1}\mathbf{X})^{-1}(\mathbf{x}_0-\mathbf{X}^{\mathrm{T}}\mathbf{C}^{-1}\mathbf{c}_0)\;.
\end{split}
\tag{21.20}
\end{equation}\]</span></p>
<p>The first two terms constitute the interpolation error variance, the third term the variance of the predictor of the mean.
<!--Note that the computation is as Equation \@ref(eq:KEDvariance), with the $\lambda$ and $\nu$ from the solution of the KED system; Equation \@ref(eq:KEDvariance2) shows this in terms of linear modelling theory. --></p>
<p>To illustrate that the kriging variance with KED depends on the values of the covariate at the sampling locations and prediction location, values of a covariate <span class="math inline">\(x\)</span> and of a correlated study variable <span class="math inline">\(z\)</span> are simulated for the <span class="math inline">\(50 \times 50\)</span> units of a spatial population (Figure <a href="Introkriging.html#fig:SimulatedXandZ">21.3</a>). First, a field with covariate values is simulated with a model-mean of 10. Next, a field with residuals is simulated. The field of the study variable is then obtained by multiplying the simulated field with covariate values by two (<span class="math inline">\(\beta_1=2\)</span>), adding a constant of 10 (<span class="math inline">\(\beta_0=10\)</span>) and, finally, adding the simulated field with residuals.</p>
<div class="sourceCode" id="cb465"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb465-1"><a href="Introkriging.html#cb465-1" aria-hidden="true" tabindex="-1"></a><span class="co">#simulate covariate values</span></span>
<span id="cb465-2"><a href="Introkriging.html#cb465-2" aria-hidden="true" tabindex="-1"></a>vgm_x <span class="ot">&lt;-</span> <span class="fu">vgm</span>(<span class="at">model=</span><span class="st">&quot;Sph&quot;</span>, <span class="at">psill=</span><span class="dv">10</span>, <span class="at">range=</span><span class="dv">200</span>, <span class="at">nugget=</span><span class="dv">0</span>)</span>
<span id="cb465-3"><a href="Introkriging.html#cb465-3" aria-hidden="true" tabindex="-1"></a>C <span class="ot">&lt;-</span> <span class="fu">variogramLine</span>(vgm_x, <span class="at">dist_vector=</span>H, <span class="at">covariance=</span><span class="cn">TRUE</span>)</span>
<span id="cb465-4"><a href="Introkriging.html#cb465-4" aria-hidden="true" tabindex="-1"></a>Upper <span class="ot">&lt;-</span> <span class="fu">chol</span>(C) </span>
<span id="cb465-5"><a href="Introkriging.html#cb465-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">314</span>)</span>
<span id="cb465-6"><a href="Introkriging.html#cb465-6" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n=</span><span class="fu">nrow</span>(mypop),<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb465-7"><a href="Introkriging.html#cb465-7" aria-hidden="true" tabindex="-1"></a>mypop<span class="sc">$</span>x <span class="ot">&lt;-</span> <span class="fu">crossprod</span>(Upper,N)<span class="sc">+</span><span class="dv">10</span></span>
<span id="cb465-8"><a href="Introkriging.html#cb465-8" aria-hidden="true" tabindex="-1"></a><span class="co">#simulate values for residuals</span></span>
<span id="cb465-9"><a href="Introkriging.html#cb465-9" aria-hidden="true" tabindex="-1"></a>vgm_resi <span class="ot">&lt;-</span> <span class="fu">vgm</span>(<span class="at">model=</span><span class="st">&quot;Sph&quot;</span>, <span class="at">psill=</span><span class="dv">5</span>, <span class="at">range=</span><span class="dv">100</span>, <span class="at">nugget=</span><span class="dv">0</span>)</span>
<span id="cb465-10"><a href="Introkriging.html#cb465-10" aria-hidden="true" tabindex="-1"></a>C <span class="ot">&lt;-</span> <span class="fu">variogramLine</span>(vgm_resi, <span class="at">dist_vector=</span>H, <span class="at">covariance=</span><span class="cn">TRUE</span>)</span>
<span id="cb465-11"><a href="Introkriging.html#cb465-11" aria-hidden="true" tabindex="-1"></a>Upper <span class="ot">&lt;-</span> <span class="fu">chol</span>(C)</span>
<span id="cb465-12"><a href="Introkriging.html#cb465-12" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">314</span>)</span>
<span id="cb465-13"><a href="Introkriging.html#cb465-13" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n=</span><span class="fu">nrow</span>(mypop),<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb465-14"><a href="Introkriging.html#cb465-14" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> <span class="fu">crossprod</span>(Upper,N)</span>
<span id="cb465-15"><a href="Introkriging.html#cb465-15" aria-hidden="true" tabindex="-1"></a><span class="co">#compute mean of study variable</span></span>
<span id="cb465-16"><a href="Introkriging.html#cb465-16" aria-hidden="true" tabindex="-1"></a>betas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">2</span>)</span>
<span id="cb465-17"><a href="Introkriging.html#cb465-17" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> betas[<span class="dv">1</span>] <span class="sc">+</span> betas[<span class="dv">2</span>]<span class="sc">*</span>mypop<span class="sc">$</span>x</span>
<span id="cb465-18"><a href="Introkriging.html#cb465-18" aria-hidden="true" tabindex="-1"></a><span class="co">#compute study variable z</span></span>
<span id="cb465-19"><a href="Introkriging.html#cb465-19" aria-hidden="true" tabindex="-1"></a>mypop<span class="sc">$</span>z <span class="ot">&lt;-</span> mu  <span class="sc">+</span> e</span></code></pre></div>
<p>As before, a centred square grid with a spacing of 100 distance units is selected. The simulated values of the study variable <span class="math inline">\(z\)</span> and covariate <span class="math inline">\(x\)</span> are used to predict <span class="math inline">\(z\)</span> at a prediction location <span class="math inline">\(\mathbf{s}_0\)</span> by kriging with an external drift (red cell in Figure <a href="Introkriging.html#fig:SimulatedXandZ">21.3</a>). Although at the prediction location we have only one simulated value of covariate <span class="math inline">\(x\)</span>, a series of covariate values is used to predict <span class="math inline">\(z\)</span> at that location: <span class="math inline">\(x_0 = 0, 2, 4, \cdots, 20\)</span>. In practice we have of course only one value of the covariate at a fixed location, but this is for illustration purposes only. Note that we have only one data set with `observations’ of <span class="math inline">\(x\)</span> and <span class="math inline">\(z\)</span> at the sampling locations (square grid).</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:SimulatedXandZ"></span>
<img src="SpatialSampling_files/figure-html/SimulatedXandZ-1.png" alt="Maps with simulated values of covariate $x$ and study variable $z$, the centred square grid of sampling units and the prediction unit (red cell with coordinates (590,670))." width="100%" />
<p class="caption">
Figure 21.3: Maps with simulated values of covariate <span class="math inline">\(x\)</span> and study variable <span class="math inline">\(z\)</span>, the centred square grid of sampling units and the prediction unit (red cell with coordinates (590,670)).
</p>
</div>
<div class="sourceCode" id="cb466"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb466-1"><a href="Introkriging.html#cb466-1" aria-hidden="true" tabindex="-1"></a>zxsim_sample <span class="ot">&lt;-</span> <span class="fu">over</span>(mysample, mypop)</span>
<span id="cb466-2"><a href="Introkriging.html#cb466-2" aria-hidden="true" tabindex="-1"></a>mysample<span class="sc">$</span>z <span class="ot">&lt;-</span> zxsim_sample<span class="sc">$</span>z</span>
<span id="cb466-3"><a href="Introkriging.html#cb466-3" aria-hidden="true" tabindex="-1"></a>mysample<span class="sc">$</span>x <span class="ot">&lt;-</span> zxsim_sample<span class="sc">$</span>x</span>
<span id="cb466-4"><a href="Introkriging.html#cb466-4" aria-hidden="true" tabindex="-1"></a>x0 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="dv">0</span>, <span class="at">to=</span><span class="dv">20</span>, <span class="at">by=</span><span class="dv">2</span>)</span>
<span id="cb466-5"><a href="Introkriging.html#cb466-5" aria-hidden="true" tabindex="-1"></a>v_zpred_KED <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb466-6"><a href="Introkriging.html#cb466-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x0)) {</span>
<span id="cb466-7"><a href="Introkriging.html#cb466-7" aria-hidden="true" tabindex="-1"></a>  s_0<span class="sc">$</span>x <span class="ot">&lt;-</span> x0[i]</span>
<span id="cb466-8"><a href="Introkriging.html#cb466-8" aria-hidden="true" tabindex="-1"></a>  predictions  <span class="ot">&lt;-</span> <span class="fu">krige</span>(</span>
<span id="cb466-9"><a href="Introkriging.html#cb466-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula=</span>z<span class="sc">~</span>x,</span>
<span id="cb466-10"><a href="Introkriging.html#cb466-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">locations=</span>mysample,</span>
<span id="cb466-11"><a href="Introkriging.html#cb466-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata=</span>s_0,</span>
<span id="cb466-12"><a href="Introkriging.html#cb466-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">model=</span>vgm_resi,</span>
<span id="cb466-13"><a href="Introkriging.html#cb466-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">debug.level=</span><span class="dv">0</span>)</span>
<span id="cb466-14"><a href="Introkriging.html#cb466-14" aria-hidden="true" tabindex="-1"></a>  v_zpred_KED[i] <span class="ot">&lt;-</span> predictions<span class="sc">$</span>var1.var</span>
<span id="cb466-15"><a href="Introkriging.html#cb466-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Note the formula <code>z~x</code> in the code chunk above, indicating that there is now an independent variable (covariate). The covariate values are attached to the file with the prediction location one-by-one in a for-loop. Also note that for KED we need the semivariogram of the residuals, not of the study variable itself. The residual semivariogram used in prediction is the same as the one used in simulating the fields: a spherical model without nugget, a sill of 5 and a range of 100 distance units.</p>
<p>To assess the contribution of the uncertainty about the mean, I also predict the values assuming that the mean is known. In other words we assume that the two regression coefficients <span class="math inline">\(\beta_0\)</span> (intercept) and <span class="math inline">\(\beta_1\)</span> (slope) are known. This type of kriging is referred to as simple kriging (SK). With SK the constraints explained above are removed, so that there are no Lagrange multipliers involved. Argument <code>beta</code> is used to specify the known regression coefficients. I used the same values as in simulation.</p>
<div class="sourceCode" id="cb467"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb467-1"><a href="Introkriging.html#cb467-1" aria-hidden="true" tabindex="-1"></a>v_zpred_SK <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb467-2"><a href="Introkriging.html#cb467-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x0)) {</span>
<span id="cb467-3"><a href="Introkriging.html#cb467-3" aria-hidden="true" tabindex="-1"></a>  s_0<span class="sc">$</span>x <span class="ot">&lt;-</span> x0[i]</span>
<span id="cb467-4"><a href="Introkriging.html#cb467-4" aria-hidden="true" tabindex="-1"></a>  prediction  <span class="ot">&lt;-</span> <span class="fu">krige</span>(</span>
<span id="cb467-5"><a href="Introkriging.html#cb467-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula=</span>z<span class="sc">~</span>x, </span>
<span id="cb467-6"><a href="Introkriging.html#cb467-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">locations=</span>mysample, </span>
<span id="cb467-7"><a href="Introkriging.html#cb467-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata=</span>s_0, </span>
<span id="cb467-8"><a href="Introkriging.html#cb467-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">model=</span>vgm_resi, </span>
<span id="cb467-9"><a href="Introkriging.html#cb467-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">beta=</span>betas, </span>
<span id="cb467-10"><a href="Introkriging.html#cb467-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">debug.level=</span><span class="dv">0</span>)</span>
<span id="cb467-11"><a href="Introkriging.html#cb467-11" aria-hidden="true" tabindex="-1"></a>  v_zpred_SK[i] <span class="ot">&lt;-</span> prediction<span class="sc">$</span>var1.var</span>
<span id="cb467-12"><a href="Introkriging.html#cb467-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Figure <a href="Introkriging.html#fig:KEDVarSKVar">21.4</a> shows that, contrary to the SK variance, the kriging variance with KED is not constant, but depends on the covariate value at the prediction location. It is the smallest near the mean of the covariate values at the sampling units, which is 10.0. The more extreme the covariate value at the prediction location, the larger the kriging variance with KED. This is analogous to the variance of predictions with a linear regression model.</p>
<p>The variance with simple kriging (SK) is constant. This is because with SK we assume that the regression coefficients are known, so that we know the model-mean at a prediction location. What remains is the error in the interpolation of the residuals (first two terms in Equation <a href="Introkriging.html#eq:KEDvariance2">(21.20)</a>. This interpolation error is independent of the value of <span class="math inline">\(x\)</span> at the prediction location. In Figure <a href="Introkriging.html#fig:KEDVarSKVar">21.4</a> the difference between the variance with KED and with SK is the variance of the predictor of the model-mean, due to uncertainty about the regression coefficients. In real-world applications these regression coefficients are unknown and must be <em>estimated</em> from the sample data. This variance is smallest for a covariate value about equal to the sample mean of the covariate, and increases with the absolute difference of the covariate value and this sample mean.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:KEDVarSKVar"></span>
<img src="SpatialSampling_files/figure-html/KEDVarSKVar-1.png" alt="Variance of the prediction error as a function of the covariate value at a fixed prediction location, obtained with kriging with an external drift (KED) and simple kriging (SK) ." width="80%" />
<p class="caption">
Figure 21.4: Variance of the prediction error as a function of the covariate value at a fixed prediction location, obtained with kriging with an external drift (KED) and simple kriging (SK) .
</p>
</div>
</div>
<div id="VariogramEstimation" class="section level2" number="21.4">
<h2><span class="header-section-number">21.4</span> Estimating the semivariogram</h2>
<p>Kriging requires a semivariogram or covariance function as input for computing the covariance matrix of the study variable at the sampling locations and the vector of covariance of the study variable at the sampling locations and the prediction location. In most cases the semivariogram model is unknown and must be estimated from sample data; however for designing a sample it may be justified to use a semivariogram model developed in a similar study. Once the parameters of the semivariogram model are estimated, these are plugged in the kriging equations. There are two fundamentally different approaches for estimating the semivariogram parameters from sample data: the <em>method-of-moments</em> and <em>maximum likelihood estimation</em> <span class="citation">(<a href="#ref-lar00b" role="doc-biblioref">Lark 2000</a>)</span>.</p>
<div id="MoM" class="section level3" number="21.4.1">
<h3><span class="header-section-number">21.4.1</span> Method-of-moments</h3>
<p>With the method-of-moments approach the semivariogram is estimated in two steps. In the first step a sample semivariogram, also referred to as an experimental semivariogram, is estimated. This is done by choosing a series of distance intervals (bins). If a semivariogram in different directions is required, we must also choose direction intervals.</p>
<p>For each distance interval all pairs of points with a separation distance in that interval are identified. For each pair half the squared difference of the study variable is computed, and these squared differences are averaged over all point-pairs of that interval. This average is the estimated semivariance of that distance interval. The estimated semivariances for all distance intervals are plotted against the average separation distances per distance interval. In the second step a permissible model is fitted to the sample semivariogram, using some form of weighted least squares. For details, see <span class="citation"><a href="#ref-webster2007" role="doc-biblioref">Webster and Oliver</a> (<a href="#ref-webster2007" role="doc-biblioref">2007</a>)</span>.</p>
<p>The next code chunk shows how this can be done in <strong>R</strong>. A simple random sample of 150 points is selected from the first simulated field shown in Figure <a href="Introkriging.html#fig:Twokrigingsimulations">21.2</a>. Function <code>variogram</code> of package <strong>gstat</strong> is then used to compute the sample semivariogram. Note that no distance intervals need be specified to function <code>variogram</code>. This can be done with argument <code>width</code> or argument <code>boundaries</code>. In their absence, the default value for argument <code>width</code> is equal to the maximum separation distance divided by fifteen, so that there are fifteen points in the sample semivariogram. The maximum separation distance can be set with argument <code>cutoff</code>. The default value for this argument is equal to one-third of the longest diagonal of the bounding box of the point set. The output is a data frame, with the number of point-pairs, average separation distance and estimated semivariance in the first three columns.</p>
<div class="sourceCode" id="cb468"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb468-1"><a href="Introkriging.html#cb468-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb468-2"><a href="Introkriging.html#cb468-2" aria-hidden="true" tabindex="-1"></a>units <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(mypop), <span class="at">size=</span><span class="dv">150</span>)</span>
<span id="cb468-3"><a href="Introkriging.html#cb468-3" aria-hidden="true" tabindex="-1"></a>mysample <span class="ot">&lt;-</span> mypop[units,]</span>
<span id="cb468-4"><a href="Introkriging.html#cb468-4" aria-hidden="true" tabindex="-1"></a><span class="fu">coordinates</span>(mysample) <span class="ot">&lt;-</span> <span class="er">~</span>s1<span class="sc">+</span>s2</span>
<span id="cb468-5"><a href="Introkriging.html#cb468-5" aria-hidden="true" tabindex="-1"></a>vg <span class="ot">&lt;-</span> <span class="fu">variogram</span>(z<span class="sc">~</span><span class="dv">1</span>, <span class="at">data=</span>mysample)</span>
<span id="cb468-6"><a href="Introkriging.html#cb468-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(vg[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>)])</span></code></pre></div>
<pre><code>   np      dist    gamma
1  35  24.02379 38.73456
2  74  49.02384 42.57199
3 179  78.62401 62.13025
4 213 110.05088 72.41387
5 239 139.20163 82.21432
6 323 170.55712 88.38168</code></pre>
<p>The next step is to fit a model. This can be done with function <code>fit.variogram</code> of the <strong>gstat</strong> package. Many models can be fitted with this function (type <code>vgm()</code> to see all models). I chose a spherical model. Function <code>fit.variogram</code> requires initial values of the semivariogram parameters. From the sample semivariogram my eyeball estimates are 25 for the nugget, 250 for the range and 75 for the partial sill. These are passed to the <code>vgm</code> function, and used as the <code>model</code> argument of function <code>fit.variogram</code>. The sample semivariogram and the fitted model can simply be plotted with function <code>plot</code>.</p>
<div class="sourceCode" id="cb470"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb470-1"><a href="Introkriging.html#cb470-1" aria-hidden="true" tabindex="-1"></a>vgm_MoM <span class="ot">&lt;-</span> <span class="fu">fit.variogram</span>(vg, <span class="at">model=</span><span class="fu">vgm</span>(<span class="at">model=</span><span class="st">&quot;Sph&quot;</span>,</span>
<span id="cb470-2"><a href="Introkriging.html#cb470-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">psill=</span><span class="dv">75</span>, <span class="at">range=</span><span class="dv">250</span>, <span class="at">nugget=</span><span class="dv">25</span>))</span>
<span id="cb470-3"><a href="Introkriging.html#cb470-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(vg, vgm_MoM, <span class="at">plot.numbers=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="SpatialSampling_files/figure-html/semivariogramSimulatedField1-1.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb471"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb471-1"><a href="Introkriging.html#cb471-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(vgm_MoM)</span></code></pre></div>
<pre><code>  model    psill    range
1   Nug 26.32048   0.0000
2   Sph 68.36364 227.7999</code></pre>
<p>Note that <code>fit.variogram</code> has several options for weighted least squares optimisation, see <code>?fit.variogram</code> for details. Also, note that this non-linear fit may not converge to a solution, especially if the starting values specified to <code>vgm</code> are not near their optimal values.</p>
<p>Further, this method depends on the choice of cutoff and distance intervals. We hope that changing these does not change the fitted model too much, but this is not always the case, especially with smaller data sets.</p>
</div>
<div id="MLestimationVariogram" class="section level3" number="21.4.2">
<h3><span class="header-section-number">21.4.2</span> Maximum likelihood</h3>
<p>In contrast to the method-of-moments, with the maximum likelihood method the data are not paired into couples and binned into a sample semivariogram. Instead the semivariogram model is estimated in one step. To apply this method one typically assumes that (possibly after transformation) the <span class="math inline">\(n\)</span> sample data come from a multivariate normal distribution. If we have one observation from a normal distribution, the probability density of that observation is given by</p>
<p><span class="math display" id="eq:densitynormal">\[\begin{equation}
f(z|\mu,\sigma ^{2})=
\frac{1}{\sigma \sqrt{2\pi }}\exp \left\{ -\frac{1}{2}\left( \frac{z-\mu }{\sigma }\right) ^{2}\right\} \;,
\tag{21.21}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(\mu\)</span> the mean and <span class="math inline">\(\sigma^2\)</span> the variance. With multiple independent observations, each of them coming from a normal distribution, the joint probability density is given by the product of the probability densities per observation. However, if the data are not independent, we must account for the covariances and the joint probability density can be computed by</p>
<p><span class="math display" id="eq:densitymvnormal">\[\begin{equation}
f(\mathbf{z}|\pmb{\mu} ,\pmb{\theta})=
(2\pi )^{-\frac{n}{2}}|\mathbf{C}|^{-\frac{1}{2}}
\exp \left\{ -\frac{1}{2}(\mathbf{z}-\pmb{\mu} )^{\mathrm{T}}\,\mathbf{C}^{-1}\,(\mathbf{z}-\pmb{\mu} )\right\} \;,
\tag{21.22}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(\mathbf{z}\)</span> is the vector with the <span class="math inline">\(n\)</span> sample data, <span class="math inline">\(\pmb{\mu}\)</span> is the vector with means, <span class="math inline">\(\pmb{\theta}\)</span> is the vector with parameters of the covariance function and <span class="math inline">\(\mathbf{C}\)</span> is the <span class="math inline">\(n \times n\)</span> matrix with variances and covariances of the sample data. If the probability density of Equation <a href="Introkriging.html#eq:densitymvnormal">(21.22)</a> is regarded as a function of <span class="math inline">\(\pmb{\mu}\)</span> and <span class="math inline">\(\pmb{\theta}\)</span> with the data <span class="math inline">\(\mathbf{z}\)</span> fixed, this equation defines the likelihood.</p>
<p>Maximum likelihood estimates of the semivariogram can be obtained with function <code>likfit</code> of package <strong>geoR</strong> <span class="citation">(<a href="#ref-geoR" role="doc-biblioref">Ribeiro Jr et al. 2020</a>)</span>. First, a geoR object must be made, specifying which columns of the data frame contain the spatial coordinates and the study variable.</p>
<div class="sourceCode" id="cb473"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb473-1"><a href="Introkriging.html#cb473-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geoR)</span>
<span id="cb473-2"><a href="Introkriging.html#cb473-2" aria-hidden="true" tabindex="-1"></a>mysample <span class="ot">&lt;-</span> <span class="fu">as</span>(mysample,<span class="st">&quot;data.frame&quot;</span>)</span>
<span id="cb473-3"><a href="Introkriging.html#cb473-3" aria-hidden="true" tabindex="-1"></a>dGeoR <span class="ot">&lt;-</span> <span class="fu">as.geodata</span>(<span class="at">obj=</span>mysample, <span class="at">header=</span><span class="cn">TRUE</span>, <span class="at">coords.col=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">data.col=</span><span class="dv">3</span>)</span></code></pre></div>
<p>The model parameters can then be estimated with function <code>likfit</code>. Argument <code>trend="cte"</code> means that we assume that the mean is constant throughout the study area.</p>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb474-1"><a href="Introkriging.html#cb474-1" aria-hidden="true" tabindex="-1"></a>vgm_ML <span class="ot">&lt;-</span> <span class="fu">likfit</span>(<span class="at">geodata=</span>dGeoR, <span class="at">trend=</span><span class="st">&quot;cte&quot;</span>, </span>
<span id="cb474-2"><a href="Introkriging.html#cb474-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">cov.model=</span><span class="st">&quot;spherical&quot;</span>, <span class="at">ini.cov.pars=</span><span class="fu">c</span>(<span class="dv">80</span>,<span class="dv">200</span>),</span>
<span id="cb474-3"><a href="Introkriging.html#cb474-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">nugget=</span><span class="dv">20</span>, <span class="at">lik.method=</span><span class="st">&quot;ML&quot;</span>, <span class="at">messages=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p>Table <a href="Introkriging.html#tab:VariogramEstimates">21.2</a> shows the maximum likelihood estimates together with the method-of-moments estimates.</p>
<table class=" lightable-classic" style="font-family: &quot;Arial Narrow&quot;, &quot;Source Sans Pro&quot;, sans-serif; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:VariogramEstimates">Table 21.2: </span>Estimated parameters of a spherical semivariogram obtained with method-of-moments and maximum likelihood estimation.
</caption>
<thead>
<tr>
<th style="text-align:left;">
Parameter
</th>
<th style="text-align:right;">
MoM
</th>
<th style="text-align:right;">
ML
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
nugget
</td>
<td style="text-align:right;">
26.3
</td>
<td style="text-align:right;">
19.5
</td>
</tr>
<tr>
<td style="text-align:left;">
partial sill
</td>
<td style="text-align:right;">
68.4
</td>
<td style="text-align:right;">
83.8
</td>
</tr>
<tr>
<td style="text-align:left;">
range
</td>
<td style="text-align:right;">
227.8
</td>
<td style="text-align:right;">
217.8
</td>
</tr>
</tbody>
</table>
<p>As can be seen, the estimates are substantially different, especially the division of the a priori variance (sill) into partial sill and nugget.</p>
</div>
</div>
<div id="ResidualVariogram" class="section level2" number="21.5">
<h2><span class="header-section-number">21.5</span> Estimating the residual semivariogram</h2>
<p>For KED estimates of the regression coefficients and of the parameters of the residual semivariogram are needed. Estimation of these model parameters is not a trivial problem, as the estimated regression coefficients and estimated residual semivariogram parameters are not independent. The residuals depend on the estimated regression coefficients and, as a consequence, also the parameters of the residual semivariogram depend on the estimated coefficients. Vice versa, the estimated regression coefficients depend on the spatial correlation of the residuals, and so on the estimated residual semivariogram parameters. This a classic “which came first, the chicken or the egg?” recursive problem.</p>
<p>Estimation of the model parameters is illustrated with the simulated field of Figure <a href="Introkriging.html#fig:SimulatedXandZ">21.3</a>. A simple random sample of size 150 is selected to estimate the model parameters.</p>
<div id="IterativeMoM" class="section level3" number="21.5.1">
<h3><span class="header-section-number">21.5.1</span> Iterative method-of-moments</h3>
<p>A simple option is iterative estimation of the regression coefficients followed by method-of-moments estimation of the sample semivariogram and fitting of a semivariogram model. In the first iteration the regression coefficients are estimated by ordinary least squares (OLS). This implies that the data are assumed independent, i.e. we assume a pure nugget residual semivariogram. The sample semivariogram of the OLS residuals is then computed by the method-of-moments, followed by fitting a model to this sample semivariogram. With package <strong>gstat</strong> this can be done with one line of <strong>R</strong> code, using in function <code>variogram</code> as an argument a formula specifying the study variable and the predictors.</p>
<div class="sourceCode" id="cb475"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb475-1"><a href="Introkriging.html#cb475-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">314</span>)</span>
<span id="cb475-2"><a href="Introkriging.html#cb475-2" aria-hidden="true" tabindex="-1"></a>units <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(mypop), <span class="at">size=</span><span class="dv">150</span>)</span>
<span id="cb475-3"><a href="Introkriging.html#cb475-3" aria-hidden="true" tabindex="-1"></a>mysample <span class="ot">&lt;-</span> <span class="fu">cbind</span>(mypop[units,])</span>
<span id="cb475-4"><a href="Introkriging.html#cb475-4" aria-hidden="true" tabindex="-1"></a>vg_resi <span class="ot">&lt;-</span> <span class="fu">variogram</span>(z<span class="sc">~</span>x, <span class="at">data=</span>mysample)</span>
<span id="cb475-5"><a href="Introkriging.html#cb475-5" aria-hidden="true" tabindex="-1"></a>vgmdl <span class="ot">&lt;-</span> <span class="fu">vgm</span>(<span class="at">model=</span><span class="st">&quot;Sph&quot;</span>, <span class="at">psill=</span><span class="dv">10</span>, <span class="at">range=</span><span class="dv">150</span>, <span class="at">nugget=</span><span class="dv">0</span>)</span>
<span id="cb475-6"><a href="Introkriging.html#cb475-6" aria-hidden="true" tabindex="-1"></a>vgmresi_MoM <span class="ot">&lt;-</span> <span class="fu">fit.variogram</span>(vg_resi, <span class="at">model=</span>vgmdl)</span></code></pre></div>
<p>Given these estimates of the semivariogram parameters, the regression coefficients are re-estimated by accounting for spatial dependency of the residuals. This can be done by generalised least squares (GLS). Function <code>spDists</code> of package <strong>sp</strong> is used to compute the matrix with distances between the sampling locations, <code>variogramLine</code> of package <strong>gstat</strong> to transform the distance matrix into a covariance matrix.</p>
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb476-1"><a href="Introkriging.html#cb476-1" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data=</span><span class="dv">1</span>, <span class="at">nrow=</span><span class="fu">nrow</span>(<span class="fu">as</span>(mysample, <span class="st">&quot;data.frame&quot;</span>)), <span class="at">ncol=</span><span class="dv">2</span>)</span>
<span id="cb476-2"><a href="Introkriging.html#cb476-2" aria-hidden="true" tabindex="-1"></a>X[,<span class="dv">2</span>] <span class="ot">&lt;-</span> mysample<span class="sc">$</span>x</span>
<span id="cb476-3"><a href="Introkriging.html#cb476-3" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> mysample<span class="sc">$</span>z</span>
<span id="cb476-4"><a href="Introkriging.html#cb476-4" aria-hidden="true" tabindex="-1"></a>D <span class="ot">&lt;-</span> <span class="fu">spDists</span>(mysample)</span>
<span id="cb476-5"><a href="Introkriging.html#cb476-5" aria-hidden="true" tabindex="-1"></a>C <span class="ot">&lt;-</span> <span class="fu">variogramLine</span>(vgmresi_MoM, <span class="at">dist_vector=</span>D, <span class="at">covariance=</span><span class="cn">TRUE</span>)</span>
<span id="cb476-6"><a href="Introkriging.html#cb476-6" aria-hidden="true" tabindex="-1"></a>Cinv <span class="ot">&lt;-</span> <span class="fu">solve</span>(C)</span>
<span id="cb476-7"><a href="Introkriging.html#cb476-7" aria-hidden="true" tabindex="-1"></a>XCXinv <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">crossprod</span>(X, Cinv) <span class="sc">%*%</span> X)</span>
<span id="cb476-8"><a href="Introkriging.html#cb476-8" aria-hidden="true" tabindex="-1"></a>XCz <span class="ot">&lt;-</span> <span class="fu">crossprod</span>(X, Cinv) <span class="sc">%*%</span> z</span>
<span id="cb476-9"><a href="Introkriging.html#cb476-9" aria-hidden="true" tabindex="-1"></a>betaGLS <span class="ot">&lt;-</span> XCXinv <span class="sc">%*%</span> XCz</span></code></pre></div>
<p>The GLS estimates of the regression coefficients can then be used to re-compute the residuals of the mean, and so on, until the changes in the model parameters are negligible.</p>
<div class="sourceCode" id="cb477"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb477-1"><a href="Introkriging.html#cb477-1" aria-hidden="true" tabindex="-1"></a><span class="cf">repeat</span> {</span>
<span id="cb477-2"><a href="Introkriging.html#cb477-2" aria-hidden="true" tabindex="-1"></a>  betaGLS.cur <span class="ot">&lt;-</span> betaGLS</span>
<span id="cb477-3"><a href="Introkriging.html#cb477-3" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">&lt;-</span> X <span class="sc">%*%</span> betaGLS</span>
<span id="cb477-4"><a href="Introkriging.html#cb477-4" aria-hidden="true" tabindex="-1"></a>  mysample<span class="sc">$</span>e <span class="ot">&lt;-</span> z<span class="sc">-</span>mu</span>
<span id="cb477-5"><a href="Introkriging.html#cb477-5" aria-hidden="true" tabindex="-1"></a>  vg_resi <span class="ot">&lt;-</span> <span class="fu">variogram</span>(e<span class="sc">~</span><span class="dv">1</span>, <span class="at">data=</span>mysample)</span>
<span id="cb477-6"><a href="Introkriging.html#cb477-6" aria-hidden="true" tabindex="-1"></a>  vgmresi_MoM <span class="ot">&lt;-</span> <span class="fu">fit.variogram</span>(vg_resi, <span class="at">model=</span>vgmdl)</span>
<span id="cb477-7"><a href="Introkriging.html#cb477-7" aria-hidden="true" tabindex="-1"></a>  C <span class="ot">&lt;-</span> <span class="fu">variogramLine</span>(vgmresi_MoM, <span class="at">dist_vector=</span>D, <span class="at">covariance=</span><span class="cn">TRUE</span>)</span>
<span id="cb477-8"><a href="Introkriging.html#cb477-8" aria-hidden="true" tabindex="-1"></a>  Cinv <span class="ot">&lt;-</span> <span class="fu">solve</span>(C)</span>
<span id="cb477-9"><a href="Introkriging.html#cb477-9" aria-hidden="true" tabindex="-1"></a>  XCXinv <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">crossprod</span>(X, Cinv) <span class="sc">%*%</span> X)</span>
<span id="cb477-10"><a href="Introkriging.html#cb477-10" aria-hidden="true" tabindex="-1"></a>  XCz <span class="ot">&lt;-</span> <span class="fu">crossprod</span>(X, Cinv) <span class="sc">%*%</span> z</span>
<span id="cb477-11"><a href="Introkriging.html#cb477-11" aria-hidden="true" tabindex="-1"></a>  betaGLS <span class="ot">&lt;-</span> XCXinv <span class="sc">%*%</span> XCz</span>
<span id="cb477-12"><a href="Introkriging.html#cb477-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">sum</span>(<span class="fu">abs</span>(betaGLS<span class="sc">-</span>betaGLS.cur))<span class="sc">&lt;</span><span class="fl">0.0001</span>) {</span>
<span id="cb477-13"><a href="Introkriging.html#cb477-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span></span>
<span id="cb477-14"><a href="Introkriging.html#cb477-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb477-15"><a href="Introkriging.html#cb477-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Table <a href="Introkriging.html#tab:ResidualVariogramEstimates">21.3</a> shows the estimates of the residual semivariogram parameters and regression coefficients, together with the estimates obtained by restricted maximum likelihood, which is explained in the next subsection.</p>
</div>
<div id="REML" class="section level3" number="21.5.2">
<h3><span class="header-section-number">21.5.2</span> Restricted maximum likelihood</h3>
<p>The estimates of the residual semivariogram parameters obtained by the iterative method-of-moments procedure are not unbiased. When the mean is not constant but a linear combination of one or more covariates, also ML estimation results in biased estimates of the residual semivariogram parameters. Unbiased estimates of the regression coefficients and residual semivariogram parameters can be obtained by restricted maximum likelihood (also referred to as residual maximum likelihood), REML. In REML the vector with the data are premultiplied by a so-called projection matrix <span class="math inline">\(\mathbf{P}\)</span> <span class="citation">(<a href="#ref-Kitanidis1983" role="doc-biblioref">Kitanidis 1983</a>)</span>. This projection matrix has the property that a vector with zeroes is obtained when the matrix <span class="math inline">\(\mathbf{X}\)</span> with the covariate values at the sampling locations (and ones in first column) is pre-multiplied with <span class="math inline">\(\mathbf{P}\)</span>:</p>
<p><span class="math display" id="eq:PX">\[\begin{equation}
\mathbf{P}\mathbf{X}=\mathbf{0} \;.
\tag{21.23}
\end{equation}\]</span></p>
<p>Pre-multiplying both sides of the KED model (Equation <a href="Introkriging.html#eq:KEDmodel2">(21.15)</a>) with <span class="math inline">\(\mathbf{P}\)</span> gives <span class="citation">(<a href="#ref-webster2007" role="doc-biblioref">Webster and Oliver 2007</a>)</span></p>
<p><span class="math display">\[\begin{equation}
\mathbf{P}\mathbf{z}(\mathbf{s})=\mathbf{y}(\mathbf{s})=\mathbf{P}\mathbf{X}\pmb{\beta} + \mathbf{P}\pmb{\epsilon}(\mathbf{s})=\mathbf{P}\pmb{\epsilon}(\mathbf{s}) \;.
(\#eq:)
\end{equation}\]</span></p>
<p>In words, by pre-multiplying the variable <span class="math inline">\(\mathbf{z}\)</span> with matrix <span class="math inline">\(\mathbf{P}\)</span> a new variable <span class="math inline">\(\mathbf{y}\)</span> is obtained that has a constant mean. So, the trend is filtered out, whatever the regression coefficients are. The semivariogram parameters of this new variable can be estimated by ML. The projection matrix <span class="math inline">\(\mathbf{P}\)</span> can be computed by</p>
<p><span class="math display">\[\begin{equation}
\mathbf{P}=\mathbf{I}-\mathbf{X}(\mathbf{X}^{\mathrm{T}}\mathbf{X})^{-1}\mathbf{X}^{\mathrm{T}} \;,
(\#eq:Pz(s))
\end{equation}\]</span></p>
<p>with <span class="math inline">\(\mathbf{I}\)</span> the <span class="math inline">\(n \times n\)</span> identity matrix (matrix with ones on the diagonal, zeroes in all off-diagonal elements). The natural log of the residual likelihood can be computed by <span class="citation">(<a href="#ref-lar06" role="doc-biblioref">Lark and Webster 2006</a>)</span></p>
<p><span class="math display" id="eq:residualloglikhood">\[\begin{equation}
\ell(\pmb{\theta}|\mathbf{z})=\mathrm{constant}-0.5(\mathrm{ln}|\mathbf{C}|+|\mathbf{X}^{\mathrm{T}}\mathbf{C}^{-1}\mathbf{X}|+\mathbf{y}^{\mathbf{T}}\mathbf{C}^{-1}(\mathbf{I-\mathbf{Q}})\mathbf{z})) \;,
\tag{21.24}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(\mathbf{Q} = \mathbf{X}(\mathbf{X}^{\mathrm{T}}\mathbf{C}^{-1}\mathbf{X})^{-1}\mathbf{X}^{\mathrm{T}}\mathbf{C}^{-1}\)</span></p>
<p>Restricted maximum likelihood estimates of the semivariogram can be obtained with function <code>likfit</code> of package <strong>geoR</strong>, used above in maximum likelihood estimation of the variogram <span class="citation">(<a href="#ref-geoR" role="doc-biblioref">Ribeiro Jr et al. 2020</a>)</span>.</p>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb478-1"><a href="Introkriging.html#cb478-1" aria-hidden="true" tabindex="-1"></a>vgm_REML <span class="ot">&lt;-</span> <span class="fu">likfit</span>( <span class="at">geodata=</span>dGeoR, <span class="at">trend=</span><span class="sc">~</span>x,</span>
<span id="cb478-2"><a href="Introkriging.html#cb478-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">cov.model=</span><span class="st">&quot;spherical&quot;</span>, <span class="at">ini.cov.pars=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">100</span>),</span>
<span id="cb478-3"><a href="Introkriging.html#cb478-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">nugget=</span><span class="dv">0</span>, <span class="at">lik.method=</span><span class="st">&quot;REML&quot;</span>, <span class="at">messages=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<table class=" lightable-classic" style="font-family: &quot;Arial Narrow&quot;, &quot;Source Sans Pro&quot;, sans-serif; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:ResidualVariogramEstimates">Table 21.3: </span>Estimated parameters of a spherical semivariogram for the residuals and estimated regression coefficients, obtained with iterative method-of-moments (iMoM) and restricted maximum likelihood (REML) estimation.
</caption>
<thead>
<tr>
<th style="text-align:left;">
Parameter
</th>
<th style="text-align:right;">
iMoM
</th>
<th style="text-align:right;">
REML
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
nugget
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
partial sill
</td>
<td style="text-align:right;">
2.137
</td>
<td style="text-align:right;">
1.909
</td>
</tr>
<tr>
<td style="text-align:left;">
range
</td>
<td style="text-align:right;">
129.147
</td>
<td style="text-align:right;">
141.491
</td>
</tr>
<tr>
<td style="text-align:left;">
intercept
</td>
<td style="text-align:right;">
3.255
</td>
<td style="text-align:right;">
3.083
</td>
</tr>
<tr>
<td style="text-align:left;">
x
</td>
<td style="text-align:right;">
2.712
</td>
<td style="text-align:right;">
2.732
</td>
</tr>
</tbody>
</table>
<p>Table <a href="Introkriging.html#tab:ResidualVariogramEstimates">21.3</a> shows that REML results in a smaller estimated (partial) sill and larger estimated range than iterative method-of-moments. Of the two regression coefficients especially the estimated intercept differs considerably among the two estimation methods.</p>
<p>I realise that this is a rather short introduction to kriging. I refer to <span class="citation"><a href="#ref-isa89" role="doc-biblioref">Isaaks and Srivastava</a> (<a href="#ref-isa89" role="doc-biblioref">1989</a>)</span> for an introduction to geostatistics, to <span class="citation"><a href="#ref-goo97" role="doc-biblioref">Goovaerts</a> (<a href="#ref-goo97" role="doc-biblioref">1997</a>)</span> for an expos<span class="math inline">\(\acute{\text{e}}\)</span> of the many versions of kriging and to <span class="citation"><a href="#ref-webster2007" role="doc-biblioref">Webster and Oliver</a> (<a href="#ref-webster2007" role="doc-biblioref">2007</a>)</span> for an elaborate explanation of kriging. An nice educational tool for getting a feeling for ordinary kriging is <a href="https://wiki.52north.org/AI_GEOSTATS/SWEZKriging">E{Z}-Kriging</a>.</p>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-chr91" class="csl-entry">
Christensen, R. 1991. <em>Linear Models for Multivariate, Time Series, and Spatial Data</em>. New York: Springer.
</div>
<div id="ref-goo97" class="csl-entry">
Goovaerts, P. 1997. <em>Geostatistics for Natural Resources Evaluation</em>. New York: Oxford University Press.
</div>
<div id="ref-isa89" class="csl-entry">
Isaaks, E. H., and R. M. Srivastava. 1989. <em>An Introduction to Applied Geostatistics</em>. New York: Oxford University Press.
</div>
<div id="ref-Kitanidis1983" class="csl-entry">
Kitanidis, P. K. 1983. <span>“Statistical Estimation of Polynomial Generalized Covariance Functions and Hydrologic Applications.”</span> <em>Water Resources Research</em> 19 (4): 909–21.
</div>
<div id="ref-lar00b" class="csl-entry">
Lark, R. M. 2000. <span>“Estimating Variograms of Soil Properties by the Method-of-Moments and Maximum Likelihood.”</span> <em>European Journal of Soil Science</em> 51 (4): 717–28.
</div>
<div id="ref-lar06" class="csl-entry">
Lark, R. M., and R. Webster. 2006. <span>“Geostatistical Mapping of Geomorphic Variables in the Presence of Trend.”</span> <em>Earth Surface Processes and Landforms</em> 31 (7): 862–74.
</div>
<div id="ref-peb04" class="csl-entry">
Pebesma, E. J. 2004. <span>“Multivariable Geostatistics in <span>S</span>: The Gstat Package.”</span> <em>Computers &amp; Geosciences</em> 30 (7): 683–91.
</div>
<div id="ref-geoR" class="csl-entry">
Ribeiro Jr, Paulo J., Peter J. Diggle, Martin Schlather, Roger Bivand, and Brian Ripley. 2020. <em><span class="nocase">geoR: Analysis of Geostatistical Data</span></em>. <a href="https://CRAN.R-project.org/package=geoR">https://CRAN.R-project.org/package=geoR</a>.
</div>
<div id="ref-webster2007" class="csl-entry">
———. 2007. <em><span class="nocase">Geostatistics for Environmental Scientists</span></em>. Second. Chichester: Wiley.
</div>
</div>
<div class="footnotes">
<hr />
<ol start="8">
<li id="fn8"><p>Model-unbiasedness is explained in Chapter <a href="Approaches.html#Approaches">26</a>.<a href="Introkriging.html#fnref8" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="SpatialResponseSurface.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="MBgridspacing.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/DickBrus/SpatialSamplingwithR/edit/master/27-IntroKriging.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["SpatialSampling.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
