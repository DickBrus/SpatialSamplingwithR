<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Stratified simple random sampling | Spatial sampling with R</title>
  <meta name="description" content="This book is for researchers, consultants and students who would like to know how to collect spatial data, either for estimating parameters for the population or several subpopulations, or for mapping. How many data do we need, and how to select the population units? The book presents a wide overview of spatial sampling designs. Besides there is a chapter on designs for sampling in space and time for monitoring. The emphasis is not on the theory, but on how to implement sampling designs in R and on how the (sub)population parameters can be estimated from the sample." />
  <meta name="generator" content="bookdown 0.25 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Stratified simple random sampling | Spatial sampling with R" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="/images/cover.pdf" />
  <meta property="og:description" content="This book is for researchers, consultants and students who would like to know how to collect spatial data, either for estimating parameters for the population or several subpopulations, or for mapping. How many data do we need, and how to select the population units? The book presents a wide overview of spatial sampling designs. Besides there is a chapter on designs for sampling in space and time for monitoring. The emphasis is not on the theory, but on how to implement sampling designs in R and on how the (sub)population parameters can be estimated from the sample." />
  <meta name="github-repo" content="DickBrus/SpatialSamplingwithR" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Stratified simple random sampling | Spatial sampling with R" />
  
  <meta name="twitter:description" content="This book is for researchers, consultants and students who would like to know how to collect spatial data, either for estimating parameters for the population or several subpopulations, or for mapping. How many data do we need, and how to select the population units? The book presents a wide overview of spatial sampling designs. Besides there is a chapter on designs for sampling in space and time for monitoring. The emphasis is not on the theory, but on how to implement sampling designs in R and on how the (sub)population parameters can be estimated from the sample." />
  <meta name="twitter:image" content="/images/cover.pdf" />

<meta name="author" content="Dick J. Brus" />


<meta name="date" content="2022-10-10" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="SI.html"/>
<link rel="next" href="SY.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Spatial sampling with R</a></li>

<li class="divider"></li>
<li><a href="index.html#preface">Preface<span></span></a>
<ul>
<li><a href="index.html#acknowledgments">Acknowledgments<span></span></a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="GeneralIntro.html"><a href="GeneralIntro.html"><i class="fa fa-check"></i><b>1</b> Introduction<span></span></a>
<ul>
<li class="chapter" data-level="1.1" data-path="GeneralIntro.html"><a href="GeneralIntro.html#BasicConcepts"><i class="fa fa-check"></i><b>1.1</b> Basic sampling concepts<span></span></a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="GeneralIntro.html"><a href="GeneralIntro.html#PopulationParameters"><i class="fa fa-check"></i><b>1.1.1</b> Population parameters<span></span></a></li>
<li class="chapter" data-level="1.1.2" data-path="GeneralIntro.html"><a href="GeneralIntro.html#descriptive-statistics-vs.-inference-about-a-population"><i class="fa fa-check"></i><b>1.1.2</b> Descriptive statistics vs. inference about a population<span></span></a></li>
<li class="chapter" data-level="1.1.3" data-path="GeneralIntro.html"><a href="GeneralIntro.html#random-sampling-vs.-probability-sampling"><i class="fa fa-check"></i><b>1.1.3</b> Random sampling vs. probability sampling<span></span></a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="GeneralIntro.html"><a href="GeneralIntro.html#DBvsMB"><i class="fa fa-check"></i><b>1.2</b> Design-based vs. model-based approach<span></span></a></li>
<li class="chapter" data-level="1.3" data-path="GeneralIntro.html"><a href="GeneralIntro.html#Datasets"><i class="fa fa-check"></i><b>1.3</b> Populations used in sampling experiments<span></span></a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="GeneralIntro.html"><a href="GeneralIntro.html#Voorst"><i class="fa fa-check"></i><b>1.3.1</b> Soil organic matter in Voorst, the Netherlands<span></span></a></li>
<li class="chapter" data-level="1.3.2" data-path="GeneralIntro.html"><a href="GeneralIntro.html#Poppy"><i class="fa fa-check"></i><b>1.3.2</b> Poppy fields in Kandahar, Afghanistan<span></span></a></li>
<li class="chapter" data-level="1.3.3" data-path="GeneralIntro.html"><a href="GeneralIntro.html#Amazonia"><i class="fa fa-check"></i><b>1.3.3</b> Aboveground biomass in Eastern Amazonia, Brazil<span></span></a></li>
<li class="chapter" data-level="1.3.4" data-path="GeneralIntro.html"><a href="GeneralIntro.html#TASIberia"><i class="fa fa-check"></i><b>1.3.4</b> Annual mean air temperature in Iberia<span></span></a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>I Probability sampling for estimating population parameters<span></span></b></span></li>
<li class="chapter" data-level="2" data-path="IntroProbabilitySampling.html"><a href="IntroProbabilitySampling.html"><i class="fa fa-check"></i><b>2</b> Introduction to probability sampling<span></span></a>
<ul>
<li><a href="IntroProbabilitySampling.html#arbitrary-haphazard-sampling-vs.-probability-sampling">Arbitrary (haphazard) sampling vs. probability sampling<span></span></a></li>
<li class="chapter" data-level="2.1" data-path="IntroProbabilitySampling.html"><a href="IntroProbabilitySampling.html#HTestimator"><i class="fa fa-check"></i><b>2.1</b> Horvitz-Thompson estimator<span></span></a></li>
<li class="chapter" data-level="2.2" data-path="IntroProbabilitySampling.html"><a href="IntroProbabilitySampling.html#hansen-hurwitz-estimator"><i class="fa fa-check"></i><b>2.2</b> Hansen-Hurwitz estimator<span></span></a></li>
<li class="chapter" data-level="2.3" data-path="IntroProbabilitySampling.html"><a href="IntroProbabilitySampling.html#using-models-in-design-based-approach"><i class="fa fa-check"></i><b>2.3</b> Using models in design-based approach<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="SI.html"><a href="SI.html"><i class="fa fa-check"></i><b>3</b> Simple random sampling<span></span></a>
<ul>
<li class="chapter" data-level="3.1" data-path="SI.html"><a href="SI.html#HTestimatorSI"><i class="fa fa-check"></i><b>3.1</b> Estimation of population parameters<span></span></a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="SI.html"><a href="SI.html#PopProportion"><i class="fa fa-check"></i><b>3.1.1</b> Population proportion<span></span></a></li>
<li class="chapter" data-level="3.1.2" data-path="SI.html"><a href="SI.html#CDF"><i class="fa fa-check"></i><b>3.1.2</b> Cumulative distribution function and quantiles<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="SI.html"><a href="SI.html#VarMeanSI"><i class="fa fa-check"></i><b>3.2</b> Sampling variance of estimator of population parameters<span></span></a></li>
<li class="chapter" data-level="3.3" data-path="SI.html"><a href="SI.html#ConfidenceInterval"><i class="fa fa-check"></i><b>3.3</b> Confidence interval estimate<span></span></a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="SI.html"><a href="SI.html#ConfidenceIntervalProportion"><i class="fa fa-check"></i><b>3.3.1</b> Confidence interval for a proportion<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="SI.html"><a href="SI.html#SIcircularplots"><i class="fa fa-check"></i><b>3.4</b> Simple random sampling of circular plots<span></span></a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="SI.html"><a href="SI.html#sampling-from-a-finite-set-of-fixed-circles"><i class="fa fa-check"></i><b>3.4.1</b> Sampling from a finite set of fixed circles<span></span></a></li>
<li class="chapter" data-level="3.4.2" data-path="SI.html"><a href="SI.html#sampling-from-an-infinite-set-of-floating-circles"><i class="fa fa-check"></i><b>3.4.2</b> Sampling from an infinite set of floating circles<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="STSI.html"><a href="STSI.html"><i class="fa fa-check"></i><b>4</b> Stratified simple random sampling<span></span></a>
<ul>
<li class="chapter" data-level="4.1" data-path="STSI.html"><a href="STSI.html#EstimatorsSTSI"><i class="fa fa-check"></i><b>4.1</b> Estimation of population parameters<span></span></a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="STSI.html"><a href="STSI.html#population-proportion-cumulative-distribution-function-and-quantiles"><i class="fa fa-check"></i><b>4.1.1</b> Population proportion, cumulative distribution function, and quantiles<span></span></a></li>
<li class="chapter" data-level="4.1.2" data-path="STSI.html"><a href="STSI.html#WhyStratify"><i class="fa fa-check"></i><b>4.1.2</b> Why should we stratify?<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="STSI.html"><a href="STSI.html#CISTSI"><i class="fa fa-check"></i><b>4.2</b> Confidence interval estimate<span></span></a></li>
<li class="chapter" data-level="4.3" data-path="STSI.html"><a href="STSI.html#STSIallocation"><i class="fa fa-check"></i><b>4.3</b> Allocation of sample size to strata<span></span></a></li>
<li class="chapter" data-level="4.4" data-path="STSI.html"><a href="STSI.html#cumrootf"><i class="fa fa-check"></i><b>4.4</b> <em>Cum-root-f</em> stratification<span></span></a></li>
<li class="chapter" data-level="4.5" data-path="STSI.html"><a href="STSI.html#kmeansstratification"><i class="fa fa-check"></i><b>4.5</b> Stratification with multiple covariates<span></span></a></li>
<li class="chapter" data-level="4.6" data-path="STSI.html"><a href="STSI.html#geostrata"><i class="fa fa-check"></i><b>4.6</b> Geographical stratification<span></span></a></li>
<li class="chapter" data-level="4.7" data-path="STSI.html"><a href="STSI.html#multiway-stratification"><i class="fa fa-check"></i><b>4.7</b> Multiway stratification<span></span></a></li>
<li class="chapter" data-level="4.8" data-path="STSI.html"><a href="STSI.html#MultivariateStratification"><i class="fa fa-check"></i><b>4.8</b> Multivariate stratification<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="SY.html"><a href="SY.html"><i class="fa fa-check"></i><b>5</b> Systematic random sampling<span></span></a>
<ul>
<li class="chapter" data-level="5.1" data-path="SY.html"><a href="SY.html#EstVarSY"><i class="fa fa-check"></i><b>5.1</b> Estimation of population parameters<span></span></a></li>
<li class="chapter" data-level="5.2" data-path="SY.html"><a href="SY.html#approximating-the-sampling-variance-of-the-estimator-of-the-mean"><i class="fa fa-check"></i><b>5.2</b> Approximating the sampling variance of the estimator of the mean<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="Cl.html"><a href="Cl.html"><i class="fa fa-check"></i><b>6</b> Cluster random sampling<span></span></a>
<ul>
<li class="chapter" data-level="6.1" data-path="Cl.html"><a href="Cl.html#clustersamplingestimators"><i class="fa fa-check"></i><b>6.1</b> Estimation of population parameters<span></span></a></li>
<li class="chapter" data-level="6.2" data-path="Cl.html"><a href="Cl.html#clusters-selected-with-probabilities-proportional-to-size-without-replacement"><i class="fa fa-check"></i><b>6.2</b> Clusters selected with probabilities proportional to size, without replacement<span></span></a></li>
<li class="chapter" data-level="6.3" data-path="Cl.html"><a href="Cl.html#SIC"><i class="fa fa-check"></i><b>6.3</b> Simple random sampling of clusters<span></span></a></li>
<li class="chapter" data-level="6.4" data-path="Cl.html"><a href="Cl.html#StratifiedCl"><i class="fa fa-check"></i><b>6.4</b> Stratified cluster random sampling<span></span></a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="Twostage.html"><a href="Twostage.html"><i class="fa fa-check"></i><b>7</b> Two-stage cluster random sampling<span></span></a>
<ul>
<li class="chapter" data-level="7.1" data-path="Twostage.html"><a href="Twostage.html#twostagesamplingestimators"><i class="fa fa-check"></i><b>7.1</b> Estimation of population parameters<span></span></a></li>
<li class="chapter" data-level="7.2" data-path="Twostage.html"><a href="Twostage.html#primary-sampling-units-selected-without-replacement"><i class="fa fa-check"></i><b>7.2</b> Primary sampling units selected without replacement<span></span></a></li>
<li class="chapter" data-level="7.3" data-path="Twostage.html"><a href="Twostage.html#TwostageSISI"><i class="fa fa-check"></i><b>7.3</b> Simple random sampling of primary sampling units<span></span></a></li>
<li class="chapter" data-level="7.4" data-path="Twostage.html"><a href="Twostage.html#StratifiedTwostage"><i class="fa fa-check"></i><b>7.4</b> Stratified two-stage cluster random sampling<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="pps.html"><a href="pps.html"><i class="fa fa-check"></i><b>8</b> Sampling with probabilities proportional to size<span></span></a>
<ul>
<li class="chapter" data-level="8.1" data-path="pps.html"><a href="pps.html#ppswr"><i class="fa fa-check"></i><b>8.1</b> Probability-proportional-to-size sampling with replacement<span></span></a></li>
<li class="chapter" data-level="8.2" data-path="pps.html"><a href="pps.html#ppswor"><i class="fa fa-check"></i><b>8.2</b> Probability-proportional-to-size sampling without replacement<span></span></a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="pps.html"><a href="pps.html#Systematicpps"><i class="fa fa-check"></i><b>8.2.1</b> Systematic pps sampling without replacement<span></span></a></li>
<li class="chapter" data-level="8.2.2" data-path="pps.html"><a href="pps.html#pivotalmethod"><i class="fa fa-check"></i><b>8.2.2</b> The pivotal method<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html"><i class="fa fa-check"></i><b>9</b> Balanced and well-spread sampling<span></span></a>
<ul>
<li class="chapter" data-level="9.1" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#Balanced"><i class="fa fa-check"></i><b>9.1</b> Balanced sampling<span></span></a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#balanced-sample-vs.-balanced-sampling-design"><i class="fa fa-check"></i><b>9.1.1</b> Balanced sample vs. balanced sampling design<span></span></a></li>
<li class="chapter" data-level="9.1.2" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#unequal-inclusion-probabilities"><i class="fa fa-check"></i><b>9.1.2</b> Unequal inclusion probabilities<span></span></a></li>
<li class="chapter" data-level="9.1.3" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#StratifiedsamplingasBalancedsampling"><i class="fa fa-check"></i><b>9.1.3</b> Stratified random sampling<span></span></a></li>
<li class="chapter" data-level="9.1.4" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#Multiwaystratification"><i class="fa fa-check"></i><b>9.1.4</b> Multiway stratification<span></span></a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#Spreaded"><i class="fa fa-check"></i><b>9.2</b> Well-spread sampling<span></span></a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#LPM"><i class="fa fa-check"></i><b>9.2.1</b> Local pivotal method<span></span></a></li>
<li class="chapter" data-level="9.2.2" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#GRTS"><i class="fa fa-check"></i><b>9.2.2</b> Generalised random-tessellation stratified sampling<span></span></a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#BalancedandSpreaded"><i class="fa fa-check"></i><b>9.3</b> Balanced sampling with spreading<span></span></a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="Modelassisted.html"><a href="Modelassisted.html"><i class="fa fa-check"></i><b>10</b> Model-assisted estimation<span></span></a>
<ul>
<li class="chapter" data-level="10.1" data-path="Modelassisted.html"><a href="Modelassisted.html#GREG"><i class="fa fa-check"></i><b>10.1</b> Generalised regression estimator<span></span></a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="Modelassisted.html"><a href="Modelassisted.html#RegressionEstimator"><i class="fa fa-check"></i><b>10.1.1</b> Simple and multiple regression estimators<span></span></a></li>
<li class="chapter" data-level="10.1.2" data-path="Modelassisted.html"><a href="Modelassisted.html#penalised-least-squares-estimation"><i class="fa fa-check"></i><b>10.1.2</b> Penalised least squares estimation<span></span></a></li>
<li class="chapter" data-level="10.1.3" data-path="Modelassisted.html"><a href="Modelassisted.html#RegressionEstimatorSTSI"><i class="fa fa-check"></i><b>10.1.3</b> Regression estimator with stratified simple random sampling<span></span></a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="Modelassisted.html"><a href="Modelassisted.html#RatioEstimator"><i class="fa fa-check"></i><b>10.2</b> Ratio estimator<span></span></a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="Modelassisted.html"><a href="Modelassisted.html#RatioEstimatorSTSI"><i class="fa fa-check"></i><b>10.2.1</b> Ratio estimators with stratified simple random sampling<span></span></a></li>
<li class="chapter" data-level="10.2.2" data-path="Modelassisted.html"><a href="Modelassisted.html#PoststratifiedEstimator"><i class="fa fa-check"></i><b>10.2.2</b> Poststratified estimator<span></span></a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="Modelassisted.html"><a href="Modelassisted.html#RandomForest"><i class="fa fa-check"></i><b>10.3</b> Model-assisted estimation using machine learning techniques<span></span></a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="Modelassisted.html"><a href="Modelassisted.html#predicting-with-a-regression-tree"><i class="fa fa-check"></i><b>10.3.1</b> Predicting with a regression tree<span></span></a></li>
<li class="chapter" data-level="10.3.2" data-path="Modelassisted.html"><a href="Modelassisted.html#predicting-with-a-random-forest"><i class="fa fa-check"></i><b>10.3.2</b> Predicting with a random forest<span></span></a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="Modelassisted.html"><a href="Modelassisted.html#big-data-and-volunteer-data"><i class="fa fa-check"></i><b>10.4</b> Big data and volunteer data<span></span></a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="Twophase.html"><a href="Twophase.html"><i class="fa fa-check"></i><b>11</b> Two-phase random sampling<span></span></a>
<ul>
<li class="chapter" data-level="11.1" data-path="Twophase.html"><a href="Twophase.html#TwophaseStratification"><i class="fa fa-check"></i><b>11.1</b> Two-phase random sampling for stratification<span></span></a></li>
<li class="chapter" data-level="11.2" data-path="Twophase.html"><a href="Twophase.html#TwophaseRegression"><i class="fa fa-check"></i><b>11.2</b> Two-phase random sampling for regression<span></span></a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html"><i class="fa fa-check"></i><b>12</b> Computing the required sample size<span></span></a>
<ul>
<li class="chapter" data-level="12.1" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#standard-error"><i class="fa fa-check"></i><b>12.1</b> Standard error<span></span></a></li>
<li class="chapter" data-level="12.2" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#ReqSampleSizeLengthCI"><i class="fa fa-check"></i><b>12.2</b> Length of confidence interval<span></span></a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#length-of-confidence-interval-for-a-proportion"><i class="fa fa-check"></i><b>12.2.1</b> Length of confidence interval for a proportion<span></span></a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#statistical-testing-of-hypothesis"><i class="fa fa-check"></i><b>12.3</b> Statistical testing of hypothesis<span></span></a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#sample-size-for-testing-a-proportion"><i class="fa fa-check"></i><b>12.3.1</b> Sample size for testing a proportion<span></span></a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#DesignEffect"><i class="fa fa-check"></i><b>12.4</b> Accounting for design effect<span></span></a></li>
<li class="chapter" data-level="12.5" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#BayesianSampleSize"><i class="fa fa-check"></i><b>12.5</b> Bayesian sample size determination<span></span></a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#bayesian-criteria-for-sample-size-computation"><i class="fa fa-check"></i><b>12.5.1</b> Bayesian criteria for sample size computation<span></span></a></li>
<li class="chapter" data-level="12.5.2" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#mixed-bayesian-likelihood-approach"><i class="fa fa-check"></i><b>12.5.2</b> Mixed Bayesian-likelihood approach<span></span></a></li>
<li class="chapter" data-level="12.5.3" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#estimation-of-population-mean"><i class="fa fa-check"></i><b>12.5.3</b> Estimation of population mean<span></span></a></li>
<li class="chapter" data-level="12.5.4" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#estimation-of-a-population-proportion"><i class="fa fa-check"></i><b>12.5.4</b> Estimation of a population proportion<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="MBpredictionofDesignVariance.html"><a href="MBpredictionofDesignVariance.html"><i class="fa fa-check"></i><b>13</b> Model-based optimisation of probability sampling designs<span></span></a>
<ul>
<li class="chapter" data-level="13.1" data-path="MBpredictionofDesignVariance.html"><a href="MBpredictionofDesignVariance.html#model-based-optimisation-of-sampling-design-type-and-sample-size"><i class="fa fa-check"></i><b>13.1</b> Model-based optimisation of sampling design type and sample size<span></span></a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="MBpredictionofDesignVariance.html"><a href="MBpredictionofDesignVariance.html#AnalyticalApproach"><i class="fa fa-check"></i><b>13.1.1</b> Analytical approach<span></span></a></li>
<li class="chapter" data-level="13.1.2" data-path="MBpredictionofDesignVariance.html"><a href="MBpredictionofDesignVariance.html#GeostatisticalSimulationApproach"><i class="fa fa-check"></i><b>13.1.2</b> Geostatistical simulation approach<span></span></a></li>
<li class="chapter" data-level="13.1.3" data-path="MBpredictionofDesignVariance.html"><a href="MBpredictionofDesignVariance.html#MBpredSamplingVarBayes"><i class="fa fa-check"></i><b>13.1.3</b> Bayesian approach<span></span></a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="MBpredictionofDesignVariance.html"><a href="MBpredictionofDesignVariance.html#Ospats"><i class="fa fa-check"></i><b>13.2</b> Model-based optimisation of spatial strata<span></span></a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html"><i class="fa fa-check"></i><b>14</b> Sampling for estimating parameters of domains<span></span></a>
<ul>
<li class="chapter" data-level="14.1" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#LargeDomainsDirectEstimator"><i class="fa fa-check"></i><b>14.1</b> Direct estimator for large domains<span></span></a></li>
<li class="chapter" data-level="14.2" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#SmallDomainsModelAssisted"><i class="fa fa-check"></i><b>14.2</b> Model-assisted estimators for small domains<span></span></a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#RegressionestimatorSmallDomain"><i class="fa fa-check"></i><b>14.2.1</b> Regression estimator<span></span></a></li>
<li class="chapter" data-level="14.2.2" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#SyntheticestimatorSmallDomain"><i class="fa fa-check"></i><b>14.2.2</b> Synthetic estimator<span></span></a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#SmallAreaModelBased"><i class="fa fa-check"></i><b>14.3</b> Model-based prediction<span></span></a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#random-intercept-model"><i class="fa fa-check"></i><b>14.3.1</b> Random intercept model<span></span></a></li>
<li class="chapter" data-level="14.3.2" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#geostatistical-model"><i class="fa fa-check"></i><b>14.3.2</b> Geostatistical model<span></span></a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#supplemental-probability-sampling-of-small-domains"><i class="fa fa-check"></i><b>14.4</b> Supplemental probability sampling of small domains<span></span></a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html"><i class="fa fa-check"></i><b>15</b> Repeated sample surveys for monitoring population parameters<span></span></a>
<ul>
<li class="chapter" data-level="15.1" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#space-time-designs"><i class="fa fa-check"></i><b>15.1</b> Space-time designs<span></span></a></li>
<li class="chapter" data-level="15.2" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#SpaceTimeparameters"><i class="fa fa-check"></i><b>15.2</b> Space-time population parameters<span></span></a></li>
<li class="chapter" data-level="15.3" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#design-based-generalised-least-squares-estimation-of-spatial-means"><i class="fa fa-check"></i><b>15.3</b> Design-based generalised least squares estimation of spatial means<span></span></a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#current-mean"><i class="fa fa-check"></i><b>15.3.1</b> Current mean<span></span></a></li>
<li class="chapter" data-level="15.3.2" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#change-of-the-spatial-mean"><i class="fa fa-check"></i><b>15.3.2</b> Change of the spatial mean<span></span></a></li>
<li class="chapter" data-level="15.3.3" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#temporal-trend-of-the-spatial-mean"><i class="fa fa-check"></i><b>15.3.3</b> Temporal trend of the spatial mean<span></span></a></li>
<li class="chapter" data-level="15.3.4" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#space-time-mean"><i class="fa fa-check"></i><b>15.3.4</b> Space-time mean<span></span></a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#case-study-annual-mean-daily-temperature-in-iberia"><i class="fa fa-check"></i><b>15.4</b> Case study: annual mean daily temperature in Iberia<span></span></a>
<ul>
<li class="chapter" data-level="15.4.1" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#static-synchronous-design"><i class="fa fa-check"></i><b>15.4.1</b> Static-synchronous design<span></span></a></li>
<li class="chapter" data-level="15.4.2" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#independent-synchronous-design"><i class="fa fa-check"></i><b>15.4.2</b> Independent synchronous design<span></span></a></li>
<li class="chapter" data-level="15.4.3" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#serially-alternating-design"><i class="fa fa-check"></i><b>15.4.3</b> Serially alternating design<span></span></a></li>
<li class="chapter" data-level="15.4.4" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#supplemented-panel-design"><i class="fa fa-check"></i><b>15.4.4</b> Supplemented panel design<span></span></a></li>
<li class="chapter" data-level="15.4.5" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#rotating-panel-design"><i class="fa fa-check"></i><b>15.4.5</b> Rotating panel design<span></span></a></li>
<li class="chapter" data-level="15.4.6" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#sampling-experiment"><i class="fa fa-check"></i><b>15.4.6</b> Sampling experiment<span></span></a></li>
</ul></li>
<li class="chapter" data-level="15.5" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#space-time-sampling-with-stratified-random-sampling-in-space"><i class="fa fa-check"></i><b>15.5</b> Space-time sampling with stratified random sampling in space<span></span></a></li>
</ul></li>
<li class="part"><span><b>II Sampling for mapping<span></span></b></span></li>
<li class="chapter" data-level="16" data-path="IntroSamplingforMapping.html"><a href="IntroSamplingforMapping.html"><i class="fa fa-check"></i><b>16</b> Introduction to sampling for mapping<span></span></a>
<ul>
<li class="chapter" data-level="16.1" data-path="IntroSamplingforMapping.html"><a href="IntroSamplingforMapping.html#when-is-probability-sampling-not-required"><i class="fa fa-check"></i><b>16.1</b> When is probability sampling not required?<span></span></a></li>
<li class="chapter" data-level="16.2" data-path="IntroSamplingforMapping.html"><a href="IntroSamplingforMapping.html#sampling-for-simultaneously-mapping-and-estimating-means"><i class="fa fa-check"></i><b>16.2</b> Sampling for simultaneously mapping and estimating means<span></span></a></li>
<li class="chapter" data-level="16.3" data-path="IntroSamplingforMapping.html"><a href="IntroSamplingforMapping.html#broad-overview-of-sampling-designs-for-mapping"><i class="fa fa-check"></i><b>16.3</b> Broad overview of sampling designs for mapping<span></span></a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="RegularGridSpatialCoverage.html"><a href="RegularGridSpatialCoverage.html"><i class="fa fa-check"></i><b>17</b> Regular grid and spatial coverage sampling<span></span></a>
<ul>
<li class="chapter" data-level="17.1" data-path="RegularGridSpatialCoverage.html"><a href="RegularGridSpatialCoverage.html#Regulargrid"><i class="fa fa-check"></i><b>17.1</b> Regular grid sampling<span></span></a></li>
<li class="chapter" data-level="17.2" data-path="RegularGridSpatialCoverage.html"><a href="RegularGridSpatialCoverage.html#SpatialCoverage"><i class="fa fa-check"></i><b>17.2</b> Spatial coverage sampling<span></span></a></li>
<li class="chapter" data-level="17.3" data-path="RegularGridSpatialCoverage.html"><a href="RegularGridSpatialCoverage.html#SpatialInfill"><i class="fa fa-check"></i><b>17.3</b> Spatial infill sampling<span></span></a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="kmeans.html"><a href="kmeans.html"><i class="fa fa-check"></i><b>18</b> Covariate space coverage sampling<span></span></a>
<ul>
<li class="chapter" data-level="18.1" data-path="kmeans.html"><a href="kmeans.html#covariate-space-infill-sampling"><i class="fa fa-check"></i><b>18.1</b> Covariate space infill sampling<span></span></a></li>
<li class="chapter" data-level="18.2" data-path="kmeans.html"><a href="kmeans.html#PerformanceCSC"><i class="fa fa-check"></i><b>18.2</b> Performance of covariate space coverage sampling in random forest prediction<span></span></a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="cLHS.html"><a href="cLHS.html"><i class="fa fa-check"></i><b>19</b> Conditioned Latin hypercube sampling<span></span></a>
<ul>
<li class="chapter" data-level="19.1" data-path="cLHS.html"><a href="cLHS.html#cLHIS"><i class="fa fa-check"></i><b>19.1</b> Conditioned Latin hypercube infill sampling<span></span></a></li>
<li class="chapter" data-level="19.2" data-path="cLHS.html"><a href="cLHS.html#performance-of-conditioned-latin-hypercube-sampling-in-random-forest-prediction"><i class="fa fa-check"></i><b>19.2</b> Performance of conditioned Latin hypercube sampling in random forest prediction<span></span></a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="SpatialResponseSurface.html"><a href="SpatialResponseSurface.html"><i class="fa fa-check"></i><b>20</b> Spatial response surface sampling<span></span></a>
<ul>
<li class="chapter" data-level="20.1" data-path="SpatialResponseSurface.html"><a href="SpatialResponseSurface.html#IncreaseSampleSize"><i class="fa fa-check"></i><b>20.1</b> Increasing the sample size<span></span></a></li>
<li class="chapter" data-level="20.2" data-path="SpatialResponseSurface.html"><a href="SpatialResponseSurface.html#stratified-spatial-response-surface-sampling"><i class="fa fa-check"></i><b>20.2</b> Stratified spatial response surface sampling<span></span></a></li>
<li class="chapter" data-level="20.3" data-path="SpatialResponseSurface.html"><a href="SpatialResponseSurface.html#mapping"><i class="fa fa-check"></i><b>20.3</b> Mapping<span></span></a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="Introkriging.html"><a href="Introkriging.html"><i class="fa fa-check"></i><b>21</b> Introduction to kriging<span></span></a>
<ul>
<li class="chapter" data-level="21.1" data-path="Introkriging.html"><a href="Introkriging.html#OrdinaryKriging"><i class="fa fa-check"></i><b>21.1</b> Ordinary kriging<span></span></a></li>
<li class="chapter" data-level="21.2" data-path="Introkriging.html"><a href="Introkriging.html#BlockKriging"><i class="fa fa-check"></i><b>21.2</b> Block-kriging<span></span></a></li>
<li class="chapter" data-level="21.3" data-path="Introkriging.html"><a href="Introkriging.html#IntroKED"><i class="fa fa-check"></i><b>21.3</b> Kriging with an external drift<span></span></a></li>
<li class="chapter" data-level="21.4" data-path="Introkriging.html"><a href="Introkriging.html#VariogramEstimation"><i class="fa fa-check"></i><b>21.4</b> Estimating the semivariogram<span></span></a>
<ul>
<li class="chapter" data-level="21.4.1" data-path="Introkriging.html"><a href="Introkriging.html#MoM"><i class="fa fa-check"></i><b>21.4.1</b> Method-of-moments<span></span></a></li>
<li class="chapter" data-level="21.4.2" data-path="Introkriging.html"><a href="Introkriging.html#MLestimationVariogram"><i class="fa fa-check"></i><b>21.4.2</b> Maximum likelihood<span></span></a></li>
</ul></li>
<li class="chapter" data-level="21.5" data-path="Introkriging.html"><a href="Introkriging.html#ResidualVariogram"><i class="fa fa-check"></i><b>21.5</b> Estimating the residual semivariogram<span></span></a>
<ul>
<li class="chapter" data-level="21.5.1" data-path="Introkriging.html"><a href="Introkriging.html#IterativeMoM"><i class="fa fa-check"></i><b>21.5.1</b> Iterative method-of-moments<span></span></a></li>
<li class="chapter" data-level="21.5.2" data-path="Introkriging.html"><a href="Introkriging.html#REML"><i class="fa fa-check"></i><b>21.5.2</b> Restricted maximum likelihood<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="22" data-path="MBgridspacing.html"><a href="MBgridspacing.html"><i class="fa fa-check"></i><b>22</b> Model-based optimisation of the grid spacing<span></span></a>
<ul>
<li class="chapter" data-level="22.1" data-path="MBgridspacing.html"><a href="MBgridspacing.html#GridspacingOK"><i class="fa fa-check"></i><b>22.1</b> Optimal grid spacing for ordinary kriging<span></span></a></li>
<li class="chapter" data-level="22.2" data-path="MBgridspacing.html"><a href="MBgridspacing.html#controlling-the-mean-or-a-quantile-of-the-ordinary-kriging-variance"><i class="fa fa-check"></i><b>22.2</b> Controlling the mean or a quantile of the ordinary kriging variance<span></span></a></li>
<li class="chapter" data-level="22.3" data-path="MBgridspacing.html"><a href="MBgridspacing.html#optimal-grid-spacing-for-block-kriging"><i class="fa fa-check"></i><b>22.3</b> Optimal grid spacing for block-kriging<span></span></a></li>
<li class="chapter" data-level="22.4" data-path="MBgridspacing.html"><a href="MBgridspacing.html#MBgridspacingKED"><i class="fa fa-check"></i><b>22.4</b> Optimal grid spacing for kriging with an external drift<span></span></a></li>
<li class="chapter" data-level="22.5" data-path="MBgridspacing.html"><a href="MBgridspacing.html#BayesianGridSpacing"><i class="fa fa-check"></i><b>22.5</b> Bayesian approach<span></span></a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="MBSamplePattern.html"><a href="MBSamplePattern.html"><i class="fa fa-check"></i><b>23</b> Model-based optimisation of the sampling pattern<span></span></a>
<ul>
<li class="chapter" data-level="23.1" data-path="MBSamplePattern.html"><a href="MBSamplePattern.html#SSA"><i class="fa fa-check"></i><b>23.1</b> Spatial simulated annealing<span></span></a></li>
<li class="chapter" data-level="23.2" data-path="MBSamplePattern.html"><a href="MBSamplePattern.html#SamplePatternOK"><i class="fa fa-check"></i><b>23.2</b> Optimising the sampling pattern for ordinary kriging<span></span></a></li>
<li class="chapter" data-level="23.3" data-path="MBSamplePattern.html"><a href="MBSamplePattern.html#SamplePatternKED"><i class="fa fa-check"></i><b>23.3</b> Optimising the sampling pattern for kriging with an external drift<span></span></a></li>
<li class="chapter" data-level="23.4" data-path="MBSamplePattern.html"><a href="MBSamplePattern.html#model-based-infill-sampling-for-ordinary-kriging"><i class="fa fa-check"></i><b>23.4</b> Model-based infill sampling for ordinary kriging<span></span></a></li>
<li class="chapter" data-level="23.5" data-path="MBSamplePattern.html"><a href="MBSamplePattern.html#model-based-infill-sampling-for-kriging-with-an-external-drift"><i class="fa fa-check"></i><b>23.5</b> Model-based infill sampling for kriging with an external drift<span></span></a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html"><i class="fa fa-check"></i><b>24</b> Sampling for estimating the semivariogram<span></span></a>
<ul>
<li class="chapter" data-level="24.1" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#NestedSampling"><i class="fa fa-check"></i><b>24.1</b> Nested sampling<span></span></a></li>
<li class="chapter" data-level="24.2" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#IndependentSamplingPairs"><i class="fa fa-check"></i><b>24.2</b> Independent sampling of pairs of points<span></span></a></li>
<li class="chapter" data-level="24.3" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#samplingforvariogram"><i class="fa fa-check"></i><b>24.3</b> Optimisation of sampling pattern for semivariogram estimation<span></span></a>
<ul>
<li class="chapter" data-level="24.3.1" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#UncertainSemivariogramParameters"><i class="fa fa-check"></i><b>24.3.1</b> Uncertainty about semivariogram parameters<span></span></a></li>
<li class="chapter" data-level="24.3.2" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#UncertainKrigingVariance"><i class="fa fa-check"></i><b>24.3.2</b> Uncertainty about the kriging variance<span></span></a></li>
</ul></li>
<li class="chapter" data-level="24.4" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#SamplingEstimationandPrediction"><i class="fa fa-check"></i><b>24.4</b> Optimisation of sampling pattern for semivariogram estimation and mapping<span></span></a></li>
<li class="chapter" data-level="24.5" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#a-practical-solution"><i class="fa fa-check"></i><b>24.5</b> A practical solution<span></span></a></li>
</ul></li>
<li class="chapter" data-level="25" data-path="Validation.html"><a href="Validation.html"><i class="fa fa-check"></i><b>25</b> Sampling for validation of maps<span></span></a>
<ul>
<li class="chapter" data-level="25.1" data-path="Validation.html"><a href="Validation.html#map-quality-indices"><i class="fa fa-check"></i><b>25.1</b> Map quality indices<span></span></a>
<ul>
<li class="chapter" data-level="25.1.1" data-path="Validation.html"><a href="Validation.html#estimation-of-map-quality-indices"><i class="fa fa-check"></i><b>25.1.1</b> Estimation of map quality indices<span></span></a></li>
</ul></li>
<li class="chapter" data-level="25.2" data-path="Validation.html"><a href="Validation.html#real-world-case-study"><i class="fa fa-check"></i><b>25.2</b> Real-world case study<span></span></a>
<ul>
<li class="chapter" data-level="25.2.1" data-path="Validation.html"><a href="Validation.html#estimation-of-the-population-mean-error-and-mean-squared-error"><i class="fa fa-check"></i><b>25.2.1</b> Estimation of the population mean error and mean squared error<span></span></a></li>
<li class="chapter" data-level="25.2.2" data-path="Validation.html"><a href="Validation.html#estimation-of-the-standard-error-of-the-estimator-of-the-population-mean-error-and-mean-squared-error"><i class="fa fa-check"></i><b>25.2.2</b> Estimation of the standard error of the estimator of the population mean error and mean squared error<span></span></a></li>
<li class="chapter" data-level="25.2.3" data-path="Validation.html"><a href="Validation.html#estimation-of-model-efficiency-coefficient"><i class="fa fa-check"></i><b>25.2.3</b> Estimation of model efficiency coefficient<span></span></a></li>
<li class="chapter" data-level="25.2.4" data-path="Validation.html"><a href="Validation.html#statistical-testing-of-hypothesis-about-population-me-and-mse"><i class="fa fa-check"></i><b>25.2.4</b> Statistical testing of hypothesis about population ME and MSE<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="26" data-path="Approaches.html"><a href="Approaches.html"><i class="fa fa-check"></i><b>26</b> Design-based, model-based, and model-assisted approach for sampling and inference<span></span></a>
<ul>
<li class="chapter" data-level="26.1" data-path="Approaches.html"><a href="Approaches.html#two-sources-of-randomness"><i class="fa fa-check"></i><b>26.1</b> Two sources of randomness<span></span></a></li>
<li class="chapter" data-level="26.2" data-path="Approaches.html"><a href="Approaches.html#iid"><i class="fa fa-check"></i><b>26.2</b> Identically and independently distributed<span></span></a></li>
<li class="chapter" data-level="26.3" data-path="Approaches.html"><a href="Approaches.html#BiasandVariance"><i class="fa fa-check"></i><b>26.3</b> Bias and variance<span></span></a></li>
<li class="chapter" data-level="26.4" data-path="Approaches.html"><a href="Approaches.html#effectivesamplesize"><i class="fa fa-check"></i><b>26.4</b> Effective sample size<span></span></a></li>
<li class="chapter" data-level="26.5" data-path="Approaches.html"><a href="Approaches.html#ExploitSpatialStructure"><i class="fa fa-check"></i><b>26.5</b> Exploiting spatial structure in design-based approach<span></span></a></li>
<li class="chapter" data-level="26.6" data-path="Approaches.html"><a href="Approaches.html#ModelassistedvsModeldependent"><i class="fa fa-check"></i><b>26.6</b> Model-assisted vs. model-dependent<span></span></a></li>
</ul></li>
<li class="appendix"><span><b>Appendices<span></span></b></span></li>
<li class="chapter" data-level="A" data-path="Answers.html"><a href="Answers.html"><i class="fa fa-check"></i><b>A</b> Answers to exercises<span></span></a>
<ul>
<li><a href="Answers.html#introduction-to-probability-sampling">Introduction to probability sampling<span></span></a></li>
<li><a href="Answers.html#simple-random-sampling-1">Simple random sampling<span></span></a></li>
<li><a href="Answers.html#stratified-simple-random-sampling-1">Stratified simple random sampling<span></span></a></li>
<li><a href="Answers.html#systematic-random-sampling-2">Systematic random sampling<span></span></a></li>
<li><a href="Answers.html#cluster-random-sampling">Cluster random sampling<span></span></a></li>
<li><a href="Answers.html#two-stage-cluster-random-sampling-1">Two-stage cluster random sampling<span></span></a></li>
<li><a href="Answers.html#sampling-with-probabilities-proportional-to-size">Sampling with probabilities proportional to size<span></span></a></li>
<li><a href="Answers.html#balanced-and-well-spread-sampling">Balanced and well-spread sampling<span></span></a></li>
<li><a href="Answers.html#model-assisted-estimation">Model-assisted estimation<span></span></a></li>
<li><a href="Answers.html#two-phase-random-sampling">Two-phase random sampling<span></span></a></li>
<li><a href="Answers.html#computing-the-required-sample-size">Computing the required sample size<span></span></a></li>
<li><a href="Answers.html#model-based-optimisation-of-probability-sampling-designs">Model-based optimisation of probability sampling designs<span></span></a></li>
<li><a href="Answers.html#repeated-sample-surveys-for-monitoring-population-parameters">Repeated sample surveys for monitoring population parameters<span></span></a></li>
<li><a href="Answers.html#regular-grid-and-spatial-coverage-sampling">Regular grid and spatial coverage sampling<span></span></a></li>
<li><a href="Answers.html#covariate-space-coverage-sampling">Covariate space coverage sampling<span></span></a></li>
<li><a href="Answers.html#conditioned-latin-hypercube-sampling">Conditioned Latin hypercube sampling<span></span></a></li>
<li><a href="Answers.html#model-based-optimisation-of-the-grid-spacing">Model-based optimisation of the grid spacing<span></span></a></li>
<li><a href="Answers.html#model-based-optimisation-of-the-sampling-pattern">Model-based optimisation of the sampling pattern<span></span></a></li>
<li><a href="Answers.html#sampling-for-estimating-the-semivariogram">Sampling for estimating the semivariogram<span></span></a></li>
<li><a href="Answers.html#sampling-for-validation-of-maps">Sampling for validation of maps<span></span></a></li>
</ul></li>
<li><a href="references.html#references">References<span></span></a></li>
<li class="divider"></li>
<li><a href="https://github.com/DickBrus/">Dick Brus</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Spatial sampling with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="STSI" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Chapter 4</span> Stratified simple random sampling<a href="STSI.html#STSI" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In stratified random sampling the population is divided into subpopulations, for instance, soil mapping units, areas with the same land use or land cover, administrative units, etc. The subareas are mutually exclusive, i.e., they do not overlap, and are jointly exhaustive, i.e., their union equals the entire population (study area). Within each subpopulation, referred to as a stratum, a probability sample is selected by some sampling design. If these probability samples are selected by simple random sampling, as described in the previous chapter, the design is stratified <em>simple</em> random sampling, the topic of this chapter. If sampling units are selected by cluster random sampling, then the design is stratified <em>cluster</em> random sampling.</p>
<p>Stratified simple random sampling is illustrated with Voorst (Figure <a href="STSI.html#fig:SampleSTSI">4.1</a>). Tibble <code>grdVoorst</code> with simulated data contains variable <code>stratum</code>. The strata are combinations of soil class and land use, obtained by overlaying a soil map and a land use map. To select a stratified simple random sample, we set the total sample size <span class="math inline">\(n\)</span>. The sampling units must be apportioned to the strata. I chose to apportion the units proportionally to the size (area, number of grid cells) of the strata (for details, see Section <a href="STSI.html#STSIallocation">4.3</a>). The larger a stratum, the more units are selected from this stratum. The sizes of the strata, i.e., the total number of grid cells, are computed with function <code>tapply</code>.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="STSI.html#cb33-1" aria-hidden="true" tabindex="-1"></a>N_h <span class="ot">&lt;-</span> <span class="fu">tapply</span>(grdVoorst<span class="sc">$</span>stratum, <span class="at">INDEX =</span> grdVoorst<span class="sc">$</span>stratum, <span class="at">FUN =</span> length)</span>
<span id="cb33-2"><a href="STSI.html#cb33-2" aria-hidden="true" tabindex="-1"></a>w_h <span class="ot">&lt;-</span> N_h <span class="sc">/</span> <span class="fu">sum</span>(N_h)</span>
<span id="cb33-3"><a href="STSI.html#cb33-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">40</span></span>
<span id="cb33-4"><a href="STSI.html#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(n_h <span class="ot">&lt;-</span> <span class="fu">round</span>(n <span class="sc">*</span> w_h))</span></code></pre></div>
<pre><code>BA EA PA RA XF 
13  8  9  4  7 </code></pre>
<p>The sum of the stratum sample sizes is 41; we want 40, so we reduce the largest stratum sample size by 1.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="STSI.html#cb35-1" aria-hidden="true" tabindex="-1"></a>n_h[<span class="dv">1</span>] <span class="ot">&lt;-</span> n_h[<span class="dv">1</span>] <span class="sc">-</span> <span class="dv">1</span></span></code></pre></div>
<p>The stratified simple random sample is selected with function <code>strata</code> of package <strong>sampling</strong> <span class="citation">(<a href="#ref-Tille2016" role="doc-biblioref">Tillé and Matei 2021</a>)</span>. Argument <code>size</code> specifies the stratum sample sizes.</p>

<div class="rmdcaution">
The stratum sample sizes must be in the order the strata are encountered in tibble <code>grdVoorst</code>, which is determined first with function <code>unique</code>.
</div>
<p>Within the strata, the grid cells are selected by simple random sampling <em>with replacement</em> (<code>method = "srswr"</code>), so that in principle more than one point can be selected within a grid cell, see Chapter <a href="SI.html#SI">3</a> for a motivation of this. Function <code>getdata</code> extracts the observations of the selected units from the sampling frame, as well as the spatial coordinates and the stratum of these units. The coordinates of the centres of the selected grid cells are jittered by an amount equal to half the side of the grid cells. In the next code chunk, this is done with function <code>mutate</code> of package <strong>dplyr</strong> <span class="citation">(<a href="#ref-dplyr" role="doc-biblioref">Hadley Wickham et al. 2021</a>)</span> which is part of package <strong>tidyverse</strong> <span class="citation">(<a href="#ref-Wickham2019" role="doc-biblioref">Hadley Wickham et al. 2019</a>)</span>. We have seen the pipe operator <code>%&gt;%</code> of package <strong>magrittr</strong> <span class="citation">(<a href="#ref-magrittr" role="doc-biblioref">Bache and Wickham 2020</a>)</span> before in Subsection <a href="SI.html#CDF">3.1.2</a>. If you are not familiar with <strong>tidyverse</strong> I recommend reading the excellent book  <span class="citation">(<a href="#ref-Wickham2017" role="doc-biblioref">H. Wickham and Grolemund 2017</a>)</span>.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="STSI.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sampling)</span>
<span id="cb36-2"><a href="STSI.html#cb36-2" aria-hidden="true" tabindex="-1"></a>ord <span class="ot">&lt;-</span> <span class="fu">unique</span>(grdVoorst<span class="sc">$</span>stratum)</span>
<span id="cb36-3"><a href="STSI.html#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">314</span>)</span>
<span id="cb36-4"><a href="STSI.html#cb36-4" aria-hidden="true" tabindex="-1"></a>units <span class="ot">&lt;-</span> sampling<span class="sc">::</span><span class="fu">strata</span>(</span>
<span id="cb36-5"><a href="STSI.html#cb36-5" aria-hidden="true" tabindex="-1"></a>  grdVoorst, <span class="at">stratanames =</span> <span class="st">&quot;stratum&quot;</span>, <span class="at">size =</span> n_h[ord], <span class="at">method =</span> <span class="st">&quot;srswr&quot;</span>)</span>
<span id="cb36-6"><a href="STSI.html#cb36-6" aria-hidden="true" tabindex="-1"></a>mysample <span class="ot">&lt;-</span> <span class="fu">getdata</span>(grdVoorst, units) <span class="sc">%&gt;%</span></span>
<span id="cb36-7"><a href="STSI.html#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">s1 =</span> s1 <span class="sc">%&gt;%</span> <span class="fu">jitter</span>(<span class="at">amount =</span> <span class="dv">25</span> <span class="sc">/</span> <span class="dv">2</span>),</span>
<span id="cb36-8"><a href="STSI.html#cb36-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">s2 =</span> s2 <span class="sc">%&gt;%</span> <span class="fu">jitter</span>(<span class="at">amount =</span> <span class="dv">25</span> <span class="sc">/</span> <span class="dv">2</span>))</span></code></pre></div>

<div class="rmdnote">
The name of the package is added to function <code>strata</code> (<code>sampling::strata</code>), as <code>strata</code> is also a function of another package. Not adding the name of the package may result in an error message.
</div>
<p>Figure <a href="STSI.html#fig:SampleSTSI">4.1</a> shows the selected sample.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:SampleSTSI"></span>
<img src="SpatialSampling_files/figure-html/SampleSTSI-1.png" alt="Stratified simple random sample of size 40 from Voorst. Strata are combinations of soil class and land use." width="100%" />
<p class="caption">
Figure 4.1: Stratified simple random sample of size 40 from Voorst. Strata are combinations of soil class and land use.
</p>
</div>
<div id="EstimatorsSTSI" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Estimation of population parameters<a href="STSI.html#EstimatorsSTSI" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>With simple random sampling within strata, the estimator of the population mean for simple random sampling (Equation <a href="SI.html#eq:HTMeanSI">(3.2)</a>) is applied at the level of the strata. The estimated stratum means are then averaged, using the relative sizes or areas of the strata as weights:</p>
<p><span class="math display" id="eq:HTMeanSTSI">\[\begin{equation}
\hat{\bar{z}}= \sum\limits_{h=1}^{H} w_{h}\,\hat{\bar{z}}_{h} \;,
\tag{4.1}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(H\)</span> is the number of strata, <span class="math inline">\(w_{h}\)</span> is the relative size (area) of stratum <span class="math inline">\(h\)</span> (stratum weight): <span class="math inline">\(w_h = N_h/N\)</span>, and <span class="math inline">\(\hat{\bar{z}}_{h}\)</span> is the estimated mean of stratum <span class="math inline">\(h\)</span>, estimated by the sample mean for stratum <span class="math inline">\(h\)</span>:</p>
<p><span class="math display" id="eq:HTStratumMeanSI">\[\begin{equation}
\hat{\bar{z}}_{h}=\frac{1}{n_h}\sum_{k \in \mathcal{S}_h} z_k\;,
\tag{4.2}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(\mathcal{S}_h\)</span> the sample selected from stratum <span class="math inline">\(h\)</span>.</p>
<p>The same estimator is found when the <span class="math inline">\(\pi\)</span> estimator is worked out for stratified simple random sampling. With stratified simple random sampling without replacement and different sampling fractions for the strata, the inclusion probabilities differ among the strata and equal <span class="math inline">\(\pi_{k} = n_h/N_h\)</span> for all <span class="math inline">\(k\)</span> in stratum <span class="math inline">\(h\)</span>, with <span class="math inline">\(n_h\)</span> the sample size of stratum <span class="math inline">\(h\)</span> and <span class="math inline">\(N_h\)</span> the size of stratum <span class="math inline">\(h\)</span>. Inserting this in the <span class="math inline">\(\pi\)</span> estimator of the population mean (Equation <a href="IntroProbabilitySampling.html#eq:HTMean">(2.4)</a>) gives</p>
<p><span class="math display" id="eq:HTMeanSTSI2">\[\begin{equation}
\hat{\bar{z}}= \frac{1}{N}\sum\limits_{h=1}^{H}\sum\limits_{k \in \mathcal{S}_h} \frac{z_{k}}{\pi_{k}} = \frac{1}{N}\sum\limits_{h=1}^{H} \frac{N_h}{n_h}\sum\limits_{k \in \mathcal{S}_h} z_{k} = \sum\limits_{h=1}^{H} w_{h}\,\hat{\bar{z}}_{h} \;.
\tag{4.3}
\end{equation}\]</span></p>

<div class="rmdnote">
The sampling fractions are usually slightly different, even with proportional allocation (Section <a href="STSI.html#STSIallocation">4.3</a>), because <span class="math inline">\(n_h/N_h\)</span> cannot be made exactly equal for all strata. Sample sizes necessarily are integers, so <span class="math inline">\(n_h/N_h\)</span> must be rounded to integers.
</div>
<p>The sampling variance of the estimator of the population mean is estimated by first estimating the sampling variances of the estimated stratum means, followed by computing the weighted average of the estimated sampling variances of the estimated stratum means. Note that we must square the stratum weights:</p>
<p><span class="math display" id="eq:EstVarMeanSTSI">\[\begin{equation}
\widehat{V}\!\left(\hat{\bar{z}}\right)=\sum\limits_{h=1}^{H}w_{h}^{2}\,\widehat{V}\!\left(\hat{\bar{z}}_{h}\right)\;,
\tag{4.4}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(\widehat{V}\!\left(\hat{\bar{z}}_{h}\right)\)</span> is the estimated sampling variance of <span class="math inline">\(\hat{\bar{z}}_{h}\)</span>:</p>
<p><span class="math display" id="eq:EstVarstratummean">\[\begin{equation}
\widehat{V}\!\left(\hat{\bar{z}}_{h}\right)= (1-\frac{n_h}{N_h}) \frac{\widehat{S^2}_h(z)}{n_h}\;,
\tag{4.5}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(\widehat{S^2}_h(z)\)</span> the estimated variance of <span class="math inline">\(z\)</span> within stratum <span class="math inline">\(h\)</span>:</p>
<p><span class="math display" id="eq:EstStratumVar">\[\begin{equation}
\widehat{S^2}_h(z)=\frac{1}{n_h-1}\sum\limits_{k \in \mathcal{S}_h}\left(z_{k}-\hat{\bar{z}}_{h}\right)^{2}\;.
\tag{4.6}
\end{equation}\]</span></p>
<p>For stratified simple random sampling with replacement of finite populations and stratified simple random sampling of infinite populations the fpcs <span class="math inline">\(1-(n_h/N_h)\)</span> can be dropped.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="STSI.html#cb37-1" aria-hidden="true" tabindex="-1"></a>mz_h <span class="ot">&lt;-</span> <span class="fu">tapply</span>(mysample<span class="sc">$</span>z, <span class="at">INDEX =</span> mysample<span class="sc">$</span>stratum, <span class="at">FUN =</span> mean)</span>
<span id="cb37-2"><a href="STSI.html#cb37-2" aria-hidden="true" tabindex="-1"></a>mz <span class="ot">&lt;-</span> <span class="fu">sum</span>(w_h <span class="sc">*</span> mz_h)</span>
<span id="cb37-3"><a href="STSI.html#cb37-3" aria-hidden="true" tabindex="-1"></a>S2z_h <span class="ot">&lt;-</span> <span class="fu">tapply</span>(mysample<span class="sc">$</span>z, <span class="at">INDEX =</span> mysample<span class="sc">$</span>stratum, <span class="at">FUN =</span> var)</span>
<span id="cb37-4"><a href="STSI.html#cb37-4" aria-hidden="true" tabindex="-1"></a>v_mz_h <span class="ot">&lt;-</span> S2z_h <span class="sc">/</span> n_h</span>
<span id="cb37-5"><a href="STSI.html#cb37-5" aria-hidden="true" tabindex="-1"></a>se_mz <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>(w_h<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> v_mz_h))</span></code></pre></div>
<table class=" lightable-classic" style="font-family: &quot;Arial Narrow&quot;, &quot;Source Sans Pro&quot;, sans-serif; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:stratummeans">Table 4.1: </span>Size (Nh), sample size (nh), estimated mean (Mean), estimated variance (Variance), and estimated standard error of estimator of mean (se) of the five strata in Voorst.
</caption>
<thead>
<tr>
<th style="text-align:left;">
Stratum
</th>
<th style="text-align:left;">
Nh
</th>
<th style="text-align:right;">
nh
</th>
<th style="text-align:right;">
Mean
</th>
<th style="text-align:left;">
Variance
</th>
<th style="text-align:right;">
se
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
BA
</td>
<td style="text-align:left;">
2,371
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
91.1
</td>
<td style="text-align:left;">
946.3
</td>
<td style="text-align:right;">
8.9
</td>
</tr>
<tr>
<td style="text-align:left;">
EA
</td>
<td style="text-align:left;">
1,442
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
58.3
</td>
<td style="text-align:left;">
555.5
</td>
<td style="text-align:right;">
8.3
</td>
</tr>
<tr>
<td style="text-align:left;">
PA
</td>
<td style="text-align:left;">
1,710
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
59.4
</td>
<td style="text-align:left;">
214.7
</td>
<td style="text-align:right;">
4.9
</td>
</tr>
<tr>
<td style="text-align:left;">
RA
</td>
<td style="text-align:left;">
659
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
103.2
</td>
<td style="text-align:left;">
2,528.8
</td>
<td style="text-align:right;">
25.1
</td>
</tr>
<tr>
<td style="text-align:left;">
XF
</td>
<td style="text-align:left;">
1,346
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
133.9
</td>
<td style="text-align:left;">
3,807.3
</td>
<td style="text-align:right;">
23.3
</td>
</tr>
</tbody>
</table>
<p>Table <a href="STSI.html#tab:stratummeans">4.1</a> shows per stratum the estimated mean, variance, and sampling variance of the estimated mean of the SOM concentration. We can see large differences in the within-stratum variances. For the stratified sample of Figure <a href="STSI.html#fig:SampleSTSI">4.1</a>, the estimated population mean equals 86.3 g kg<sup>-1</sup>, and the estimated standard error of this estimator equals 5.8 g kg<sup>-1</sup>.</p>
<p>The population mean can also be estimated directly using the basic <span class="math inline">\(\pi\)</span> estimator (Equation <a href="IntroProbabilitySampling.html#eq:HTMean">(2.4)</a>). The inclusion probabilities are included in <code>data.frame</code> <code>mysample</code>, obtained with function <code>getdata</code> (see code chunk above), as variable <code>Prob</code>.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="STSI.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mysample)</span></code></pre></div>
<pre><code>           s1       s2         z stratum ID_unit        Prob Stratum
1135 202554.8 464556.7 186.99296      XF    1135 0.005189017       1
2159 204305.5 464738.9  75.04809      XF    2159 0.005189017       1
4205 203038.3 465057.0 138.14617      XF    4205 0.005189017       1
4503 202381.1 465096.7  69.43803      XF    4503 0.005189017       1
5336 203610.4 465237.8  78.02003      XF    5336 0.005189017       1
5853 205147.1 465315.5 164.55224      XF    5853 0.005189017       1</code></pre>
<p>The population total is estimated first, and by dividing this estimated total by the total number of population units <span class="math inline">\(N\)</span> an estimate of the population mean is obtained.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="STSI.html#cb40-1" aria-hidden="true" tabindex="-1"></a>tz <span class="ot">&lt;-</span> <span class="fu">sum</span>(mysample<span class="sc">$</span>z <span class="sc">/</span> mysample<span class="sc">$</span>Prob)</span>
<span id="cb40-2"><a href="STSI.html#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(mz <span class="ot">&lt;-</span> tz <span class="sc">/</span> <span class="fu">sum</span>(N_h))</span></code></pre></div>
<pre><code>[1] 86.53333</code></pre>
<p>The two estimates of the population mean are not exactly equal. This is due to rounding errors in the inclusion probabilities. This can be shown by computing the sum of the inclusion probabilities over all population units. This sum should be equal to the sample size <span class="math inline">\(n=40\)</span>, but as we can see below, this sum is slightly smaller.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="STSI.html#cb42-1" aria-hidden="true" tabindex="-1"></a>pi_h <span class="ot">&lt;-</span> <span class="fu">tapply</span>(mysample<span class="sc">$</span>Prob, <span class="at">INDEX =</span> mysample<span class="sc">$</span>stratum, <span class="at">FUN =</span> unique)</span>
<span id="cb42-2"><a href="STSI.html#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">sum</span>(pi_h <span class="sc">*</span> N_h))</span></code></pre></div>
<pre><code>[1] 39.90711</code></pre>
<p>Now suppose we ignore that the sample data come from a stratified sampling design and we use the (unweighted) sample mean as an estimate of the population mean.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="STSI.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">mean</span>(mysample<span class="sc">$</span>z))</span></code></pre></div>
<pre><code>[1] 86.11247</code></pre>
<p>The sample mean slightly differs from the proper estimate of the population mean (7.238). The sample mean is a <em>biased</em> estimator, but the bias is small. The bias is only small because the stratum sample sizes are about proportional to the sizes of the strata, so that the inclusion probabilities (sampling intensities) are about equal for all strata: 0.0050494, 0.0055344, 0.0052509, 0.006056, 0.005189. The probabilities are not exactly equal because the stratum sample sizes are necessarily rounded to integers and because we reduced the largest sample size by one unit. The bias would have been substantially larger if an equal number of units would have been selected from each stratum, leading to much larger differences in the inclusion probabilities among the strata. Sampling intensity in stratum BA, for instance, then would be much smaller compared to the other strata, and so would be the inclusion probabilities of the units in this stratum as compared to the other strata. Stratum BA then would be underrepresented in the sample. This is not a problem as long as we account for the difference in inclusion probabilities of the units in the estimation of the population mean. The estimated mean of stratum BA then gets the largest weight, equal to the inverse of the inclusion probability. If we do not account for these differences in inclusion probabilities, the estimator of the mean will be seriously biased.</p>
<p>The next code chunk shows how the population mean and its standard error can be estimated with package <strong>survey</strong> <span class="citation">(<a href="#ref-Lumley2020" role="doc-biblioref">Lumley 2021</a>)</span>. Note that the stratum weights <span class="math inline">\(N_h/n_h\)</span> must be passed to function <code>svydesign</code> using argument <code>weight</code>. These are first attached to <code>data.frame</code> <code>mysample</code> by creating a look-up table <code>lut</code>, which is then merged with function <code>merge</code> to <code>data.frame</code> <code>mysample</code>.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="STSI.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb46-2"><a href="STSI.html#cb46-2" aria-hidden="true" tabindex="-1"></a>labels <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(mysample<span class="sc">$</span>stratum))</span>
<span id="cb46-3"><a href="STSI.html#cb46-3" aria-hidden="true" tabindex="-1"></a>lut <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">stratum =</span> labels, <span class="at">weight =</span> N_h <span class="sc">/</span> n_h)</span>
<span id="cb46-4"><a href="STSI.html#cb46-4" aria-hidden="true" tabindex="-1"></a>mysample <span class="ot">&lt;-</span> <span class="fu">merge</span>(<span class="at">x =</span> mysample, <span class="at">y =</span> lut)</span>
<span id="cb46-5"><a href="STSI.html#cb46-5" aria-hidden="true" tabindex="-1"></a>design_stsi <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(</span>
<span id="cb46-6"><a href="STSI.html#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="sc">~</span> <span class="dv">1</span>, <span class="at">strata =</span> <span class="sc">~</span> stratum, <span class="at">weight =</span> <span class="sc">~</span> weight, <span class="at">data =</span> mysample)</span>
<span id="cb46-7"><a href="STSI.html#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="fu">svymean</span>(<span class="sc">~</span> z, design_stsi)</span></code></pre></div>
<pre><code>    mean     SE
z 86.334 5.8167</code></pre>
<div id="population-proportion-cumulative-distribution-function-and-quantiles" class="section level3 hasAnchor" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> Population proportion, cumulative distribution function, and quantiles<a href="STSI.html#population-proportion-cumulative-distribution-function-and-quantiles" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The proportion of a population satisfying some condition can be estimated by Equations <a href="STSI.html#eq:HTMeanSTSI">(4.1)</a> and <a href="STSI.html#eq:HTStratumMeanSI">(4.2)</a>, substituting for the study variable <span class="math inline">\(z_k\)</span> an 0/1 indicator <span class="math inline">\(y_k\)</span> with value 1 if for unit <span class="math inline">\(k\)</span> the condition is satisfied, and 0 otherwise (Subsection <a href="SI.html#PopProportion">3.1.1</a>). In general, with stratified simple random sampling the inclusion probabilities are not exactly equal, so that the estimated population proportion is not equal to the sample proportion.</p>
<p>These unequal inclusion probabilities must also be accounted for when estimating the cumulative distribution function (CDF) and quantiles (Subsection <a href="SI.html#CDF">3.1.2</a>), as shown in the next code chunk for the CDF.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="STSI.html#cb48-1" aria-hidden="true" tabindex="-1"></a>thresholds <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(mysample<span class="sc">$</span>z))</span>
<span id="cb48-2"><a href="STSI.html#cb48-2" aria-hidden="true" tabindex="-1"></a>cumfreq <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="at">length =</span> <span class="fu">length</span>(thresholds))</span>
<span id="cb48-3"><a href="STSI.html#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">length</span>(thresholds))) {</span>
<span id="cb48-4"><a href="STSI.html#cb48-4" aria-hidden="true" tabindex="-1"></a>  ind <span class="ot">&lt;-</span> mysample<span class="sc">$</span>z <span class="sc">&lt;=</span> thresholds[i]</span>
<span id="cb48-5"><a href="STSI.html#cb48-5" aria-hidden="true" tabindex="-1"></a>  mh_ind <span class="ot">&lt;-</span> <span class="fu">tapply</span>(ind, <span class="at">INDEX =</span> mysample<span class="sc">$</span>stratum, <span class="at">FUN =</span> mean)</span>
<span id="cb48-6"><a href="STSI.html#cb48-6" aria-hidden="true" tabindex="-1"></a>  cumfreq[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(w_h <span class="sc">*</span> mh_ind)</span>
<span id="cb48-7"><a href="STSI.html#cb48-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb48-8"><a href="STSI.html#cb48-8" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> thresholds, <span class="at">y =</span> cumfreq)</span></code></pre></div>
<p>Figure <a href="STSI.html#fig:EstimatedCDFVoorstSTSI">4.2</a> shows the estimated CDF, estimated from the stratified simple random sample of 40 units from Voorst (Figure <a href="STSI.html#fig:SampleSTSI">4.1</a>).</p>

<div class="figure" style="text-align: center"><span style="display:block;" id="fig:EstimatedCDFVoorstSTSI"></span>
<img src="SpatialSampling_files/figure-html/EstimatedCDFVoorstSTSI-1.png" alt="Estimated cumulative distribution function of the SOM concentration (g kg-1) in Voorst, estimated from the stratified simple random sample of 40 units." width="80%" />
<p class="caption">
Figure 4.2: Estimated cumulative distribution function of the SOM concentration (g kg<sup>-1</sup>) in Voorst, estimated from the stratified simple random sample of 40 units.
</p>
</div>
<p>The estimated proportions, or cumulative frequencies, are used to estimate a quantile. These estimates are easily obtained with function <code>svyquantile</code> of package <strong>survey</strong>.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="STSI.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">svyquantile</span>(<span class="sc">~</span> z, design_stsi, <span class="at">quantile =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.8</span>))</span></code></pre></div>
<pre><code>$z
     quantile    ci.2.5   ci.97.5        se
0.5  69.56081  65.70434  84.03993  4.515916
0.8 117.73877 102.75359 161.88611 14.563887

attr(,&quot;hasci&quot;)
[1] TRUE
attr(,&quot;class&quot;)
[1] &quot;newsvyquantile&quot;</code></pre>
</div>
<div id="WhyStratify" class="section level3 hasAnchor" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> Why should we stratify?<a href="STSI.html#WhyStratify" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>There can be two reasons for stratifying the population:</p>
<ol style="list-style-type: decimal">
<li>we are interested in the mean or total per stratum; or</li>
<li>we want to increase the precision of the estimated mean or total for the entire population.</li>
</ol>
<p>Figure <a href="STSI.html#fig:SamplingDistributionSTSI">4.3</a> shows boxplots of the approximated sampling distributions of the <span class="math inline">\(\pi\)</span> estimator of the mean SOM concentration for stratified simple random sampling and simple random sampling, both of size 40, obtained by repeating the random sampling with each design and estimation 10,000 times.</p>

<div class="figure" style="text-align: center"><span style="display:block;" id="fig:SamplingDistributionSTSI"></span>
<img src="SpatialSampling_files/figure-html/SamplingDistributionSTSI-1.png" alt="Approximated sampling distribution of the \(\pi\) estimator of the mean SOM concentration (g kg-1) in Voorst for stratified simple random sampling (STSI) and simple random sampling (SI) of size 40." width="80%" />
<p class="caption">
Figure 4.3: Approximated sampling distribution of the <span class="math inline">\(\pi\)</span> estimator of the mean SOM concentration (g kg<sup>-1</sup>) in Voorst for stratified simple random sampling (STSI) and simple random sampling (SI) of size 40.
</p>
</div>
<p>The approximated sampling distributions of the estimators of the population mean with the two designs are not very different. With stratified random sampling, the spread of the estimated means is somewhat smaller. The horizontal red line is the population mean (81.1 g kg<sup>-1</sup>). The gain in precision due to the stratification, referred to as the stratification effect, can be quantified by the ratio of the variance with simple random sampling and the variance with stratified simple random sampling. So, when this variance ratio is larger than 1, stratified simple random sampling is more precise than simple random sampling. For Voorst the stratification effect with proportional allocation (Section <a href="STSI.html#STSIallocation">4.3</a>) equals 1.310. This means that with simple random sampling we need 1.310 more sampling units than with stratified simple random sampling to obtain an estimate of the same precision.</p>
<p>The stratification effect can be computed from the population variance <span class="math inline">\(S^2(z)\)</span> (Equation <a href="SI.html#eq:PopulationVariance">(3.8)</a>) and the variances within the strata <span class="math inline">\(S^2_h(z)\)</span>. In the sampling experiment, these variances are known without error because we know the <span class="math inline">\(z\)</span>-values for all units in the population. In practice, we only know the <span class="math inline">\(z\)</span>-values for the sampled units. However, a design-unbiased estimator of the population variance is <span class="citation">(<a href="#ref-gru06" role="doc-biblioref">de Gruijter et al. 2006</a>)</span></p>
<p><span class="math display" id="eq:EstimatorPopulationVariancefromSTSI">\[\begin{equation}
\widehat{S^{2}}(z)= \widehat{\overline{z^{2}}}-\left(\hat{\bar{z}}\right)^{2}+
\widehat{V}\!\left(\hat{\bar{z}}\right) \;,
\tag{4.7}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(\widehat{\overline{z^{2}}}\)</span> denotes the estimated population mean of the study variable squared (<span class="math inline">\(z^2\)</span>), obtained in the same way as <span class="math inline">\(\hat{\bar{z}}\)</span> (Equation <a href="STSI.html#eq:HTMeanSTSI">(4.1)</a>), but using squared values, and <span class="math inline">\(\widehat{V}\!\left(\hat{\bar{z}}\right)\)</span> denotes the estimated variance of the estimator of the population mean (Equation <a href="STSI.html#eq:EstVarMeanSTSI">(4.4)</a>).</p>
<p>The estimated population variance is then divided by the sum of the stratum sample sizes to get an estimate of the sampling variance of the estimator of the mean with simple random sampling of an equal number of units:</p>
<p><span class="math display" id="eq:stratificationeffect">\[\begin{equation}
\widehat{V}(\hat{\bar{z}}_{\text{SI}}) = \frac{\widehat{S^2}(z)}{\sum_{h=1}^{H}n_h}\;.
\tag{4.8}
\end{equation}\]</span></p>
<p>The population variance can be estimated with function <code>s2</code> of package <strong>surveyplanning</strong> <span class="citation">(<a href="#ref-surveyplanning" role="doc-biblioref">Breidaks, Liberts, and Jukams 2020</a>)</span>. However, this function is an implementation of an alternative, consistent estimator of the population variance <span class="citation">(<a href="#ref-sar92" role="doc-biblioref">Särndal, Swensson, and Wretman 1992</a>)</span>:</p>
<p><span class="math display" id="eq:EstimatorPopulationVariance4AnyDesign">\[\begin{equation}
\widehat{S^2}(z) = \frac{N-1}{N} \frac{n}{n-1} \frac{1}{N-1} \sum_{k \in \mathcal{S}} \frac{(z_k - \hat{\bar{z}}_{\pi})^2}{\pi_k} \;.
\tag{4.9}
\end{equation}\]</span></p>

<div class="rmdnote">
An estimator is consistent if it converges in probability to the true value of the parameter as the sample size tends to infinity <span class="citation">(<a href="#ref-sar92" role="doc-biblioref">Särndal, Swensson, and Wretman 1992</a>)</span>.
</div>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="STSI.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(surveyplanning)</span>
<span id="cb51-2"><a href="STSI.html#cb51-2" aria-hidden="true" tabindex="-1"></a>S2z <span class="ot">&lt;-</span> <span class="fu">s2</span>(mysample<span class="sc">$</span>z, <span class="at">w =</span> mysample<span class="sc">$</span>weight)</span></code></pre></div>
<p>The design effect is defined as the variance of an estimator of the population mean with the sampling design under study divided by the variance of the <span class="math inline">\(\pi\)</span> estimator of the mean with simple random sampling of an equal number of units (Section <a href="RequiredSampleSize.html#DesignEffect">12.4</a>). So, the design effect of stratified random sampling is the reciprocal of the stratification effect. For the stratified simple random sample of Figure <a href="STSI.html#fig:SampleSTSI">4.1</a>, the design effect can then be estimated as follows. Function <code>SE</code> extracts the estimated standard error of the estimator of the mean from the output of function <code>svymean</code>. The extracted standard error is then squared to obtain an estimate of the sampling variance of the estimator of the population with stratified simple random sampling. Finally, this variance is divided by the variance with simple random sampling of an equal number of units.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="STSI.html#cb52-1" aria-hidden="true" tabindex="-1"></a>v_mz_SI <span class="ot">&lt;-</span> S2z <span class="sc">/</span> n</span>
<span id="cb52-2"><a href="STSI.html#cb52-2" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">svymean</span>(<span class="sc">~</span> z, design_stsi)</span>
<span id="cb52-3"><a href="STSI.html#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="fu">SE</span>(res)<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> v_mz_SI</span></code></pre></div>
<pre><code>          z
z 0.6903965</code></pre>
<p>The same value is obtained with argument <code>deff</code> of function <code>svymean</code>.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="STSI.html#cb54-1" aria-hidden="true" tabindex="-1"></a>design_stsi <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(</span>
<span id="cb54-2"><a href="STSI.html#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="sc">~</span> <span class="dv">1</span>, <span class="at">strata =</span> <span class="sc">~</span> stratum, <span class="at">weight =</span> <span class="sc">~</span> weight, <span class="at">data =</span> mysample)</span>
<span id="cb54-3"><a href="STSI.html#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="fu">svymean</span>(<span class="sc">~</span> z, design_stsi, <span class="at">deff =</span> <span class="st">&quot;replace&quot;</span>)</span></code></pre></div>
<pre><code>     mean      SE   DEff
z 86.3340  5.8167 0.6904</code></pre>
<p>So, when using package <strong>survey</strong>, estimation of the population variance is not needed to estimate the design effect. I only added this to make clear how the design effect is computed with functions in package <strong>survey</strong>. In following chapters I will skip the estimation of the population variance.</p>
<p>The estimated design effect as estimated from the stratified sample is smaller than 1, showing that stratified simple random sampling is more efficient than simple random sampling. The reciprocal of the estimated design effect (1.448) is somewhat larger than the stratification effect as computed in the sampling experiment, but this is an estimate of the design effect from one stratified sample only. The estimated population variance varies among stratified samples, and so does the estimated design effect.</p>
<p>Stratified simple random sampling with proportional allocation (Section <a href="STSI.html#STSIallocation">4.3</a>) is more precise than simple random sampling when the sum of squares of the stratum means is larger than the sum of squares within strata <span class="citation">(<a href="#ref-loh99" role="doc-biblioref">Lohr 1999</a>)</span>:</p>
<p><span class="math display" id="eq:STSImoreprecisewhen">\[\begin{equation}
SSB &gt; SSW\;,
\tag{4.10}
\end{equation}\]</span></p>
<p>with SSB the weighted sum-of-squares between the stratum means:</p>
<p><span class="math display" id="eq:SSB">\[\begin{equation}
SSB = \sum_{h=1}^H N_h (\bar{z}_h-\bar{z})^2 \;,
\tag{4.11}
\end{equation}\]</span></p>
<p>and SSW the sum over the strata of the weighted variances within strata (weights equal to <span class="math inline">\(1-N_h/N\)</span>):</p>
<p><span class="math display" id="eq:SSW">\[\begin{equation}
SSW = \sum_{h=1}^H (1-\frac{N_h}{N})S^2_h\;.
\tag{4.12}
\end{equation}\]</span></p>
<p>In other words, the smaller the differences in the stratum means and the larger the variances within the strata, the smaller the stratification effect will be. Figure <a href="STSI.html#fig:boxplotsSOMstrata">4.4</a> shows a boxplot of the SOM concentration per stratum (soil-land use combination). The stratum means are equal to 83.0, 49.0, 68.8, 92.7, 122.3 g kg<sup>-1</sup>. The stratum variances are 1799.2, 238.4, 1652.9, 1905.4, 2942.8 (g kg<sup>-1</sup>)<sup>2</sup>. The large stratum variances explain the modest gain in precision realised by stratified simple random sampling compared to simple random sampling in this case.</p>

<div class="figure" style="text-align: center"><span style="display:block;" id="fig:boxplotsSOMstrata"></span>
<img src="SpatialSampling_files/figure-html/boxplotsSOMstrata-1.png" alt="Boxplots of the SOM concentration (g kg-1) for the five strata (soil-land use combinations) in Voorst." width="100%" />
<p class="caption">
Figure 4.4: Boxplots of the SOM concentration (g kg<sup>-1</sup>) for the five strata (soil-land use combinations) in Voorst.
</p>
</div>
</div>
</div>
<div id="CISTSI" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Confidence interval estimate<a href="STSI.html#CISTSI" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <span class="math inline">\(100(1-\alpha)\)</span>% confidence interval for <span class="math inline">\(\bar{z}\)</span> is given by</p>
<p><span class="math display" id="eq:CISTSI">\[\begin{equation}
\hat{\bar{z}} \pm t_{\alpha /2, df}\cdot
\sqrt{\widehat{V}\!\left(\hat{\bar{z}}\right)} \;,
\tag{4.13}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(t_{\alpha /2,df}\)</span> is the <span class="math inline">\((1-\alpha /2)\)</span> quantile of a <em>t</em> distribution with <span class="math inline">\(df\)</span> degrees of freedom. The degrees of freedom <span class="math inline">\(df\)</span> can be approximated by <span class="math inline">\(n-H\)</span>, as proposed by <span class="citation"><a href="#ref-loh99" role="doc-biblioref">Lohr</a> (<a href="#ref-loh99" role="doc-biblioref">1999</a>)</span>. This is the number of the degrees of freedom if the variances within the strata are equal. With unequal variances within strata, <span class="math inline">\(df\)</span> can be approximated by Sattherwaite’s method <span class="citation">(<a href="#ref-nan04" role="doc-biblioref">Nanthakumar and Selvavel 2004</a>)</span>:</p>
<p><span class="math display" id="eq:dfSattherwaite">\[\begin{equation}
df \approx \frac {\left(\sum_{h=1}^H w_h^2
\frac{\widehat{S^2}_h(z)}{n_h}\right)^2} {\sum_{h=1}^H w_h^4
\left(\frac{\widehat{S^2}_h(z)}{n_h}\right)^2 \frac {1}{n_h-1}} \;.
\tag{4.14}
\end{equation}\]</span></p>
<p>A confidence interval estimate of the population mean can be extracted with method <code>confint</code> of package <strong>survey</strong>. It uses <span class="math inline">\(n-H\)</span> degrees of freedom.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="STSI.html#cb56-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">svymean</span>(<span class="sc">~</span> z, design_stsi)</span>
<span id="cb56-2"><a href="STSI.html#cb56-2" aria-hidden="true" tabindex="-1"></a>df_stsi <span class="ot">&lt;-</span> <span class="fu">degf</span>(design_stsi)</span>
<span id="cb56-3"><a href="STSI.html#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(res, <span class="at">df =</span> df_stsi, <span class="at">level =</span> <span class="fl">0.95</span>)</span></code></pre></div>
<pre><code>     2.5 %   97.5 %
z 74.52542 98.14252</code></pre>
</div>
<div id="STSIallocation" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Allocation of sample size to strata<a href="STSI.html#STSIallocation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>After we have decided on the total sample size <span class="math inline">\(n\)</span>, we must decide how to apportion the units to the strata. It is reasonable to allocate more sampling units to large strata and fewer to small strata. The simplest way to achieve this is proportional allocation:</p>
<p><span class="math display" id="eq:propallocation">\[\begin{equation}
n_{h}=n \cdot \frac{N_{h}}{\sum N_{h}}\;,
\tag{4.15}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(N_h\)</span> the total number of population units (size) of stratum <span class="math inline">\(h\)</span>. With infinite populations <span class="math inline">\(N_h\)</span> is replaced by the area <span class="math inline">\(A_h\)</span>. The sample sizes computed with this equation are rounded to the nearest integers.</p>
<p>If we have prior information on the variance of the study variable within the strata, then it makes sense to account for differences in variance. Heterogeneous strata should receive more sampling units than homogeneous strata, leading to Neyman allocation:</p>
<p><span class="math display" id="eq:Neymanallocation">\[\begin{equation}
n_{h}= n \cdot \frac{N_{h}\,S_{h}(z)}{\sum\limits_{h=1}^{H} N_{h}\,S_{h}(z)} \;,
\tag{4.16}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(S_h(z)\)</span> the standard deviation (square root of variance) of the study variable <span class="math inline">\(z\)</span> in stratum <span class="math inline">\(h\)</span>.</p>
<p>Finally, the costs of sampling may differ among the strata. It can be relatively expensive to sample nearly inaccessible strata, and we do not want to sample many units there. This leads to optimal allocation:</p>
<p><span class="math display" id="eq:optallocation">\[\begin{equation}
n_{h}= n \cdot \frac{\frac{N_{h}\,S_{h}(z)}{\sqrt{c_{h}}}}{\sum\limits_{h=1}^{H} \frac{N_{h}\,S_{h}(z)}{\sqrt{c_{h}}}} \;,
\tag{4.17}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(c_h\)</span> the costs per sampling unit in stratum <span class="math inline">\(h\)</span>. Optimal means that given the total costs this allocation type leads to minimum sampling variance, assuming a linear costs model:</p>
<p><span class="math display" id="eq:linearcostmodel">\[\begin{equation}
C = c_0 + \sum_{h=1}^H n_h c_h \;,
\tag{4.18}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(c_0\)</span> overhead costs. So, the more variable a stratum and the lower the costs, the more units will be selected from this stratum.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="STSI.html#cb58-1" aria-hidden="true" tabindex="-1"></a>S2z_h <span class="ot">&lt;-</span> <span class="fu">tapply</span>(<span class="at">X =</span> grdVoorst<span class="sc">$</span>z, <span class="at">INDEX =</span> grdVoorst<span class="sc">$</span>stratum, <span class="at">FUN =</span> var)</span>
<span id="cb58-2"><a href="STSI.html#cb58-2" aria-hidden="true" tabindex="-1"></a>n_h_Neyman <span class="ot">&lt;-</span> <span class="fu">round</span>(n <span class="sc">*</span> N_h <span class="sc">*</span> <span class="fu">sqrt</span>(S2z_h) <span class="sc">/</span> <span class="fu">sum</span>(N_h <span class="sc">*</span> <span class="fu">sqrt</span>(S2z_h)))</span></code></pre></div>
<p>These optimal sample sizes can be computed with function <code>optsize</code> of package <strong>surveyplanning</strong>.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="STSI.html#cb59-1" aria-hidden="true" tabindex="-1"></a>labels <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(mysample<span class="sc">$</span>stratum))</span>
<span id="cb59-2"><a href="STSI.html#cb59-2" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">optsize</span>(labels, n, N_h, S2z_h)</span>
<span id="cb59-3"><a href="STSI.html#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(res<span class="sc">$</span>nh, <span class="dv">0</span>)</span></code></pre></div>
<pre><code>[1] 14  3  9  4 10</code></pre>
<p>Table <a href="STSI.html#tab:tableallocation">4.2</a> shows the proportional and optimal sample sizes for the five strata of the study area Voorst, for a total sample size of 40. Stratum XF is the one-but-smallest stratum and therefore receives only seven sampling units. However, the standard deviation in this stratum is the largest, and as a consequence with optimal allocation the sample size in this stratum is increased by three points, at the cost of stratum EA which is relatively homogeneous.</p>
<table class=" lightable-classic" style="font-family: &quot;Arial Narrow&quot;, &quot;Source Sans Pro&quot;, sans-serif; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:tableallocation">Table 4.2: </span>Proportional and Neyman sample sizes in stratified simple random sampling of Voorst with a total sample size of 40.
</caption>
<thead>
<tr>
<th style="text-align:left;">
Stratum
</th>
<th style="text-align:left;">
Nh
</th>
<th style="text-align:right;">
Sh
</th>
<th style="text-align:right;">
nhprop
</th>
<th style="text-align:right;">
nhNeyman
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
BA
</td>
<td style="text-align:left;">
2,371
</td>
<td style="text-align:right;">
42.4
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
14
</td>
</tr>
<tr>
<td style="text-align:left;">
EA
</td>
<td style="text-align:left;">
1,442
</td>
<td style="text-align:right;">
15.4
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
PA
</td>
<td style="text-align:left;">
1,710
</td>
<td style="text-align:right;">
40.7
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
RA
</td>
<td style="text-align:left;">
659
</td>
<td style="text-align:right;">
43.7
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:left;">
XF
</td>
<td style="text-align:left;">
1,346
</td>
<td style="text-align:right;">
54.2
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
10
</td>
</tr>
</tbody>
<tfoot>
<tr>
<td style="padding: 0; border:0;" colspan="100%">
<sup></sup> Nh: stratum size; Sh: stratum standard deviation.
</td>
</tr>
</tfoot>
</table>
<p>Figure <a href="STSI.html#fig:plotsdmeanallocation">4.5</a> shows the standard error of the <span class="math inline">\(\pi\)</span> estimator of the mean SOM concentration as a function of the total sample size, for simple random sampling and for stratified simple random sampling with proportional and Neyman allocation. A small extra gain in precision can be achieved using Neyman allocation instead of proportional allocation. However, in practice often Neyman allocation is not achievable, because we do not know the standard deviations of the study variable within the strata. If a quantitative covariate <span class="math inline">\(x\)</span> is used for stratification (see Sections <a href="STSI.html#cumrootf">4.4</a> and <a href="MBpredictionofDesignVariance.html#Ospats">13.2</a>), the standard deviations <span class="math inline">\(S_h(z)\)</span> are approximated by <span class="math inline">\(S_h(x)\)</span>, resulting in approximately optimal stratum sample sizes. The gain in precision compared to proportional allocation is then partly or entirely lost.</p>

<div class="figure" style="text-align: center"><span style="display:block;" id="fig:plotsdmeanallocation"></span>
<img src="SpatialSampling_files/figure-html/plotsdmeanallocation-1.png" alt="Standard error of the \(\pi\) estimator of the mean SOM concentration (g kg-1) as a function of the total sample size, for simple random sampling (SI) and for stratified simple random sampling with proportional (STSI(prop)) and Neyman allocation (STSI(Neyman)) for Voorst." width="100%" />
<p class="caption">
Figure 4.5: Standard error of the <span class="math inline">\(\pi\)</span> estimator of the mean SOM concentration (g kg<sup>-1</sup>) as a function of the total sample size, for simple random sampling (SI) and for stratified simple random sampling with proportional (STSI(prop)) and Neyman allocation (STSI(Neyman)) for Voorst.
</p>
</div>
<p>Optimal allocation and Neyman allocation assume univariate stratification, i.e., the stratified simple random sample is used to estimate the mean of a single study variable. If we have multiple study variables, optimal allocation becomes more complicated. In Bethel allocation, the total sampling costs, assuming a linear costs model (Equation <a href="STSI.html#eq:linearcostmodel">(4.18)</a>), are minimised given a constraint on the precision of the estimated mean for each study variable <span class="citation">(<a href="#ref-Bethel1989" role="doc-biblioref">Bethel 1989</a>)</span>, see Section <a href="STSI.html#MultivariateStratification">4.8</a>. Bethel allocation can be computed with function <code>bethel</code> of package <strong>SamplingStrata</strong> <span class="citation">(<a href="#ref-Barcaroli2020" role="doc-biblioref">G. Barcaroli et al. 2020</a>)</span>.</p>
<div id="exercises-5" class="section level4 unnumbered hasAnchor">
<h4>Exercises<a href="STSI.html#exercises-5" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>Use function <code>strata</code> of package <strong>sampling</strong> to select a stratified simple random sample with replacement of size 40 from Voorst, using proportional allocation. Check that the sum of the stratum sample sizes is 40.
<ul>
<li>Estimate the population mean and the standard error of the estimator.</li>
<li>Compute the true standard error of the estimator. Hint: compute the population variances of the study variable <span class="math inline">\(z\)</span> per stratum, and divide these by the stratum sample sizes.</li>
<li>Compute a 95% confidence interval estimate of the population mean, using function <code>confint</code> of package <strong>survey</strong>.<br />
</li>
</ul></li>
<li>Looking at Figure <a href="STSI.html#fig:boxplotsSOMstrata">4.4</a>, which strata do you expect can be merged without losing much precision of the estimated population mean?<br />
</li>
<li>Use function <code>fct_collapse</code> of package <strong>forcats</strong> <span class="citation">(<a href="#ref-forcats" role="doc-biblioref">Hadley Wickham 2021</a>)</span> to merge the strata EA and PA.
<ul>
<li>Compute the true sampling variance of the estimator of the mean for this new stratification, for a total sample size of 40 and proportional allocation.</li>
<li>Compare this true sampling variance with the true sampling variance using the original five strata (same sample size, proportional allocation). What is your conclusion about the new stratification?<br />
</li>
</ul></li>
<li>Proof that the sum of the inclusion probabilities over all population units with stratified simple random sampling equals the sample size <span class="math inline">\(n\)</span>.</li>
</ol>
</div>
</div>
<div id="cumrootf" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> <em>Cum-root-f</em> stratification<a href="STSI.html#cumrootf" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>When we have a quantitative covariate <span class="math inline">\(x\)</span> related to the study variable <span class="math inline">\(z\)</span> and <span class="math inline">\(x\)</span> is known for all units in the population, strata can be constructed with the <em>cum-root-f</em> method using this covariate as a stratification variable, see <span class="citation"><a href="#ref-Dalenius1959" role="doc-biblioref">Dalenius and Hodges</a> (<a href="#ref-Dalenius1959" role="doc-biblioref">1959</a>)</span> and <span class="citation"><a href="#ref-coc77" role="doc-biblioref">Cochran</a> (<a href="#ref-coc77" role="doc-biblioref">1977</a>)</span>. Population units with similar values for the covariate (stratification variable) are grouped into a stratum. Strata are computed as follows:</p>
<ol style="list-style-type: decimal">
<li>Compute a frequency histogram of the stratification variable using a large number of bins.<br />
</li>
<li>Compute the square root of the frequencies.<br />
</li>
<li>Cumulate the square root of the frequencies, i.e., compute <span class="math inline">\(\sqrt{f_1}\)</span>, <span class="math inline">\(\sqrt{f_1} + \sqrt{f_2}\)</span>, <span class="math inline">\(\sqrt{f_1} + \sqrt{f_2} + \sqrt{f_3}\)</span>, etc.<br />
</li>
<li>Divide the cumulative sum of the last bin by the number of strata, multiply this value by <span class="math inline">\(1,2, \dots, H-1\)</span>, with <em>H</em> the number of strata, and select the boundaries of the histogram bins closest to these values.</li>
</ol>
<p>In <em>cum-root-f</em> stratification, it is assumed that the covariate values are nearly perfect predictions of the study variable, so that the prediction errors do not affect the stratification. Under this assumption the stratification is optimal with Neyman allocation of sampling units to the strata <a href="STSI.html#STSIallocation">4.3</a>.</p>
<p><em>Cum-root-f</em> stratification is illustrated with the data of Xuancheng in China. We wish to estimate the mean organic matter concentration in the topsoil (SOM, g kg<sup>-1</sup>) of this area. Various covariates are available that are correlated with SOM, such as elevation, yearly average temperature, slope, and various other terrain attributes. Elevation, the name of this variable in the tibble is dem, is used as as a single stratification variable, see Figure <a href="STSI.html#fig:DEMXuancheng">4.6</a>. The correlation coefficient of SOM and elevation in a sample of 183 observations is 0.59. The positive correlation can be explained as follows. Temperature is decreasing with elevation, leading to a smaller decomposition rate of organic matter in the soil.</p>

<div class="figure" style="text-align: center"><span style="display:block;" id="fig:DEMXuancheng"></span>
<img src="SpatialSampling_files/figure-html/DEMXuancheng-1.png" alt="Elevation used as a stratification variable in cum-root-f stratification of Xuancheng." width="100%" />
<p class="caption">
Figure 4.6: Elevation used as a stratification variable in <em>cum-root-f</em> stratification of Xuancheng.
</p>
</div>
<p>The strata can be constructed with the package <strong>stratification</strong> <span class="citation">(<a href="#ref-Baillargeon2011" role="doc-biblioref">Baillargeon and Rivest 2011</a>)</span>. Care should be taken that the data are sorted in ascending order by the variable used for stratification, see help of function <code>strata.cumrootf</code>. Argument <code>n</code> of this function is the total sample size, but this value has no effect on the stratification. Argument <code>Ls</code> is the number of strata. I arbitrarily chose to construct five strata. Argument <code>nclass</code> is the number of bins of the histogram. The output object of function <code>strata.cumrootf</code> is a list containing amongst others a numeric vector with the stratum bounds (<code>bh</code>) and a factor with the stratum levels of the grid cells (<code>stratumID</code>). Finally, note that the values of the stratification variable must be positive. The minimum elevation is -5 m, so I added the absolute value of this minimum to elevation.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="STSI.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stratification)</span>
<span id="cb61-2"><a href="STSI.html#cb61-2" aria-hidden="true" tabindex="-1"></a>grdXuancheng <span class="ot">&lt;-</span> grdXuancheng <span class="sc">%&gt;%</span></span>
<span id="cb61-3"><a href="STSI.html#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(dem) <span class="sc">%&gt;%</span></span>
<span id="cb61-4"><a href="STSI.html#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dem_new =</span> dem <span class="sc">+</span> <span class="fu">abs</span>(<span class="fu">min</span>(dem)))</span>
<span id="cb61-5"><a href="STSI.html#cb61-5" aria-hidden="true" tabindex="-1"></a>crfstrata <span class="ot">&lt;-</span> <span class="fu">strata.cumrootf</span>(</span>
<span id="cb61-6"><a href="STSI.html#cb61-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> grdXuancheng<span class="sc">$</span>dem_new, <span class="at">n =</span> <span class="dv">100</span>, <span class="at">Ls =</span> <span class="dv">5</span>, <span class="at">nclass =</span> <span class="dv">500</span>)</span>
<span id="cb61-7"><a href="STSI.html#cb61-7" aria-hidden="true" tabindex="-1"></a>bh <span class="ot">&lt;-</span> crfstrata<span class="sc">$</span>bh</span>
<span id="cb61-8"><a href="STSI.html#cb61-8" aria-hidden="true" tabindex="-1"></a>grdXuancheng<span class="sc">$</span>crfstrata <span class="ot">&lt;-</span> crfstrata<span class="sc">$</span>stratumID</span></code></pre></div>
<p>Stratum bounds are threshold values of the stratification variable elevation; these stratum bounds are equal to 46.7, 108.3, 214.5, 384.4. Note that the number of stratum bounds is one less than the number of strata. The resulting stratification is shown in Figure <a href="STSI.html#fig:optstrata">4.7</a>. Note that most strata are not single polygons, but are made up of many smaller polygons. This may be even more so if the stratification variable shows a noisy spatial pattern. This is not a problem at all, as a stratum is just a collection of population units (raster cells) and need not be spatially contiguous.</p>

<div class="figure" style="text-align: center"><span style="display:block;" id="fig:optstrata"></span>
<img src="SpatialSampling_files/figure-html/optstrata-1.png" alt="Stratification of Xuancheng obtained with the cum-root-f method, using elevation as a stratification variable." width="100%" />
<p class="caption">
Figure 4.7: Stratification of Xuancheng obtained with the <em>cum-root-f</em> method, using elevation as a stratification variable.
</p>
</div>
<div id="exercises-6" class="section level4 unnumbered hasAnchor">
<h4>Exercises<a href="STSI.html#exercises-6" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol start="5" style="list-style-type: decimal">
<li>Write an <strong>R</strong> script to compute five <em>cum-root-f</em> strata for Eastern Amazonia (<code>grdAmazonia</code> in package <strong>sswr</strong>) to estimate the population mean of aboveground biomass (AGB), using log-transformed short-wave infrared radiation (SWIR2) as a stratification variable.
<ul>
<li>Compute ten <em>cum-root-f</em> strata, using function <code>strata</code> of package <strong>sampling</strong>. Sort the units first in ascending order on lnSWIR2. Use the stratum sample sizes as computed by function <code>strata.cumrootf</code>. What allocation is used for computing the stratum sample sizes?</li>
<li>Select a stratified simple random sample of 100 units. First, compute the stratum sample sizes for proportional allocation.</li>
<li>Estimate the population mean of AGB and its sampling variance.</li>
<li>Compute the true sampling variance of the estimator of the mean for this sampling design (see Exercise 1 for a hint).</li>
<li>Compute the stratification effect (gain in precision). Hint: compute the sampling variance for simple random sampling by computing the population variance of AGB, and divide this by the total sample size.</li>
</ul></li>
</ol>
</div>
</div>
<div id="kmeansstratification" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> Stratification with multiple covariates<a href="STSI.html#kmeansstratification" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>If we have multiple variables that are possibly related to the study variable, we may want to use them all or a subset of them as stratification variables. Using the quantitative variables one-by-one in <em>cum-root-f</em> stratification, followed by overlaying the maps with univariate strata, may lead to numerous cross-classification strata.</p>
<p>A simple solution is to construct homogeneous groups, referred to as clusters, of population units (raster cells). The units within a cluster are more similar to each other than to the units in other clusters. Various clustering techniques are available. Here, I use hard k-means.</p>
<p>This is illustrated again with the Xuancheng case study. Five quantitative covariates are used for constructing the strata. Besides elevation, which was used as a single stratification variable in the previous section, now also temperature, slope, topographic wetness index (twi), and profile curvature are used to construct clusters that are used as strata in stratified simple random sampling. To speed up the computations, a subgrid with a spacing of 0.4 km is selected, using function <code>spsample</code> of package <strong>sp</strong>, see Chapter <a href="SY.html#SY">5</a> <span class="citation">(<a href="#ref-Bivand2013" role="doc-biblioref">Bivand, Pebesma, and Gómez-Rubio 2013</a>)</span>.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="STSI.html#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb62-2"><a href="STSI.html#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gridded</span>(grdXuancheng) <span class="ot">&lt;-</span> <span class="er">~</span> s1 <span class="sc">+</span> s2</span>
<span id="cb62-3"><a href="STSI.html#cb62-3" aria-hidden="true" tabindex="-1"></a>subgrd <span class="ot">&lt;-</span> <span class="fu">spsample</span>(</span>
<span id="cb62-4"><a href="STSI.html#cb62-4" aria-hidden="true" tabindex="-1"></a>  grdXuancheng, <span class="at">type =</span> <span class="st">&quot;regular&quot;</span>, <span class="at">cellsize =</span> <span class="dv">400</span>, <span class="at">offset =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>))</span>
<span id="cb62-5"><a href="STSI.html#cb62-5" aria-hidden="true" tabindex="-1"></a>subgrd <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">coordinates</span>(subgrd), <span class="fu">over</span>(subgrd, grdXuancheng))</span></code></pre></div>
<p>Five clusters are computed with k-means using as clustering variables the five covariates mentioned above. The scale of these covariates is largely different, and for this reason they must be scaled before being used in clustering. The k-means algorithm is a deterministic algorithm, i.e., the same initial clustering will end in the same final, optimised clustering. This final clustering can be suboptimal, and therefore it is recommended to repeat the clustering as many times as feasible, with different initial clusterings. Argument <code>nstart</code> is the number of initial clusterings. The best clustering, i.e., the one with the smallest within-cluster sum-of-squares, is kept.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="STSI.html#cb63-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;dem&quot;</span>, <span class="st">&quot;temperature&quot;</span>, <span class="st">&quot;slope&quot;</span>, <span class="st">&quot;profile.curvature&quot;</span>, <span class="st">&quot;twi&quot;</span>)</span>
<span id="cb63-2"><a href="STSI.html#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">314</span>)</span>
<span id="cb63-3"><a href="STSI.html#cb63-3" aria-hidden="true" tabindex="-1"></a>myClusters <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(</span>
<span id="cb63-4"><a href="STSI.html#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale</span>(subgrd[, x]), <span class="at">centers =</span> <span class="dv">5</span>, <span class="at">iter.max =</span> <span class="dv">1000</span>, <span class="at">nstart =</span> <span class="dv">100</span>)</span>
<span id="cb63-5"><a href="STSI.html#cb63-5" aria-hidden="true" tabindex="-1"></a>subgrd<span class="sc">$</span>cluster <span class="ot">&lt;-</span> myClusters<span class="sc">$</span>cluster</span></code></pre></div>
<p>Figure <a href="STSI.html#fig:kmeansstrataXuancheng">4.8</a> shows the five clusters obtained by k-means clustering of the raster cells. These clusters can be used as strata in random sampling.</p>

<div class="figure" style="text-align: center"><span style="display:block;" id="fig:kmeansstrataXuancheng"></span>
<img src="SpatialSampling_files/figure-html/kmeansstrataXuancheng-1.png" alt="Five clusters obtained by k-means clustering of the raster cells of Xuancheng, using five scaled covariates in clustering." width="100%" />
<p class="caption">
Figure 4.8: Five clusters obtained by k-means clustering of the raster cells of Xuancheng, using five scaled covariates in clustering.
</p>
</div>
<p>The size of the clusters used as strata is largely different (Table <a href="STSI.html#tab:tablekmeansstrata">4.3</a>). This table also shows means of the unscaled covariates used in clustering.</p>
<table class=" lightable-classic" style="font-family: &quot;Arial Narrow&quot;, &quot;Source Sans Pro&quot;, sans-serif; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:tablekmeansstrata">Table 4.3: </span>Size (Nh) and means of clustering variables of the five strata of Xuancheng obtained with k-means clustering of raster cells.
</caption>
<thead>
<tr>
<th style="text-align:right;">
Stratum
</th>
<th style="text-align:left;">
Nh
</th>
<th style="text-align:right;">
Elevation
</th>
<th style="text-align:right;">
Temperature
</th>
<th style="text-align:right;">
Slope
</th>
<th style="text-align:right;">
Profilecurv
</th>
<th style="text-align:right;">
Twi
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
1,581
</td>
<td style="text-align:right;">
300
</td>
<td style="text-align:right;">
14.45
</td>
<td style="text-align:right;">
12.21
</td>
<td style="text-align:right;">
-0.00147
</td>
<td style="text-align:right;">
6.34
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
15,987
</td>
<td style="text-align:right;">
54
</td>
<td style="text-align:right;">
15.44
</td>
<td style="text-align:right;">
2.11
</td>
<td style="text-align:right;">
0.00001
</td>
<td style="text-align:right;">
9.24
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
4,255
</td>
<td style="text-align:right;">
181
</td>
<td style="text-align:right;">
14.64
</td>
<td style="text-align:right;">
11.11
</td>
<td style="text-align:right;">
0.00068
</td>
<td style="text-align:right;">
7.75
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
4,955
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
15.59
</td>
<td style="text-align:right;">
0.47
</td>
<td style="text-align:right;">
0.00006
</td>
<td style="text-align:right;">
17.08
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
1,625
</td>
<td style="text-align:right;">
416
</td>
<td style="text-align:right;">
13.70
</td>
<td style="text-align:right;">
21.21
</td>
<td style="text-align:right;">
0.00012
</td>
<td style="text-align:right;">
6.45
</td>
</tr>
</tbody>
</table>
<p>Categorical variables can be accommodated in clustering using the technique proposed by <span class="citation"><a href="#ref-Huang1998" role="doc-biblioref">Huang</a> (<a href="#ref-Huang1998" role="doc-biblioref">1998</a>)</span>, implemented in package <strong>clustMixType</strong> <span class="citation">(<a href="#ref-clustMixType" role="doc-biblioref">Szepannek 2018</a>)</span>.</p>
<p>In the situation that we already have some data of the study variable, an alternative solution is to calibrate a model for the study variable, for instance a multiple linear regression model, using the covariates as predictors, and to use the predictions of the study variable as a single stratification variable in <em>cum-root-f</em> stratification or in optimal spatial stratification, see Section <a href="MBpredictionofDesignVariance.html#Ospats">13.2</a>.</p>
</div>
<div id="geostrata" class="section level2 hasAnchor" number="4.6">
<h2><span class="header-section-number">4.6</span> Geographical stratification<a href="STSI.html#geostrata" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>When no covariate is available, we may still decide to apply a <em>geographical stratification</em>. For instance, a square study area can be divided into 4 <span class="math inline">\(\times\)</span> 4 equal-sized subsquares that are used as strata. When we select one or two points per subsquare, we avoid strong spatial clustering of the sampling points. Geographical stratification improves the <em>spatial coverage</em>. When the study variable is spatially structured, think for instance of a spatial trend, then geographical stratification will lead to more precisely estimated means (smaller sampling variances).</p>
<p>A simple method for constructing geographical strata is k-means clustering <span class="citation">(<a href="#ref-bru99" role="doc-biblioref">Brus, Spätjens, and de Gruijter 1999</a>)</span>. See Section <a href="RegularGridSpatialCoverage.html#SpatialCoverage">17.2</a> for a simple illustrative example of how geographical strata are computed with k-means clustering. In this approach, the study area is discretised by a large number of grid cells. These grid cells are the objects that are clustered. The clustering variables are simply the spatial coordinates of the centres of the grid cells. This method leads to compact geographical strata, briefly referred to as geostrata. Geostrata can be computed with function <code>kmeans</code>, as shown in Section <a href="STSI.html#kmeansstratification">4.5</a>. The two clustering variables have the same scale, so they should not be scaled because this would lead to an arbitrary distortion of geographical distances. The geostrata generally will not have the same number of grid cells. Geostrata of equal size can be attractive, as then the sample becomes selfweighting, i.e., the sample mean is an unbiased estimator of the population mean.</p>
<p>Geostrata of the same size can be computed with function <code>stratify</code> of the package <strong>spcosa</strong> (<span class="citation"><a href="#ref-spcosa" role="doc-biblioref">D. Walvoort, Brus, and de Gruijter</a> (<a href="#ref-spcosa" role="doc-biblioref">2020</a>)</span>, <span class="citation"><a href="#ref-walvoort2010" role="doc-biblioref">D. J. J. Walvoort, Brus, and Gruijter</a> (<a href="#ref-walvoort2010" role="doc-biblioref">2010</a>)</span>), with argument <code>equalArea = TRUE</code>.</p>
<p>If the total number of grid cells divided by the number of strata is an integer, the stratum sizes are exactly equal; otherwise, the difference is one grid cell. <span class="citation"><a href="#ref-walvoort2010" role="doc-biblioref">D. J. J. Walvoort, Brus, and Gruijter</a> (<a href="#ref-walvoort2010" role="doc-biblioref">2010</a>)</span> describe the k-means algorithms implemented in this package in detail. Argument <code>object</code> of function <code>stratify</code> specifies a spatial object of the population units. In the <strong>R</strong> code below the subgrid of <code>grdXuancheng</code> generated in Section <a href="STSI.html#kmeansstratification">4.5</a> is converted to a <code>SpatialPixelsDataFrame</code> with function <code>gridded</code> of the package <strong>sp</strong>. The spatial object can also be of class <code>SpatialPolygons</code>. In that case, either argument <code>nGridCells</code> or argument <code>cellSize</code> must be set, so that the vector map in <code>object</code> can be discretised by a finite number of grid cells. Argument <code>nTry</code> specifies the number of initial stratifications in k-means clustering, and therefore is comparable with argument <code>nstart</code> of function <code>kmeans</code>. For more details on spatial stratification using k-means clustering, see Section <a href="RegularGridSpatialCoverage.html#SpatialCoverage">17.2</a>. The k-means algorithm used with <code>equalArea = TRUE</code> takes much more computing time than the one used with <code>equalArea = FALSE</code>.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="STSI.html#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spcosa)</span>
<span id="cb64-2"><a href="STSI.html#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb64-3"><a href="STSI.html#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">314</span>)</span>
<span id="cb64-4"><a href="STSI.html#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="fu">gridded</span>(subgrd) <span class="ot">&lt;-</span> <span class="er">~</span> x1 <span class="sc">+</span> x2</span>
<span id="cb64-5"><a href="STSI.html#cb64-5" aria-hidden="true" tabindex="-1"></a>mygeostrata <span class="ot">&lt;-</span> <span class="fu">stratify</span>(</span>
<span id="cb64-6"><a href="STSI.html#cb64-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> subgrd, <span class="at">nStrata =</span> <span class="dv">50</span>, <span class="at">nTry =</span> <span class="dv">1</span>, <span class="at">equalArea =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>Function <code>spsample</code> of package <strong>spcosa</strong> is used to select from each geostratum a simple random sample of two points.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="STSI.html#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">314</span>)</span>
<span id="cb65-2"><a href="STSI.html#cb65-2" aria-hidden="true" tabindex="-1"></a>mysample <span class="ot">&lt;-</span> spcosa<span class="sc">::</span><span class="fu">spsample</span>(mygeostrata, <span class="at">n =</span> <span class="dv">2</span>)</span></code></pre></div>
<p>Figure <a href="STSI.html#fig:GeoStrata">4.9</a> shows fifty compact geostrata of equal size for Xuancheng with the selected sampling points. Note that the sampling points are reasonably well spread throughout the study area<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:GeoStrata"></span>
<img src="SpatialSampling_files/figure-html/GeoStrata-1.png" alt="Compact geostrata of equal size for Xuancheng and stratified simple random sample of two points per stratum." width="100%" />
<p class="caption">
Figure 4.9: Compact geostrata of equal size for Xuancheng and stratified simple random sample of two points per stratum.
</p>
</div>
<p>Once the observations are done, the population mean can be estimated with function <code>estimate</code>. For Xuancheng I simulated data from a normal distribution, just to illustrate estimation with function <code>estimate</code>. Various statistics can be estimated, among which the population mean (spatial mean), the standard error, and the CDF. The CDF is estimated by transforming the data into indicators (Subsection <a href="SI.html#CDF">3.1.2</a>).</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="STSI.html#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spcosa)</span>
<span id="cb66-2"><a href="STSI.html#cb66-2" aria-hidden="true" tabindex="-1"></a>mysample <span class="ot">&lt;-</span> spcosa<span class="sc">::</span><span class="fu">spsample</span>(mygeostrata, <span class="at">n =</span> <span class="dv">2</span>)</span>
<span id="cb66-3"><a href="STSI.html#cb66-3" aria-hidden="true" tabindex="-1"></a>mydata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">z =</span> <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="at">mean =</span> <span class="dv">10</span>, <span class="at">sd =</span> <span class="dv">2</span>))</span>
<span id="cb66-4"><a href="STSI.html#cb66-4" aria-hidden="true" tabindex="-1"></a>mean <span class="ot">&lt;-</span> <span class="fu">estimate</span>(<span class="st">&quot;spatial mean&quot;</span>, mygeostrata, mysample, <span class="at">data =</span> mydata)</span>
<span id="cb66-5"><a href="STSI.html#cb66-5" aria-hidden="true" tabindex="-1"></a>se <span class="ot">&lt;-</span> <span class="fu">estimate</span>(<span class="st">&quot;standard error&quot;</span>, mygeostrata, mysample, <span class="at">data =</span> mydata)</span>
<span id="cb66-6"><a href="STSI.html#cb66-6" aria-hidden="true" tabindex="-1"></a>cdf <span class="ot">&lt;-</span> <span class="fu">estimate</span>(<span class="st">&quot;scdf&quot;</span>, mygeostrata, mysample, <span class="at">data =</span> mydata)</span></code></pre></div>
<p>The estimated population mean equals 9.8 with an estimated standard error of 0.2.</p>
<div id="exercises-7" class="section level4 unnumbered hasAnchor">
<h4>Exercises<a href="STSI.html#exercises-7" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol start="6" style="list-style-type: decimal">
<li>Why is it attractive to select at least two points per geostratum?<br />
</li>
<li>The alternative to 50 geostrata and two points per geostratum is 100 geostrata and one point per geostratum. Which sampling strategy will be more precise?<br />
</li>
<li>The geostrata in Figure <a href="STSI.html#fig:GeoStrata">4.9</a> have equal size (area), which can be enforced by argument <code>equalArea = TRUE</code>. Why are equal sizes attractive? Work out the estimator of the population mean for strata of equal size.<br />
</li>
<li>Write an <strong>R</strong> script to construct 20 compact geographical strata of equal size for agricultural field Leest. The geopackage file of this field can be read with <strong>sf</strong> function <code>read_sf(system.file("extdata/leest.gpkg", package = "sswr"))</code>. Remove the projection attributes with <code>st_set_crs(NA_crs_)</code>, and convert the simple feature object to a spatial object with method <code>as_Spatial</code>. Select two points per geostratum, using function <code>spsample</code> of package <strong>spcosa</strong>. Repeat this with 40 strata of equal size, and randomly select one point per stratum.
<ul>
<li>If only one point per stratum is selected, the sampling variance can be approximated by the collapsed strata estimator. In this method, pairs of strata are formed, and the two strata of a pair are joined. In each new stratum we now have two points. With an odd number of strata there will be one group of three strata and three points. The sample is then analysed as if it were a random sample from the new collapsed strata. Suppose we group the strata on the basis of the measurements of the study variable. Do you think this is a proper way of grouping?</li>
<li>In case you think this is not a proper way of grouping the strata, how would you group the strata?</li>
<li>Is the sampling variance estimator unbiased? If not, is the sampling variance overestimated or underestimated?<br />
</li>
</ul></li>
<li>Laboratory costs for measuring the study variable can be saved by bulking the soil aliquots (composite sampling). There are two options: bulking all soil aliquots from the same stratum (bulking within strata) or bulking by selecting one aliquot from each stratum (bulking across strata). In <strong>spcosa</strong> bulking across strata is implemented. Write an <strong>R</strong> script to construct 20 compact geographical strata for study area Voorst. Use argument <code>equalArea = TRUE</code>. Select four points per stratum using argument <code>type = "composite"</code>, and convert the resulting object to <code>SpatialPoints</code>. Extract the <span class="math inline">\(z\)</span>-values in <code>grdVoorst</code> at the selected sampling points using function <code>over</code>. Add a variable to the resulting data frame indicating the composite (points 1 to 4 are from the first stratum, points 5 to 8 from the second stratum, etc.), and estimate the means for the four composites using function <code>tapply</code>. Finally, estimate the population mean and its standard error.
<ul>
<li>Can the sampling variance of the estimator of the mean be estimated for bulking within the strata?</li>
<li>The alternative to analysing the concentration of four composite samples obtained by bulking across strata is to analyse all 20 <span class="math inline">\(\times\)</span> 4 aliquots separately. The strata have equal size, so the inclusion probabilities are equal. As a consequence, the sample mean is an unbiased estimator of the population mean. Is the precision of this estimated population mean equal to that of the estimated population mean with composite sampling? If not, is it smaller or larger, and why?</li>
<li>If you use argument <code>equalArea = FALSE</code> in combination with argument <code>type = "composite"</code>, you get an error message. Why does this combination of arguments not work?</li>
</ul></li>
</ol>
</div>
</div>
<div id="multiway-stratification" class="section level2 hasAnchor" number="4.7">
<h2><span class="header-section-number">4.7</span> Multiway stratification<a href="STSI.html#multiway-stratification" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In Section <a href="STSI.html#kmeansstratification">4.5</a> multiple continuous covariates are used to construct clusters of raster cells using k-means. These clusters are then used as strata. This section considers the case where we have multiple categorical and/or continuous variables that we would like to use as stratification variables. The continuous stratification variables are first used to compute strata based on that stratification variable, e.g., using the <em>cum-root-f</em> method. What could be done then is to compute the cross-classification of each unit and use these cross-classifications as strata in random sampling. However, this may lead to numerous strata, maybe even more than the intended sample size. To reduce the total number of strata, we may aggregate cross-classification strata with similar means of the study variable, based on our prior knowledge.</p>
<p>An alternative to aggregation of cross-classification strata is to use the separate strata, i.e., the strata based on an individual stratification variable, as <em>marginal</em> strata in random sampling. How this works is explained in Subsection <a href="BalancedSpreaded.html#Multiwaystratification">9.1.4</a>.</p>
</div>
<div id="MultivariateStratification" class="section level2 hasAnchor" number="4.8">
<h2><span class="header-section-number">4.8</span> Multivariate stratification<a href="STSI.html#MultivariateStratification" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Another situation is where we have multiple study variables and would like to optimise the stratification and allocation for estimating the population means of all study variables. Optimal stratification for multiple study variables is only relevant if we would like to use different stratification variables for the study variables. In many cases, we do not have reliable prior information about the different study variables justifying the use of multiple stratification variables. We are already happy to have one stratification variable that may serve to increase the precision of the estimated means of all study variables.</p>
<p>However, in case we do have multiple stratification variables tailored to different study variables, the objective is to partition the population in strata, so that for a given allocation, the total sampling costs, assuming a linear costs model (Equation <a href="STSI.html#eq:linearcostmodel">(4.18)</a>), are minimised given a constraint on the precision of the estimated mean for each study variable.</p>
<p>Package <strong>SamplingStrata</strong> <span class="citation">(<a href="#ref-Barcaroli2020" role="doc-biblioref">G. Barcaroli et al. 2020</a>)</span> can be used to optimise multivariate strata. <span class="citation"><a href="#ref-Barcaroli2014" role="doc-biblioref">Giulio Barcaroli</a> (<a href="#ref-Barcaroli2014" role="doc-biblioref">2014</a>)</span> gives details about the objective function and the algorithm used for optimising the strata. Sampling units are allocated to the strata by Bethel allocation <span class="citation">(<a href="#ref-Bethel1989" role="doc-biblioref">Bethel 1989</a>)</span>. The required precision is specified in terms of a coefficient of variation, one per study variable.</p>
<p>Multivariate stratification is illustrated with the Meuse data set of package <strong>gstat</strong> <span class="citation">(<a href="#ref-peb04" role="doc-biblioref">E. J. Pebesma 2004</a>)</span>. The prior data of heavy metal concentrations of Cd and Zn are used in spatial prediction to create maps of these two study variables.</p>
<p>The maps of natural logs of the two metal concentrations are created by kriging with an external drift, using the square root of the distance to the Meuse river as a predictor for the mean, see Section <a href="Introkriging.html#IntroKED">21.3</a> for how this spatial prediction method works.</p>
<p>Figure <a href="STSI.html#fig:PredictedCd">4.10</a> shows the map with the predicted log Cd and log Zn concentrations.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:PredictedCd"></span>
<img src="SpatialSampling_files/figure-html/PredictedCd-1.png" alt="Kriging predictions of natural logs of Cd and Zn concentrations in the study area Meuse, used as stratification variables in bivariate stratification." width="100%" />
<p class="caption">
Figure 4.10: Kriging predictions of natural logs of Cd and Zn concentrations in the study area Meuse, used as stratification variables in bivariate stratification.
</p>
</div>
<p>The predicted log concentrations of the two heavy metals are used as stratification variables in designing a new sample for design-based estimation of the population means of Cd and Zn. For the log of Cd, there are negative predicted concentrations (Figure <a href="STSI.html#fig:PredictedCd">4.10</a>). This leads to an error when running function <code>optimStrata</code>. The minimum predicted log Cd concentration is -1.7, so I added 2 to the predictions. A variable indicating the domains of interest is added to the data frame. The value of this variable is 1 for all grid cells, so that a sample is designed for estimating the mean of the entire population. As a first step, function <code>buildFrameDF</code> is used to create a data frame that can be handled by function <code>optimStrata</code>. Argument <code>X</code> specifies the stratification variables, and argument <code>Y</code> the study variables. In our case, the stratification variables and the study variables are the same. This is typical for the situation where the stratification variables are obtained by mapping the study variables.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="STSI.html#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SamplingStrata)</span>
<span id="cb67-2"><a href="STSI.html#cb67-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">cd =</span> lcd_kriged<span class="sc">$</span>var1.pred <span class="sc">+</span> <span class="dv">2</span>,</span>
<span id="cb67-3"><a href="STSI.html#cb67-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">zn =</span> lzn_kriged<span class="sc">$</span>var1.pred,</span>
<span id="cb67-4"><a href="STSI.html#cb67-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">dom =</span> <span class="dv">1</span>,</span>
<span id="cb67-5"><a href="STSI.html#cb67-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">id =</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(lcd_kriged)))</span>
<span id="cb67-6"><a href="STSI.html#cb67-6" aria-hidden="true" tabindex="-1"></a>frame <span class="ot">&lt;-</span> <span class="fu">buildFrameDF</span>(</span>
<span id="cb67-7"><a href="STSI.html#cb67-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">df =</span> df, <span class="at">id =</span> <span class="st">&quot;id&quot;</span>,</span>
<span id="cb67-8"><a href="STSI.html#cb67-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">X =</span> <span class="fu">c</span>(<span class="st">&quot;cd&quot;</span>, <span class="st">&quot;zn&quot;</span>), <span class="at">Y =</span> <span class="fu">c</span>(<span class="st">&quot;cd&quot;</span>, <span class="st">&quot;zn&quot;</span>),</span>
<span id="cb67-9"><a href="STSI.html#cb67-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">domainvalue =</span> <span class="st">&quot;dom&quot;</span>)</span></code></pre></div>
<p>Next, a data frame with the precision requirements for the estimated means is created. The precision requirement is given as a coefficient of variation, i.e., the standard error of the estimated population mean, divided by the estimated mean. The study variables as specified in <code>Y</code> are used to compute the estimated means and the standard errors for a given stratification and allocation.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="STSI.html#cb68-1" aria-hidden="true" tabindex="-1"></a>cv <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">list</span>(<span class="at">DOM =</span> <span class="st">&quot;DOM1&quot;</span>, <span class="at">CV1 =</span> <span class="fl">0.02</span>, <span class="at">CV2 =</span> <span class="fl">0.02</span>, <span class="at">domainvalue =</span> <span class="dv">1</span>))</span></code></pre></div>
<p>Finally, the multivariate stratification is optimised by searching for the optimal stratum bounds using a genetic algorithm <span class="citation">(<a href="#ref-ger99" role="doc-biblioref">Gershenfeld 1999</a>)</span>.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="STSI.html#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">314</span>)</span>
<span id="cb69-2"><a href="STSI.html#cb69-2" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">optimStrata</span>(</span>
<span id="cb69-3"><a href="STSI.html#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;continuous&quot;</span>,  <span class="at">errors =</span> cv, <span class="at">framesamp =</span> frame, <span class="at">nStrata =</span> <span class="dv">5</span>,</span>
<span id="cb69-4"><a href="STSI.html#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">50</span>, <span class="at">pops =</span> <span class="dv">20</span>, <span class="at">showPlot =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>A summary of the strata can be obtained with function <code>summaryStrata</code>.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="STSI.html#cb70-1" aria-hidden="true" tabindex="-1"></a>smrstrata <span class="ot">&lt;-</span> <span class="fu">summaryStrata</span>(res<span class="sc">$</span>framenew, res<span class="sc">$</span>aggr_strata, <span class="at">progress =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>  Stratum Population Allocation Lower_X1 Upper_X1 Lower_X2 Upper_X2
1       1        717          7    0.266    1.421    4.502    5.576
2       2        694          5    1.421    2.090    4.950    6.010
3       3        597          3    2.091    2.630    5.163    6.358
4       4        704          6    2.630    3.476    5.472    6.802
5       5        391          5    3.480    4.781    6.234    7.527</code></pre>
<p>Column <code>Population</code> contains the sizes of the strata, i.e., the number of grid cells. The total sample size equals 26. The sample size per stratum is computed with Bethel allocation, see Section <a href="STSI.html#STSIallocation">4.3</a>. The last four columns contain the lower and upper bounds of the orthogonal intervals.</p>
<p>Figure <a href="STSI.html#fig:2dplotbivariatestrata">4.11</a> shows a 2D-plot of the bivariate strata. The strata can be plotted as a series of nested rectangles. All population units in the smallest rectangle belong to stratum 1; all units in the one-but-smallest rectangle that are not in the smallest rectangle belong to stratum 2, etc. If we have more than two stratification variables, the strata form a series of nested hyperrectangles or boxes. The strata are obtained as the Cartesian product of orthogonal intervals.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="STSI.html#cb72-1" aria-hidden="true" tabindex="-1"></a>plt <span class="ot">&lt;-</span> <span class="fu">plotStrata2d</span>(res<span class="sc">$</span>framenew, res<span class="sc">$</span>aggr_strata,</span>
<span id="cb72-2"><a href="STSI.html#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">domain =</span> <span class="dv">1</span>, <span class="at">vars =</span> <span class="fu">c</span>(<span class="st">&quot;X1&quot;</span>, <span class="st">&quot;X2&quot;</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Cd&quot;</span>, <span class="st">&quot;Zn&quot;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:2dplotbivariatestrata"></span>
<img src="SpatialSampling_files/figure-html/2dplotbivariatestrata-1.png" alt="2D-plot of optimised bivariate strata of the study area Meuse." width="80%" />
<p class="caption">
Figure 4.11: 2D-plot of optimised bivariate strata of the study area Meuse.
</p>
</div>

<div class="rmdnote">
It may happen that after the optimisation of the stratum bounds in some resulting strata, no units are contained. If the stratification with a smaller number of strata requires fewer sampling units so that the sampling costs are lower (and still the precision requirement is met), then this is retained as the optimal stratification.
</div>
<p>Figure <a href="STSI.html#fig:OptimisedstrataMeuse">4.12</a> shows a map of the optimised strata.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:OptimisedstrataMeuse"></span>
<img src="SpatialSampling_files/figure-html/OptimisedstrataMeuse-1.png" alt="Map of optimised bivariate strata of the study area Meuse." width="80%" />
<p class="caption">
Figure 4.12: Map of optimised bivariate strata of the study area Meuse.
</p>
</div>
<p>The expected coefficient of variation can be extracted with function <code>expected_CV</code>.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="STSI.html#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">expected_CV</span>(res<span class="sc">$</span>aggr_strata)</span></code></pre></div>
<pre><code>     cv(Y1)    cv(Y2)
DOM1   0.02 0.0087401</code></pre>
<p>The coefficient of variation of Cd is indeed equal to the desired level of 0.02, for Zn it is smaller. So, in this case Cd is the study variable that determines the total sample size of 26 units.</p>
<p>Note that these coefficients of variation are computed from the stratification variables, which are predictions of the study variable. Errors in these predictions are not accounted for. It is well known that kriging is a smoother, so that the variance of the predicted values within a stratum is smaller than the variance of the true values. As a consequence, the coefficients of variation of the predictions underestimate the coefficients of variation of the study variables. See Section <a href="MBpredictionofDesignVariance.html#Ospats">13.2</a> for how prediction errors and spatial correlation of prediction errors can be accounted for in optimal stratification. An additional problem is that I added a value of 2 to the log Cd concentrations. This does not affect the standard error of the estimated mean, but does affect the estimated mean, so that also for this reason the coefficient of variation of the study variable Cd is underestimated.</p>

</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-magrittr" class="csl-entry">
Bache, Stefan Milton, and Hadley Wickham. 2020. <em><span class="nocase">magrittr: A Forward-Pipe Operator for R</span></em>. <a href="https://CRAN.R-project.org/package=magrittr">https://CRAN.R-project.org/package=magrittr</a>.
</div>
<div id="ref-Baillargeon2011" class="csl-entry">
Baillargeon, S., and L.-P. Rivest. 2011. <span>“<span class="nocase">The construction of stratified designs in R with the package stratification</span>.”</span> <em>Survey Methodology</em> 37 (1): 53–65.
</div>
<div id="ref-Barcaroli2020" class="csl-entry">
Barcaroli, G., M. Ballin, H. Odendaal, D. Pagliuca, E. Willighagen, and D. Zardetto. 2020. <em><span class="nocase">SamplingStrata: Optimal Stratification of Sampling Frames for Multipurpose Sampling Surveys</span></em>. <a href="{https://cran.r-project.org/package=SamplingStrata}">{https://cran.r-project.org/package=SamplingStrata}</a>.
</div>
<div id="ref-Barcaroli2014" class="csl-entry">
Barcaroli, Giulio. 2014. <span>“<span class="nocase">SamplingStrata: An R Package for the Optimization of Stratified Sampling</span>.”</span> <em>Journal of Statistical Software</em> 61 (4): 1–24. <a href="https://doi.org/10.18637/jss.v061.i04">https://doi.org/10.18637/jss.v061.i04</a>.
</div>
<div id="ref-Bethel1989" class="csl-entry">
Bethel, J. 1989. <span>“<span class="nocase">Sample allocation in multivariate surveys</span>.”</span> <em>Survey Methodology</em> 15 (1): 47–57.
</div>
<div id="ref-Bivand2013" class="csl-entry">
Bivand, Roger S., Edzer Pebesma, and Virgilio Gómez-Rubio. 2013. <em>Applied Spatial Data Analysis with <span>R</span></em>. Second. New York: Springer. <a href="https://asdar-book.org/">https://asdar-book.org/</a>.
</div>
<div id="ref-surveyplanning" class="csl-entry">
Breidaks, Juris, Martins Liberts, and Janis Jukams. 2020. <em><span class="nocase">surveyplanning</span>: Survey Planning Tools</em>. <a href="https://csblatvia.github.io/surveyplanning/">https://csblatvia.github.io/surveyplanning/</a>.
</div>
<div id="ref-bru99" class="csl-entry">
Brus, D. J., L. E. E. M. Spätjens, and J. J. de Gruijter. 1999. <span>“A Sampling Scheme for Estimating the Mean Extractable Phosphorus Concentration of Fields for Environmental Regulation.”</span> <em>Geoderma</em> 89 (1–2): 129–48.
</div>
<div id="ref-coc77" class="csl-entry">
Cochran, W. G. 1977. <em>Sampling Techniques</em>. New York: Wiley.
</div>
<div id="ref-Dalenius1959" class="csl-entry">
Dalenius, T., and J. L. Hodges. 1959. <span>“Minimum Variance Stratification.”</span> <em>Journal of the American Statistical Association</em> 54 (285): 88–101. <a href="https://doi.org/10.2307/2282141">https://doi.org/10.2307/2282141</a>.
</div>
<div id="ref-gru06" class="csl-entry">
de Gruijter, J. J., D. J. Brus, M. F. P. Bierkens, and M. Knotters. 2006. <em>Sampling for Natural Resource Monitoring</em>. Berlin: Springer.
</div>
<div id="ref-ger99" class="csl-entry">
Gershenfeld, N. 1999. <em>The Nature of Mathematical Modeling</em>. Cambridge: Cambridge University Press.
</div>
<div id="ref-Huang1998" class="csl-entry">
Huang, Z. 1998. <span>“Extensions to the k-Means Algorithm for Clustering Large Data Sets with Categorical Values.”</span> <em>Data Mining and Knowledge Discovery</em> 2: 283–304.
</div>
<div id="ref-loh99" class="csl-entry">
Lohr, S. L. 1999. <em>Sampling: Design and Analysis</em>. Pacific Grove: Duxbury Press.
</div>
<div id="ref-Lumley2020" class="csl-entry">
———. 2021. <em><span class="nocase">survey: Analysis of Complex Survey Samples</span></em>.
</div>
<div id="ref-nan04" class="csl-entry">
Nanthakumar, A., and K. Selvavel. 2004. <span>“Estimation of Proportion of Success from a Stratified Population: A Comparative Study.”</span> <em>Communications in Statistics</em> 33 (9): 2245–57.
</div>
<div id="ref-peb04" class="csl-entry">
Pebesma, E. J. 2004. <span>“Multivariable Geostatistics in <span>S</span>: The Gstat Package.”</span> <em>Computers &amp; Geosciences</em> 30 (7): 683–91.
</div>
<div id="ref-sar92" class="csl-entry">
Särndal, C. E., B. Swensson, and J. Wretman. 1992. <em>Model Assisted Survey Sampling</em>. New York: Springer.
</div>
<div id="ref-clustMixType" class="csl-entry">
Szepannek, Gero. 2018. <span>“<span class="nocase">clustMixType</span>: User-Friendly Clustering of Mixed-Type Data in <span>R</span>.”</span> <em>The R Journal</em> 10 (2): 200–208. <a href="https://doi.org/10.32614/RJ-2018-048">https://doi.org/10.32614/RJ-2018-048</a>.
</div>
<div id="ref-Tille2016" class="csl-entry">
Tillé, Y., and A. Matei. 2021. <em><span class="nocase">sampling: Survey Sampling</span></em>. <a href="https://CRAN.R-project.org/package=sampling">https://CRAN.R-project.org/package=sampling</a>.
</div>
<div id="ref-walvoort2010" class="csl-entry">
Walvoort, D. J. J., D. J. Brus, and J. J. de Gruijter. 2010. <span>“An <span>R</span> Package for Spatial Coverage Sampling and Random Sampling from Compact Geographical Strata by k-Means.”</span> <em>Computers &amp; Geosciences</em> 36 (10): 1261–67. <a href="https://doi.org/10.1016/j.cageo.2010.04.005">https://doi.org/10.1016/j.cageo.2010.04.005</a>.
</div>
<div id="ref-spcosa" class="csl-entry">
Walvoort, Dennis, Dick Brus, and Jaap de Gruijter. 2020. <em>Spatial Coverage Sampling and Random Sampling from Compact Geographical Strata</em>. <a href="https://CRAN.R-project.org/package=spcosa">https://CRAN.R-project.org/package=spcosa</a>.
</div>
<div id="ref-forcats" class="csl-entry">
———. 2021. <em><span class="nocase">forcats: Tools for Working with Categorical Variables (Factors)</span></em>. <a href="https://CRAN.R-project.org/package=forcats">https://CRAN.R-project.org/package=forcats</a>.
</div>
<div id="ref-Wickham2019" class="csl-entry">
Wickham, Hadley, Mara Averick, Jennifer Bryan, Winston Chang, Lucy D’Agostino McGowan, Romain François, Garrett Grolemund, et al. 2019. <span>“Welcome to the <span class="nocase">tidyverse</span>.”</span> <em>Journal of Open Source Software</em> 4 (43): 1686. <a href="https://doi.org/10.21105/joss.01686">https://doi.org/10.21105/joss.01686</a>.
</div>
<div id="ref-dplyr" class="csl-entry">
Wickham, Hadley, Romain François, Lionel Henry, and Kirill Müller. 2021. <em>Dplyr: A Grammar of Data Manipulation</em>. <a href="https://CRAN.R-project.org/package=dplyr">https://CRAN.R-project.org/package=dplyr</a>.
</div>
<div id="ref-Wickham2017" class="csl-entry">
Wickham, H., and G. Grolemund. 2017. <em><span class="nocase">R for Data Science. Import, Tidy, Transform, Visualize, and Model Data</span></em>. Sebastopol: O’Reilly Media. <a href="https://books.google.nl/books?id=-7RhvgAACAAJ">https://books.google.nl/books?id=-7RhvgAACAAJ</a>.
</div>
</div>
<div class="footnotes">
<hr />
<ol start="2">
<li id="fn2"><p>The compact geostrata and the sample are plotted with package <strong>ggplot2</strong>. A simple alternative is to use method <code>plot</code> of <strong>spcosa</strong>: <code>plot(mygeostrata, mysample)</code>.<a href="STSI.html#fnref2" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="SI.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="SY.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/DickBrus/SpatialSamplingwithR/edit/master/04-STSI.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["SpatialSampling.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
