<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 24 Sampling for estimating the semivariogram | Spatial sampling with R</title>
  <meta name="description" content="This book is for researchers, consultants and students who would like to know how to collect spatial data, either for estimating parameters for the population or several subpopulations, or for mapping. How many data do we need, and how to select the population units? The book presents a wide overview of spatial sampling designs. Besides there is a chapter on designs for sampling in space and time for monitoring. The emphasis is not on the theory, but on how to implement sampling designs in R and on how the (sub)population parameters can be estimated from the sample." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 24 Sampling for estimating the semivariogram | Spatial sampling with R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="/images/cover.pdf" />
  <meta property="og:description" content="This book is for researchers, consultants and students who would like to know how to collect spatial data, either for estimating parameters for the population or several subpopulations, or for mapping. How many data do we need, and how to select the population units? The book presents a wide overview of spatial sampling designs. Besides there is a chapter on designs for sampling in space and time for monitoring. The emphasis is not on the theory, but on how to implement sampling designs in R and on how the (sub)population parameters can be estimated from the sample." />
  <meta name="github-repo" content="DickBrus/SpatialSamplingwithR" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 24 Sampling for estimating the semivariogram | Spatial sampling with R" />
  
  <meta name="twitter:description" content="This book is for researchers, consultants and students who would like to know how to collect spatial data, either for estimating parameters for the population or several subpopulations, or for mapping. How many data do we need, and how to select the population units? The book presents a wide overview of spatial sampling designs. Besides there is a chapter on designs for sampling in space and time for monitoring. The emphasis is not on the theory, but on how to implement sampling designs in R and on how the (sub)population parameters can be estimated from the sample." />
  <meta name="twitter:image" content="/images/cover.pdf" />

<meta name="author" content="Dick J. Brus" />


<meta name="date" content="2021-12-15" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="MBSamplePattern.html"/>
<link rel="next" href="Validation.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Spatial sampling with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="GeneralIntro.html"><a href="GeneralIntro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="GeneralIntro.html"><a href="GeneralIntro.html#BasicConcepts"><i class="fa fa-check"></i><b>1.1</b> Basic sampling concepts</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="GeneralIntro.html"><a href="GeneralIntro.html#PopulationParameters"><i class="fa fa-check"></i><b>1.1.1</b> Population parameters</a></li>
<li class="chapter" data-level="1.1.2" data-path="GeneralIntro.html"><a href="GeneralIntro.html#descriptive-statistics-versus-inference-about-a-population"><i class="fa fa-check"></i><b>1.1.2</b> Descriptive statistics versus inference about a population</a></li>
<li class="chapter" data-level="1.1.3" data-path="GeneralIntro.html"><a href="GeneralIntro.html#random-sampling-versus-probability-sampling"><i class="fa fa-check"></i><b>1.1.3</b> Random sampling versus probability sampling</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="GeneralIntro.html"><a href="GeneralIntro.html#DBvsMB"><i class="fa fa-check"></i><b>1.2</b> Design-based versus model-based approach</a></li>
<li class="chapter" data-level="1.3" data-path="GeneralIntro.html"><a href="GeneralIntro.html#Datasets"><i class="fa fa-check"></i><b>1.3</b> Populations used in sampling experiments</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="GeneralIntro.html"><a href="GeneralIntro.html#Voorst"><i class="fa fa-check"></i><b>1.3.1</b> Soil organic matter in Voorst (Netherlands)</a></li>
<li class="chapter" data-level="1.3.2" data-path="GeneralIntro.html"><a href="GeneralIntro.html#Poppy"><i class="fa fa-check"></i><b>1.3.2</b> Poppy fields in Kandahar (Afghanistan)</a></li>
<li class="chapter" data-level="1.3.3" data-path="GeneralIntro.html"><a href="GeneralIntro.html#Amazonia"><i class="fa fa-check"></i><b>1.3.3</b> Aboveground biomass in Eastern Amazonia (Brazil)</a></li>
<li class="chapter" data-level="1.3.4" data-path="GeneralIntro.html"><a href="GeneralIntro.html#TASSpainPortugal"><i class="fa fa-check"></i><b>1.3.4</b> Annual mean air temperature in Spain and Portugal</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>I Probability sampling for estimating (sub)population parameters</b></span></li>
<li class="chapter" data-level="2" data-path="IntroProbabilitySampling.html"><a href="IntroProbabilitySampling.html"><i class="fa fa-check"></i><b>2</b> Introduction to probability sampling</a>
<ul>
<li class="chapter" data-level="2.1" data-path="IntroProbabilitySampling.html"><a href="IntroProbabilitySampling.html#HTestimator"><i class="fa fa-check"></i><b>2.1</b> Horvitz-Thompson estimator</a></li>
<li class="chapter" data-level="2.2" data-path="IntroProbabilitySampling.html"><a href="IntroProbabilitySampling.html#hansen-hurwitz-estimator"><i class="fa fa-check"></i><b>2.2</b> Hansen-Hurwitz estimator</a></li>
<li class="chapter" data-level="2.3" data-path="IntroProbabilitySampling.html"><a href="IntroProbabilitySampling.html#using-models-in-design-based-approach"><i class="fa fa-check"></i><b>2.3</b> Using models in design-based approach</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="SI.html"><a href="SI.html"><i class="fa fa-check"></i><b>3</b> Simple random sampling</a>
<ul>
<li class="chapter" data-level="3.1" data-path="SI.html"><a href="SI.html#HTestimatorSI"><i class="fa fa-check"></i><b>3.1</b> Estimation of population parameters</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="SI.html"><a href="SI.html#PopProportion"><i class="fa fa-check"></i><b>3.1.1</b> Population proportion</a></li>
<li class="chapter" data-level="3.1.2" data-path="SI.html"><a href="SI.html#CDF"><i class="fa fa-check"></i><b>3.1.2</b> Cumulative distribution function and quantiles</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="SI.html"><a href="SI.html#VarMeanSI"><i class="fa fa-check"></i><b>3.2</b> Sampling variance of estimator of population parameters</a></li>
<li class="chapter" data-level="3.3" data-path="SI.html"><a href="SI.html#ConfidenceInterval"><i class="fa fa-check"></i><b>3.3</b> Confidence interval estimate</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="SI.html"><a href="SI.html#ConfidenceIntervalProportion"><i class="fa fa-check"></i><b>3.3.1</b> Confidence interval for proportion</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="SI.html"><a href="SI.html#SIcircularplots"><i class="fa fa-check"></i><b>3.4</b> Simple random sampling of circular plots</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="SI.html"><a href="SI.html#sampling-from-a-finite-set-of-fixed-circles"><i class="fa fa-check"></i><b>3.4.1</b> Sampling from a finite set of fixed circles</a></li>
<li class="chapter" data-level="3.4.2" data-path="SI.html"><a href="SI.html#sampling-from-an-infinite-set-of-floating-circles"><i class="fa fa-check"></i><b>3.4.2</b> Sampling from an infinite set of floating circles</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="STSI.html"><a href="STSI.html"><i class="fa fa-check"></i><b>4</b> Stratified simple random sampling</a>
<ul>
<li class="chapter" data-level="4.1" data-path="STSI.html"><a href="STSI.html#EstimatorsSTSI"><i class="fa fa-check"></i><b>4.1</b> Estimation of population parameters</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="STSI.html"><a href="STSI.html#population-proportion-cumulative-distribution-function-and-quantiles"><i class="fa fa-check"></i><b>4.1.1</b> Population proportion, cumulative distribution function, and quantiles</a></li>
<li class="chapter" data-level="4.1.2" data-path="STSI.html"><a href="STSI.html#WhyStratify"><i class="fa fa-check"></i><b>4.1.2</b> Why should we stratify?</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="STSI.html"><a href="STSI.html#CISTSI"><i class="fa fa-check"></i><b>4.2</b> Confidence interval estimate</a></li>
<li class="chapter" data-level="4.3" data-path="STSI.html"><a href="STSI.html#STSIallocation"><i class="fa fa-check"></i><b>4.3</b> Allocation of sample size to strata</a></li>
<li class="chapter" data-level="4.4" data-path="STSI.html"><a href="STSI.html#cumrootf"><i class="fa fa-check"></i><b>4.4</b> <em>Cum-root-f</em> stratification</a></li>
<li class="chapter" data-level="4.5" data-path="STSI.html"><a href="STSI.html#kmeansstratification"><i class="fa fa-check"></i><b>4.5</b> Stratification with multiple covariates</a></li>
<li class="chapter" data-level="4.6" data-path="STSI.html"><a href="STSI.html#geostrata"><i class="fa fa-check"></i><b>4.6</b> Geographical stratification</a></li>
<li class="chapter" data-level="4.7" data-path="STSI.html"><a href="STSI.html#multi-way-stratification"><i class="fa fa-check"></i><b>4.7</b> Multi-way stratification</a></li>
<li class="chapter" data-level="4.8" data-path="STSI.html"><a href="STSI.html#MultivariateStratification"><i class="fa fa-check"></i><b>4.8</b> Multivariate stratification</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="SY.html"><a href="SY.html"><i class="fa fa-check"></i><b>5</b> Systematic random sampling</a>
<ul>
<li class="chapter" data-level="5.1" data-path="SY.html"><a href="SY.html#EstVarSY"><i class="fa fa-check"></i><b>5.1</b> Estimation of population parameters</a></li>
<li class="chapter" data-level="5.2" data-path="SY.html"><a href="SY.html#approximating-the-sampling-variance-of-the-estimator-of-the-mean"><i class="fa fa-check"></i><b>5.2</b> Approximating the sampling variance of the estimator of the mean</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="Cl.html"><a href="Cl.html"><i class="fa fa-check"></i><b>6</b> Cluster random sampling</a>
<ul>
<li class="chapter" data-level="6.1" data-path="Cl.html"><a href="Cl.html#clustersamplingestimators"><i class="fa fa-check"></i><b>6.1</b> Estimation of population parameters</a></li>
<li class="chapter" data-level="6.2" data-path="Cl.html"><a href="Cl.html#clusters-selected-with-probabilities-proportional-to-size-without-replacement"><i class="fa fa-check"></i><b>6.2</b> Clusters selected with probabilities proportional to size, without replacement</a></li>
<li class="chapter" data-level="6.3" data-path="Cl.html"><a href="Cl.html#SIC"><i class="fa fa-check"></i><b>6.3</b> Simple random sampling of clusters</a></li>
<li class="chapter" data-level="6.4" data-path="Cl.html"><a href="Cl.html#StratifiedCl"><i class="fa fa-check"></i><b>6.4</b> Stratified cluster random sampling</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="Twostage.html"><a href="Twostage.html"><i class="fa fa-check"></i><b>7</b> Two-stage cluster random sampling</a>
<ul>
<li class="chapter" data-level="7.1" data-path="Twostage.html"><a href="Twostage.html#twostagesamplingestimators"><i class="fa fa-check"></i><b>7.1</b> Estimation of population parameters</a></li>
<li class="chapter" data-level="7.2" data-path="Twostage.html"><a href="Twostage.html#primary-sampling-units-selected-without-replacement"><i class="fa fa-check"></i><b>7.2</b> Primary sampling units selected without replacement</a></li>
<li class="chapter" data-level="7.3" data-path="Twostage.html"><a href="Twostage.html#TwostageSISI"><i class="fa fa-check"></i><b>7.3</b> Simple random sampling of primary sampling units</a></li>
<li class="chapter" data-level="7.4" data-path="Twostage.html"><a href="Twostage.html#StratifiedTwostage"><i class="fa fa-check"></i><b>7.4</b> Stratified two-stage cluster random sampling</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="pps.html"><a href="pps.html"><i class="fa fa-check"></i><b>8</b> Sampling with probabilities proportional to size</a>
<ul>
<li class="chapter" data-level="8.1" data-path="pps.html"><a href="pps.html#ppswr"><i class="fa fa-check"></i><b>8.1</b> Probability-proportional-to-size sampling with replacement</a></li>
<li class="chapter" data-level="8.2" data-path="pps.html"><a href="pps.html#ppswor"><i class="fa fa-check"></i><b>8.2</b> Probability-proportional-to-size sampling without replacement</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="pps.html"><a href="pps.html#Systematicpps"><i class="fa fa-check"></i><b>8.2.1</b> Systematic pps sampling without replacement</a></li>
<li class="chapter" data-level="8.2.2" data-path="pps.html"><a href="pps.html#pivotalmethod"><i class="fa fa-check"></i><b>8.2.2</b> The pivotal method</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html"><i class="fa fa-check"></i><b>9</b> Balanced and well-spread sampling</a>
<ul>
<li class="chapter" data-level="9.1" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#Balanced"><i class="fa fa-check"></i><b>9.1</b> Balanced sampling</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#balanced-sample-versus-balanced-sampling-design"><i class="fa fa-check"></i><b>9.1.1</b> Balanced sample versus balanced sampling design</a></li>
<li class="chapter" data-level="9.1.2" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#unequal-inclusion-probabilities"><i class="fa fa-check"></i><b>9.1.2</b> Unequal inclusion probabilities</a></li>
<li class="chapter" data-level="9.1.3" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#StratifiedsamplingasBalancedsampling"><i class="fa fa-check"></i><b>9.1.3</b> Stratified random sampling</a></li>
<li class="chapter" data-level="9.1.4" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#Multiwaystratification"><i class="fa fa-check"></i><b>9.1.4</b> Multi-way stratification</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#Spreaded"><i class="fa fa-check"></i><b>9.2</b> Well-spread sampling</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#LPM"><i class="fa fa-check"></i><b>9.2.1</b> Local pivotal method</a></li>
<li class="chapter" data-level="9.2.2" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#GRTS"><i class="fa fa-check"></i><b>9.2.2</b> Generalised random-tessellation stratified sampling</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#BalancedandSpreaded"><i class="fa fa-check"></i><b>9.3</b> Balanced sampling with spreading</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="Modelassisted.html"><a href="Modelassisted.html"><i class="fa fa-check"></i><b>10</b> Model-assisted estimation</a>
<ul>
<li class="chapter" data-level="10.1" data-path="Modelassisted.html"><a href="Modelassisted.html#GREG"><i class="fa fa-check"></i><b>10.1</b> Generalised regression estimator</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="Modelassisted.html"><a href="Modelassisted.html#RegressionEstimator"><i class="fa fa-check"></i><b>10.1.1</b> Simple and multiple regression estimators</a></li>
<li class="chapter" data-level="10.1.2" data-path="Modelassisted.html"><a href="Modelassisted.html#penalised-least-squares-estimation"><i class="fa fa-check"></i><b>10.1.2</b> Penalised least squares estimation</a></li>
<li class="chapter" data-level="10.1.3" data-path="Modelassisted.html"><a href="Modelassisted.html#RegressionEstimatorSTSI"><i class="fa fa-check"></i><b>10.1.3</b> Regression estimator with stratified simple random sampling</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="Modelassisted.html"><a href="Modelassisted.html#RatioEstimator"><i class="fa fa-check"></i><b>10.2</b> Ratio estimator</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="Modelassisted.html"><a href="Modelassisted.html#RatioEstimatorSTSI"><i class="fa fa-check"></i><b>10.2.1</b> Ratio estimators with stratified simple random sampling</a></li>
<li class="chapter" data-level="10.2.2" data-path="Modelassisted.html"><a href="Modelassisted.html#PoststratifiedEstimator"><i class="fa fa-check"></i><b>10.2.2</b> Poststratified estimator</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="Modelassisted.html"><a href="Modelassisted.html#RandomForest"><i class="fa fa-check"></i><b>10.3</b> Model-assisted estimation using machine learning techniques</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="Modelassisted.html"><a href="Modelassisted.html#predicting-with-a-regression-tree"><i class="fa fa-check"></i><b>10.3.1</b> Predicting with a regression tree</a></li>
<li class="chapter" data-level="10.3.2" data-path="Modelassisted.html"><a href="Modelassisted.html#predicting-with-a-random-forest"><i class="fa fa-check"></i><b>10.3.2</b> Predicting with a random forest</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="Modelassisted.html"><a href="Modelassisted.html#big-data-and-volunteer-data"><i class="fa fa-check"></i><b>10.4</b> Big data and volunteer data</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="Twophase.html"><a href="Twophase.html"><i class="fa fa-check"></i><b>11</b> Two-phase random sampling</a>
<ul>
<li class="chapter" data-level="11.1" data-path="Twophase.html"><a href="Twophase.html#TwophaseStratification"><i class="fa fa-check"></i><b>11.1</b> Two-phase random sampling for stratification</a></li>
<li class="chapter" data-level="11.2" data-path="Twophase.html"><a href="Twophase.html#TwophaseRegression"><i class="fa fa-check"></i><b>11.2</b> Two-phase random sampling for regression</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html"><i class="fa fa-check"></i><b>12</b> Computing the required sample size</a>
<ul>
<li class="chapter" data-level="12.1" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#standard-error"><i class="fa fa-check"></i><b>12.1</b> Standard error</a></li>
<li class="chapter" data-level="12.2" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#ReqSampleSizeLengthCI"><i class="fa fa-check"></i><b>12.2</b> Length of confidence interval</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#length-of-confidence-interval-for-a-proportion"><i class="fa fa-check"></i><b>12.2.1</b> Length of confidence interval for a proportion</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#statistical-testing-of-hypothesis"><i class="fa fa-check"></i><b>12.3</b> Statistical testing of hypothesis</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#sample-size-for-testing-a-proportion"><i class="fa fa-check"></i><b>12.3.1</b> Sample size for testing a proportion</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#DesignEffect"><i class="fa fa-check"></i><b>12.4</b> Accounting for design effect</a></li>
<li class="chapter" data-level="12.5" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#BayesianSampleSize"><i class="fa fa-check"></i><b>12.5</b> Bayesian sample size determination</a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#bayesian-criteria-for-sample-size-computation"><i class="fa fa-check"></i><b>12.5.1</b> Bayesian criteria for sample size computation</a></li>
<li class="chapter" data-level="12.5.2" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#mixed-bayesian-likelihood-approach"><i class="fa fa-check"></i><b>12.5.2</b> Mixed Bayesian-likelihood approach</a></li>
<li class="chapter" data-level="12.5.3" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#estimation-of-population-mean"><i class="fa fa-check"></i><b>12.5.3</b> Estimation of population mean</a></li>
<li class="chapter" data-level="12.5.4" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#estimation-of-a-population-proportion"><i class="fa fa-check"></i><b>12.5.4</b> Estimation of a population proportion</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="MBpredictionofDesignVariance.html"><a href="MBpredictionofDesignVariance.html"><i class="fa fa-check"></i><b>13</b> Model-based optimisation of probability sampling designs</a>
<ul>
<li class="chapter" data-level="13.1" data-path="MBpredictionofDesignVariance.html"><a href="MBpredictionofDesignVariance.html#model-based-optimisation-of-sampling-design-type-and-sample-size"><i class="fa fa-check"></i><b>13.1</b> Model-based optimisation of sampling design type and sample size</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="MBpredictionofDesignVariance.html"><a href="MBpredictionofDesignVariance.html#AnalyticalApproach"><i class="fa fa-check"></i><b>13.1.1</b> Analytical approach</a></li>
<li class="chapter" data-level="13.1.2" data-path="MBpredictionofDesignVariance.html"><a href="MBpredictionofDesignVariance.html#GeostatisticalSimulationApproach"><i class="fa fa-check"></i><b>13.1.2</b> Geostatistical simulation approach</a></li>
<li class="chapter" data-level="13.1.3" data-path="MBpredictionofDesignVariance.html"><a href="MBpredictionofDesignVariance.html#MBpredSamplingVarBayes"><i class="fa fa-check"></i><b>13.1.3</b> Bayesian approach</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="MBpredictionofDesignVariance.html"><a href="MBpredictionofDesignVariance.html#Ospats"><i class="fa fa-check"></i><b>13.2</b> Model-based optimisation of spatial strata</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html"><i class="fa fa-check"></i><b>14</b> Sampling for estimating parameters of (small) domains</a>
<ul>
<li class="chapter" data-level="14.1" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#LargeDomainsDirectEstimator"><i class="fa fa-check"></i><b>14.1</b> Direct estimator for large domains</a></li>
<li class="chapter" data-level="14.2" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#SmallDomainsModelAssisted"><i class="fa fa-check"></i><b>14.2</b> Model-assisted estimators for small domains</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#RegressionestimatorSmallDomain"><i class="fa fa-check"></i><b>14.2.1</b> Regression estimator</a></li>
<li class="chapter" data-level="14.2.2" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#SyntheticestimatorSmallDomain"><i class="fa fa-check"></i><b>14.2.2</b> Synthetic estimator</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#SmallAreaModelBased"><i class="fa fa-check"></i><b>14.3</b> Model-based prediction</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#random-intercept-model"><i class="fa fa-check"></i><b>14.3.1</b> Random intercept model</a></li>
<li class="chapter" data-level="14.3.2" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#geostatistical-model"><i class="fa fa-check"></i><b>14.3.2</b> Geostatistical model</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#supplemental-probability-sampling-of-small-domains"><i class="fa fa-check"></i><b>14.4</b> Supplemental probability sampling of small domains</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html"><i class="fa fa-check"></i><b>15</b> Repeated sample surveys for monitoring population parameters</a>
<ul>
<li class="chapter" data-level="15.1" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#space-time-designs"><i class="fa fa-check"></i><b>15.1</b> Space-time designs</a></li>
<li class="chapter" data-level="15.2" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#SpaceTimeparameters"><i class="fa fa-check"></i><b>15.2</b> Space-time population parameters</a></li>
<li class="chapter" data-level="15.3" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#design-based-generalised-least-squares-estimation-of-spatial-means"><i class="fa fa-check"></i><b>15.3</b> Design-based generalised least squares estimation of spatial means</a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#current-mean"><i class="fa fa-check"></i><b>15.3.1</b> Current mean</a></li>
<li class="chapter" data-level="15.3.2" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#change-of-the-spatial-mean"><i class="fa fa-check"></i><b>15.3.2</b> Change of the spatial mean</a></li>
<li class="chapter" data-level="15.3.3" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#temporal-trend-of-the-spatial-mean"><i class="fa fa-check"></i><b>15.3.3</b> Temporal trend of the spatial mean</a></li>
<li class="chapter" data-level="15.3.4" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#space-time-mean"><i class="fa fa-check"></i><b>15.3.4</b> Space-time mean</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#case-study-annual-mean-daily-temperature-in-spain"><i class="fa fa-check"></i><b>15.4</b> Case study: annual mean daily temperature in Spain</a>
<ul>
<li class="chapter" data-level="15.4.1" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#static-synchronous-design"><i class="fa fa-check"></i><b>15.4.1</b> Static-synchronous design</a></li>
<li class="chapter" data-level="15.4.2" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#independent-synchronous-design"><i class="fa fa-check"></i><b>15.4.2</b> Independent synchronous design</a></li>
<li class="chapter" data-level="15.4.3" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#serially-alternating-design"><i class="fa fa-check"></i><b>15.4.3</b> Serially alternating design</a></li>
<li class="chapter" data-level="15.4.4" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#supplemented-panel-design"><i class="fa fa-check"></i><b>15.4.4</b> Supplemented panel design</a></li>
<li class="chapter" data-level="15.4.5" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#rotating-panel-design"><i class="fa fa-check"></i><b>15.4.5</b> Rotating panel design</a></li>
<li class="chapter" data-level="15.4.6" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#sampling-experiment"><i class="fa fa-check"></i><b>15.4.6</b> Sampling experiment</a></li>
</ul></li>
<li class="chapter" data-level="15.5" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#space-time-sampling-with-stratified-random-sampling-in-space"><i class="fa fa-check"></i><b>15.5</b> Space-time sampling with stratified random sampling in space</a></li>
</ul></li>
<li class="part"><span><b>II Sampling for mapping</b></span></li>
<li class="chapter" data-level="16" data-path="IntroSamplingforMapping.html"><a href="IntroSamplingforMapping.html"><i class="fa fa-check"></i><b>16</b> Introduction to sampling for mapping</a>
<ul>
<li class="chapter" data-level="16.1" data-path="IntroSamplingforMapping.html"><a href="IntroSamplingforMapping.html#when-is-probability-sampling-not-required"><i class="fa fa-check"></i><b>16.1</b> When is probability sampling not required?</a></li>
<li class="chapter" data-level="16.2" data-path="IntroSamplingforMapping.html"><a href="IntroSamplingforMapping.html#sampling-for-simultaneously-mapping-and-estimating-means"><i class="fa fa-check"></i><b>16.2</b> Sampling for simultaneously mapping and estimating means</a></li>
<li class="chapter" data-level="16.3" data-path="IntroSamplingforMapping.html"><a href="IntroSamplingforMapping.html#broad-overview-of-sampling-designs-for-mapping"><i class="fa fa-check"></i><b>16.3</b> Broad overview of sampling designs for mapping</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="RegularGridSpatialCoverage.html"><a href="RegularGridSpatialCoverage.html"><i class="fa fa-check"></i><b>17</b> Regular grid and spatial coverage sampling</a>
<ul>
<li class="chapter" data-level="17.1" data-path="RegularGridSpatialCoverage.html"><a href="RegularGridSpatialCoverage.html#Regulargrid"><i class="fa fa-check"></i><b>17.1</b> Regular grid sampling</a></li>
<li class="chapter" data-level="17.2" data-path="RegularGridSpatialCoverage.html"><a href="RegularGridSpatialCoverage.html#SpatialCoverage"><i class="fa fa-check"></i><b>17.2</b> Spatial coverage sampling</a></li>
<li class="chapter" data-level="17.3" data-path="RegularGridSpatialCoverage.html"><a href="RegularGridSpatialCoverage.html#SpatialInfill"><i class="fa fa-check"></i><b>17.3</b> Spatial infill sampling</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="kmeans.html"><a href="kmeans.html"><i class="fa fa-check"></i><b>18</b> Covariate space coverage sampling</a>
<ul>
<li class="chapter" data-level="18.1" data-path="kmeans.html"><a href="kmeans.html#covariate-space-infill-sampling"><i class="fa fa-check"></i><b>18.1</b> Covariate space infill sampling</a></li>
<li class="chapter" data-level="18.2" data-path="kmeans.html"><a href="kmeans.html#PerformanceCSC"><i class="fa fa-check"></i><b>18.2</b> Performance of covariate space coverage sampling in random forest prediction</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="cLHS.html"><a href="cLHS.html"><i class="fa fa-check"></i><b>19</b> Conditioned Latin hypercube sampling</a>
<ul>
<li class="chapter" data-level="19.1" data-path="cLHS.html"><a href="cLHS.html#cLHIS"><i class="fa fa-check"></i><b>19.1</b> Conditioned Latin hypercube infill sampling</a></li>
<li class="chapter" data-level="19.2" data-path="cLHS.html"><a href="cLHS.html#performance-of-conditioned-latin-hypercube-sampling-in-random-forest-prediction"><i class="fa fa-check"></i><b>19.2</b> Performance of conditioned Latin hypercube sampling in random forest prediction</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="SpatialResponseSurface.html"><a href="SpatialResponseSurface.html"><i class="fa fa-check"></i><b>20</b> Spatial response surface sampling</a>
<ul>
<li class="chapter" data-level="20.1" data-path="SpatialResponseSurface.html"><a href="SpatialResponseSurface.html#IncreaseSampleSize"><i class="fa fa-check"></i><b>20.1</b> Increasing the sample size</a></li>
<li class="chapter" data-level="20.2" data-path="SpatialResponseSurface.html"><a href="SpatialResponseSurface.html#stratified-spatial-response-surface-sampling"><i class="fa fa-check"></i><b>20.2</b> Stratified spatial response surface sampling</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="Introkriging.html"><a href="Introkriging.html"><i class="fa fa-check"></i><b>21</b> Introduction to kriging</a>
<ul>
<li class="chapter" data-level="21.1" data-path="Introkriging.html"><a href="Introkriging.html#OrdinaryKriging"><i class="fa fa-check"></i><b>21.1</b> Ordinary kriging</a></li>
<li class="chapter" data-level="21.2" data-path="Introkriging.html"><a href="Introkriging.html#BlockKriging"><i class="fa fa-check"></i><b>21.2</b> Block-kriging</a></li>
<li class="chapter" data-level="21.3" data-path="Introkriging.html"><a href="Introkriging.html#IntroKED"><i class="fa fa-check"></i><b>21.3</b> Kriging with an external drift</a></li>
<li class="chapter" data-level="21.4" data-path="Introkriging.html"><a href="Introkriging.html#VariogramEstimation"><i class="fa fa-check"></i><b>21.4</b> Estimating the semivariogram</a>
<ul>
<li class="chapter" data-level="21.4.1" data-path="Introkriging.html"><a href="Introkriging.html#MoM"><i class="fa fa-check"></i><b>21.4.1</b> Method-of-moments</a></li>
<li class="chapter" data-level="21.4.2" data-path="Introkriging.html"><a href="Introkriging.html#MLestimationVariogram"><i class="fa fa-check"></i><b>21.4.2</b> Maximum likelihood</a></li>
</ul></li>
<li class="chapter" data-level="21.5" data-path="Introkriging.html"><a href="Introkriging.html#ResidualVariogram"><i class="fa fa-check"></i><b>21.5</b> Estimating the residual semivariogram</a>
<ul>
<li class="chapter" data-level="21.5.1" data-path="Introkriging.html"><a href="Introkriging.html#IterativeMoM"><i class="fa fa-check"></i><b>21.5.1</b> Iterative method-of-moments</a></li>
<li class="chapter" data-level="21.5.2" data-path="Introkriging.html"><a href="Introkriging.html#REML"><i class="fa fa-check"></i><b>21.5.2</b> Restricted maximum likelihood</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="22" data-path="MBgridspacing.html"><a href="MBgridspacing.html"><i class="fa fa-check"></i><b>22</b> Model-based optimisation of the grid spacing</a>
<ul>
<li class="chapter" data-level="22.1" data-path="MBgridspacing.html"><a href="MBgridspacing.html#GridspacingOK"><i class="fa fa-check"></i><b>22.1</b> Optimal grid spacing for ordinary kriging</a></li>
<li class="chapter" data-level="22.2" data-path="MBgridspacing.html"><a href="MBgridspacing.html#controlling-the-mean-or-a-quantile-of-the-ordinary-kriging-variance"><i class="fa fa-check"></i><b>22.2</b> Controlling the mean or a quantile of the ordinary kriging variance</a></li>
<li class="chapter" data-level="22.3" data-path="MBgridspacing.html"><a href="MBgridspacing.html#optimal-grid-spacing-for-block-kriging"><i class="fa fa-check"></i><b>22.3</b> Optimal grid spacing for block-kriging</a></li>
<li class="chapter" data-level="22.4" data-path="MBgridspacing.html"><a href="MBgridspacing.html#MBgridspacingKED"><i class="fa fa-check"></i><b>22.4</b> Optimal grid spacing for kriging with an external drift</a></li>
<li class="chapter" data-level="22.5" data-path="MBgridspacing.html"><a href="MBgridspacing.html#BayesianGridSpacing"><i class="fa fa-check"></i><b>22.5</b> Bayesian approach</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="MBSamplePattern.html"><a href="MBSamplePattern.html"><i class="fa fa-check"></i><b>23</b> Model-based optimisation of the sampling pattern</a>
<ul>
<li class="chapter" data-level="23.1" data-path="MBSamplePattern.html"><a href="MBSamplePattern.html#SSA"><i class="fa fa-check"></i><b>23.1</b> Spatial simulated annealing</a></li>
<li class="chapter" data-level="23.2" data-path="MBSamplePattern.html"><a href="MBSamplePattern.html#SamplePatternOK"><i class="fa fa-check"></i><b>23.2</b> Optimising the sampling pattern for ordinary kriging</a></li>
<li class="chapter" data-level="23.3" data-path="MBSamplePattern.html"><a href="MBSamplePattern.html#SamplePatternKED"><i class="fa fa-check"></i><b>23.3</b> Optimising the sampling pattern for kriging with an external drift</a></li>
<li class="chapter" data-level="23.4" data-path="MBSamplePattern.html"><a href="MBSamplePattern.html#model-based-infill-sampling-for-ordinary-kriging"><i class="fa fa-check"></i><b>23.4</b> Model-based infill sampling for ordinary kriging</a></li>
<li class="chapter" data-level="23.5" data-path="MBSamplePattern.html"><a href="MBSamplePattern.html#model-based-infill-sampling-for-kriging-with-an-external-drift"><i class="fa fa-check"></i><b>23.5</b> Model-based infill sampling for kriging with an external drift</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html"><i class="fa fa-check"></i><b>24</b> Sampling for estimating the semivariogram</a>
<ul>
<li class="chapter" data-level="24.1" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#NestedSampling"><i class="fa fa-check"></i><b>24.1</b> Nested sampling</a></li>
<li class="chapter" data-level="24.2" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#IndependentSamplingPairs"><i class="fa fa-check"></i><b>24.2</b> Independent sampling of pairs of points</a></li>
<li class="chapter" data-level="24.3" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#samplingforvariogram"><i class="fa fa-check"></i><b>24.3</b> Optimisation of sampling pattern for semivariogram estimation</a>
<ul>
<li class="chapter" data-level="24.3.1" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#UncertainSemivariogramParameters"><i class="fa fa-check"></i><b>24.3.1</b> Uncertainty about semivariogram parameters</a></li>
<li class="chapter" data-level="24.3.2" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#UncertainKrigingVariance"><i class="fa fa-check"></i><b>24.3.2</b> Uncertainty about the kriging variance</a></li>
</ul></li>
<li class="chapter" data-level="24.4" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#SamplingEstimationandPrediction"><i class="fa fa-check"></i><b>24.4</b> Optimisation of sampling pattern for semivariogram estimation and mapping</a></li>
<li class="chapter" data-level="24.5" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#a-practical-solution"><i class="fa fa-check"></i><b>24.5</b> A practical solution</a></li>
</ul></li>
<li class="chapter" data-level="25" data-path="Validation.html"><a href="Validation.html"><i class="fa fa-check"></i><b>25</b> Sampling for validation of maps</a>
<ul>
<li class="chapter" data-level="25.1" data-path="Validation.html"><a href="Validation.html#map-quality-indices"><i class="fa fa-check"></i><b>25.1</b> Map quality indices</a>
<ul>
<li class="chapter" data-level="25.1.1" data-path="Validation.html"><a href="Validation.html#estimation-of-map-quality-indices"><i class="fa fa-check"></i><b>25.1.1</b> Estimation of map quality indices</a></li>
</ul></li>
<li class="chapter" data-level="25.2" data-path="Validation.html"><a href="Validation.html#real-world-case-study"><i class="fa fa-check"></i><b>25.2</b> Real-world case study</a>
<ul>
<li class="chapter" data-level="25.2.1" data-path="Validation.html"><a href="Validation.html#estimation-of-the-population-mean-error-and-mean-squared-error"><i class="fa fa-check"></i><b>25.2.1</b> Estimation of the population mean error and mean squared error</a></li>
<li class="chapter" data-level="25.2.2" data-path="Validation.html"><a href="Validation.html#estimation-of-the-standard-error-of-the-estimator-of-the-population-mean-error-and-mean-squared-error"><i class="fa fa-check"></i><b>25.2.2</b> Estimation of the standard error of the estimator of the population mean error and mean squared error</a></li>
<li class="chapter" data-level="25.2.3" data-path="Validation.html"><a href="Validation.html#estimation-of-model-efficiency-coefficient"><i class="fa fa-check"></i><b>25.2.3</b> Estimation of model efficiency coefficient</a></li>
<li class="chapter" data-level="25.2.4" data-path="Validation.html"><a href="Validation.html#statistical-testing-of-hypothesis-about-population-me-and-mse"><i class="fa fa-check"></i><b>25.2.4</b> Statistical testing of hypothesis about population ME and MSE</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="26" data-path="Approaches.html"><a href="Approaches.html"><i class="fa fa-check"></i><b>26</b> Design-based, model-based, and model-assisted approach for sampling and inference</a>
<ul>
<li class="chapter" data-level="26.1" data-path="Approaches.html"><a href="Approaches.html#two-sources-of-randomness"><i class="fa fa-check"></i><b>26.1</b> Two sources of randomness</a></li>
<li class="chapter" data-level="26.2" data-path="Approaches.html"><a href="Approaches.html#iid"><i class="fa fa-check"></i><b>26.2</b> “Identically and independently distributed” (i.i.d.)</a></li>
<li class="chapter" data-level="26.3" data-path="Approaches.html"><a href="Approaches.html#BiasandVariance"><i class="fa fa-check"></i><b>26.3</b> Bias and variance</a></li>
<li class="chapter" data-level="26.4" data-path="Approaches.html"><a href="Approaches.html#effectivesamplesize"><i class="fa fa-check"></i><b>26.4</b> Effective sample size</a></li>
<li class="chapter" data-level="26.5" data-path="Approaches.html"><a href="Approaches.html#ExploitSpatialStructure"><i class="fa fa-check"></i><b>26.5</b> Exploiting spatial structure in design-based approach</a></li>
<li class="chapter" data-level="26.6" data-path="Approaches.html"><a href="Approaches.html#ModelassistedvsModeldependent"><i class="fa fa-check"></i><b>26.6</b> Model-assisted versus model-dependent</a></li>
</ul></li>
<li class="appendix"><span><b>Appendices</b></span></li>
<li class="chapter" data-level="A" data-path="Answers.html"><a href="Answers.html"><i class="fa fa-check"></i><b>A</b> Answers to exercises</a>
<ul>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#introduction-to-probability-sampling"><i class="fa fa-check"></i>Introduction to probability sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#simple-random-sampling-1"><i class="fa fa-check"></i>Simple random sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#stratified-simple-random-sampling-1"><i class="fa fa-check"></i>Stratified simple random sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#systematic-random-sampling-2"><i class="fa fa-check"></i>Systematic random sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#cluster-random-sampling"><i class="fa fa-check"></i>Cluster random sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#two-stage-cluster-random-sampling-1"><i class="fa fa-check"></i>Two-stage cluster random sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#sampling-with-probabilities-proportional-to-size"><i class="fa fa-check"></i>Sampling with probabilities proportional to size</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#balanced-and-well-spread-sampling"><i class="fa fa-check"></i>Balanced and well-spread sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#model-assisted-estimation"><i class="fa fa-check"></i>Model-assisted estimation</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#two-phase-random-sampling"><i class="fa fa-check"></i>Two-phase random sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#computing-the-required-sample-size"><i class="fa fa-check"></i>Computing the required sample size</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#model-based-optimisation-of-probability-sampling-designs"><i class="fa fa-check"></i>Model-based optimisation of probability sampling designs</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#repeated-sample-surveys-for-monitoring-population-parameters"><i class="fa fa-check"></i>Repeated sample surveys for monitoring population parameters</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#regular-grid-and-spatial-coverage-sampling"><i class="fa fa-check"></i>Regular grid and spatial coverage sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#covariate-space-coverage-sampling"><i class="fa fa-check"></i>Covariate space coverage sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#conditioned-latin-hypercube-sampling"><i class="fa fa-check"></i>Conditioned Latin hypercube sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#model-based-optimisation-of-the-grid-spacing"><i class="fa fa-check"></i>Model-based optimisation of the grid spacing</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#model-based-optimisation-of-the-sampling-pattern"><i class="fa fa-check"></i>Model-based optimisation of the sampling pattern</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#sampling-for-estimating-the-semivariogram"><i class="fa fa-check"></i>Sampling for estimating the semivariogram</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#sampling-for-validation-of-maps"><i class="fa fa-check"></i>Sampling for validation of maps</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/DickBrus/">Dick Brus</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Spatial sampling with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="SamplingVariogram" class="section level1" number="24">
<h1><span class="header-section-number">Chapter 24</span> Sampling for estimating the semivariogram</h1>
<p>For model-based sampling as described in Chapters <a href="MBgridspacing.html#MBgridspacing">22</a> and <a href="MBSamplePattern.html#MBSamplePattern">23</a> we must specify the (residual) semivariogram. In case we do not have a reasonable prior estimate of the semivariogram, we may decide to first collect data with the specific aim of estimating the semivariogram. This semivariogram is subsequently used to design a model-based sample for mapping. This chapter is about how to design a reconnaissance sample survey for estimating the semivariogram.</p>
<p>The first question is how many observations we need for this. <span class="citation"><a href="#ref-web92" role="doc-biblioref">Webster and Oliver</a> (<a href="#ref-web92" role="doc-biblioref">1992</a>)</span> gave as a rule of thumb that 150 to 225 points are needed to obtain a reliable semivariogram when estimated by the method-of-moments (MoM). <span class="citation"><a href="#ref-lar00b" role="doc-biblioref">Lark</a> (<a href="#ref-lar00b" role="doc-biblioref">2000</a>)</span> showed that with maximum likelihood (ML) estimation two-third to only half of the observations are needed to achieve equal precision of the estimated semivariogram parameters.</p>
<p>Once we have decided on the sample size, we must select the locations of the sampling units. Two random sampling designs for semivariogram estimation are described, nested sampling (Section <a href="SamplingVariogram.html#NestedSampling">24.1</a>) and independent sampling of pairs of points (Section <a href="SamplingVariogram.html#IndependentSamplingPairs">24.2</a>). Section <a href="SamplingVariogram.html#samplingforvariogram">24.3</a> is devoted to model-based optimisation of the sampling pattern for semivariogram estimation. Section <a href="SamplingVariogram.html#SamplingEstimationandPrediction">24.4</a> is about how to design a single sample that can be used both for estimation of the semivariogram and prediction (mapping). In a final section a practical solution is described for the problem of how to design a sample for semivariogram estimation and prediction.</p>
<div id="NestedSampling" class="section level2" number="24.1">
<h2><span class="header-section-number">24.1</span> Nested sampling</h2>
<p>Nested sampling can be used to estimate the semivariance at a limited number of separation distances, see <span class="citation"><a href="#ref-Oliver1986" role="doc-biblioref">Oliver and Webster</a> (<a href="#ref-Oliver1986" role="doc-biblioref">1986</a>)</span> and <span class="citation"><a href="#ref-Webster2006" role="doc-biblioref">Webster et al.</a> (<a href="#ref-Webster2006" role="doc-biblioref">2006</a>)</span>. First, we must decide on these separation distances. We need point-pairs at various separation distances, especially for small separation distances, so that we get reliable estimates of this part of the semivariogram which has a strong effect on the kriging weights. Usually, separation distances are chosen in a geometric progression, for instance 2, 8, 32, 128, and 512 m. The multiplier, which is four in this example, should not be too small; as a rule of thumb use three or larger.</p>
<p>There are two versions of nested sampling. In the first stage of the first version several main stations are selected in a way that they cover the study area well, for instance by spatial coverage sampling. In the second stage each of the main stations is used as a starting point to select one point at a distance equal to the largest chosen separation distance (512 m in the example) in a random direction from the main station. This doubles the sample size. In the third stage all points selected in the previous stages (main stations of stage 1 plus the points of stage 2) are used as starting points to select one point at a distance equal to the second largest separation distance (128 m), and so on. All points selected in the various stages are included in the nested sample. The code chunk below shows the function for random selection of one point at distance <span class="math inline">\(h\)</span> from a starting point. Note the <code>while</code> loop which continues until a point is found that is inside the area. This is checked with function <code>over</code> of package <strong>sp</strong>.</p>
<div class="sourceCode" id="cb501"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb501-1"><a href="SamplingVariogram.html#cb501-1" aria-hidden="true" tabindex="-1"></a>SelectPoint <span class="ot">&lt;-</span> <span class="cf">function</span>(start, h, area) {</span>
<span id="cb501-2"><a href="SamplingVariogram.html#cb501-2" aria-hidden="true" tabindex="-1"></a>  dxy <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="at">length =</span> <span class="dv">2</span>)</span>
<span id="cb501-3"><a href="SamplingVariogram.html#cb501-3" aria-hidden="true" tabindex="-1"></a>  inArea <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb501-4"><a href="SamplingVariogram.html#cb501-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (<span class="fu">is.na</span>(inArea)) {</span>
<span id="cb501-5"><a href="SamplingVariogram.html#cb501-5" aria-hidden="true" tabindex="-1"></a>    angle <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">2</span> <span class="sc">*</span> pi)</span>
<span id="cb501-6"><a href="SamplingVariogram.html#cb501-6" aria-hidden="true" tabindex="-1"></a>    dxy[<span class="dv">1</span>] <span class="ot">&lt;-</span> h <span class="sc">*</span> <span class="fu">sin</span>(angle); dxy[<span class="dv">2</span>] <span class="ot">&lt;-</span> h <span class="sc">*</span> <span class="fu">cos</span>(angle)</span>
<span id="cb501-7"><a href="SamplingVariogram.html#cb501-7" aria-hidden="true" tabindex="-1"></a>    xypnt <span class="ot">&lt;-</span> start <span class="sc">+</span> dxy</span>
<span id="cb501-8"><a href="SamplingVariogram.html#cb501-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coordinates</span>(xypnt) <span class="ot">&lt;-</span> <span class="er">~</span> s1 <span class="sc">+</span> s2</span>
<span id="cb501-9"><a href="SamplingVariogram.html#cb501-9" aria-hidden="true" tabindex="-1"></a>    inArea <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">over</span>(<span class="at">x =</span> xypnt, <span class="at">y =</span> area))[<span class="dv">1</span>]</span>
<span id="cb501-10"><a href="SamplingVariogram.html#cb501-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb501-11"><a href="SamplingVariogram.html#cb501-11" aria-hidden="true" tabindex="-1"></a>  xypoint <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(xypnt)</span>
<span id="cb501-12"><a href="SamplingVariogram.html#cb501-12" aria-hidden="true" tabindex="-1"></a>  xypoint</span>
<span id="cb501-13"><a href="SamplingVariogram.html#cb501-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The first stage of the second version is equal to that of the first version. However, in the second stage each of the main stations serves as a starting point for randomly selecting a <em>pair of points</em> with a separation distance equal to the largest chosen separation distance. The main station is halfway the selected pair of points. In the third stage each of the substations is used to select in the same way a pair of points separated by the second largest chosen distance, and so on. Only the points selected in the final stage are used as sampling points. The <strong>R</strong> code below shows the function for random selection of two points separated by <span class="math inline">\(h\)</span> distance units with a starting point halfway the pair of points. The <code>while</code> loop continues until both points of a pair are inside the area.</p>
<div class="sourceCode" id="cb502"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb502-1"><a href="SamplingVariogram.html#cb502-1" aria-hidden="true" tabindex="-1"></a>SelectPair <span class="ot">&lt;-</span> <span class="cf">function</span>(start, h, area) {</span>
<span id="cb502-2"><a href="SamplingVariogram.html#cb502-2" aria-hidden="true" tabindex="-1"></a>  dxy <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="at">length =</span> <span class="dv">2</span>)</span>
<span id="cb502-3"><a href="SamplingVariogram.html#cb502-3" aria-hidden="true" tabindex="-1"></a>  xypoints <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb502-4"><a href="SamplingVariogram.html#cb502-4" aria-hidden="true" tabindex="-1"></a>  inArea1 <span class="ot">&lt;-</span> inArea2 <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb502-5"><a href="SamplingVariogram.html#cb502-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (<span class="fu">is.na</span>(inArea1) <span class="sc">|</span> <span class="fu">is.na</span>(inArea2)) {</span>
<span id="cb502-6"><a href="SamplingVariogram.html#cb502-6" aria-hidden="true" tabindex="-1"></a>    angle <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">2</span> <span class="sc">*</span> pi)</span>
<span id="cb502-7"><a href="SamplingVariogram.html#cb502-7" aria-hidden="true" tabindex="-1"></a>    dxy[<span class="dv">1</span>] <span class="ot">&lt;-</span> h <span class="sc">*</span> <span class="fu">sin</span>(angle) <span class="sc">/</span> <span class="dv">2</span>; dxy[<span class="dv">2</span>] <span class="ot">&lt;-</span> h <span class="sc">*</span> <span class="fu">cos</span>(angle) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb502-8"><a href="SamplingVariogram.html#cb502-8" aria-hidden="true" tabindex="-1"></a>    xypnt1 <span class="ot">&lt;-</span> start <span class="sc">+</span> dxy</span>
<span id="cb502-9"><a href="SamplingVariogram.html#cb502-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coordinates</span>(xypnt1) <span class="ot">&lt;-</span> <span class="er">~</span> s1 <span class="sc">+</span> s2</span>
<span id="cb502-10"><a href="SamplingVariogram.html#cb502-10" aria-hidden="true" tabindex="-1"></a>    inArea1 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">over</span>(<span class="at">x =</span> xypnt1, <span class="at">y =</span> area))[<span class="dv">1</span>]</span>
<span id="cb502-11"><a href="SamplingVariogram.html#cb502-11" aria-hidden="true" tabindex="-1"></a>    dxy[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="sc">-</span>dxy[<span class="dv">1</span>]; dxy[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="sc">-</span>dxy[<span class="dv">2</span>]</span>
<span id="cb502-12"><a href="SamplingVariogram.html#cb502-12" aria-hidden="true" tabindex="-1"></a>    xypnt2 <span class="ot">&lt;-</span> start <span class="sc">+</span> dxy</span>
<span id="cb502-13"><a href="SamplingVariogram.html#cb502-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coordinates</span>(xypnt2) <span class="ot">&lt;-</span> <span class="er">~</span> s1 <span class="sc">+</span> s2</span>
<span id="cb502-14"><a href="SamplingVariogram.html#cb502-14" aria-hidden="true" tabindex="-1"></a>    inArea2 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">over</span>(<span class="at">x =</span> xypnt2, <span class="at">y =</span> area))[<span class="dv">1</span>]</span>
<span id="cb502-15"><a href="SamplingVariogram.html#cb502-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb502-16"><a href="SamplingVariogram.html#cb502-16" aria-hidden="true" tabindex="-1"></a>  xypoints <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">as.data.frame</span>(xypnt1), <span class="fu">as.data.frame</span>(xypnt2))</span>
<span id="cb502-17"><a href="SamplingVariogram.html#cb502-17" aria-hidden="true" tabindex="-1"></a>  xypoints</span>
<span id="cb502-18"><a href="SamplingVariogram.html#cb502-18" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The <strong>R</strong> code below shows the selection of a nested sample from Hunter Valley using both versions. Only one main station is selected. In total sixteen points are selected in four stages. The separation distances are 2,000, 1,000, 500, and 250 m. Sixteen points is not enough for estimating the semivariogram and a multiplier of two is rather small, but this example is for illustrative purpose only.</p>
<p>Note that the separation distances are in descending order. The largest separation distance should not be chosen too large, because then, when the main station is somewhere in the middle of the study area, it may happen that using the first version no pair can be found with that separation distance. A similar problem may occur with the second version when in subsequent stages a station is selected near the border of the study area. A copy of the <code>data.frame</code> <code>grdHunterValley</code> is made because both the original data frame is needed, as well as a gridded version of this data frame.</p>
<div class="sourceCode" id="cb503"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb503-1"><a href="SamplingVariogram.html#cb503-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb503-2"><a href="SamplingVariogram.html#cb503-2" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> grdHunterValley</span>
<span id="cb503-3"><a href="SamplingVariogram.html#cb503-3" aria-hidden="true" tabindex="-1"></a><span class="fu">gridded</span>(grdHunterValley) <span class="ot">&lt;-</span> <span class="er">~</span> s1 <span class="sc">+</span> s2</span>
<span id="cb503-4"><a href="SamplingVariogram.html#cb503-4" aria-hidden="true" tabindex="-1"></a>lags <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2000</span>, <span class="dv">1000</span>, <span class="dv">500</span>, <span class="dv">250</span>)</span></code></pre></div>
<p>The next code chunk is an implementation of the first version of nested sampling.</p>
<div class="sourceCode" id="cb504"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb504-1"><a href="SamplingVariogram.html#cb504-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">614</span>)</span>
<span id="cb504-2"><a href="SamplingVariogram.html#cb504-2" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(grid), <span class="dv">1</span>)</span>
<span id="cb504-3"><a href="SamplingVariogram.html#cb504-3" aria-hidden="true" tabindex="-1"></a>mainstation <span class="ot">&lt;-</span> grid[id, <span class="fu">c</span>(<span class="st">&quot;s1&quot;</span>, <span class="st">&quot;s2&quot;</span>)]</span>
<span id="cb504-4"><a href="SamplingVariogram.html#cb504-4" aria-hidden="true" tabindex="-1"></a>newpnt <span class="ot">&lt;-</span> <span class="fu">SelectPoint</span>(<span class="at">start =</span> mainstation, <span class="at">h =</span> lags[<span class="dv">1</span>], <span class="at">area =</span> grdHunterValley)</span>
<span id="cb504-5"><a href="SamplingVariogram.html#cb504-5" aria-hidden="true" tabindex="-1"></a>mynestedsample <span class="ot">&lt;-</span> <span class="fu">rbind</span>(mainstation, newpnt)</span>
<span id="cb504-6"><a href="SamplingVariogram.html#cb504-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(lags)) {</span>
<span id="cb504-7"><a href="SamplingVariogram.html#cb504-7" aria-hidden="true" tabindex="-1"></a>  newpnts <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb504-8"><a href="SamplingVariogram.html#cb504-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(mynestedsample))) {</span>
<span id="cb504-9"><a href="SamplingVariogram.html#cb504-9" aria-hidden="true" tabindex="-1"></a>    pnts <span class="ot">&lt;-</span> <span class="fu">SelectPoint</span>(</span>
<span id="cb504-10"><a href="SamplingVariogram.html#cb504-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">start =</span> mynestedsample[i, ], <span class="at">h =</span> lags[j], <span class="at">area =</span> grdHunterValley)</span>
<span id="cb504-11"><a href="SamplingVariogram.html#cb504-11" aria-hidden="true" tabindex="-1"></a>    newpnts <span class="ot">&lt;-</span> <span class="fu">rbind</span>(newpnts, pnts)</span>
<span id="cb504-12"><a href="SamplingVariogram.html#cb504-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb504-13"><a href="SamplingVariogram.html#cb504-13" aria-hidden="true" tabindex="-1"></a>  mynestedsample <span class="ot">&lt;-</span> <span class="fu">rbind</span>(mynestedsample, newpnts)</span>
<span id="cb504-14"><a href="SamplingVariogram.html#cb504-14" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The <strong>R</strong> code for the second version is presented in the next code chunk.</p>
<div class="sourceCode" id="cb505"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb505-1"><a href="SamplingVariogram.html#cb505-1" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(grid), <span class="dv">1</span>)</span>
<span id="cb505-2"><a href="SamplingVariogram.html#cb505-2" aria-hidden="true" tabindex="-1"></a>mainstation <span class="ot">&lt;-</span> grid[id, <span class="fu">c</span>(<span class="st">&quot;s1&quot;</span>, <span class="st">&quot;s2&quot;</span>)]</span>
<span id="cb505-3"><a href="SamplingVariogram.html#cb505-3" aria-hidden="true" tabindex="-1"></a>pnt <span class="ot">&lt;-</span> <span class="fu">SelectPoint</span>(<span class="at">start =</span> mainstation, <span class="at">h =</span> lags[<span class="dv">1</span>], <span class="at">area =</span> grdHunterValley)</span>
<span id="cb505-4"><a href="SamplingVariogram.html#cb505-4" aria-hidden="true" tabindex="-1"></a>stations <span class="ot">&lt;-</span> <span class="fu">rbind</span>(mainstation, pnt)</span>
<span id="cb505-5"><a href="SamplingVariogram.html#cb505-5" aria-hidden="true" tabindex="-1"></a>allstations <span class="ot">&lt;-</span>  <span class="fu">rbind</span>(mainstation, pnt)</span>
<span id="cb505-6"><a href="SamplingVariogram.html#cb505-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(lags)) {</span>
<span id="cb505-7"><a href="SamplingVariogram.html#cb505-7" aria-hidden="true" tabindex="-1"></a>  newstations <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb505-8"><a href="SamplingVariogram.html#cb505-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(stations))) {</span>
<span id="cb505-9"><a href="SamplingVariogram.html#cb505-9" aria-hidden="true" tabindex="-1"></a>    pnts <span class="ot">&lt;-</span> <span class="fu">SelectPair</span>(</span>
<span id="cb505-10"><a href="SamplingVariogram.html#cb505-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">start =</span> stations[i, ], <span class="at">h =</span> lags[j], <span class="at">area =</span> grdHunterValley)</span>
<span id="cb505-11"><a href="SamplingVariogram.html#cb505-11" aria-hidden="true" tabindex="-1"></a>    newstations <span class="ot">&lt;-</span> <span class="fu">rbind</span>(newstations, pnts)</span>
<span id="cb505-12"><a href="SamplingVariogram.html#cb505-12" aria-hidden="true" tabindex="-1"></a>    allstations <span class="ot">&lt;-</span> <span class="fu">rbind</span>(allstations, pnts)</span>
<span id="cb505-13"><a href="SamplingVariogram.html#cb505-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb505-14"><a href="SamplingVariogram.html#cb505-14" aria-hidden="true" tabindex="-1"></a>  stations <span class="ot">&lt;-</span> newstations</span>
<span id="cb505-15"><a href="SamplingVariogram.html#cb505-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb505-16"><a href="SamplingVariogram.html#cb505-16" aria-hidden="true" tabindex="-1"></a>mynestedsample_2 <span class="ot">&lt;-</span> stations</span></code></pre></div>
<p>Figure <a href="SamplingVariogram.html#fig:BalancedNestedSample">24.1</a> shows the two selected nested samples. For the sample selected with the second version also the stations that served as starting points for the selection of the point-pairs are plotted.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:BalancedNestedSample"></span>
<img src="SpatialSampling_files/figure-html/BalancedNestedSample-1.png" alt="Balanced nested samples from Hunter Valley, selected with the two versions of nested sampling. In the subfigure of the second version the selected sampling points (symbol x) are plotted together with the selected stations (halfway the two points of a pair)." width="100%" />
<p class="caption">
Figure 24.1: Balanced nested samples from Hunter Valley, selected with the two versions of nested sampling. In the subfigure of the second version the selected sampling points (symbol x) are plotted together with the selected stations (halfway the two points of a pair).
</p>
</div>
<p>The samples of Figure <a href="SamplingVariogram.html#fig:BalancedNestedSample">24.1</a> are examples of <em>balanced</em> nested samples. The number of point-pairs separated by a given distance doubles with every stage. As a consequence, the estimated semivariances for the smallest separation distance are much more precise than for the largest distance. We are most uncertain about the estimated semivariances for the largest separation distances. If in the first stage only one point-pair separated by the largest distance is selected, then we have only one degree of freedom for estimating the variance component associated with this stage. It is more efficient to select more than one main station, say about ten, and to select fewer points in the final stages. For instance, with the second version we may decide to select a point-pair at only half the number of stations selected in the one-but-last stage. The nested sample then becomes unbalanced.</p>
<p>The model for nested sampling with four stages is a hierarchical analysis of variance (ANOVA) model with random effects:</p>
<p><span class="math display" id="eq:ANOVAmodelnested">\[\begin{equation}
Z_{ijkl}=\mu+A_i+B_{ij}+C_{ijk}+\epsilon_{ijkl} \;,
\tag{24.1}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(\mu\)</span> the mean, <span class="math inline">\(A_i\)</span> the effect of the <span class="math inline">\(i\)</span>th first stage station, <span class="math inline">\(B_{ij}\)</span> the effect of the <span class="math inline">\(j\)</span>th second stage station within the <span class="math inline">\(i\)</span>th first stage station, and so on. <span class="math inline">\(A_i\)</span>, <span class="math inline">\(B_{ij}\)</span>, <span class="math inline">\(C_{ijk}\)</span>, and <span class="math inline">\(\epsilon_{ijkl}\)</span> are random quantities (random effects) all with zero mean and variances <span class="math inline">\(\sigma^2_1\)</span>, <span class="math inline">\(\sigma^2_2\)</span>, <span class="math inline">\(\sigma^2_3\)</span>, and <span class="math inline">\(\sigma^2_4\)</span> respectively.</p>
<p>For balanced designs the variance components can be estimated by the MoM from a hierarchical ANOVA. The first step is to assign factors to the sampling points that indicate the grouping of the sampling points in the various stages. The number of factors needed is the number of stages minus 1. All factors have two levels. Figures <a href="SamplingVariogram.html#fig:FactorLevelsBalancedNestedSample">24.2</a> and <a href="SamplingVariogram.html#fig:FactorLevelsBalancedNestedSample2">24.3</a> show the levels of the three factors. The levels of the first factor show the strongest spatial clustering, those of the second factor the one-but-strongest, and so on.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:FactorLevelsBalancedNestedSample"></span>
<img src="SpatialSampling_files/figure-html/FactorLevelsBalancedNestedSample-1.png" alt="The levels of the three factors assigned to the sampling points of the balanced nested sample selected with the first version." width="100%" />
<p class="caption">
Figure 24.2: The levels of the three factors assigned to the sampling points of the balanced nested sample selected with the first version.
</p>
</div>
<p>The <strong>R</strong> code below shows the construction of the three factors for the second version of nested sampling.</p>
<div class="sourceCode" id="cb506"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb506-1"><a href="SamplingVariogram.html#cb506-1" aria-hidden="true" tabindex="-1"></a>mynestedsample_2<span class="sc">$</span>factor1 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">each =</span> <span class="dv">8</span>)</span>
<span id="cb506-2"><a href="SamplingVariogram.html#cb506-2" aria-hidden="true" tabindex="-1"></a>mynestedsample_2<span class="sc">$</span>factor2 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">each =</span> <span class="dv">4</span>)</span>
<span id="cb506-3"><a href="SamplingVariogram.html#cb506-3" aria-hidden="true" tabindex="-1"></a>mynestedsample_2<span class="sc">$</span>factor3 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">each =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:FactorLevelsBalancedNestedSample2"></span>
<img src="SpatialSampling_files/figure-html/FactorLevelsBalancedNestedSample2-1.png" alt="The levels of the three factors assigned to the sampling points of the balanced nested sample selected with the second version." width="100%" />
<p class="caption">
Figure 24.3: The levels of the three factors assigned to the sampling points of the balanced nested sample selected with the second version.
</p>
</div>
<p>For unbalanced nested designs the variance components can be estimated by restricted maximum likelihood (REML) <span class="citation">(<a href="#ref-Webster2006" role="doc-biblioref">Webster et al. 2006</a>)</span>. REML estimation is also recommended if in Equation <a href="SamplingVariogram.html#eq:ANOVAmodelnested">(24.1)</a> instead of a constant mean <span class="math inline">\(\mu\)</span> the mean is a linear combination of one or more covariates (fixed effects). The semivariances at the chosen separation distances are obtained by cumulating the estimated variance components.</p>
<p>The <strong>R</strong> code below shows how the variance components and the semivariances can be estimated with function <code>lme</code> of the package <strong>nlme</strong> <span class="citation">(<a href="#ref-nlme" role="doc-biblioref">Pinheiro et al. 2021</a>)</span>, once the data are collected and added to the data frame. This function fits linear mixed-effects models and allows for nested random effects. It can be used both for balanced and unbalanced nested samples, and for a constant mean or a mean that is a linear combination of covariates. Argument <code>fixed</code> is a formula describing the fixed effects with the response variable on the left-hand side of the ~ operator and the covariates for the mean on the right-hand side. If a constant mean is assumed, as in our example, this is indicated by the 1 on the right-hand side of the ~ operator. Argument <code>random</code> is a one-sided formula (no response variable is on the left-hand side of the ~ operator). On the right-hand side of the <span class="math inline">\(|\)</span> separator, the nested structure of the data is specified using the factors of Figure <a href="SamplingVariogram.html#fig:FactorLevelsBalancedNestedSample">24.2</a>. The 1 on the left-hand side of the <span class="math inline">\(|\)</span> separator means that we assume that all regression coefficients associated with the covariates are fixed (non-random) quantities.</p>
<div class="sourceCode" id="cb507"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb507-1"><a href="SamplingVariogram.html#cb507-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nlme)</span>
<span id="cb507-2"><a href="SamplingVariogram.html#cb507-2" aria-hidden="true" tabindex="-1"></a>lmodel <span class="ot">&lt;-</span> <span class="fu">lme</span>(</span>
<span id="cb507-3"><a href="SamplingVariogram.html#cb507-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">fixed =</span> z <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> mynestedsample, <span class="at">random =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> factor1 <span class="sc">/</span> factor2 <span class="sc">/</span> factor3)</span>
<span id="cb507-4"><a href="SamplingVariogram.html#cb507-4" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">VarCorr</span>(lmodel))</span>
<span id="cb507-5"><a href="SamplingVariogram.html#cb507-5" aria-hidden="true" tabindex="-1"></a>sigmas <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(res[<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">7</span>), <span class="dv">1</span>])</span>
<span id="cb507-6"><a href="SamplingVariogram.html#cb507-6" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fu">rev</span>(sigmas)</span>
<span id="cb507-7"><a href="SamplingVariogram.html#cb507-7" aria-hidden="true" tabindex="-1"></a>semivar <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(sigmas)</span></code></pre></div>
<p>Random sampling of the points is not strictly needed, because a model-based approach is followed here. The model of Equation <a href="SamplingVariogram.html#eq:ANOVAmodelnested">(24.1)</a> is a superpopulation model, i.e. we assume that the population is generated by this model (see Chapter <a href="Approaches.html#Approaches">26</a>). <span class="citation"><a href="#ref-Papritz2011" role="doc-biblioref">Papritz et al.</a> (<a href="#ref-Papritz2011" role="doc-biblioref">2011</a>)</span>, for instance, selected the points (using the second version) non-randomly to improve the control of the nested subareas and the average separation distances.</p>
<p><span class="citation"><a href="#ref-Lark2011CAGEO" role="doc-biblioref">Lark</a> (<a href="#ref-Lark2011CAGEO" role="doc-biblioref">2011</a>)</span> describes a method for optimisation of a nested design, given the total number of points and the chosen separation distances.</p>
<div id="exercises-31" class="section level4 unnumbered">
<h4>Exercises</h4>
<ol style="list-style-type: decimal">
<li>Write an <strong>R</strong> script to select with the first version a balanced nested sample from Hunter Valley. Use as separation distances 1,000, 500, 200, 100, and 50 m.
<ul>
<li>Add the factors that are needed for estimating the variance components to the data frame with the selected sampling points.</li>
<li>Overlay the sampling points with the <code>SpatialPixelsDataFrame</code>, and estimate the semivariances for the attribute compound topographic index (cti).</li>
</ul></li>
</ol>
</div>
</div>
<div id="IndependentSamplingPairs" class="section level2" number="24.2">
<h2><span class="header-section-number">24.2</span> Independent sampling of pairs of points</h2>
<p>With the nested design the estimated semivariances for the different separation distances are not independent. Independent estimated semivariances can be obtained by independent random selection of pairs of points (IPP sampling). Independence here means design-independence, see Section <a href="Approaches.html#iid">26.2</a>. Similar to a regression model, a semivariogram can be defined as a superpopulation model or as a population model. Only in the current section a semivariogram is defined at the population level. Such a semivariogram is referred to as a non-ergodic semivariogram or local semivariogram <span class="citation">(<a href="#ref-bru94b" role="doc-biblioref">Brus and de Gruijter 1994</a>)</span>.</p>
<p>IPP sampling is straightforward for simple random sampling. For each separation distance a point-pair is selected by first selecting fully randomly one point from the study area. Then the second point is randomly selected from the circle with the first point at its centre and a radius equal to the chosen separation distance. If this second point is outside the study area, both points are discarded. This is repeated until we have the required point-pairs for this separation distance. The next code chunk is an implementation of this selection procedure.</p>
<div class="sourceCode" id="cb508"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb508-1"><a href="SamplingVariogram.html#cb508-1" aria-hidden="true" tabindex="-1"></a>SIpairs <span class="ot">&lt;-</span> <span class="cf">function</span>(h, n, area) {</span>
<span id="cb508-2"><a href="SamplingVariogram.html#cb508-2" aria-hidden="true" tabindex="-1"></a>  topo <span class="ot">&lt;-</span> <span class="fu">as</span>(<span class="fu">getGridTopology</span>(area), <span class="st">&quot;data.frame&quot;</span>)</span>
<span id="cb508-3"><a href="SamplingVariogram.html#cb508-3" aria-hidden="true" tabindex="-1"></a>  cellsize <span class="ot">&lt;-</span> topo<span class="sc">$</span>cellsize[<span class="dv">1</span>]</span>
<span id="cb508-4"><a href="SamplingVariogram.html#cb508-4" aria-hidden="true" tabindex="-1"></a>  xy <span class="ot">&lt;-</span> <span class="fu">coordinates</span>(area)</span>
<span id="cb508-5"><a href="SamplingVariogram.html#cb508-5" aria-hidden="true" tabindex="-1"></a>  dxy <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="at">length =</span> <span class="dv">2</span>)</span>
<span id="cb508-6"><a href="SamplingVariogram.html#cb508-6" aria-hidden="true" tabindex="-1"></a>  xypnts1 <span class="ot">&lt;-</span> xypnts2 <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb508-7"><a href="SamplingVariogram.html#cb508-7" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb508-8"><a href="SamplingVariogram.html#cb508-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (i <span class="sc">&lt;=</span> n) {</span>
<span id="cb508-9"><a href="SamplingVariogram.html#cb508-9" aria-hidden="true" tabindex="-1"></a>    id1 <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">length</span>(area), <span class="at">size =</span> <span class="dv">1</span>)</span>
<span id="cb508-10"><a href="SamplingVariogram.html#cb508-10" aria-hidden="true" tabindex="-1"></a>    xypnt1 <span class="ot">&lt;-</span> xy[id1, ]</span>
<span id="cb508-11"><a href="SamplingVariogram.html#cb508-11" aria-hidden="true" tabindex="-1"></a>    xypnt1[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">jitter</span>(xypnt1[<span class="dv">1</span>], <span class="at">amount =</span> cellsize <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb508-12"><a href="SamplingVariogram.html#cb508-12" aria-hidden="true" tabindex="-1"></a>    xypnt1[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">jitter</span>(xypnt1[<span class="dv">2</span>], <span class="at">amount =</span> cellsize <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb508-13"><a href="SamplingVariogram.html#cb508-13" aria-hidden="true" tabindex="-1"></a>    angle <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">2</span> <span class="sc">*</span> pi)</span>
<span id="cb508-14"><a href="SamplingVariogram.html#cb508-14" aria-hidden="true" tabindex="-1"></a>    dxy[<span class="dv">1</span>] <span class="ot">&lt;-</span> h <span class="sc">*</span> <span class="fu">sin</span>(angle); dxy[<span class="dv">2</span>] <span class="ot">&lt;-</span> h <span class="sc">*</span> <span class="fu">cos</span>(angle)</span>
<span id="cb508-15"><a href="SamplingVariogram.html#cb508-15" aria-hidden="true" tabindex="-1"></a>    xypnt2 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">t</span>(xypnt1 <span class="sc">+</span> dxy))</span>
<span id="cb508-16"><a href="SamplingVariogram.html#cb508-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coordinates</span>(xypnt2) <span class="ot">&lt;-</span> <span class="er">~</span> s1 <span class="sc">+</span> s2</span>
<span id="cb508-17"><a href="SamplingVariogram.html#cb508-17" aria-hidden="true" tabindex="-1"></a>    inArea <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">over</span>(<span class="at">x =</span> xypnt2, <span class="at">y =</span> area))[<span class="dv">1</span>]</span>
<span id="cb508-18"><a href="SamplingVariogram.html#cb508-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.na</span>(inArea)) {</span>
<span id="cb508-19"><a href="SamplingVariogram.html#cb508-19" aria-hidden="true" tabindex="-1"></a>      xypnts1 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(xypnts1, xypnt1)</span>
<span id="cb508-20"><a href="SamplingVariogram.html#cb508-20" aria-hidden="true" tabindex="-1"></a>      xypnts2 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(xypnts2, <span class="fu">as.data.frame</span>(xypnt2))</span>
<span id="cb508-21"><a href="SamplingVariogram.html#cb508-21" aria-hidden="true" tabindex="-1"></a>      i <span class="ot">&lt;-</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb508-22"><a href="SamplingVariogram.html#cb508-22" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb508-23"><a href="SamplingVariogram.html#cb508-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span>(xypnt1, xypnt2)</span>
<span id="cb508-24"><a href="SamplingVariogram.html#cb508-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb508-25"><a href="SamplingVariogram.html#cb508-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(xypnts1, xypnts2)</span>
<span id="cb508-26"><a href="SamplingVariogram.html#cb508-26" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>IPP sampling is illustrated with the compound topographic index (cti, which is the same as topographic wetness index) data of Hunter Valley. Five separation distances are chosen, collected in numeric <code>h</code>, and for each distance <span class="math inline">\(n=100\)</span> point-pairs are selected by simple random sampling.</p>
<div class="sourceCode" id="cb509"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb509-1"><a href="SamplingVariogram.html#cb509-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb509-2"><a href="SamplingVariogram.html#cb509-2" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">500</span>, <span class="dv">1000</span>)</span>
<span id="cb509-3"><a href="SamplingVariogram.html#cb509-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb509-4"><a href="SamplingVariogram.html#cb509-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb509-5"><a href="SamplingVariogram.html#cb509-5" aria-hidden="true" tabindex="-1"></a>allpairs <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb509-6"><a href="SamplingVariogram.html#cb509-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">length</span>(h))) {</span>
<span id="cb509-7"><a href="SamplingVariogram.html#cb509-7" aria-hidden="true" tabindex="-1"></a>  pairs <span class="ot">&lt;-</span> <span class="fu">SIpairs</span>(<span class="at">h =</span> h[i], <span class="at">n =</span> n, <span class="at">area =</span> grdHunterValley)</span>
<span id="cb509-8"><a href="SamplingVariogram.html#cb509-8" aria-hidden="true" tabindex="-1"></a>  allpairs <span class="ot">&lt;-</span> <span class="fu">rbind</span>(allpairs, pairs, <span class="at">make.row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb509-9"><a href="SamplingVariogram.html#cb509-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The <code>data.frame</code> <code>allpairs</code> has four columns: the spatial coordinates of the first and of the second point of a pair. An overlay is made of the selected points with the <code>SpatialPixelsDataFrame</code>, and the cti values are extracted.</p>
<div class="sourceCode" id="cb510"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb510-1"><a href="SamplingVariogram.html#cb510-1" aria-hidden="true" tabindex="-1"></a>pnt1 <span class="ot">&lt;-</span> allpairs[, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)]</span>
<span id="cb510-2"><a href="SamplingVariogram.html#cb510-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coordinates</span>(pnt1) <span class="ot">&lt;-</span> <span class="er">~</span> s1 <span class="sc">+</span> s2</span>
<span id="cb510-3"><a href="SamplingVariogram.html#cb510-3" aria-hidden="true" tabindex="-1"></a>z1 <span class="ot">&lt;-</span> <span class="fu">over</span>(<span class="at">x =</span> pnt1, <span class="at">y =</span> grdHunterValley)[<span class="dv">4</span>]</span>
<span id="cb510-4"><a href="SamplingVariogram.html#cb510-4" aria-hidden="true" tabindex="-1"></a>pnt2 <span class="ot">&lt;-</span> allpairs[, <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>)]</span>
<span id="cb510-5"><a href="SamplingVariogram.html#cb510-5" aria-hidden="true" tabindex="-1"></a><span class="fu">coordinates</span>(pnt2) <span class="ot">&lt;-</span> <span class="er">~</span> s1 <span class="sc">+</span> s2</span>
<span id="cb510-6"><a href="SamplingVariogram.html#cb510-6" aria-hidden="true" tabindex="-1"></a>z2 <span class="ot">&lt;-</span> <span class="fu">over</span>(<span class="at">x =</span> pnt2, <span class="at">y =</span> grdHunterValley)[<span class="dv">4</span>]</span>
<span id="cb510-7"><a href="SamplingVariogram.html#cb510-7" aria-hidden="true" tabindex="-1"></a>mysample <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">h =</span> <span class="fu">rep</span>(h, <span class="at">each =</span> n), z1, z2)</span>
<span id="cb510-8"><a href="SamplingVariogram.html#cb510-8" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(mysample)[<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>)] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;z1&quot;</span>, <span class="st">&quot;z2&quot;</span>)</span></code></pre></div>
<p>The semivariances for the chosen separation distances are estimated as well as the variance of these estimated semivariances.</p>
<div class="sourceCode" id="cb511"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb511-1"><a href="SamplingVariogram.html#cb511-1" aria-hidden="true" tabindex="-1"></a>gammah <span class="ot">&lt;-</span> vgammah <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="at">length =</span> <span class="fu">length</span>(h))</span>
<span id="cb511-2"><a href="SamplingVariogram.html#cb511-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">length</span>(h))) {</span>
<span id="cb511-3"><a href="SamplingVariogram.html#cb511-3" aria-hidden="true" tabindex="-1"></a>  units <span class="ot">&lt;-</span> <span class="fu">which</span>(mysample<span class="sc">$</span>h <span class="sc">==</span> h[i])</span>
<span id="cb511-4"><a href="SamplingVariogram.html#cb511-4" aria-hidden="true" tabindex="-1"></a>  pairsh <span class="ot">&lt;-</span> mysample[units, ]</span>
<span id="cb511-5"><a href="SamplingVariogram.html#cb511-5" aria-hidden="true" tabindex="-1"></a>  gammah[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>((pairsh<span class="sc">$</span>z1 <span class="sc">-</span> pairsh<span class="sc">$</span>z2)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb511-6"><a href="SamplingVariogram.html#cb511-6" aria-hidden="true" tabindex="-1"></a>  vgammah[i] <span class="ot">&lt;-</span> <span class="fu">var</span>((pairsh<span class="sc">$</span>z1 <span class="sc">-</span> pairsh<span class="sc">$</span>z2)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> (n <span class="sc">*</span> <span class="dv">4</span>)</span>
<span id="cb511-7"><a href="SamplingVariogram.html#cb511-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>A spherical model with nugget is fitted to the sample semivariogram, using function <code>nls</code>, with weights equal to the reciprocal of the estimated variances of the estimated semivariances.</p>
<div class="sourceCode" id="cb512"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb512-1"><a href="SamplingVariogram.html#cb512-1" aria-hidden="true" tabindex="-1"></a>samplevariogram <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(h, gammah, vgammah)</span>
<span id="cb512-2"><a href="SamplingVariogram.html#cb512-2" aria-hidden="true" tabindex="-1"></a>SphNug <span class="ot">&lt;-</span> <span class="cf">function</span>(h, range, psill, nugget) {</span>
<span id="cb512-3"><a href="SamplingVariogram.html#cb512-3" aria-hidden="true" tabindex="-1"></a>  h <span class="ot">&lt;-</span> h <span class="sc">/</span> range</span>
<span id="cb512-4"><a href="SamplingVariogram.html#cb512-4" aria-hidden="true" tabindex="-1"></a>  nugget <span class="sc">+</span> psill <span class="sc">*</span> <span class="fu">ifelse</span>(h <span class="sc">&lt;</span> <span class="dv">1</span>, (<span class="fl">1.5</span> <span class="sc">*</span> h <span class="sc">-</span> <span class="fl">0.5</span> <span class="sc">*</span> h<span class="sc">^</span><span class="dv">3</span>), <span class="dv">1</span>)</span>
<span id="cb512-5"><a href="SamplingVariogram.html#cb512-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb512-6"><a href="SamplingVariogram.html#cb512-6" aria-hidden="true" tabindex="-1"></a>fit.var <span class="ot">&lt;-</span> <span class="fu">nls</span>(gammah <span class="sc">~</span> <span class="fu">SphNug</span>(h, range, psill, nugget),</span>
<span id="cb512-7"><a href="SamplingVariogram.html#cb512-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> samplevariogram, <span class="at">start =</span> <span class="fu">list</span>(<span class="at">psill =</span> <span class="dv">4</span>, <span class="at">range =</span> <span class="dv">200</span>, <span class="at">nugget =</span> <span class="dv">1</span>),</span>
<span id="cb512-8"><a href="SamplingVariogram.html#cb512-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">weights =</span> <span class="dv">1</span> <span class="sc">/</span> vgammah, <span class="at">algorithm =</span> <span class="st">&quot;port&quot;</span>, <span class="at">lower =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb512-9"><a href="SamplingVariogram.html#cb512-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pars <span class="ot">&lt;-</span> <span class="fu">signif</span>(<span class="fu">coef</span>(fit.var), <span class="dv">3</span>))</span></code></pre></div>
<pre><code> psill  range nugget 
  3.29 188.00   1.21 </code></pre>
<p>Figure <a href="SamplingVariogram.html#fig:variogramCTI">24.4</a> shows the sample semivariogram and the fitted model.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:variogramCTI"></span>
<img src="SpatialSampling_files/figure-html/variogramCTI-1.png" alt="Sample semivariogram, obtained by independent sampling of pairs of points, and fitted spherical model of compount topographic index in Hunter Valley." width="80%" />
<p class="caption">
Figure 24.4: Sample semivariogram, obtained by independent sampling of pairs of points, and fitted spherical model of compount topographic index in Hunter Valley.
</p>
</div>
<p>The covariances of the estimated semivariances at different separation distances are zero, as the point-pairs are selected independently. This keeps estimation of the variances and covariances of the estimated semivariogram parameters simple. In the next code chunk this is done by bootstrapping.</p>
<p>In bootstrapping for each separation distance a simple random sample <em>with replacement</em> of point-pairs is selected from the original sample of point-pairs. A point-pair can be selected more than once. The sample size (number of draws) is equal to the total number of point-pairs per separation distance in the original sample.</p>
<p>Every run of the bootstrap results in as many bootstrap samples as there are separation distances. The bootstrap samples are used to fit a semivariogram model. The whole procedure is repeated 500 times, resulting in 500 vectors with model parameters. These vectors can be used to estimate the variances and covariances of the estimators of the three semivariogram parameters.</p>
<div class="sourceCode" id="cb514"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb514-1"><a href="SamplingVariogram.html#cb514-1" aria-hidden="true" tabindex="-1"></a>allpars <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb514-2"><a href="SamplingVariogram.html#cb514-2" aria-hidden="true" tabindex="-1"></a>R <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb514-3"><a href="SamplingVariogram.html#cb514-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>R) {</span>
<span id="cb514-4"><a href="SamplingVariogram.html#cb514-4" aria-hidden="true" tabindex="-1"></a>  gammah <span class="ot">&lt;-</span> vgammah <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="at">length =</span> <span class="fu">length</span>(h))</span>
<span id="cb514-5"><a href="SamplingVariogram.html#cb514-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">length</span>(h))) {</span>
<span id="cb514-6"><a href="SamplingVariogram.html#cb514-6" aria-hidden="true" tabindex="-1"></a>    units <span class="ot">&lt;-</span> <span class="fu">which</span>(mysample<span class="sc">$</span>h <span class="sc">==</span> h[i])</span>
<span id="cb514-7"><a href="SamplingVariogram.html#cb514-7" aria-hidden="true" tabindex="-1"></a>    pairs <span class="ot">&lt;-</span> mysample[units, ]</span>
<span id="cb514-8"><a href="SamplingVariogram.html#cb514-8" aria-hidden="true" tabindex="-1"></a>    ids <span class="ot">&lt;-</span> <span class="fu">sample</span>(n, <span class="at">size =</span> n, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb514-9"><a href="SamplingVariogram.html#cb514-9" aria-hidden="true" tabindex="-1"></a>    mybtps <span class="ot">&lt;-</span> pairs[ids, ]</span>
<span id="cb514-10"><a href="SamplingVariogram.html#cb514-10" aria-hidden="true" tabindex="-1"></a>    gammah[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>((mybtps<span class="sc">$</span>z1 <span class="sc">-</span> mybtps<span class="sc">$</span>z2)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb514-11"><a href="SamplingVariogram.html#cb514-11" aria-hidden="true" tabindex="-1"></a>    vgammah[i] <span class="ot">&lt;-</span> <span class="fu">var</span>((mybtps<span class="sc">$</span>z1 <span class="sc">-</span> mybtps<span class="sc">$</span>z2)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> (n <span class="sc">*</span> <span class="dv">4</span>)</span>
<span id="cb514-12"><a href="SamplingVariogram.html#cb514-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb514-13"><a href="SamplingVariogram.html#cb514-13" aria-hidden="true" tabindex="-1"></a>  samplevariogram <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(h, gammah, vgammah)</span>
<span id="cb514-14"><a href="SamplingVariogram.html#cb514-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tryCatch</span>({</span>
<span id="cb514-15"><a href="SamplingVariogram.html#cb514-15" aria-hidden="true" tabindex="-1"></a>    fittedvariogram <span class="ot">&lt;-</span> <span class="fu">nls</span>(gammah <span class="sc">~</span> <span class="fu">SphNug</span>(h, range, psill, nugget),</span>
<span id="cb514-16"><a href="SamplingVariogram.html#cb514-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> samplevariogram, <span class="at">start =</span> <span class="fu">list</span>(<span class="at">psill =</span> <span class="dv">4</span>, <span class="at">range =</span> <span class="dv">200</span>, <span class="at">nugget =</span> <span class="dv">1</span>),</span>
<span id="cb514-17"><a href="SamplingVariogram.html#cb514-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">weights =</span> <span class="dv">1</span> <span class="sc">/</span> vgammah, <span class="at">algorithm =</span> <span class="st">&quot;port&quot;</span>, <span class="at">lower =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb514-18"><a href="SamplingVariogram.html#cb514-18" aria-hidden="true" tabindex="-1"></a>  pars <span class="ot">&lt;-</span> <span class="fu">coef</span>(fittedvariogram)</span>
<span id="cb514-19"><a href="SamplingVariogram.html#cb514-19" aria-hidden="true" tabindex="-1"></a>  allpars <span class="ot">&lt;-</span> <span class="fu">rbind</span>(allpars, pars)}, <span class="at">error =</span> <span class="cf">function</span>(e) {})</span>
<span id="cb514-20"><a href="SamplingVariogram.html#cb514-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb514-21"><a href="SamplingVariogram.html#cb514-21" aria-hidden="true" tabindex="-1"></a><span class="co">#compute variance-covariance matrix</span></span>
<span id="cb514-22"><a href="SamplingVariogram.html#cb514-22" aria-hidden="true" tabindex="-1"></a><span class="fu">signif</span>(<span class="fu">var</span>(allpars), <span class="dv">3</span>)</span></code></pre></div>
<pre><code>         psill   range  nugget
psill    1.160   -44.6  -0.803
range  -44.600 66700.0 172.000
nugget  -0.803   172.0   1.070</code></pre>
<p>Note the large variance for the range parameter (the standard deviation is 258 m) as well as the negative covariance of the nugget and the partial sill parameter (the Pearson correlation coefficient is -0.72). Histograms of the three estimated semivariogram parameters are shown in Figure <a href="SamplingVariogram.html#fig:histogramsvariogramparameters">24.5</a>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:histogramsvariogramparameters"></span>
<img src="SpatialSampling_files/figure-html/histogramsvariogramparameters-1.png" alt="Frequency distributions  of estimated parameters of a spherical semivariogram of compound topographic index in Hunter Valley." width="100%" />
<p class="caption">
Figure 24.5: Frequency distributions of estimated parameters of a spherical semivariogram of compound topographic index in Hunter Valley.
</p>
</div>

<div class="rmdnote">
<span class="citation"><a href="#ref-Marcelli2019" role="doc-biblioref">Marcelli, Corona, and Fattorini</a> (<a href="#ref-Marcelli2019" role="doc-biblioref">2019</a>)</span> show how a probability sample of <em>points</em> (instead of pairs of points) can be used in design-based estimation of the semivariogram. From the <span class="math inline">\(n\)</span> randomly selected points all <span class="math inline">\(n(n-1)/2\)</span> point-pairs are constructed. The <em>second-order inclusion probabilities</em> of these point-pairs are used to estimate the mean semivariance for separation distance classes. This sampling strategy makes better use of the data and is therefore potentially more efficient than IPP sampling.
</div>
<div id="exercises-32" class="section level4 unnumbered">
<h4>Exercises</h4>
<ol start="2" style="list-style-type: decimal">
<li>Write an <strong>R</strong> script to select simple random samples of pairs of points for estimating the semivariogram of cti in Hunter Valley. Use as separation distances 25, 50, 100, 200, and 400 m. Note that these separation distances are smaller than those used above. Select 100 pairs per separation distance.
<ul>
<li>Compute the sample semivariogram, and estimate a spherical model with nugget using function <code>nls</code>.</li>
<li>Compare the estimated semivariogram parameters with the estimates obtained with the larger separation distances.</li>
<li>Estimate the variance-covariance matrix of the estimated semivariogram parameters by bootstrapping.</li>
<li>Compare the variances of the estimated semivariogram parameters with the variances obtained with the larger separation distances. Which variance is changed most?</li>
</ul></li>
</ol>
</div>
</div>
<div id="samplingforvariogram" class="section level2" number="24.3">
<h2><span class="header-section-number">24.3</span> Optimisation of sampling pattern for semivariogram estimation</h2>
<p>There is rich literature on model-based optimisation of the sampling locations for semivariogram estimation. Several design criteria (minimisation criteria) have been proposed for optimising the sampling pattern. Various authors have proposed a measure of the uncertainty about the semivariogram parameters as a minimisation criterion. These criteria are described and illustrated in the next subsection. The kriging variance is sensitive to errors in the estimated semivariogram. Therefore <span class="citation"><a href="#ref-lar02" role="doc-biblioref">Lark</a> (<a href="#ref-lar02" role="doc-biblioref">2002</a>)</span> proposed to use a measure of the uncertainty about the kriging variance as a minimisation criterion (Subsection <a href="SamplingVariogram.html#UncertainKrigingVariance">24.3.2</a>).</p>
<div id="UncertainSemivariogramParameters" class="section level3" number="24.3.1">
<h3><span class="header-section-number">24.3.1</span> Uncertainty about semivariogram parameters</h3>
<p><span class="citation"><a href="#ref-mul99" role="doc-biblioref">Müller and Zimmerman</a> (<a href="#ref-mul99" role="doc-biblioref">1999</a>)</span> as well as <span class="citation"><a href="#ref-bog99" role="doc-biblioref">Bogaert and Russo</a> (<a href="#ref-bog99" role="doc-biblioref">1999</a>)</span> proposed the determinant of the variance-covariance matrix of semivariogram parameters, estimated by generalised least squares to fit the MoM sample semivariogram. For instance, if we have two semivariogram parameters, <span class="math inline">\(\theta_1\)</span> and <span class="math inline">\(\theta_2\)</span>, the determinant of the 2 <span class="math inline">\(\times\)</span> 2 variance-covariance matrix equals the sum of the variances of the two estimated parameters minus two times the covariance of the two estimated parameters. If the two estimated parameters are positively correlated, the determinant of the matrix is smaller than if they are uncorrelated, and the covariance term is zero. The determinant is a measure of our <em>joint</em> uncertainty about the semivariogram parameters.</p>
<p><span class="citation"><a href="#ref-zhu05" role="doc-biblioref">Zhu and Stein</a> (<a href="#ref-zhu05" role="doc-biblioref">2005</a>)</span> proposed as a minimisation criterion the log of the determinant of the inverse Fisher information matrix in ML estimation of the semivariogram, hereafter shortly denoted by logdet. The Fisher information about a semivariogram parameter is a function of the likelihood of the semivariogram parameter; the likelihood of a semivariogram parameter is the probability of the data as a function of the semivariogram parameter. The log of this likelihood can be plotted against values of the parameter. The flatter the log-likelihood surface, the less information is in the data about the parameter. The flatness of the surface can be measured by the first derivative of the log-likelihood to the semivariogram parameter. Strong negative or positive derivative values indicate a steep surface. The Fisher information for a model parameter is defined as the expectation of the <em>square</em> of the first derivative of the log-likelihood to that semivariogram parameter, see <span class="citation"><a href="#ref-Ly2017" role="doc-biblioref">Ly et al.</a> (<a href="#ref-Ly2017" role="doc-biblioref">2017</a>)</span> for a nice tutorial on this subject. The more information we have about a semivariogram, the less uncertain we are about that parameter. This explains why the inverse of the Fisher information can be used as a measure of uncertainty. The inverse Fisher information matrix contains the variances and covariances of the estimated semivariogram parameters.</p>
<p>The code chunks hereafter show how logdet can be computed. It makes use of the result of <span class="citation"><a href="#ref-Kitanidis87" role="doc-biblioref">Kitanidis</a> (<a href="#ref-Kitanidis87" role="doc-biblioref">1987</a>)</span> who showed that each element of the Fisher information matrix <span class="math inline">\(\mathbf{I}(\theta)\)</span> can be obtained with (see also <span class="citation"><a href="#ref-lar02" role="doc-biblioref">Lark</a> (<a href="#ref-lar02" role="doc-biblioref">2002</a>)</span>)</p>
<p><span class="math display" id="eq:FisherInformation">\[\begin{equation}
[\mathbf{I}(\theta)]_{ij}=\frac{1}{2}\mathrm{Tr}\left[\mathbf{A}^{-1}\frac{\partial\mathbf{A}}{\partial\theta_i}\mathbf{A}^{-1}\frac{\partial\mathbf{A}}{\partial\theta_j}\right]\;,
\tag{24.2}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(\mathbf{A}\)</span> the correlation matrix of the sampling points, <span class="math inline">\(\frac{\partial\mathbf{A}}{\partial\theta_i}\)</span> the partial derivative of the correlation matrix to the <span class="math inline">\(i\)</span>th semivariogram parameter, and Tr[<span class="math inline">\(\cdot\)</span>] the trace of a matrix.</p>
<p>As an illustration I selected a simple random sample of 100 points from Hunter Valley. A matrix with distances between the points of a sample is computed. Preliminary values for the semivariogram parameters <span class="math inline">\(\xi\)</span> (ratio of spatial dependence) and <span class="math inline">\(\phi\)</span> (distance parameter) are obtained by visual inspection of the sample semivariogram, and the <strong>gstat</strong> <span class="citation">(<a href="#ref-peb04" role="doc-biblioref">E. J. Pebesma 2004</a>)</span> function <code>variogramLine</code> is used to compute the correlation matrix.</p>
<div class="sourceCode" id="cb516"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb516-1"><a href="SamplingVariogram.html#cb516-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb516-2"><a href="SamplingVariogram.html#cb516-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gstat)</span>
<span id="cb516-3"><a href="SamplingVariogram.html#cb516-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb516-4"><a href="SamplingVariogram.html#cb516-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">314</span>)</span>
<span id="cb516-5"><a href="SamplingVariogram.html#cb516-5" aria-hidden="true" tabindex="-1"></a>units <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(grdHunterValley), n)</span>
<span id="cb516-6"><a href="SamplingVariogram.html#cb516-6" aria-hidden="true" tabindex="-1"></a>mysample0 <span class="ot">&lt;-</span> grdHunterValley[units, ]</span>
<span id="cb516-7"><a href="SamplingVariogram.html#cb516-7" aria-hidden="true" tabindex="-1"></a><span class="fu">coordinates</span>(mysample0) <span class="ot">&lt;-</span> <span class="er">~</span> s1 <span class="sc">+</span> s2</span>
<span id="cb516-8"><a href="SamplingVariogram.html#cb516-8" aria-hidden="true" tabindex="-1"></a>D <span class="ot">&lt;-</span> <span class="fu">spDists</span>(mysample0)</span>
<span id="cb516-9"><a href="SamplingVariogram.html#cb516-9" aria-hidden="true" tabindex="-1"></a>xi <span class="ot">&lt;-</span> <span class="fl">0.8</span>; phi <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb516-10"><a href="SamplingVariogram.html#cb516-10" aria-hidden="true" tabindex="-1"></a>thetas <span class="ot">&lt;-</span> <span class="fu">c</span>(xi, phi)</span>
<span id="cb516-11"><a href="SamplingVariogram.html#cb516-11" aria-hidden="true" tabindex="-1"></a>vgmodel <span class="ot">&lt;-</span> <span class="fu">vgm</span>(<span class="at">model =</span> <span class="st">&quot;Exp&quot;</span>, <span class="at">psill =</span> thetas[<span class="dv">1</span>],</span>
<span id="cb516-12"><a href="SamplingVariogram.html#cb516-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">range =</span> thetas[<span class="dv">2</span>], <span class="at">nugget =</span> <span class="dv">1</span> <span class="sc">-</span> thetas[<span class="dv">1</span>])</span>
<span id="cb516-13"><a href="SamplingVariogram.html#cb516-13" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">variogramLine</span>(vgmodel, <span class="at">dist_vector =</span> D, <span class="at">covariance =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>In the next step the semivariogram parameters are slightly changed one-by-one. The changes, referred to as perturbations, are a small fraction of the preliminary semivariogram parameter values. The perturbed semivariogram parameters are used to compute the perturbed correlation matrices (<code>pA</code>) and the partial derivatives of the correlation matrix (<code>dA</code>) for each perturbation.</p>
<div class="sourceCode" id="cb517"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb517-1"><a href="SamplingVariogram.html#cb517-1" aria-hidden="true" tabindex="-1"></a>perturbation <span class="ot">&lt;-</span> <span class="fl">0.01</span></span>
<span id="cb517-2"><a href="SamplingVariogram.html#cb517-2" aria-hidden="true" tabindex="-1"></a>pA <span class="ot">&lt;-</span> dA <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb517-3"><a href="SamplingVariogram.html#cb517-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">length</span>(thetas))) {</span>
<span id="cb517-4"><a href="SamplingVariogram.html#cb517-4" aria-hidden="true" tabindex="-1"></a>  thetas_pert <span class="ot">&lt;-</span> thetas</span>
<span id="cb517-5"><a href="SamplingVariogram.html#cb517-5" aria-hidden="true" tabindex="-1"></a>  thetas_pert[i] <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> perturbation) <span class="sc">*</span> thetas[i]</span>
<span id="cb517-6"><a href="SamplingVariogram.html#cb517-6" aria-hidden="true" tabindex="-1"></a>  vgmodel_pert <span class="ot">&lt;-</span> <span class="fu">vgm</span>(<span class="at">model =</span> <span class="st">&quot;Exp&quot;</span>, <span class="at">psill =</span> thetas_pert[<span class="dv">1</span>],</span>
<span id="cb517-7"><a href="SamplingVariogram.html#cb517-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">range =</span> thetas_pert[<span class="dv">2</span>], <span class="at">nugget =</span> <span class="dv">1</span> <span class="sc">-</span> thetas_pert[<span class="dv">1</span>])</span>
<span id="cb517-8"><a href="SamplingVariogram.html#cb517-8" aria-hidden="true" tabindex="-1"></a>  pA[[i]] <span class="ot">&lt;-</span> <span class="fu">variogramLine</span>(vgmodel_pert, <span class="at">dist_vector =</span> D, <span class="at">covariance =</span> <span class="cn">TRUE</span>)</span>
<span id="cb517-9"><a href="SamplingVariogram.html#cb517-9" aria-hidden="true" tabindex="-1"></a>  dA[[i]] <span class="ot">&lt;-</span> (pA[[i]] <span class="sc">-</span> A) <span class="sc">/</span> (thetas[i] <span class="sc">*</span> perturbation)</span>
<span id="cb517-10"><a href="SamplingVariogram.html#cb517-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Finally, the Fisher information matrix is computed using Equation <a href="SamplingVariogram.html#eq:FisherInformation">(24.2)</a>. We do not need to compute the inverse of the Fisher information matrix, because the determinant of the inverse of a matrix is equal to the inverse of the determinant of the (not inverted) matrix. The determinant is computed with function <code>determinant</code>.</p>
<div class="sourceCode" id="cb518"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb518-1"><a href="SamplingVariogram.html#cb518-1" aria-hidden="true" tabindex="-1"></a>I <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="fu">length</span>(thetas), <span class="fu">length</span>(thetas))</span>
<span id="cb518-2"><a href="SamplingVariogram.html#cb518-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">length</span>(thetas))) {</span>
<span id="cb518-3"><a href="SamplingVariogram.html#cb518-3" aria-hidden="true" tabindex="-1"></a>  m_i <span class="ot">&lt;-</span> <span class="fu">solve</span>(A, dA[[i]])</span>
<span id="cb518-4"><a href="SamplingVariogram.html#cb518-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> i<span class="sc">:</span><span class="fu">length</span>(thetas)) {</span>
<span id="cb518-5"><a href="SamplingVariogram.html#cb518-5" aria-hidden="true" tabindex="-1"></a>    m_j <span class="ot">&lt;-</span> <span class="fu">solve</span>(A, dA[[j]])</span>
<span id="cb518-6"><a href="SamplingVariogram.html#cb518-6" aria-hidden="true" tabindex="-1"></a>    I[i, j] <span class="ot">&lt;-</span> I[j, i] <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="sc">*</span> <span class="fu">sum</span>(<span class="fu">diag</span>(m_i <span class="sc">%*%</span> m_j))</span>
<span id="cb518-7"><a href="SamplingVariogram.html#cb518-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb518-8"><a href="SamplingVariogram.html#cb518-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb518-9"><a href="SamplingVariogram.html#cb518-9" aria-hidden="true" tabindex="-1"></a>logdet0 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">determinant</span>(I, <span class="at">logarithm =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>modulus</span></code></pre></div>
<p>The joint uncertainty about the semivariogram parameters, as quantified by the log of the determinant of the inverse of the information matrix, equals 6.286. Hereafter we will see how much this joint uncertainty can be reduced by optimising the spatial pattern of the sample used for semivariogram estimation, compared to the simple random sample used in the above calculation. Note that a preliminary semivariogram is needed to compute an optimised sampling pattern for semivariogram estimation.</p>
<p>Function <code>optimUSER</code> of package <strong>spsann</strong> can be used to search for the sampling locations with the minimum value of logdet. This function has been used before in Section <a href="MBSamplePattern.html#SamplePatternOK">23.2</a>. Package <strong>spsann</strong> cannot deal with the 22,124 candidate grid nodes of Hunter Valley; these are too many. I therefore selected a subgrid of 50 m <span class="math inline">\(\times\)</span> 50 m.</p>
<p>The sample size for estimation of the semivariogram is passed to function <code>optimUSER</code> with argument <code>points</code>. A simple random sample of size 100 is used as an initial sample (but this is not the simple random sample used above to illustrate the computations). The objective function to be minimised is passed to function <code>optimUSER</code> with argument <code>fun</code>. The objective function <code>logdet</code> is defined in package <strong>sswr</strong>. Argument <code>model</code> specifies the model <em>type</em>, using the characters of <strong>gstat</strong>. Argument <code>thetas</code> specifies the preliminary semivariogram parameter values. Argument <code>perturbation</code> specifies how much the semivariogram parameters are changed to compute the perturbed correlation matrices (<code>pA</code>) and the partial derivatives of the correlation matrix (<code>dA</code>).</p>
<div class="sourceCode" id="cb519"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb519-1"><a href="SamplingVariogram.html#cb519-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gridded</span>(grdHunterValley) <span class="ot">&lt;-</span> <span class="er">~</span> s1 <span class="sc">+</span> s2</span>
<span id="cb519-2"><a href="SamplingVariogram.html#cb519-2" aria-hidden="true" tabindex="-1"></a>candi <span class="ot">&lt;-</span> <span class="fu">spsample</span>(grdHunterValley, <span class="at">type =</span> <span class="st">&quot;regular&quot;</span>,</span>
<span id="cb519-3"><a href="SamplingVariogram.html#cb519-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">cellsize =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">50</span>), <span class="at">offset =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>))</span>
<span id="cb519-4"><a href="SamplingVariogram.html#cb519-4" aria-hidden="true" tabindex="-1"></a>candi <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(candi)</span>
<span id="cb519-5"><a href="SamplingVariogram.html#cb519-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(candi) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>)</span>
<span id="cb519-6"><a href="SamplingVariogram.html#cb519-6" aria-hidden="true" tabindex="-1"></a>schedule <span class="ot">&lt;-</span> <span class="fu">scheduleSPSANN</span>(</span>
<span id="cb519-7"><a href="SamplingVariogram.html#cb519-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">initial.acceptance =</span> <span class="fl">0.8</span>,</span>
<span id="cb519-8"><a href="SamplingVariogram.html#cb519-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">initial.temperature =</span> <span class="fl">0.03</span>, <span class="at">temperature.decrease =</span> <span class="fl">0.9</span>,</span>
<span id="cb519-9"><a href="SamplingVariogram.html#cb519-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">500</span>, <span class="at">chain.length =</span> <span class="dv">2</span>, <span class="at">stopping =</span> <span class="dv">10</span>,</span>
<span id="cb519-10"><a href="SamplingVariogram.html#cb519-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">x.min =</span> <span class="dv">0</span>, <span class="at">y.min =</span> <span class="dv">0</span>, <span class="at">cellsize =</span> <span class="dv">50</span>)</span>
<span id="cb519-11"><a href="SamplingVariogram.html#cb519-11" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">314</span>)</span>
<span id="cb519-12"><a href="SamplingVariogram.html#cb519-12" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">optimUSER</span>(</span>
<span id="cb519-13"><a href="SamplingVariogram.html#cb519-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">points =</span> <span class="dv">100</span>, <span class="at">candi =</span> candi,</span>
<span id="cb519-14"><a href="SamplingVariogram.html#cb519-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">fun =</span> logdet,</span>
<span id="cb519-15"><a href="SamplingVariogram.html#cb519-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> <span class="st">&quot;Exp&quot;</span>, <span class="at">thetas =</span> thetas, <span class="at">perturbation =</span> <span class="fl">0.01</span>,</span>
<span id="cb519-16"><a href="SamplingVariogram.html#cb519-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">schedule =</span> schedule, <span class="at">track =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>Figure <a href="SamplingVariogram.html#fig:MBVariogram">24.6</a> shows the optimised sampling pattern of 100 points. The logdet of the optimised sample equals 2.219 which is 35% of the value of the simple random sample used above to illustrate the computations. The optimised sample shows strong spatial clustering. Connecting neighbouring points of the sample by lines yields a sort of mycelium. Remarkably, there is one isolated point. Besides, there are quite a few pairs of points at very short distance.</p>
</div>
<div id="UncertainKrigingVariance" class="section level3" number="24.3.2">
<h3><span class="header-section-number">24.3.2</span> Uncertainty about the kriging variance</h3>
<p><span class="citation"><a href="#ref-lar02" role="doc-biblioref">Lark</a> (<a href="#ref-lar02" role="doc-biblioref">2002</a>)</span> proposed as a minimisation criterion the estimation variance of the kriging variance (VKV) due to uncertainty in the ML estimates of the semivariogram parameters. This variance is approximated by a first order Taylor series, requiring the partial derivatives of the kriging variance with respect to the semivariogram parameters:</p>
<p><span class="math display" id="eq:varkrigingvar">\[\begin{equation}
VKV(\mathbf{s}_0) = \sum_{i=1}^p \sum_{j=1}^p \mathrm{Cov}(\theta_i,\theta_j) \frac{\partial V_{\mathrm{OK}}(\mathbf{s}_0)} {\partial \theta_i} \frac{\partial V_{\mathrm{OK}}(\mathbf{s}_0)} {\partial \theta_j}\;,
\tag{24.3}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(p\)</span> the number of semivariogram parameters, <span class="math inline">\(\mathrm{Cov}(\theta_i,\theta_j)\)</span> the covariances of the semivariogram parameters <span class="math inline">\(\theta_i\)</span> and <span class="math inline">\(\theta_j\)</span> (elements of the inverse of the Fisher information matrix <span class="math inline">\(\mathbf{I}^{-1}(\pmb{\theta})\)</span>, Equation <a href="SamplingVariogram.html#eq:FisherInformation">(24.2)</a>), and <span class="math inline">\(\frac{\partial V_{\mathrm{OK}}(\mathbf{s}_0)} {\partial \theta_i}\)</span> the partial derivative of the kriging variance to the <span class="math inline">\(i\)</span>th semivariogram parameter at prediction location <span class="math inline">\(\mathbf{s}_0\)</span>.</p>
<p>The first step in designing a sample for semivariogram estimation using VKV as a minimisation criterion is to select a sample for the second sampling round. In the code chunk below a spatial coverage sample is selected, using function <code>stratify</code> of package <strong>spcosa</strong>, see Section <a href="RegularGridSpatialCoverage.html#SpatialCoverage">17.2</a>. Once the observations of this sample are collected in the second sampling round, these data are used for mapping by ordinary kriging.</p>
<p>To optimise the sampling pattern of the first sampling round for variogram estimation, the population mean of VKV (MVKV) is used as a minimisation criterion. This population mean is estimated from a centred, square grid of 101 points, the evaluation sample. (In the code chunk below <code>n = 100</code> is used in function <code>spsample</code>, but actually 101 locations are selected.)</p>
<div class="sourceCode" id="cb520"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb520-1"><a href="SamplingVariogram.html#cb520-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spcosa)</span>
<span id="cb520-2"><a href="SamplingVariogram.html#cb520-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gridded</span>(grdHunterValley) <span class="ot">&lt;-</span> <span class="er">~</span> s1 <span class="sc">+</span> s2</span>
<span id="cb520-3"><a href="SamplingVariogram.html#cb520-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb520-4"><a href="SamplingVariogram.html#cb520-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">314</span>)</span>
<span id="cb520-5"><a href="SamplingVariogram.html#cb520-5" aria-hidden="true" tabindex="-1"></a>myStrata <span class="ot">&lt;-</span> <span class="fu">stratify</span>(grdHunterValley, <span class="at">nStrata =</span> n, <span class="at">equalArea =</span> <span class="cn">FALSE</span>, <span class="at">nTry =</span> <span class="dv">10</span>)</span>
<span id="cb520-6"><a href="SamplingVariogram.html#cb520-6" aria-hidden="true" tabindex="-1"></a>mySCsample <span class="ot">&lt;-</span> <span class="fu">as</span>(<span class="fu">spsample</span>(myStrata), <span class="st">&quot;SpatialPoints&quot;</span>)</span>
<span id="cb520-7"><a href="SamplingVariogram.html#cb520-7" aria-hidden="true" tabindex="-1"></a>myevalsample <span class="ot">&lt;-</span> <span class="fu">spsample</span>(</span>
<span id="cb520-8"><a href="SamplingVariogram.html#cb520-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> grdHunterValley, <span class="at">n =</span> <span class="dv">100</span>, <span class="at">type =</span> <span class="st">&quot;regular&quot;</span>, <span class="at">offset =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>))</span></code></pre></div>
<p>The following code chunks show how VKV at the evaluation point is computed. First, the correlation matrix of the spatial coverage sample (<code>A</code>) is computed as well as the correlation matrix of the spatial coverage sample and the evaluation points (<code>A0</code>). Correlation matrix <code>A</code> is extended with a column and a row with ones, see Equation <a href="Introkriging.html#eq:krigingeqsmatrix">(21.5)</a>.</p>
<div class="sourceCode" id="cb521"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb521-1"><a href="SamplingVariogram.html#cb521-1" aria-hidden="true" tabindex="-1"></a>D <span class="ot">&lt;-</span> <span class="fu">spDists</span>(mySCsample)</span>
<span id="cb521-2"><a href="SamplingVariogram.html#cb521-2" aria-hidden="true" tabindex="-1"></a>vgmodel <span class="ot">&lt;-</span> <span class="fu">vgm</span>(<span class="at">model =</span> <span class="st">&quot;Exp&quot;</span>, <span class="at">psill =</span> thetas[<span class="dv">1</span>], <span class="at">range =</span> thetas[<span class="dv">2</span>],</span>
<span id="cb521-3"><a href="SamplingVariogram.html#cb521-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">nugget =</span> <span class="dv">1</span> <span class="sc">-</span> thetas[<span class="dv">1</span>])</span>
<span id="cb521-4"><a href="SamplingVariogram.html#cb521-4" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">variogramLine</span>(vgmodel, <span class="at">dist_vector =</span> D, <span class="at">covariance =</span> <span class="cn">TRUE</span>)</span>
<span id="cb521-5"><a href="SamplingVariogram.html#cb521-5" aria-hidden="true" tabindex="-1"></a>nobs <span class="ot">&lt;-</span> <span class="fu">length</span>(mySCsample)</span>
<span id="cb521-6"><a href="SamplingVariogram.html#cb521-6" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="dv">0</span>, <span class="at">nrow =</span> nobs <span class="sc">+</span> <span class="dv">1</span>, <span class="at">ncol =</span> nobs <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb521-7"><a href="SamplingVariogram.html#cb521-7" aria-hidden="true" tabindex="-1"></a>B[<span class="dv">1</span><span class="sc">:</span>nobs, <span class="dv">1</span><span class="sc">:</span>nobs] <span class="ot">&lt;-</span> A</span>
<span id="cb521-8"><a href="SamplingVariogram.html#cb521-8" aria-hidden="true" tabindex="-1"></a>B[<span class="dv">1</span><span class="sc">:</span>nobs, nobs <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb521-9"><a href="SamplingVariogram.html#cb521-9" aria-hidden="true" tabindex="-1"></a>B[nobs <span class="sc">+</span> <span class="dv">1</span>, <span class="dv">1</span><span class="sc">:</span>nobs] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb521-10"><a href="SamplingVariogram.html#cb521-10" aria-hidden="true" tabindex="-1"></a>D0 <span class="ot">&lt;-</span> <span class="fu">spDists</span>(<span class="at">x =</span> myevalsample, <span class="at">y =</span> mySCsample)</span>
<span id="cb521-11"><a href="SamplingVariogram.html#cb521-11" aria-hidden="true" tabindex="-1"></a>A0 <span class="ot">&lt;-</span> <span class="fu">variogramLine</span>(vgmodel, <span class="at">dist_vector =</span> D0, <span class="at">covariance =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>Next, the semivariogram parameters are perturbed one-by-one, and the perturbed correlation matrices <code>pA</code> and <code>pA0</code> are computed.</p>
<div class="sourceCode" id="cb522"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb522-1"><a href="SamplingVariogram.html#cb522-1" aria-hidden="true" tabindex="-1"></a>pA  <span class="ot">&lt;-</span> pA0 <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb522-2"><a href="SamplingVariogram.html#cb522-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">length</span>(thetas))) {</span>
<span id="cb522-3"><a href="SamplingVariogram.html#cb522-3" aria-hidden="true" tabindex="-1"></a>  thetas_pert <span class="ot">&lt;-</span> thetas</span>
<span id="cb522-4"><a href="SamplingVariogram.html#cb522-4" aria-hidden="true" tabindex="-1"></a>  thetas_pert[i] <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> perturbation) <span class="sc">*</span> thetas[i]</span>
<span id="cb522-5"><a href="SamplingVariogram.html#cb522-5" aria-hidden="true" tabindex="-1"></a>  vgmodel_pert <span class="ot">&lt;-</span> <span class="fu">vgm</span>(<span class="at">model =</span> <span class="st">&quot;Exp&quot;</span>, <span class="at">psill =</span> thetas_pert[<span class="dv">1</span>],</span>
<span id="cb522-6"><a href="SamplingVariogram.html#cb522-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">range =</span> thetas_pert[<span class="dv">2</span>], <span class="at">nugget =</span> <span class="dv">1</span> <span class="sc">-</span> thetas_pert[<span class="dv">1</span>])</span>
<span id="cb522-7"><a href="SamplingVariogram.html#cb522-7" aria-hidden="true" tabindex="-1"></a>  pA[[i]] <span class="ot">&lt;-</span> <span class="fu">variogramLine</span>(vgmodel_pert, <span class="at">dist_vector =</span> D, <span class="at">covariance =</span> <span class="cn">TRUE</span>)</span>
<span id="cb522-8"><a href="SamplingVariogram.html#cb522-8" aria-hidden="true" tabindex="-1"></a>  pA0[[i]] <span class="ot">&lt;-</span> <span class="fu">variogramLine</span>(vgmodel_pert, <span class="at">dist_vector =</span> D0, <span class="at">covariance =</span> <span class="cn">TRUE</span>)</span>
<span id="cb522-9"><a href="SamplingVariogram.html#cb522-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb522-10"><a href="SamplingVariogram.html#cb522-10" aria-hidden="true" tabindex="-1"></a>pB <span class="ot">&lt;-</span> pb <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb522-11"><a href="SamplingVariogram.html#cb522-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">length</span>(thetas))) {</span>
<span id="cb522-12"><a href="SamplingVariogram.html#cb522-12" aria-hidden="true" tabindex="-1"></a>  pB[[i]] <span class="ot">&lt;-</span> B</span>
<span id="cb522-13"><a href="SamplingVariogram.html#cb522-13" aria-hidden="true" tabindex="-1"></a>  pB[[i]][<span class="dv">1</span><span class="sc">:</span>nobs, <span class="dv">1</span><span class="sc">:</span>nobs] <span class="ot">&lt;-</span> pA[[i]]</span>
<span id="cb522-14"><a href="SamplingVariogram.html#cb522-14" aria-hidden="true" tabindex="-1"></a>  pb[[i]] <span class="ot">&lt;-</span> <span class="fu">cbind</span>(pA0[[i]], <span class="dv">1</span>)</span>
<span id="cb522-15"><a href="SamplingVariogram.html#cb522-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Next, the kriging variance and the perturbed kriging variances are computed, and the partial derivatives of the kriging variance with respect to the semivariogram parameters are approximated. See Equations <a href="Introkriging.html#eq:krigingweights">(21.7)</a> and <a href="Introkriging.html#eq:OKvariance">(21.8)</a> for how the kriging weights <code>l</code> and the kriging variance <code>var</code> are computed.</p>
<div class="sourceCode" id="cb523"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb523-1"><a href="SamplingVariogram.html#cb523-1" aria-hidden="true" tabindex="-1"></a>var <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="at">length =</span> <span class="fu">length</span>(myevalsample))</span>
<span id="cb523-2"><a href="SamplingVariogram.html#cb523-2" aria-hidden="true" tabindex="-1"></a>pvar <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="fu">length</span>(myevalsample), <span class="at">ncol =</span> <span class="fu">length</span>(thetas))</span>
<span id="cb523-3"><a href="SamplingVariogram.html#cb523-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">length</span>(myevalsample))) {</span>
<span id="cb523-4"><a href="SamplingVariogram.html#cb523-4" aria-hidden="true" tabindex="-1"></a>  b <span class="ot">&lt;-</span> <span class="fu">c</span>(A0[i, ], <span class="dv">1</span>)</span>
<span id="cb523-5"><a href="SamplingVariogram.html#cb523-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#compute kriging weights and Lagrange multiplier</span></span>
<span id="cb523-6"><a href="SamplingVariogram.html#cb523-6" aria-hidden="true" tabindex="-1"></a>  l <span class="ot">&lt;-</span> <span class="fu">solve</span>(B, b)</span>
<span id="cb523-7"><a href="SamplingVariogram.html#cb523-7" aria-hidden="true" tabindex="-1"></a>  var[i] <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> l[<span class="dv">1</span><span class="sc">:</span>nobs] <span class="sc">%*%</span> A0[i, ] <span class="sc">-</span> l[nobs <span class="sc">+</span> <span class="dv">1</span>]</span>
<span id="cb523-8"><a href="SamplingVariogram.html#cb523-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">length</span>(thetas))) {</span>
<span id="cb523-9"><a href="SamplingVariogram.html#cb523-9" aria-hidden="true" tabindex="-1"></a>    pl <span class="ot">&lt;-</span> <span class="fu">solve</span>(pB[[j]], pb[[j]][i, ])</span>
<span id="cb523-10"><a href="SamplingVariogram.html#cb523-10" aria-hidden="true" tabindex="-1"></a>    pvar[i, j] <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> pl[<span class="dv">1</span><span class="sc">:</span>nobs] <span class="sc">%*%</span> pA0[[j]][i, ] <span class="sc">-</span> pl[nobs <span class="sc">+</span> <span class="dv">1</span>]</span>
<span id="cb523-11"><a href="SamplingVariogram.html#cb523-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb523-12"><a href="SamplingVariogram.html#cb523-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb523-13"><a href="SamplingVariogram.html#cb523-13" aria-hidden="true" tabindex="-1"></a>dvar <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb523-14"><a href="SamplingVariogram.html#cb523-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">length</span>(thetas))) {</span>
<span id="cb523-15"><a href="SamplingVariogram.html#cb523-15" aria-hidden="true" tabindex="-1"></a>  dvar[[i]] <span class="ot">&lt;-</span> (pvar[, i] <span class="sc">-</span> var) <span class="sc">/</span> (thetas[i] <span class="sc">*</span> perturbation)</span>
<span id="cb523-16"><a href="SamplingVariogram.html#cb523-16" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Finally, the partial derivatives of the kriging variance are used to approximate VKV at the 101 evaluation points (Equation <a href="SamplingVariogram.html#eq:varkrigingvar">(24.3)</a>). For this the variances and covariances of the estimated semivariogram parameters are needed, estimated by the inverse of the Fisher information matrix. The Fisher information matrix computed in Subsection <a href="SamplingVariogram.html#UncertainSemivariogramParameters">24.3.1</a> for the simple random sample of 100 points is also used here. I use the population mean of VKV (MVKV) as a minimisation criterion which is estimated by the average of the VKV values at the simple random sample of evaluation points.</p>
<!--Note that the variance-covariance matrix of estimated semivariogram parameters is computed from the sample for semivariogram estimation, not from the spatial coverage sample of the second sampling round used for prediction. -->
<div class="sourceCode" id="cb524"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb524-1"><a href="SamplingVariogram.html#cb524-1" aria-hidden="true" tabindex="-1"></a>invI <span class="ot">&lt;-</span> <span class="fu">solve</span>(I)</span>
<span id="cb524-2"><a href="SamplingVariogram.html#cb524-2" aria-hidden="true" tabindex="-1"></a>VKV <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="at">length =</span> <span class="fu">length</span>(var))</span>
<span id="cb524-3"><a href="SamplingVariogram.html#cb524-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">length</span>(thetas))) {</span>
<span id="cb524-4"><a href="SamplingVariogram.html#cb524-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">length</span>(thetas))) {</span>
<span id="cb524-5"><a href="SamplingVariogram.html#cb524-5" aria-hidden="true" tabindex="-1"></a>    VKVij <span class="ot">&lt;-</span> invI[i, j] <span class="sc">*</span> dvar[[i]] <span class="sc">*</span> dvar[[j]]</span>
<span id="cb524-6"><a href="SamplingVariogram.html#cb524-6" aria-hidden="true" tabindex="-1"></a>    VKV <span class="ot">&lt;-</span> VKV <span class="sc">+</span> VKVij</span>
<span id="cb524-7"><a href="SamplingVariogram.html#cb524-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb524-8"><a href="SamplingVariogram.html#cb524-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb524-9"><a href="SamplingVariogram.html#cb524-9" aria-hidden="true" tabindex="-1"></a>MVKV0 <span class="ot">&lt;-</span> <span class="fu">mean</span>(VKV)</span></code></pre></div>
<p>For the simple random sample the square root of MVKV equals 0.166. The mean kriging variance (MKV) at these points equals 0.768, so the uncertainty about the kriging variance is substantial. Hereafter we will see how much MVKV can be reduced by optimising the sampling pattern with spatial simulated annealing.</p>
<p>As for logdet, the sample with minimum value for MVKV can be searched for using <strong>spsann</strong> function <code>optimUSER</code>. The objective function <code>MVKV</code> is defined in package <strong>sswr</strong>. Argument <code>points</code> specifies the size of the sample for semivariogram estimation. A simple random sample of size 100 is used as an initial sample. Argument <code>psample</code> is used to specify the sample used for prediction at the evaluation points (after the second round of sampling). Argument <code>esample</code> is to specify the sample with evaluation points for estimating MVKV.</p>
<div class="sourceCode" id="cb525"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb525-1"><a href="SamplingVariogram.html#cb525-1" aria-hidden="true" tabindex="-1"></a>schedule <span class="ot">&lt;-</span> <span class="fu">scheduleSPSANN</span>(</span>
<span id="cb525-2"><a href="SamplingVariogram.html#cb525-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">initial.acceptance =</span> <span class="fl">0.8</span>,</span>
<span id="cb525-3"><a href="SamplingVariogram.html#cb525-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">initial.temperature =</span> <span class="fl">0.0004</span>, <span class="at">temperature.decrease =</span> <span class="fl">0.8</span>,</span>
<span id="cb525-4"><a href="SamplingVariogram.html#cb525-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">500</span>, <span class="at">chain.length =</span> <span class="dv">2</span>, <span class="at">stopping =</span> <span class="dv">10</span>,</span>
<span id="cb525-5"><a href="SamplingVariogram.html#cb525-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">x.min =</span> <span class="dv">0</span>, <span class="at">y.min =</span> <span class="dv">0</span>, <span class="at">cellsize =</span> <span class="dv">50</span>)</span>
<span id="cb525-6"><a href="SamplingVariogram.html#cb525-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">314</span>)</span>
<span id="cb525-7"><a href="SamplingVariogram.html#cb525-7" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">optimUSER</span>(</span>
<span id="cb525-8"><a href="SamplingVariogram.html#cb525-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">points =</span> <span class="dv">100</span>, <span class="at">candi =</span> candi,</span>
<span id="cb525-9"><a href="SamplingVariogram.html#cb525-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">fun =</span> MVKV,</span>
<span id="cb525-10"><a href="SamplingVariogram.html#cb525-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">psample =</span> mySCsample, <span class="at">esample =</span> myevalsample,</span>
<span id="cb525-11"><a href="SamplingVariogram.html#cb525-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> <span class="st">&quot;Exp&quot;</span>, <span class="at">thetas =</span> thetas,</span>
<span id="cb525-12"><a href="SamplingVariogram.html#cb525-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">perturbation =</span> <span class="fl">0.01</span>, <span class="at">schedule =</span> schedule, <span class="at">track =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>Figure <a href="SamplingVariogram.html#fig:MBVariogram">24.6</a> shows the optimised sample. The minimised value of MVKV is 26% of the value of the simple random sample used to illustrate the computations. As for logdet the optimised sample shows strong spatial clustering. However, the shape is quite different. The points are clustered in a circle.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:MBVariogram"></span>
<img src="SpatialSampling_files/figure-html/MBVariogram-1.png" alt="Optimised sampling pattern of 100 points for semivariogram estimation, using the log of the determinant of the inverse Fisher information matrix of the semivariogram parameters (logdet) and the mean estimation variance of the kriging variance (MVKV) as a minimisation criterion." width="100%" />
<p class="caption">
Figure 24.6: Optimised sampling pattern of 100 points for semivariogram estimation, using the log of the determinant of the inverse Fisher information matrix of the semivariogram parameters (logdet) and the mean estimation variance of the kriging variance (MVKV) as a minimisation criterion.
</p>
</div>

<div class="rmdnote">
Both minimisation criteria, logdet and MVKV, are a function of the semivariogram parameters <span class="math inline">\(\pmb{\theta}\)</span>, showing that the problem is circular. Using a preliminary estimate of the semivariogram parameters, <span class="math inline">\(\hat{\pmb{\theta}}\)</span>, leads to a locally optimal design at <span class="math inline">\(\hat{\pmb{\theta}}\)</span>. For this reason <span class="citation"><a href="#ref-bog99" role="doc-biblioref">Bogaert and Russo</a> (<a href="#ref-bog99" role="doc-biblioref">1999</a>)</span> and <span class="citation"><a href="#ref-zhu05" role="doc-biblioref">Zhu and Stein</a> (<a href="#ref-zhu05" role="doc-biblioref">2005</a>)</span> proposed a Bayesian approach, in which a multivariate prior distribution for the semivariogram parameters is postulated. The expected value over this distribution of the criterion is minimised. <span class="citation"><a href="#ref-lar02" role="doc-biblioref">Lark</a> (<a href="#ref-lar02" role="doc-biblioref">2002</a>)</span> computed the average of VKV over a number of semivariograms.
</div>
<p>Both methods for sample optimisation rely, amongst others, on the assumption that the mean and the variance are constant throughout the area. Under this assumption it is no problem that the sampling units are spatially clustered. So, we assume that the semivariogram estimated from the data collected in a small portion of the study area is representative for the whole study area. If we do not feel comfortable with this assumption, spreading out the sampling units by the sampling methods described in the next two sections can be a good option.</p>
<div id="exercises-33" class="section level4 unnumbered">
<h4>Exercises</h4>
<ol start="3" style="list-style-type: decimal">
<li>Write an <strong>R</strong> script to design a model-based sample of 100 points for Hunter Valley, to estimate the semivariogram for a study variable. Use logdet as a minimisation criterion. Use as a prior estimate of the semivariogram an exponential model with a distance parameter of 200 m and a ratio of spatial dependence of 0.5. Compare the sample with the optimised sample in Figure <a href="SamplingVariogram.html#fig:MBVariogram">24.6</a>, which was obtained with the same value for the distance parameter and a spatial dependence ratio of 0.8.<br />
</li>
<li>Repeat this for MVKV as a minimisation criterion.</li>
</ol>
</div>
</div>
</div>
<div id="SamplingEstimationandPrediction" class="section level2" number="24.4">
<h2><span class="header-section-number">24.4</span> Optimisation of sampling pattern for semivariogram estimation and mapping</h2>
<p>In practice a reconnaissance survey for semivariogram estimation often is not feasible. A single sample must be designed that is suitable both for estimating the semivariogram parameters and mapping, i.e. prediction with the estimated semivariogram parameters at the nodes of a fine discretisation grid. Another reason is that in a reconnaissance survey we can seldom afford a sample size large enough to obtain reliable estimates of the semivariogram parameters. <span class="citation"><a href="#ref-Papritz2011" role="doc-biblioref">Papritz et al.</a> (<a href="#ref-Papritz2011" role="doc-biblioref">2011</a>)</span> found that for a sample size of 192 points the estimated variance components with balanced and unbalanced nested designs were highly uncertain. For this reason it is attractive to use also the sampling points designed for spatial prediction (mapping) for estimating the semivariogram. Designing two samples, one for estimation of the semivariogram and one for spatial prediction, is suboptimal. Designing one sample that can be used both for estimation of the semivariogram parameters and for prediction potentially is more efficient.</p>
<p>Finally, with nested sampling and IPP sampling we aim at estimating the semivariogram of the residuals of a constant mean (see Equation <a href="SamplingVariogram.html#eq:ANOVAmodelnested">(24.1)</a>). In other words, with these designs we aim at estimating the parameters of a semivariogram model used in ordinary kriging. In situations where we have covariates that can partly explain the spatial variation of the study variable, kriging with an external drift is more appropriate. In these situations the reconnaissance survey should be tailored to estimating both the regression coefficients associated with the covariates and the parameters of the residual semivariogram.</p>
<p>Model-based methods for designing a single sample for estimation of the model parameters and for prediction with the estimated model parameters are proposed, amongst others, by <span class="citation"><a href="#ref-zim06" role="doc-biblioref">Zimmerman</a> (<a href="#ref-zim06" role="doc-biblioref">2006</a>)</span>, <span class="citation"><a href="#ref-zhu06" role="doc-biblioref">Zhu and Stein</a> (<a href="#ref-zhu06" role="doc-biblioref">2006</a>)</span>, <span class="citation"><a href="#ref-zhu06b" role="doc-biblioref">Zhu and Zhang</a> (<a href="#ref-zhu06b" role="doc-biblioref">2006</a>)</span>, and <span class="citation"><a href="#ref-Marchant2007" role="doc-biblioref">Marchant and Lark</a> (<a href="#ref-Marchant2007" role="doc-biblioref">2007</a>)</span>. The methods use a different minimisation criterion. <span class="citation"><a href="#ref-zim06" role="doc-biblioref">Zimmerman</a> (<a href="#ref-zim06" role="doc-biblioref">2006</a>)</span> proposed to minimise the kriging variance (at the centre of a square grid cell) that is augmented by an amount that accounts for the additional uncertainty in the kriging predictions due to uncertainty in the estimated semivariogram parameters, hereafter referred to as the augmented kriging variance  (AKV):</p>
<p><span class="math display" id="eq:augmentedvar">\[\begin{equation}
AKV(\mathbf{s}_0) = V_\mathrm{OK}(\mathbf{s}_0) + \mathrm{E}[\tau^2(\mathbf{s}_0)]\;,
\tag{24.4}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(V_\mathrm{OK}(\mathbf{s}_0)\)</span> the ordinary kriging variance, see Equation <a href="Introkriging.html#eq:OKvariance">(21.8)</a>, and <span class="math inline">\(\mathrm{E}[\tau^2(\mathbf{s}_0)]\)</span> the expectation of the additional variance component due to uncertainty about the semivariogram parameters estimated by ML. The additional variance component is approximated by a first order Taylor series:</p>
<p><span class="math display" id="eq:tausq">\[\begin{equation}
\mathrm{E}[\tau^2(\mathbf{s}_0)]=\sum_{i=1}^p \sum_{j=1}^p \mathrm{Cov}(\theta_i,\theta_j) \frac{\partial \lambda^{\mathrm{T}}} {\partial \theta_i} \mathbf{A}\frac{\partial \lambda} {\partial \theta_j}\;,
\tag{24.5}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(\frac{\partial \lambda} {\partial \theta_j}\)</span> the vector of partial derivatives of the kriging weights with respect to the <span class="math inline">\(j\)</span>th semivariogram parameter. Comparing Equations <a href="SamplingVariogram.html#eq:tausq">(24.5)</a> and <a href="SamplingVariogram.html#eq:varkrigingvar">(24.3)</a> shows that the two variances differ. VKV quantifies our uncertainty about the estimated kriging variance, whereas <span class="math inline">\(\mathrm{E}[\tau^2]\)</span> quantifies our uncertainty about the kriging prediction due to uncertainty about the semivariogram parameters. I use the mean of the AKV over the nodes of a prediction grid (evaluation grid) as a minimisation criterion (MAKV). The same criterion can also be used in situations where we have maps of covariates that we want to use in prediction. In that case the aim is to design a single sample that is used both for estimation of the <em>residual</em> semivariogram and for prediction by kriging with an external drift. The ordinary kriging variance <span class="math inline">\(V_\mathrm{OK}(\mathbf{s}_0)\)</span> in Equation <a href="SamplingVariogram.html#eq:augmentedvar">(24.4)</a> is then replaced by the prediction error variance with kriging with an external drift <span class="math inline">\(V_\mathrm{KED}(\mathbf{s}_0)\)</span>, see Equation <a href="Introkriging.html#eq:KEDvariance">(21.20)</a>.</p>
<p><span class="citation"><a href="#ref-zhu06" role="doc-biblioref">Zhu and Stein</a> (<a href="#ref-zhu06" role="doc-biblioref">2006</a>)</span> proposed as a minimisation criterion a linear combination of AKV (Equation <a href="SamplingVariogram.html#eq:augmentedvar">(24.4)</a>) and VKV (Equation <a href="SamplingVariogram.html#eq:varkrigingvar">(24.3)</a>), referred to as the estimation adjusted criterion (EAC):</p>
<p><span class="math display" id="eq:EAC">\[\begin{equation}
EAC(\mathbf{s}_0) = AKV(\mathbf{s}_0) + \frac{1}{2V_{\mathrm{OK}}(\mathbf{s}_0)} VKV(\mathbf{s}_0)\;.
\tag{24.6}
\end{equation}\]</span></p>
<p>Again, the mean of the EAC values (MEAC) over the nodes of a prediction grid (evaluation) is used as a minimisation criterion.</p>
<p>Computing time for optimisation of the coordinates of a large sample, say <span class="math inline">\(&gt; 50\)</span> points, can become prohibitively long. To reduce computing time, <span class="citation"><a href="#ref-zhu06" role="doc-biblioref">Zhu and Stein</a> (<a href="#ref-zhu06" role="doc-biblioref">2006</a>)</span> proposed a two-step approach. In the first step for a fixed proportion <span class="math inline">\(p \in (0,1)\)</span> the locations of <span class="math inline">\((1-p)\;n\)</span> points are optimised for prediction with given parameters, for instance by minimising MKV. This ‘prediction sample’ is supplemented with <span class="math inline">\(p \;n\)</span> points, so that the two combined samples of size <span class="math inline">\(n\)</span> minimise logdet or MVKV. This is repeated for different values of <span class="math inline">\(p\)</span>. In the second step MEAC is computed for the combined samples of size <span class="math inline">\(n\)</span>, and the proportion and the associated sample with minimum MEAC are selected.</p>
<p>A simplification of this two-step approach is to select in the first step a square grid or a spatial coverage sample (Section <a href="RegularGridSpatialCoverage.html#SpatialCoverage">17.2</a>), and to supplement this sample by a fixed number of points whose coordinates are optimised by spatial simulated annealing (SSA), using either MAKV or MEAC computed from both samples (grid sample or spatial coverage sample plus supplemental sample) as a minimisation criterion. In SSA the grid or spatial coverage sample is fixed, i.e. the locations are not further optimised. <span class="citation"><a href="#ref-Lark2018" role="doc-biblioref">Lark and Marchant</a> (<a href="#ref-Lark2018" role="doc-biblioref">2018</a>)</span> recommended as a rule of thumb to add about 10% of the fixed sample as short distance points.</p>
<p>The following code chunks show how the AKV and EAC can be computed. First, a spatial coverage sample of 90 points is selected using function <code>stratify</code> of package <strong>spcosa</strong>, see Section <a href="RegularGridSpatialCoverage.html#SpatialCoverage">17.2</a>. In addition, a simple random sample of 10 points is selected. This sample is the initial supplemental sample, whose locations are optimised. A square grid of approximately 100 points is selected as an evaluation sample.</p>
<div class="sourceCode" id="cb526"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb526-1"><a href="SamplingVariogram.html#cb526-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spcosa)</span>
<span id="cb526-2"><a href="SamplingVariogram.html#cb526-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">90</span></span>
<span id="cb526-3"><a href="SamplingVariogram.html#cb526-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">314</span>)</span>
<span id="cb526-4"><a href="SamplingVariogram.html#cb526-4" aria-hidden="true" tabindex="-1"></a>myStrata <span class="ot">&lt;-</span> <span class="fu">stratify</span>(grdHunterValley, <span class="at">nStrata =</span> n, <span class="at">equalArea =</span> <span class="cn">FALSE</span>, <span class="at">nTry =</span> <span class="dv">10</span>)</span>
<span id="cb526-5"><a href="SamplingVariogram.html#cb526-5" aria-hidden="true" tabindex="-1"></a>mySCsample <span class="ot">&lt;-</span> <span class="fu">as</span>(<span class="fu">spsample</span>(myStrata), <span class="st">&quot;SpatialPoints&quot;</span>)</span>
<span id="cb526-6"><a href="SamplingVariogram.html#cb526-6" aria-hidden="true" tabindex="-1"></a>nsup <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb526-7"><a href="SamplingVariogram.html#cb526-7" aria-hidden="true" tabindex="-1"></a>units <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(grdHunterValley), nsup)</span>
<span id="cb526-8"><a href="SamplingVariogram.html#cb526-8" aria-hidden="true" tabindex="-1"></a>mysupsample0 <span class="ot">&lt;-</span> <span class="fu">as</span>(grdHunterValley[units, ], <span class="st">&quot;SpatialPoints&quot;</span>)</span>
<span id="cb526-9"><a href="SamplingVariogram.html#cb526-9" aria-hidden="true" tabindex="-1"></a>myevalsample <span class="ot">&lt;-</span> <span class="fu">spsample</span>(</span>
<span id="cb526-10"><a href="SamplingVariogram.html#cb526-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> grdHunterValley, <span class="at">n =</span> <span class="dv">100</span>, <span class="at">type =</span> <span class="st">&quot;regular&quot;</span>, <span class="at">offset =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>))</span></code></pre></div>
<p>The next step is to compute the inverse of the Fisher information matrix, given a preliminary semivariogram model, which is used as the variance-covariance matrix of the estimated semivariogram parameters. Contrary to Section <a href="SamplingVariogram.html#samplingforvariogram">24.3</a> now <em>all</em> sampling locations are used to compute this matrix. The locations of the spatial coverage sample and the supplemental sample are merged into one <code>SpatialPoints</code> object.</p>
<div class="sourceCode" id="cb527"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb527-1"><a href="SamplingVariogram.html#cb527-1" aria-hidden="true" tabindex="-1"></a>mysample <span class="ot">&lt;-</span> <span class="fu">rbind</span>(mysupsample0, mySCsample)</span></code></pre></div>
<p>For how the Fisher information matrix is computed, I refer to the code chunks in Section <a href="SamplingVariogram.html#samplingforvariogram">24.3</a>. The inverse of this matrix can be computed with function <code>solve</code>.</p>
<p>In the next code chunk for each evaluation point the kriging weights (<code>L</code>), the kriging variance (<code>var</code>), the perturbed kriging weights (<code>pL</code>), and the perturbed kriging variances (<code>pvar</code>) are computed. In the final lines the partial derivatives of the kriging weights (<code>dL</code>) and of the kriging variances (<code>dvar</code>) with respect to the semivariogram parameters are computed. The partial derivatives of the kriging variances with respect to the semivariogram parameters are needed for computing VKV, see Equation <a href="SamplingVariogram.html#eq:varkrigingvar">(24.3)</a>, which in turn is needed for computing criterion EAC, see Equation <a href="SamplingVariogram.html#eq:EAC">(24.6)</a>.</p>
<div class="sourceCode" id="cb528"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb528-1"><a href="SamplingVariogram.html#cb528-1" aria-hidden="true" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="fu">length</span>(myevalsample), <span class="at">ncol =</span> nobs)</span>
<span id="cb528-2"><a href="SamplingVariogram.html#cb528-2" aria-hidden="true" tabindex="-1"></a>pL <span class="ot">&lt;-</span> <span class="fu">array</span>(</span>
<span id="cb528-3"><a href="SamplingVariogram.html#cb528-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dim =</span> <span class="fu">c</span>(<span class="fu">length</span>(myevalsample), <span class="fu">length</span>(mysample), <span class="fu">length</span>(thetas)))</span>
<span id="cb528-4"><a href="SamplingVariogram.html#cb528-4" aria-hidden="true" tabindex="-1"></a>var <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="at">length =</span> <span class="fu">length</span>(myevalsample))</span>
<span id="cb528-5"><a href="SamplingVariogram.html#cb528-5" aria-hidden="true" tabindex="-1"></a>pvar <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="fu">length</span>(myevalsample), <span class="at">ncol =</span> <span class="fu">length</span>(thetas))</span>
<span id="cb528-6"><a href="SamplingVariogram.html#cb528-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">length</span>(myevalsample))) {</span>
<span id="cb528-7"><a href="SamplingVariogram.html#cb528-7" aria-hidden="true" tabindex="-1"></a>  b <span class="ot">&lt;-</span> <span class="fu">c</span>(A0[i, ], <span class="dv">1</span>)</span>
<span id="cb528-8"><a href="SamplingVariogram.html#cb528-8" aria-hidden="true" tabindex="-1"></a>  l <span class="ot">&lt;-</span> <span class="fu">solve</span>(B, b)</span>
<span id="cb528-9"><a href="SamplingVariogram.html#cb528-9" aria-hidden="true" tabindex="-1"></a>  L[i, ] <span class="ot">&lt;-</span> l[<span class="dv">1</span><span class="sc">:</span>nobs]</span>
<span id="cb528-10"><a href="SamplingVariogram.html#cb528-10" aria-hidden="true" tabindex="-1"></a>  var[i] <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> l[<span class="dv">1</span><span class="sc">:</span>nobs] <span class="sc">%*%</span> A0[i, ] <span class="sc">-</span> l[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span>nobs)]</span>
<span id="cb528-11"><a href="SamplingVariogram.html#cb528-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">length</span>(thetas))) {</span>
<span id="cb528-12"><a href="SamplingVariogram.html#cb528-12" aria-hidden="true" tabindex="-1"></a>    pl <span class="ot">&lt;-</span> <span class="fu">solve</span>(pB[[j]], pb[[j]][i, ])</span>
<span id="cb528-13"><a href="SamplingVariogram.html#cb528-13" aria-hidden="true" tabindex="-1"></a>    pL[i, , j] <span class="ot">&lt;-</span> pl[<span class="dv">1</span><span class="sc">:</span>nobs]</span>
<span id="cb528-14"><a href="SamplingVariogram.html#cb528-14" aria-hidden="true" tabindex="-1"></a>    pvar[i, j] <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> pl[<span class="dv">1</span><span class="sc">:</span>nobs] <span class="sc">%*%</span> pA0[[j]][i, ] <span class="sc">-</span> pl[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span>nobs)]</span>
<span id="cb528-15"><a href="SamplingVariogram.html#cb528-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb528-16"><a href="SamplingVariogram.html#cb528-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb528-17"><a href="SamplingVariogram.html#cb528-17" aria-hidden="true" tabindex="-1"></a>dL <span class="ot">&lt;-</span> dvar <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb528-18"><a href="SamplingVariogram.html#cb528-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">length</span>(thetas))) {</span>
<span id="cb528-19"><a href="SamplingVariogram.html#cb528-19" aria-hidden="true" tabindex="-1"></a>  dL[[i]] <span class="ot">&lt;-</span> (pL[, , i] <span class="sc">-</span> L) <span class="sc">/</span> (thetas[i] <span class="sc">*</span> perturbation)</span>
<span id="cb528-20"><a href="SamplingVariogram.html#cb528-20" aria-hidden="true" tabindex="-1"></a>  dvar[[i]] <span class="ot">&lt;-</span> (pvar[, i] <span class="sc">-</span> var) <span class="sc">/</span> (thetas[i] <span class="sc">*</span> perturbation)</span>
<span id="cb528-21"><a href="SamplingVariogram.html#cb528-21" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>In the next code chunk the expected variance due to uncertainty about the semivariogram parameters (Equation <a href="SamplingVariogram.html#eq:tausq">(24.5)</a>) is computed.</p>
<div class="sourceCode" id="cb529"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb529-1"><a href="SamplingVariogram.html#cb529-1" aria-hidden="true" tabindex="-1"></a>tausq <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="at">length =</span> <span class="fu">length</span>(myevalsample))</span>
<span id="cb529-2"><a href="SamplingVariogram.html#cb529-2" aria-hidden="true" tabindex="-1"></a>tausqk <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb529-3"><a href="SamplingVariogram.html#cb529-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">length</span>(myevalsample))) {</span>
<span id="cb529-4"><a href="SamplingVariogram.html#cb529-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">length</span>(dL))) {</span>
<span id="cb529-5"><a href="SamplingVariogram.html#cb529-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">length</span>(dL))) {</span>
<span id="cb529-6"><a href="SamplingVariogram.html#cb529-6" aria-hidden="true" tabindex="-1"></a>      tausqijk <span class="ot">&lt;-</span> invI[i, j] <span class="sc">*</span> <span class="fu">t</span>(dL[[i]][k, ]) <span class="sc">%*%</span> A <span class="sc">%*%</span> dL[[j]][k, ]</span>
<span id="cb529-7"><a href="SamplingVariogram.html#cb529-7" aria-hidden="true" tabindex="-1"></a>      tausqk <span class="ot">&lt;-</span> tausqk <span class="sc">+</span> tausqijk</span>
<span id="cb529-8"><a href="SamplingVariogram.html#cb529-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb529-9"><a href="SamplingVariogram.html#cb529-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb529-10"><a href="SamplingVariogram.html#cb529-10" aria-hidden="true" tabindex="-1"></a>  tausq[k] <span class="ot">&lt;-</span> tausqk</span>
<span id="cb529-11"><a href="SamplingVariogram.html#cb529-11" aria-hidden="true" tabindex="-1"></a>  tausqk <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb529-12"><a href="SamplingVariogram.html#cb529-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The AKVs are computed by adding the kriging variances and the extra variances due to semivariogram uncertainty (Equation <a href="SamplingVariogram.html#eq:augmentedvar">(24.4)</a>). The VKV values and the EAC values are computed. Both the AKV and the EAC differ among the evaluation points. As a summary, the mean of the two variables is computed.</p>
<div class="sourceCode" id="cb530"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb530-1"><a href="SamplingVariogram.html#cb530-1" aria-hidden="true" tabindex="-1"></a>augmentedvar <span class="ot">&lt;-</span> var <span class="sc">+</span> tausq</span>
<span id="cb530-2"><a href="SamplingVariogram.html#cb530-2" aria-hidden="true" tabindex="-1"></a>MAKV0 <span class="ot">&lt;-</span> <span class="fu">mean</span>(augmentedvar)</span>
<span id="cb530-3"><a href="SamplingVariogram.html#cb530-3" aria-hidden="true" tabindex="-1"></a>VKV <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="at">length =</span> <span class="fu">length</span>(var))</span>
<span id="cb530-4"><a href="SamplingVariogram.html#cb530-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">length</span>(dvar))) {</span>
<span id="cb530-5"><a href="SamplingVariogram.html#cb530-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">length</span>(dvar))) {</span>
<span id="cb530-6"><a href="SamplingVariogram.html#cb530-6" aria-hidden="true" tabindex="-1"></a>    VKVij <span class="ot">&lt;-</span> invI[i, j] <span class="sc">*</span> dvar[[i]] <span class="sc">*</span> dvar[[j]]</span>
<span id="cb530-7"><a href="SamplingVariogram.html#cb530-7" aria-hidden="true" tabindex="-1"></a>    VKV <span class="ot">&lt;-</span> VKV <span class="sc">+</span> VKVij</span>
<span id="cb530-8"><a href="SamplingVariogram.html#cb530-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb530-9"><a href="SamplingVariogram.html#cb530-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb530-10"><a href="SamplingVariogram.html#cb530-10" aria-hidden="true" tabindex="-1"></a>EAC <span class="ot">&lt;-</span> augmentedvar <span class="sc">+</span> (VKV <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> var))</span>
<span id="cb530-11"><a href="SamplingVariogram.html#cb530-11" aria-hidden="true" tabindex="-1"></a>MEAC0 <span class="ot">&lt;-</span> <span class="fu">mean</span>(EAC)</span></code></pre></div>
<p>For the spatial coverage sample of 90 points supplemented by a simple random sample of 10 points, MAKV equals 0.846 and MEAC equals 0.896.</p>
<!--**R** script [`ObjectiveFunctions4MBSamplingVariogram.R`](https://github.com/DickBrus/SpatialSamplingwithR/tree/master/Rscripts/ObjectiveFunctions4MBSamplingVariogram.R).-->
<p>The sample can be optimised with <strong>spsann</strong> function <code>optimUSER</code>. Argument <code>points</code> is a list containing a data frame (or matrix) with the coordinates of the fixed points (assigned to sub-argument <code>fixed</code>) and an integer of the number of supplemental points of which the locations are optimised (assigned to sub-argument <code>free</code>). As already stressed above an important difference with Section <a href="SamplingVariogram.html#samplingforvariogram">24.3</a> is that the free and the fixed sample are merged and used together both for estimation of the semivariogram and for prediction. The objective functions <code>MAKV</code> and <code>MEAC</code> are defined in package <strong>sswr</strong>.</p>
<div class="sourceCode" id="cb531"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb531-1"><a href="SamplingVariogram.html#cb531-1" aria-hidden="true" tabindex="-1"></a>candi <span class="ot">&lt;-</span> <span class="fu">spsample</span>(grdHunterValley, <span class="at">type =</span> <span class="st">&quot;regular&quot;</span>,</span>
<span id="cb531-2"><a href="SamplingVariogram.html#cb531-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">cellsize =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">50</span>), <span class="at">offset =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>))</span>
<span id="cb531-3"><a href="SamplingVariogram.html#cb531-3" aria-hidden="true" tabindex="-1"></a>candi <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(candi)</span>
<span id="cb531-4"><a href="SamplingVariogram.html#cb531-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(candi) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>)</span>
<span id="cb531-5"><a href="SamplingVariogram.html#cb531-5" aria-hidden="true" tabindex="-1"></a>schedule <span class="ot">&lt;-</span> <span class="fu">scheduleSPSANN</span>(</span>
<span id="cb531-6"><a href="SamplingVariogram.html#cb531-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">initial.acceptance =</span> <span class="fl">0.8</span>,</span>
<span id="cb531-7"><a href="SamplingVariogram.html#cb531-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">initial.temperature =</span> <span class="fl">0.008</span>, <span class="at">temperature.decrease =</span> <span class="fl">0.8</span>,</span>
<span id="cb531-8"><a href="SamplingVariogram.html#cb531-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">500</span>, <span class="at">chain.length =</span> <span class="dv">20</span>, <span class="at">stopping =</span> <span class="dv">10</span>,</span>
<span id="cb531-9"><a href="SamplingVariogram.html#cb531-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">x.min =</span> <span class="dv">0</span>, <span class="at">y.min =</span> <span class="dv">0</span>, <span class="at">cellsize =</span> <span class="dv">50</span>)</span>
<span id="cb531-10"><a href="SamplingVariogram.html#cb531-10" aria-hidden="true" tabindex="-1"></a>fixed <span class="ot">&lt;-</span> <span class="fu">coordinates</span>(mySCsample)</span>
<span id="cb531-11"><a href="SamplingVariogram.html#cb531-11" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(fixed) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>)</span>
<span id="cb531-12"><a href="SamplingVariogram.html#cb531-12" aria-hidden="true" tabindex="-1"></a>pnts <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">fixed =</span> fixed, <span class="at">free =</span> nsup)</span>
<span id="cb531-13"><a href="SamplingVariogram.html#cb531-13" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">314</span>)</span>
<span id="cb531-14"><a href="SamplingVariogram.html#cb531-14" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">optimUSER</span>(</span>
<span id="cb531-15"><a href="SamplingVariogram.html#cb531-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">points =</span> pnts, <span class="at">candi =</span> candi,</span>
<span id="cb531-16"><a href="SamplingVariogram.html#cb531-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">fun =</span> MAKV,</span>
<span id="cb531-17"><a href="SamplingVariogram.html#cb531-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">esample =</span> myevalsample,</span>
<span id="cb531-18"><a href="SamplingVariogram.html#cb531-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> <span class="st">&quot;Exp&quot;</span>, <span class="at">thetas =</span> thetas, <span class="at">perturbation =</span> <span class="fl">0.01</span>,</span>
<span id="cb531-19"><a href="SamplingVariogram.html#cb531-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">schedule =</span> schedule, <span class="at">track =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>Figure <a href="SamplingVariogram.html#fig:FigMBEK">24.7</a> shows for Hunter Valley a spatial coverage sample of 90 points, supplemented by 10 points optimised by SSA, using MAKV and MEAC as a minimisation criterion.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:FigMBEK"></span>
<img src="SpatialSampling_files/figure-html/FigMBEK-1.png" alt="Optimised sampling pattern of 10 points supplemented to spatial coverage sample of 90 points, for semivariogram estimation and prediction, using the mean augmented kriging variance (MAKV) and the mean estimation adjusted criterion (MEAC) as a minimisation criterion. The prior semivariogram used in optimising the sampling pattern of the supplemental sample is an exponential semivariogram with a range of 200 m and a ratio of spatial dependence of 0.5." width="100%" />
<p class="caption">
Figure 24.7: Optimised sampling pattern of 10 points supplemented to spatial coverage sample of 90 points, for semivariogram estimation and prediction, using the mean augmented kriging variance (MAKV) and the mean estimation adjusted criterion (MEAC) as a minimisation criterion. The prior semivariogram used in optimising the sampling pattern of the supplemental sample is an exponential semivariogram with a range of 200 m and a ratio of spatial dependence of 0.5.
</p>
</div>
<p>With MAKV as a minimisation criterion there are two pairs of supplemental points at very short distance (&lt; 5 m), and with MEAC there is one such pair of supplemental points.</p>
<p>A histogram of the shortest distance to the spatial coverage sample is shown in Figure <a href="SamplingVariogram.html#fig:HistogramShortestDistance">24.8</a>. With MEAC three supplemental points are at very short distance of the spatial coverage sample (<span class="math inline">\(&lt;3\)</span> m). The average distance between neighbouring spatial coverage sampling points equals 381 m.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:HistogramShortestDistance"></span>
<img src="SpatialSampling_files/figure-html/HistogramShortestDistance-1.png" alt="Frequency distributions of the shortest distance to the spatial coverage sample of the supplemental sample, optimised with the mean augmented kriging variance (MAKV) and the mean estimation adjusted criterion (MEAC)." width="100%" />
<p class="caption">
Figure 24.8: Frequency distributions of the shortest distance to the spatial coverage sample of the supplemental sample, optimised with the mean augmented kriging variance (MAKV) and the mean estimation adjusted criterion (MEAC).
</p>
</div>
<p>MAKV of the optimised sample equals 0.771 which is 91% of MAKV of the initial sample. MEAC of the optimised sample equals 0.789 which is 88% of MEAC of the initial sample. The reduction of these two criteria through the optimisation is much smaller than for logdet and MVKV in Section <a href="SamplingVariogram.html#samplingforvariogram">24.3</a>. This can be explained by the small number of sampling units that is optimised: only the locations of 10 points are optimised, 90 are fixed. In Section <a href="SamplingVariogram.html#samplingforvariogram">24.3</a> all 100 locations were optimised.</p>
<div id="exercises-34" class="section level4 unnumbered">
<h4>Exercises</h4>
<ol start="5" style="list-style-type: decimal">
<li>Write an <strong>R</strong> script to select from Hunter Valley a spatial coverage sample of 80 points supplemented by 20 points. Use MEAC as a minimisation criterion, an exponential semivariogram with a distance parameter of 200 m and a ratio of spatial dependence of 0.8. Compare the minimised MEAC with MEAC reported above, obtained by supplementing a spatial coverage sample of 90 points by 10 points.</li>
</ol>
</div>
</div>
<div id="a-practical-solution" class="section level2" number="24.5">
<h2><span class="header-section-number">24.5</span> A practical solution</h2>
<p>Based on the optimised samples shown above, a straightforward, simple sampling design for estimation of the model parameters and for prediction is a spatial coverage sample supplemented with randomly selected points between the points of the spatial coverage sample at some chosen fixed distances. Figure <a href="SamplingVariogram.html#fig:SpatialCoveragePlus">24.9</a> shows an example. A simple random subsample without replacement of size 10 is selected from the 90 points of the spatial coverage sample. These points are used as starting points to select a point at a distance of 20 m in a random direction.</p>
<div class="sourceCode" id="cb532"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb532-1"><a href="SamplingVariogram.html#cb532-1" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb532-2"><a href="SamplingVariogram.html#cb532-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb532-3"><a href="SamplingVariogram.html#cb532-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">314</span>)</span>
<span id="cb532-4"><a href="SamplingVariogram.html#cb532-4" aria-hidden="true" tabindex="-1"></a>units <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(mySCsample), m, <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb532-5"><a href="SamplingVariogram.html#cb532-5" aria-hidden="true" tabindex="-1"></a>mySCsubsample <span class="ot">&lt;-</span> mySCsample[units, ]</span>
<span id="cb532-6"><a href="SamplingVariogram.html#cb532-6" aria-hidden="true" tabindex="-1"></a>dxy <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> m, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb532-7"><a href="SamplingVariogram.html#cb532-7" aria-hidden="true" tabindex="-1"></a>angle <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n =</span> m, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">2</span> <span class="sc">*</span> pi)</span>
<span id="cb532-8"><a href="SamplingVariogram.html#cb532-8" aria-hidden="true" tabindex="-1"></a>dxy[, <span class="dv">1</span>] <span class="ot">&lt;-</span> h <span class="sc">*</span> <span class="fu">sin</span>(angle); dxy[, <span class="dv">2</span>] <span class="ot">&lt;-</span> h <span class="sc">*</span> <span class="fu">cos</span>(angle)</span>
<span id="cb532-9"><a href="SamplingVariogram.html#cb532-9" aria-hidden="true" tabindex="-1"></a>mysupsample <span class="ot">&lt;-</span> mySCsubsample <span class="sc">+</span> dxy</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:SpatialCoveragePlus"></span>
<img src="SpatialSampling_files/figure-html/SpatialCoveragePlus-1.png" alt="Spatial coverage sample of 90 points supplemented by 10 points at short distance (20 m) from randomly selected spatial coverage points." width="80%" />
<p class="caption">
Figure 24.9: Spatial coverage sample of 90 points supplemented by 10 points at short distance (20 m) from randomly selected spatial coverage points.
</p>
</div>
<p>MAKV of this sample equals 0.801, and MEAC equals 0.809. For MAKV 40% of the maximal reduction is realised by this practical solution; for MEAC this is 19%.</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-bog99" class="csl-entry">
Bogaert, P., and D. Russo. 1999. <span>“Optimal Spatial Sampling Design for the Estimation of the Variogram Based on a Least Squares Approach.”</span> <em>Water Resources Research</em> 35 (4): 1275–89.
</div>
<div id="ref-bru94b" class="csl-entry">
Brus, D. J., and J. J. de Gruijter. 1994. <span>“Estimation of Non-Ergodic Variograms and Their Sampling Variance by Design-Based Sampling Strategies.”</span> <em>Mathematical Geology</em> 26: 437–54.
</div>
<div id="ref-Kitanidis87" class="csl-entry">
———. 1987. <span>“Parametric Estimation of Covariances of Regionalized Variables.”</span> <em>Water Resources Bulletin</em> 23 (4): 557–67.
</div>
<div id="ref-lar00b" class="csl-entry">
Lark, R. M. 2000. <span>“Estimating Variograms of Soil Properties by the Method-of-Moments and Maximum Likelihood.”</span> <em>European Journal of Soil Science</em> 51 (4): 717–28.
</div>
<div id="ref-lar02" class="csl-entry">
———. 2002. <span>“Optimized Spatial Sampling of Soil for Estimation of the Variogram by Maximum Likelihood.”</span> <em>Geoderma</em> 105 (1): 49–80.
</div>
<div id="ref-Lark2011CAGEO" class="csl-entry">
———. 2011. <span>“<span class="nocase">Spatially nested sampling schemes for spatial variance components: Scope for their optimization</span>.”</span> <em>Computers &amp; Geosciences</em> 37 (10): 1633–41. <a href="https://doi.org/{10.1016/j.cageo.2010.12.010}">https://doi.org/{10.1016/j.cageo.2010.12.010}</a>.
</div>
<div id="ref-Lark2018" class="csl-entry">
Lark, R. M., and B. P. Marchant. 2018. <span>“How Should a Spatial-Coverage Sample Design for a Geostatistical Soil Survey Be Supplemented to Support Estimation of Spatial Covariance Parameters?”</span> <em>Geoderma</em> 319: 89–99. https://doi.org/<a href="https://doi.org/10.1016/j.geoderma.2017.12.022">https://doi.org/10.1016/j.geoderma.2017.12.022</a>.
</div>
<div id="ref-Ly2017" class="csl-entry">
Ly, A., M. Marsman, J. Verhagen, R. P. P. P. Grasman, and E. J. Wagenmakers. 2017. <span>“A Tutorial on <span>Fisher</span> Information.”</span> <em>Journal of Mathematical Psychology</em> 80: 40–55.
</div>
<div id="ref-Marcelli2019" class="csl-entry">
Marcelli, A., P. Corona, and L. Fattorini. 2019. <span>“Design-Based Estimation of Mark Variograms in Forest Ecosystem Surveys.”</span> <em>Spatial Statistics</em> 30: 27–38.
</div>
<div id="ref-Marchant2007" class="csl-entry">
Marchant, B. P., and R. M. Lark. 2007. <span>“Optimized Sample Schemes for Geostatistical Surveys.”</span> <em><span>Mathematical Geology</span></em> 39 (1): 113–34. <a href="https://doi.org/{10.1007/s11004-006-9069-1}">https://doi.org/{10.1007/s11004-006-9069-1}</a>.
</div>
<div id="ref-mul99" class="csl-entry">
Müller, W. G., and D. L. Zimmerman. 1999. <span>“Optimal Designs for Variogram Estimation.”</span> <em>Environmetrics</em> 10 (1): 23–37.
</div>
<div id="ref-Oliver1986" class="csl-entry">
Oliver, M. A., and R. Webster. 1986. <span>“Combining Nested and Linear Sampling for Determining the Scale and Form of Spatial Variation of Regionalized Variables.”</span> <em>Geographical Analysis</em> 18 (3): 227–42.
</div>
<div id="ref-Papritz2011" class="csl-entry">
Papritz, A. J., A. Dümig, C. Zimmermann, H. H. Gerke, B. Felderer, I. Kögel-Knabner, W. Schaaf, and R. Schulin. 2011. <span>“<span class="nocase">Uncertainty of variance component estimates in nested sampling: a case study on the field-scale spatial variability of a restored soil</span>.”</span> <em>European Journal of Soil Science</em> 62 (3): 479–95. <a href="https://doi.org/{10.1111/j.1365-2389.2011.01363.x}">https://doi.org/{10.1111/j.1365-2389.2011.01363.x}</a>.
</div>
<div id="ref-peb04" class="csl-entry">
Pebesma, E. J. 2004. <span>“Multivariable Geostatistics in <span>S</span>: The Gstat Package.”</span> <em>Computers &amp; Geosciences</em> 30 (7): 683–91.
</div>
<div id="ref-nlme" class="csl-entry">
Pinheiro, J., D. Bates, S. DebRoy, D. Sarkar, and R Core Team. 2021. <em><span class="nocase">nlme</span>: Linear and Nonlinear Mixed Effects Models</em>. <a href="https://CRAN.R-project.org/package=nlme">https://CRAN.R-project.org/package=nlme</a>.
</div>
<div id="ref-web92" class="csl-entry">
Webster, R., and M. A. Oliver. 1992. <span>“Sample Adequately to Estimate Variograms of Soil Properties.”</span> <em>Journal of Soil Science</em> 43 (1): 177–92.
</div>
<div id="ref-Webster2006" class="csl-entry">
Webster, R., S. J. Welham, J. M. Potts, and M. A. Oliver. 2006. <span>“Estimating the Spatial Scales of Regionalized Variables by Nested Sampling, Hierarchical Analysis of Variance and Residual Maximum Likelihood.”</span> <em>Computers &amp; Geosciences</em> 32 (9): 1320–33.
</div>
<div id="ref-zhu05" class="csl-entry">
Zhu, Z., and M. L. Stein. 2005. <span>“Spatial Sampling Design for Parameter Estimation of the Covariance Function.”</span> <em>Journal of Statistical Planning and Inference</em> 134 (2): 583–603.
</div>
<div id="ref-zhu06" class="csl-entry">
———. 2006. <span>“Spatial Sampling Design for Prediction with Estimated Parameters.”</span> <em>Journal of Agricultural, Biological, and Environmental Statistics</em> 11 (1): 24–44.
</div>
<div id="ref-zhu06b" class="csl-entry">
Zhu, Z., and H. Zhang. 2006. <span>“Spatial Sampling Under the Infill Asymptotic Framework.”</span> <em>Environmetrics</em> 17: 323–37.
</div>
<div id="ref-zim06" class="csl-entry">
Zimmerman, D. L. 2006. <span>“Optimal Network Design for Spatial Prediction, Covariance Parameter Estimation, and Empirical Prediction.”</span> <em>Environmetrics</em> 17 (6): 635–52.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="MBSamplePattern.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="Validation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/DickBrus/SpatialSamplingwithR/edit/master/30-Sampling4VariogramEstimation.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["SpatialSampling.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
