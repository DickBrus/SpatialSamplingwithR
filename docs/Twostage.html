<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Two-stage cluster random sampling | Spatial sampling with R</title>
  <meta name="description" content="This book is for students, scientists, researchers and consultants who want to know how to collect spatial data, either for estimating parameters for the population or several subpopulations, or for mapping. How many data do we need, and how to select the population units? The book presents a wide overview of spatial sampling designs. Besides there is a chapter on designs for sampling in space and time for monitoring. The emphasis is not on the theory, but on how to implement sampling designs in R and on how the (sub)population parameters can be estimated from the sample." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Two-stage cluster random sampling | Spatial sampling with R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="/images/cover.pdf" />
  <meta property="og:description" content="This book is for students, scientists, researchers and consultants who want to know how to collect spatial data, either for estimating parameters for the population or several subpopulations, or for mapping. How many data do we need, and how to select the population units? The book presents a wide overview of spatial sampling designs. Besides there is a chapter on designs for sampling in space and time for monitoring. The emphasis is not on the theory, but on how to implement sampling designs in R and on how the (sub)population parameters can be estimated from the sample." />
  <meta name="github-repo" content="DickBrus/SpatialSamplingwithR" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Two-stage cluster random sampling | Spatial sampling with R" />
  
  <meta name="twitter:description" content="This book is for students, scientists, researchers and consultants who want to know how to collect spatial data, either for estimating parameters for the population or several subpopulations, or for mapping. How many data do we need, and how to select the population units? The book presents a wide overview of spatial sampling designs. Besides there is a chapter on designs for sampling in space and time for monitoring. The emphasis is not on the theory, but on how to implement sampling designs in R and on how the (sub)population parameters can be estimated from the sample." />
  <meta name="twitter:image" content="/images/cover.pdf" />

<meta name="author" content="Dick J. Brus" />


<meta name="date" content="2021-11-09" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="Cl.html"/>
<link rel="next" href="pps.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Spatial sampling with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="GeneralIntro.html"><a href="GeneralIntro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="GeneralIntro.html"><a href="GeneralIntro.html#BasicConcepts"><i class="fa fa-check"></i><b>1.1</b> Basic sampling concepts</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="GeneralIntro.html"><a href="GeneralIntro.html#PopulationParameters"><i class="fa fa-check"></i><b>1.1.1</b> Population parameters</a></li>
<li class="chapter" data-level="1.1.2" data-path="GeneralIntro.html"><a href="GeneralIntro.html#descriptive-statistics-versus-inference-about-a-population"><i class="fa fa-check"></i><b>1.1.2</b> Descriptive statistics versus inference about a population</a></li>
<li class="chapter" data-level="1.1.3" data-path="GeneralIntro.html"><a href="GeneralIntro.html#random-sampling-versus-probability-sampling"><i class="fa fa-check"></i><b>1.1.3</b> Random sampling versus probability sampling</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="GeneralIntro.html"><a href="GeneralIntro.html#DBvsMB"><i class="fa fa-check"></i><b>1.2</b> Design-based versus model-based approach</a></li>
<li class="chapter" data-level="1.3" data-path="GeneralIntro.html"><a href="GeneralIntro.html#Datasets"><i class="fa fa-check"></i><b>1.3</b> Populations used in sampling experiments</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="GeneralIntro.html"><a href="GeneralIntro.html#Voorst"><i class="fa fa-check"></i><b>1.3.1</b> Soil organic matter in Voorst (Netherlands)</a></li>
<li class="chapter" data-level="1.3.2" data-path="GeneralIntro.html"><a href="GeneralIntro.html#Poppy"><i class="fa fa-check"></i><b>1.3.2</b> Poppy fields in Kandahar (Afghanistan)</a></li>
<li class="chapter" data-level="1.3.3" data-path="GeneralIntro.html"><a href="GeneralIntro.html#Amazonia"><i class="fa fa-check"></i><b>1.3.3</b> Aboveground biomass in Eastern Amazonia (Brazil)</a></li>
<li class="chapter" data-level="1.3.4" data-path="GeneralIntro.html"><a href="GeneralIntro.html#TASSpainPortugal"><i class="fa fa-check"></i><b>1.3.4</b> Annual mean air temperature in Spain and Portugal</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>I Probability sampling for estimating (sub)population parameters</b></span></li>
<li class="chapter" data-level="2" data-path="IntroProbabilitySampling.html"><a href="IntroProbabilitySampling.html"><i class="fa fa-check"></i><b>2</b> Introduction to probability sampling</a>
<ul>
<li class="chapter" data-level="2.1" data-path="IntroProbabilitySampling.html"><a href="IntroProbabilitySampling.html#HTestimator"><i class="fa fa-check"></i><b>2.1</b> Horvitz-Thompson estimator</a></li>
<li class="chapter" data-level="2.2" data-path="IntroProbabilitySampling.html"><a href="IntroProbabilitySampling.html#hansen-hurwitz-estimator"><i class="fa fa-check"></i><b>2.2</b> Hansen-Hurwitz estimator</a></li>
<li class="chapter" data-level="2.3" data-path="IntroProbabilitySampling.html"><a href="IntroProbabilitySampling.html#using-models-in-design-based-approach"><i class="fa fa-check"></i><b>2.3</b> Using models in design-based approach</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="SI.html"><a href="SI.html"><i class="fa fa-check"></i><b>3</b> Simple random sampling</a>
<ul>
<li class="chapter" data-level="3.1" data-path="SI.html"><a href="SI.html#HTestimatorSI"><i class="fa fa-check"></i><b>3.1</b> Estimation of population parameters</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="SI.html"><a href="SI.html#PopProportion"><i class="fa fa-check"></i><b>3.1.1</b> Population proportion</a></li>
<li class="chapter" data-level="3.1.2" data-path="SI.html"><a href="SI.html#CDF"><i class="fa fa-check"></i><b>3.1.2</b> Cumulative distribution function and quantiles</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="SI.html"><a href="SI.html#VarMeanSI"><i class="fa fa-check"></i><b>3.2</b> Sampling variance of estimator of population parameters</a></li>
<li class="chapter" data-level="3.3" data-path="SI.html"><a href="SI.html#ConfidenceInterval"><i class="fa fa-check"></i><b>3.3</b> Confidence interval estimate</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="SI.html"><a href="SI.html#ConfidenceIntervalProportion"><i class="fa fa-check"></i><b>3.3.1</b> Confidence interval for proportion</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="SI.html"><a href="SI.html#SIcircularplots"><i class="fa fa-check"></i><b>3.4</b> Simple random sampling of circular plots</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="SI.html"><a href="SI.html#sampling-from-a-finite-set-of-fixed-circles"><i class="fa fa-check"></i><b>3.4.1</b> Sampling from a finite set of fixed circles</a></li>
<li class="chapter" data-level="3.4.2" data-path="SI.html"><a href="SI.html#sampling-from-an-infinite-set-of-floating-circles"><i class="fa fa-check"></i><b>3.4.2</b> Sampling from an infinite set of floating circles</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="STSI.html"><a href="STSI.html"><i class="fa fa-check"></i><b>4</b> Stratified simple random sampling</a>
<ul>
<li class="chapter" data-level="4.1" data-path="STSI.html"><a href="STSI.html#EstimatorsSTSI"><i class="fa fa-check"></i><b>4.1</b> Estimation of population parameters</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="STSI.html"><a href="STSI.html#population-proportion-cumulative-distribution-function-and-quantiles"><i class="fa fa-check"></i><b>4.1.1</b> Population proportion, cumulative distribution function, and quantiles</a></li>
<li class="chapter" data-level="4.1.2" data-path="STSI.html"><a href="STSI.html#WhyStratify"><i class="fa fa-check"></i><b>4.1.2</b> When should we stratify?</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="STSI.html"><a href="STSI.html#CISTSI"><i class="fa fa-check"></i><b>4.2</b> Confidence interval estimate</a></li>
<li class="chapter" data-level="4.3" data-path="STSI.html"><a href="STSI.html#STSIallocation"><i class="fa fa-check"></i><b>4.3</b> Allocation of sample size to strata</a></li>
<li class="chapter" data-level="4.4" data-path="STSI.html"><a href="STSI.html#cumrootf"><i class="fa fa-check"></i><b>4.4</b> <em>Cum-root-f</em> stratification</a></li>
<li class="chapter" data-level="4.5" data-path="STSI.html"><a href="STSI.html#kmeansstratification"><i class="fa fa-check"></i><b>4.5</b> Stratification with multiple covariates</a></li>
<li class="chapter" data-level="4.6" data-path="STSI.html"><a href="STSI.html#geostrata"><i class="fa fa-check"></i><b>4.6</b> Geographical stratification</a></li>
<li class="chapter" data-level="4.7" data-path="STSI.html"><a href="STSI.html#multi-way-stratification"><i class="fa fa-check"></i><b>4.7</b> Multi-way stratification</a></li>
<li class="chapter" data-level="4.8" data-path="STSI.html"><a href="STSI.html#MultivariateStratification"><i class="fa fa-check"></i><b>4.8</b> Multivariate stratification</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="SY.html"><a href="SY.html"><i class="fa fa-check"></i><b>5</b> Systematic random sampling</a>
<ul>
<li class="chapter" data-level="5.1" data-path="SY.html"><a href="SY.html#EstVarSY"><i class="fa fa-check"></i><b>5.1</b> Estimation of population parameters</a></li>
<li class="chapter" data-level="5.2" data-path="SY.html"><a href="SY.html#approximating-the-sampling-variance-of-the-estimator-of-the-mean"><i class="fa fa-check"></i><b>5.2</b> Approximating the sampling variance of the estimator of the mean</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="Cl.html"><a href="Cl.html"><i class="fa fa-check"></i><b>6</b> Cluster random sampling</a>
<ul>
<li class="chapter" data-level="6.1" data-path="Cl.html"><a href="Cl.html#clustersamplingestimators"><i class="fa fa-check"></i><b>6.1</b> Estimation of population parameters</a></li>
<li class="chapter" data-level="6.2" data-path="Cl.html"><a href="Cl.html#clusters-selected-with-probabilities-proportional-to-size-without-replacement"><i class="fa fa-check"></i><b>6.2</b> Clusters selected with probabilities proportional to size, without replacement</a></li>
<li class="chapter" data-level="6.3" data-path="Cl.html"><a href="Cl.html#SIC"><i class="fa fa-check"></i><b>6.3</b> Simple random sampling of clusters</a></li>
<li class="chapter" data-level="6.4" data-path="Cl.html"><a href="Cl.html#StratifiedCl"><i class="fa fa-check"></i><b>6.4</b> Stratified cluster random sampling</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="Twostage.html"><a href="Twostage.html"><i class="fa fa-check"></i><b>7</b> Two-stage cluster random sampling</a>
<ul>
<li class="chapter" data-level="7.1" data-path="Twostage.html"><a href="Twostage.html#twostagesamplingestimators"><i class="fa fa-check"></i><b>7.1</b> Estimation of population parameters</a></li>
<li class="chapter" data-level="7.2" data-path="Twostage.html"><a href="Twostage.html#primary-sampling-units-selected-without-replacement"><i class="fa fa-check"></i><b>7.2</b> Primary sampling units selected without replacement</a></li>
<li class="chapter" data-level="7.3" data-path="Twostage.html"><a href="Twostage.html#TwostageSISI"><i class="fa fa-check"></i><b>7.3</b> Simple random sampling of primary sampling units</a></li>
<li class="chapter" data-level="7.4" data-path="Twostage.html"><a href="Twostage.html#StratifiedTwostage"><i class="fa fa-check"></i><b>7.4</b> Stratified two-stage cluster random sampling</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="pps.html"><a href="pps.html"><i class="fa fa-check"></i><b>8</b> Sampling with probabilities proportional to size</a>
<ul>
<li class="chapter" data-level="8.1" data-path="pps.html"><a href="pps.html#ppswr"><i class="fa fa-check"></i><b>8.1</b> Probability-proportional-to-size sampling with replacement</a></li>
<li class="chapter" data-level="8.2" data-path="pps.html"><a href="pps.html#ppswor"><i class="fa fa-check"></i><b>8.2</b> Probability-proportional-to-size sampling without replacement</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="pps.html"><a href="pps.html#Systematicpps"><i class="fa fa-check"></i><b>8.2.1</b> Systematic pps sampling without replacement</a></li>
<li class="chapter" data-level="8.2.2" data-path="pps.html"><a href="pps.html#pivotalmethod"><i class="fa fa-check"></i><b>8.2.2</b> The pivotal method</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html"><i class="fa fa-check"></i><b>9</b> Balanced and well-spread sampling</a>
<ul>
<li class="chapter" data-level="9.1" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#Balanced"><i class="fa fa-check"></i><b>9.1</b> Balanced sampling</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#balanced-sample-versus-balanced-sampling-design"><i class="fa fa-check"></i><b>9.1.1</b> Balanced sample versus balanced sampling design</a></li>
<li class="chapter" data-level="9.1.2" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#unequal-inclusion-probabilities"><i class="fa fa-check"></i><b>9.1.2</b> Unequal inclusion probabilities</a></li>
<li class="chapter" data-level="9.1.3" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#StratifiedsamplingasBalancedsampling"><i class="fa fa-check"></i><b>9.1.3</b> Stratified random sampling</a></li>
<li class="chapter" data-level="9.1.4" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#Multiwaystratification"><i class="fa fa-check"></i><b>9.1.4</b> Multi-way stratification</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#Spreaded"><i class="fa fa-check"></i><b>9.2</b> Well-spread sampling</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#LPM"><i class="fa fa-check"></i><b>9.2.1</b> Local pivotal method</a></li>
<li class="chapter" data-level="9.2.2" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#GRTS"><i class="fa fa-check"></i><b>9.2.2</b> Generalised random-tessellation stratified sampling</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#BalancedandSpreaded"><i class="fa fa-check"></i><b>9.3</b> Balanced sampling with spreading</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="Modelassisted.html"><a href="Modelassisted.html"><i class="fa fa-check"></i><b>10</b> Model-assisted estimation</a>
<ul>
<li class="chapter" data-level="10.1" data-path="Modelassisted.html"><a href="Modelassisted.html#GREG"><i class="fa fa-check"></i><b>10.1</b> Generalised regression estimator</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="Modelassisted.html"><a href="Modelassisted.html#RegressionEstimator"><i class="fa fa-check"></i><b>10.1.1</b> Simple and multiple regression estimators</a></li>
<li class="chapter" data-level="10.1.2" data-path="Modelassisted.html"><a href="Modelassisted.html#penalised-least-squares-estimation"><i class="fa fa-check"></i><b>10.1.2</b> Penalised least squares estimation</a></li>
<li class="chapter" data-level="10.1.3" data-path="Modelassisted.html"><a href="Modelassisted.html#RegressionEstimatorSTSI"><i class="fa fa-check"></i><b>10.1.3</b> Regression estimator with stratified simple random sampling</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="Modelassisted.html"><a href="Modelassisted.html#RatioEstimator"><i class="fa fa-check"></i><b>10.2</b> Ratio estimator</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="Modelassisted.html"><a href="Modelassisted.html#RatioEstimatorSTSI"><i class="fa fa-check"></i><b>10.2.1</b> Ratio estimators with stratified simple random sampling</a></li>
<li class="chapter" data-level="10.2.2" data-path="Modelassisted.html"><a href="Modelassisted.html#PoststratifiedEstimator"><i class="fa fa-check"></i><b>10.2.2</b> Poststratified estimator</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="Modelassisted.html"><a href="Modelassisted.html#RandomForest"><i class="fa fa-check"></i><b>10.3</b> Model-assisted estimation using machine learning techniques</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="Modelassisted.html"><a href="Modelassisted.html#predicting-with-a-regression-tree"><i class="fa fa-check"></i><b>10.3.1</b> Predicting with a regression tree</a></li>
<li class="chapter" data-level="10.3.2" data-path="Modelassisted.html"><a href="Modelassisted.html#predicting-with-a-random-forest"><i class="fa fa-check"></i><b>10.3.2</b> Predicting with a random forest</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="Modelassisted.html"><a href="Modelassisted.html#big-data-and-volunteer-data"><i class="fa fa-check"></i><b>10.4</b> Big data and volunteer data</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="Twophase.html"><a href="Twophase.html"><i class="fa fa-check"></i><b>11</b> Two-phase random sampling</a>
<ul>
<li class="chapter" data-level="11.1" data-path="Twophase.html"><a href="Twophase.html#TwophaseStratification"><i class="fa fa-check"></i><b>11.1</b> Two-phase random sampling for stratification</a></li>
<li class="chapter" data-level="11.2" data-path="Twophase.html"><a href="Twophase.html#TwophaseRegression"><i class="fa fa-check"></i><b>11.2</b> Two-phase random sampling for regression</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html"><i class="fa fa-check"></i><b>12</b> Computing the required sample size</a>
<ul>
<li class="chapter" data-level="12.1" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#standard-error-of-estimator"><i class="fa fa-check"></i><b>12.1</b> Standard error of estimator</a></li>
<li class="chapter" data-level="12.2" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#ReqSampleSizeLengthCI"><i class="fa fa-check"></i><b>12.2</b> Length of confidence interval</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#length-of-confidence-interval-for-a-proportion"><i class="fa fa-check"></i><b>12.2.1</b> Length of confidence interval for a proportion</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#statistical-testing-of-hypothesis"><i class="fa fa-check"></i><b>12.3</b> Statistical testing of hypothesis</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#sample-size-for-testing-a-proportion"><i class="fa fa-check"></i><b>12.3.1</b> Sample size for testing a proportion</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#DesignEffect"><i class="fa fa-check"></i><b>12.4</b> Accounting for design effect</a></li>
<li class="chapter" data-level="12.5" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#BayesianSampleSize"><i class="fa fa-check"></i><b>12.5</b> Bayesian sample size determination</a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#bayesian-criteria-for-sample-size-computation"><i class="fa fa-check"></i><b>12.5.1</b> Bayesian criteria for sample size computation</a></li>
<li class="chapter" data-level="12.5.2" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#mixed-bayesian-likelihood-approach"><i class="fa fa-check"></i><b>12.5.2</b> Mixed Bayesian-likelihood approach</a></li>
<li class="chapter" data-level="12.5.3" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#estimation-of-population-mean"><i class="fa fa-check"></i><b>12.5.3</b> Estimation of population mean</a></li>
<li class="chapter" data-level="12.5.4" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#estimation-of-a-population-proportion"><i class="fa fa-check"></i><b>12.5.4</b> Estimation of a population proportion</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="MBpredictionofDesignVariance.html"><a href="MBpredictionofDesignVariance.html"><i class="fa fa-check"></i><b>13</b> Model-based optimisation of probability sampling designs</a>
<ul>
<li class="chapter" data-level="13.1" data-path="MBpredictionofDesignVariance.html"><a href="MBpredictionofDesignVariance.html#model-based-optimisation-of-sampling-design-type-and-sample-size"><i class="fa fa-check"></i><b>13.1</b> Model-based optimisation of sampling design type and sample size</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="MBpredictionofDesignVariance.html"><a href="MBpredictionofDesignVariance.html#AnalyticalApproach"><i class="fa fa-check"></i><b>13.1.1</b> Analytical approach</a></li>
<li class="chapter" data-level="13.1.2" data-path="MBpredictionofDesignVariance.html"><a href="MBpredictionofDesignVariance.html#GeostatisticalSimulationApproach"><i class="fa fa-check"></i><b>13.1.2</b> Geostatistical simulation approach</a></li>
<li class="chapter" data-level="13.1.3" data-path="MBpredictionofDesignVariance.html"><a href="MBpredictionofDesignVariance.html#MBpredSamplingVarBayes"><i class="fa fa-check"></i><b>13.1.3</b> Bayesian approach</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="MBpredictionofDesignVariance.html"><a href="MBpredictionofDesignVariance.html#Ospats"><i class="fa fa-check"></i><b>13.2</b> Model-based optimisation of spatial strata</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html"><i class="fa fa-check"></i><b>14</b> Sampling for estimating parameters of (small) domains</a>
<ul>
<li class="chapter" data-level="14.1" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#LargeDomainsDirectEstimator"><i class="fa fa-check"></i><b>14.1</b> Direct estimator for large domains</a></li>
<li class="chapter" data-level="14.2" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#SmallDomainsModelAssisted"><i class="fa fa-check"></i><b>14.2</b> Model-assisted estimators for small domains</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#RegressionestimatorSmallDomain"><i class="fa fa-check"></i><b>14.2.1</b> Regression estimator</a></li>
<li class="chapter" data-level="14.2.2" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#SyntheticestimatorSmallDomain"><i class="fa fa-check"></i><b>14.2.2</b> Synthetic estimator</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#SmallAreaModelBased"><i class="fa fa-check"></i><b>14.3</b> Model-based prediction</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#random-intercept-model"><i class="fa fa-check"></i><b>14.3.1</b> Random intercept model</a></li>
<li class="chapter" data-level="14.3.2" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#geostatistical-model"><i class="fa fa-check"></i><b>14.3.2</b> Geostatistical model</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#supplemental-probability-sampling-of-small-domains"><i class="fa fa-check"></i><b>14.4</b> Supplemental probability sampling of small domains</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html"><i class="fa fa-check"></i><b>15</b> Repeated sample surveys for monitoring population parameters</a>
<ul>
<li class="chapter" data-level="15.1" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#space-time-designs"><i class="fa fa-check"></i><b>15.1</b> Space-time designs</a></li>
<li class="chapter" data-level="15.2" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#SpaceTimeparameters"><i class="fa fa-check"></i><b>15.2</b> Space-time population parameters</a></li>
<li class="chapter" data-level="15.3" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#design-based-generalised-least-squares-estimation-of-spatial-means"><i class="fa fa-check"></i><b>15.3</b> Design-based generalised least squares estimation of spatial means</a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#current-mean"><i class="fa fa-check"></i><b>15.3.1</b> Current mean</a></li>
<li class="chapter" data-level="15.3.2" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#change-of-the-spatial-mean"><i class="fa fa-check"></i><b>15.3.2</b> Change of the spatial mean</a></li>
<li class="chapter" data-level="15.3.3" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#temporal-trend-of-the-spatial-mean"><i class="fa fa-check"></i><b>15.3.3</b> Temporal trend of the spatial mean</a></li>
<li class="chapter" data-level="15.3.4" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#space-time-mean"><i class="fa fa-check"></i><b>15.3.4</b> Space-time mean</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#case-study-annual-mean-daily-temperature-in-spain"><i class="fa fa-check"></i><b>15.4</b> Case study: annual mean daily temperature in Spain</a>
<ul>
<li class="chapter" data-level="15.4.1" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#static-synchronous-design"><i class="fa fa-check"></i><b>15.4.1</b> Static-synchronous design</a></li>
<li class="chapter" data-level="15.4.2" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#independent-synchronous-design"><i class="fa fa-check"></i><b>15.4.2</b> Independent synchronous design</a></li>
<li class="chapter" data-level="15.4.3" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#serially-alternating-design"><i class="fa fa-check"></i><b>15.4.3</b> Serially alternating design</a></li>
<li class="chapter" data-level="15.4.4" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#supplemented-panel-design"><i class="fa fa-check"></i><b>15.4.4</b> Supplemented panel design</a></li>
<li class="chapter" data-level="15.4.5" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#rotating-panel-design"><i class="fa fa-check"></i><b>15.4.5</b> Rotating panel design</a></li>
<li class="chapter" data-level="15.4.6" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#sampling-experiment"><i class="fa fa-check"></i><b>15.4.6</b> Sampling experiment</a></li>
</ul></li>
<li class="chapter" data-level="15.5" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#space-time-sampling-with-stratified-random-sampling-in-space"><i class="fa fa-check"></i><b>15.5</b> Space-time sampling with stratified random sampling in space</a></li>
</ul></li>
<li class="part"><span><b>II Sampling for mapping</b></span></li>
<li class="chapter" data-level="16" data-path="IntroSamplingforMapping.html"><a href="IntroSamplingforMapping.html"><i class="fa fa-check"></i><b>16</b> Introduction to sampling for mapping</a>
<ul>
<li class="chapter" data-level="16.1" data-path="IntroSamplingforMapping.html"><a href="IntroSamplingforMapping.html#when-is-probability-sampling-not-required"><i class="fa fa-check"></i><b>16.1</b> When is probability sampling not required?</a></li>
<li class="chapter" data-level="16.2" data-path="IntroSamplingforMapping.html"><a href="IntroSamplingforMapping.html#sampling-for-simultaneously-mapping-and-estimating-means"><i class="fa fa-check"></i><b>16.2</b> Sampling for simultaneously mapping and estimating means</a>
<ul>
<li class="chapter" data-level="16.2.1" data-path="IntroSamplingforMapping.html"><a href="IntroSamplingforMapping.html#balanced-stratified-random-sampling"><i class="fa fa-check"></i><b>16.2.1</b> Balanced stratified random sampling</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="IntroSamplingforMapping.html"><a href="IntroSamplingforMapping.html#broad-overview-of-sampling-designs-for-mapping"><i class="fa fa-check"></i><b>16.3</b> Broad overview of sampling designs for mapping</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="RegularGridSpatialCoverage.html"><a href="RegularGridSpatialCoverage.html"><i class="fa fa-check"></i><b>17</b> Regular grid and spatial coverage sampling</a>
<ul>
<li class="chapter" data-level="17.1" data-path="RegularGridSpatialCoverage.html"><a href="RegularGridSpatialCoverage.html#Regulargrid"><i class="fa fa-check"></i><b>17.1</b> Regular grid sampling</a></li>
<li class="chapter" data-level="17.2" data-path="RegularGridSpatialCoverage.html"><a href="RegularGridSpatialCoverage.html#SpatialCoverage"><i class="fa fa-check"></i><b>17.2</b> Spatial coverage sampling</a></li>
<li class="chapter" data-level="17.3" data-path="RegularGridSpatialCoverage.html"><a href="RegularGridSpatialCoverage.html#SpatialInfill"><i class="fa fa-check"></i><b>17.3</b> Spatial infill sampling</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="kmeans.html"><a href="kmeans.html"><i class="fa fa-check"></i><b>18</b> Covariate space coverage sampling</a>
<ul>
<li class="chapter" data-level="18.1" data-path="kmeans.html"><a href="kmeans.html#covariate-space-infill-sampling"><i class="fa fa-check"></i><b>18.1</b> Covariate space infill sampling</a></li>
<li class="chapter" data-level="18.2" data-path="kmeans.html"><a href="kmeans.html#PerformanceCSC"><i class="fa fa-check"></i><b>18.2</b> Performance of covariate space coverage sampling in random forest prediction</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="cLHS.html"><a href="cLHS.html"><i class="fa fa-check"></i><b>19</b> Conditioned Latin hypercube sampling</a>
<ul>
<li class="chapter" data-level="19.1" data-path="cLHS.html"><a href="cLHS.html#cLHIS"><i class="fa fa-check"></i><b>19.1</b> Conditioned Latin hypercube infill sampling</a></li>
<li class="chapter" data-level="19.2" data-path="cLHS.html"><a href="cLHS.html#performance-of-conditioned-latin-hypercube-sampling-in-random-forest-prediction"><i class="fa fa-check"></i><b>19.2</b> Performance of conditioned Latin hypercube sampling in random forest prediction</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="SpatialResponseSurface.html"><a href="SpatialResponseSurface.html"><i class="fa fa-check"></i><b>20</b> Spatial response surface sampling</a>
<ul>
<li class="chapter" data-level="20.1" data-path="SpatialResponseSurface.html"><a href="SpatialResponseSurface.html#IncreaseSampleSize"><i class="fa fa-check"></i><b>20.1</b> Increasing the sample size</a></li>
<li class="chapter" data-level="20.2" data-path="SpatialResponseSurface.html"><a href="SpatialResponseSurface.html#stratified-spatial-response-surface-sampling"><i class="fa fa-check"></i><b>20.2</b> Stratified spatial response surface sampling</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="Introkriging.html"><a href="Introkriging.html"><i class="fa fa-check"></i><b>21</b> Introduction to kriging</a>
<ul>
<li class="chapter" data-level="21.1" data-path="Introkriging.html"><a href="Introkriging.html#ordinary-kriging"><i class="fa fa-check"></i><b>21.1</b> Ordinary kriging</a></li>
<li class="chapter" data-level="21.2" data-path="Introkriging.html"><a href="Introkriging.html#BlockKriging"><i class="fa fa-check"></i><b>21.2</b> Block-kriging</a></li>
<li class="chapter" data-level="21.3" data-path="Introkriging.html"><a href="Introkriging.html#IntroKED"><i class="fa fa-check"></i><b>21.3</b> Kriging with an external drift</a></li>
<li class="chapter" data-level="21.4" data-path="Introkriging.html"><a href="Introkriging.html#VariogramEstimation"><i class="fa fa-check"></i><b>21.4</b> Estimating the semivariogram</a>
<ul>
<li class="chapter" data-level="21.4.1" data-path="Introkriging.html"><a href="Introkriging.html#MoM"><i class="fa fa-check"></i><b>21.4.1</b> Method-of-moments</a></li>
<li class="chapter" data-level="21.4.2" data-path="Introkriging.html"><a href="Introkriging.html#MLestimationVariogram"><i class="fa fa-check"></i><b>21.4.2</b> Maximum likelihood</a></li>
</ul></li>
<li class="chapter" data-level="21.5" data-path="Introkriging.html"><a href="Introkriging.html#ResidualVariogram"><i class="fa fa-check"></i><b>21.5</b> Estimating the residual semivariogram</a>
<ul>
<li class="chapter" data-level="21.5.1" data-path="Introkriging.html"><a href="Introkriging.html#IterativeMoM"><i class="fa fa-check"></i><b>21.5.1</b> Iterative method-of-moments</a></li>
<li class="chapter" data-level="21.5.2" data-path="Introkriging.html"><a href="Introkriging.html#REML"><i class="fa fa-check"></i><b>21.5.2</b> Restricted maximum likelihood</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="22" data-path="MBgridspacing.html"><a href="MBgridspacing.html"><i class="fa fa-check"></i><b>22</b> Model-based optimisation of the grid spacing</a>
<ul>
<li class="chapter" data-level="22.1" data-path="MBgridspacing.html"><a href="MBgridspacing.html#GridspacingOK"><i class="fa fa-check"></i><b>22.1</b> Optimal grid spacing for ordinary kriging</a></li>
<li class="chapter" data-level="22.2" data-path="MBgridspacing.html"><a href="MBgridspacing.html#controlling-the-mean-or-a-quantile-of-the-ordinary-kriging-variance"><i class="fa fa-check"></i><b>22.2</b> Controlling the mean or a quantile of the ordinary kriging variance</a></li>
<li class="chapter" data-level="22.3" data-path="MBgridspacing.html"><a href="MBgridspacing.html#optimal-grid-spacing-for-block-kriging"><i class="fa fa-check"></i><b>22.3</b> Optimal grid spacing for block-kriging</a></li>
<li class="chapter" data-level="22.4" data-path="MBgridspacing.html"><a href="MBgridspacing.html#MBgridspacingKED"><i class="fa fa-check"></i><b>22.4</b> Optimal grid spacing for kriging with an external drift</a></li>
<li class="chapter" data-level="22.5" data-path="MBgridspacing.html"><a href="MBgridspacing.html#BayesianGridSpacing"><i class="fa fa-check"></i><b>22.5</b> Bayesian approach</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="MBSamplePattern.html"><a href="MBSamplePattern.html"><i class="fa fa-check"></i><b>23</b> Model-based optimisation of the sampling pattern</a>
<ul>
<li class="chapter" data-level="23.1" data-path="MBSamplePattern.html"><a href="MBSamplePattern.html#SSA"><i class="fa fa-check"></i><b>23.1</b> Spatial simulated annealing</a></li>
<li class="chapter" data-level="23.2" data-path="MBSamplePattern.html"><a href="MBSamplePattern.html#SamplePatternOK"><i class="fa fa-check"></i><b>23.2</b> Optimising the sampling pattern for ordinary kriging</a></li>
<li class="chapter" data-level="23.3" data-path="MBSamplePattern.html"><a href="MBSamplePattern.html#SamplePatternKED"><i class="fa fa-check"></i><b>23.3</b> Optimising the sampling pattern for kriging with an external drift</a></li>
<li class="chapter" data-level="23.4" data-path="MBSamplePattern.html"><a href="MBSamplePattern.html#model-based-infill-sampling-for-ordinary-kriging"><i class="fa fa-check"></i><b>23.4</b> Model-based infill sampling for ordinary kriging</a></li>
<li class="chapter" data-level="23.5" data-path="MBSamplePattern.html"><a href="MBSamplePattern.html#model-based-infill-sampling-for-kriging-with-an-external-drift"><i class="fa fa-check"></i><b>23.5</b> Model-based infill sampling for kriging with an external drift</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html"><i class="fa fa-check"></i><b>24</b> Sampling for estimating the semivariogram</a>
<ul>
<li class="chapter" data-level="24.1" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#nested-sampling"><i class="fa fa-check"></i><b>24.1</b> Nested sampling</a></li>
<li class="chapter" data-level="24.2" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#independent-sampling-of-pairs-of-points"><i class="fa fa-check"></i><b>24.2</b> Independent sampling of pairs of points</a></li>
<li class="chapter" data-level="24.3" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#samplingforvariogram"><i class="fa fa-check"></i><b>24.3</b> Optimisation of sampling pattern for semivariogram estimation</a>
<ul>
<li class="chapter" data-level="24.3.1" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#UncertainSemivariogramParameters"><i class="fa fa-check"></i><b>24.3.1</b> Uncertainty about semivariogram parameters</a></li>
<li class="chapter" data-level="24.3.2" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#UncertainKrigingVariance"><i class="fa fa-check"></i><b>24.3.2</b> Uncertainty about the kriging variance</a></li>
</ul></li>
<li class="chapter" data-level="24.4" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#SamplingEstimationandPrediction"><i class="fa fa-check"></i><b>24.4</b> Optimisation of sampling pattern for semivariogram estimation and mapping</a></li>
<li class="chapter" data-level="24.5" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#a-practical-solution"><i class="fa fa-check"></i><b>24.5</b> A practical solution</a></li>
</ul></li>
<li class="chapter" data-level="25" data-path="Validation.html"><a href="Validation.html"><i class="fa fa-check"></i><b>25</b> Sampling for validation of maps</a>
<ul>
<li class="chapter" data-level="25.1" data-path="Validation.html"><a href="Validation.html#map-quality-indices"><i class="fa fa-check"></i><b>25.1</b> Map quality indices</a>
<ul>
<li class="chapter" data-level="25.1.1" data-path="Validation.html"><a href="Validation.html#estimation-of-map-quality-indices"><i class="fa fa-check"></i><b>25.1.1</b> Estimation of map quality indices</a></li>
</ul></li>
<li class="chapter" data-level="25.2" data-path="Validation.html"><a href="Validation.html#real-world-case-study"><i class="fa fa-check"></i><b>25.2</b> Real-world case study</a>
<ul>
<li class="chapter" data-level="25.2.1" data-path="Validation.html"><a href="Validation.html#estimation-of-the-population-mean-error-and-mean-squared-error"><i class="fa fa-check"></i><b>25.2.1</b> Estimation of the population Mean Error and Mean Squared Error</a></li>
<li class="chapter" data-level="25.2.2" data-path="Validation.html"><a href="Validation.html#estimation-of-the-standard-error-of-the-estimated-population-me-and-mse"><i class="fa fa-check"></i><b>25.2.2</b> Estimation of the standard error of the estimated population ME and MSE</a></li>
<li class="chapter" data-level="25.2.3" data-path="Validation.html"><a href="Validation.html#estimation-of-mec"><i class="fa fa-check"></i><b>25.2.3</b> Estimation of MEC</a></li>
<li class="chapter" data-level="25.2.4" data-path="Validation.html"><a href="Validation.html#statistical-testing-of-hypothesis-about-population-me-and-mse"><i class="fa fa-check"></i><b>25.2.4</b> Statistical testing of hypothesis about population ME and MSE</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="26" data-path="Approaches.html"><a href="Approaches.html"><i class="fa fa-check"></i><b>26</b> Design-based, model-based, and model-assisted approach for sampling and inference</a>
<ul>
<li class="chapter" data-level="26.1" data-path="Approaches.html"><a href="Approaches.html#two-sources-of-randomness"><i class="fa fa-check"></i><b>26.1</b> Two sources of randomness</a></li>
<li class="chapter" data-level="26.2" data-path="Approaches.html"><a href="Approaches.html#iid"><i class="fa fa-check"></i><b>26.2</b> “Identically and independently distributed” (i.i.d.)</a></li>
<li class="chapter" data-level="26.3" data-path="Approaches.html"><a href="Approaches.html#BiasandVariance"><i class="fa fa-check"></i><b>26.3</b> Bias and variance</a></li>
<li class="chapter" data-level="26.4" data-path="Approaches.html"><a href="Approaches.html#effectivesamplesize"><i class="fa fa-check"></i><b>26.4</b> Effective sample size</a></li>
<li class="chapter" data-level="26.5" data-path="Approaches.html"><a href="Approaches.html#ExploitSpatialStructure"><i class="fa fa-check"></i><b>26.5</b> Exploiting spatial structure in design-based approach</a></li>
<li class="chapter" data-level="26.6" data-path="Approaches.html"><a href="Approaches.html#ModelassistedvsModeldependent"><i class="fa fa-check"></i><b>26.6</b> Model-assisted versus model-dependent</a></li>
</ul></li>
<li class="appendix"><span><b>Appendices</b></span></li>
<li class="chapter" data-level="A" data-path="Answers.html"><a href="Answers.html"><i class="fa fa-check"></i><b>A</b> Answers to exercises</a>
<ul>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#introduction-to-probability-sampling"><i class="fa fa-check"></i>Introduction to probability sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#simple-random-sampling-1"><i class="fa fa-check"></i>Simple random sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#stratified-random-sampling"><i class="fa fa-check"></i>Stratified random sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#systematic-random-sampling-2"><i class="fa fa-check"></i>Systematic random sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#cluster-random-sampling"><i class="fa fa-check"></i>Cluster random sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#two-stage-random-sampling"><i class="fa fa-check"></i>Two-stage random sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#sampling-with-probabilities-proportional-to-size"><i class="fa fa-check"></i>Sampling with probabilities proportional to size</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#balanced-and-well-spread-sampling"><i class="fa fa-check"></i>Balanced and well-spread sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#model-assisted-estimation"><i class="fa fa-check"></i>Model-assisted estimation</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#two-phase-random-sampling"><i class="fa fa-check"></i>Two-phase random sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#computing-the-required-sample-size"><i class="fa fa-check"></i>Computing the required sample size</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#model-based-optimisation-of-probability-sampling-designs"><i class="fa fa-check"></i>Model-based optimisation of probability sampling designs</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#repeated-sample-surveys-for-monitoring-population-parameters"><i class="fa fa-check"></i>Repeated sample surveys for monitoring population parameters</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#regular-grid-and-spatial-coverage-sampling"><i class="fa fa-check"></i>Regular grid and spatial coverage sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#covariate-space-coverage-sampling"><i class="fa fa-check"></i>Covariate space coverage sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#conditioned-latin-hypercube-sampling"><i class="fa fa-check"></i>Conditioned Latin hypercube sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#model-based-optimisation-of-the-grid-spacing"><i class="fa fa-check"></i>Model-based optimisation of the grid spacing</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#model-based-optimisation-of-the-sampling-pattern"><i class="fa fa-check"></i>Model-based optimisation of the sampling pattern</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#sampling-for-estimating-the-semivariogram"><i class="fa fa-check"></i>Sampling for estimating the semivariogram</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#sampling-for-validation-of-maps"><i class="fa fa-check"></i>Sampling for validation of maps</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/DickBrus/">Dick Brus</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Spatial sampling with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="Twostage" class="section level1" number="7">
<h1><span class="header-section-number">Chapter 7</span> Two-stage cluster random sampling</h1>
<p>As opposed to cluster random sampling in which all population units of a cluster are observed (Chapter <a href="Cl.html#Cl">6</a>), in two-stage cluster random sampling not all units of the selected clusters are observed, but only some of them. In two-stage cluster random sampling the clusters will generally be contiguous groups of units, for instance all points in a map polygon (the polygons on the map are the clusters), whereas in single-stage cluster random sampling the clusters generally are non-contiguous. The units to be observed are selected by random subsampling of the randomly selected clusters. In two-stage cluster sampling the clusters are commonly referred to as primary sampling units (PSUs) and the units selected in the second stage as the secondary sampling units (SSUs).</p>
<p>As with cluster random sampling, two-stage cluster random sampling may lead to a strong spatial clustering of the selected population units in the study area. This may save considerable time for fieldwork, and more population units can be observed for the same budget. However, due to the spatial clustering the estimates will generally be less precise compared to samples of the same size selected by a design that leads to a much better spreading of the sampling units throughout the study area, such as systematic random sampling.</p>
<p>In two-stage cluster random sampling in principle any type of sampling design can be used at the two stages, leading to numerous combinations. An example is (SI,SI), in which both PSUs and SSUs are selected by simple random sampling.</p>
<p>Commonly the PSUs have unequal size, i.e. the number of SSUs (finite population) or the area (infinite population) are not equal for all PSUs. Think for instance of the agricultural fields, forest stands, lakes, river sections, etc. in an area. If the PSUs are of unequal size, then PSUs can best be selected with probabilities proportional to their size (pps). Recall that in (one-stage) cluster random sampling I also recommended to select the clusters with probabilities proportional to their size, see Chapter <a href="Cl.html#Cl">6</a>. If the total of the study variable of a PSU is proportional to its size, then pps sampling leads to more precise estimates compared to simple random sampling of PSUs. Also, with pps sampling of PSUs the estimation of means or totals and of their sampling variances is much simpler compared to selection with equal probabilities. Implementation of selection with probabilities proportional to size is easiest when units are replaced (pps with replacement, ppswr). This implies that a PSU might be selected more than once, especially if the total number of PSUs in the population is small compared to the number of PSU draws (large sampling fraction in first stage).</p>
<p>Using a list as a sampling frame, the following algorithm can be used to select <span class="math inline">\(n\)</span> times a PSU by ppswr from a total of <span class="math inline">\(N\)</span> PSUs in the population:</p>
<ol style="list-style-type: decimal">
<li>Select randomly one SSU from the list with <span class="math inline">\(M=\sum_{j=1}^N M_j\)</span> SSUs (<span class="math inline">\(M_j\)</span> is the number of SSUs of PSU <span class="math inline">\(j\)</span>), and determine the PSU of the selected SSU.<br />
</li>
<li>Repeat step 1 until <span class="math inline">\(n\)</span> selections have been made.</li>
</ol>
<p>In the first stage a SSU is selected in order to select a PSU. This may seem unnecessarily complicated. The reason for this is that this procedure automatically adjusts for the size of the PSUs (number of SSUs within a PSU), i.e. a PSU is selected with probability proportional to its size. In the second stage, a pre-determined number of SSUs, <span class="math inline">\(m_{j}\)</span>, is selected every time PSU <span class="math inline">\(j\)</span> is selected.</p>
<p>Note that the SSU selected in the first step of the two algorithms primarily serves to identify the PSU, but these SSUs can also be used as selected SSUs.</p>
<p>The selection of a two-stage cluster random sample is illustrated again with Voorst. Twenty-four 0.5 km squares are constructed that serve as PSUs.</p>

<div class="rmdnote">
Due to built-up areas, roads, etc., the PSUs in Voorst have unequal size, i.e. the number of SSUs (points in our case) within the PSUs varies among the PSUs.
</div>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="Twostage.html#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;data/Voorst.RData&quot;</span>)</span>
<span id="cb124-2"><a href="Twostage.html#cb124-2" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="dv">500</span> <span class="co">#width of PSUs</span></span>
<span id="cb124-3"><a href="Twostage.html#cb124-3" aria-hidden="true" tabindex="-1"></a>s1bnd <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="fu">min</span>(grdVoorst<span class="sc">$</span>s1)<span class="sc">+</span>w, <span class="at">to=</span><span class="fu">min</span>(grdVoorst<span class="sc">$</span>s1)<span class="sc">+</span>(<span class="dv">11</span><span class="sc">*</span>w), <span class="at">by=</span>w)<span class="sc">+</span><span class="fl">12.5</span></span>
<span id="cb124-4"><a href="Twostage.html#cb124-4" aria-hidden="true" tabindex="-1"></a>s1f <span class="ot">&lt;-</span> <span class="fu">findInterval</span>(grdVoorst<span class="sc">$</span>s1,s1bnd)</span>
<span id="cb124-5"><a href="Twostage.html#cb124-5" aria-hidden="true" tabindex="-1"></a>s2bnd <span class="ot">&lt;-</span> <span class="fu">min</span>(grdVoorst<span class="sc">$</span>s2)<span class="sc">+</span>w<span class="fl">+12.5</span></span>
<span id="cb124-6"><a href="Twostage.html#cb124-6" aria-hidden="true" tabindex="-1"></a>s2f <span class="ot">&lt;-</span> <span class="fu">findInterval</span>(grdVoorst<span class="sc">$</span>s2, s2bnd)</span>
<span id="cb124-7"><a href="Twostage.html#cb124-7" aria-hidden="true" tabindex="-1"></a>grdVoorst<span class="sc">$</span>psu <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">interaction</span>(s1f, s2f))</span></code></pre></div>
<p>In the next code chunk a function is defined to select a two-stage cluster random sample from an infinite population, discretised by finite number of points (centres of grid cells).</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="Twostage.html#cb125-1" aria-hidden="true" tabindex="-1"></a>twostage <span class="ot">&lt;-</span> <span class="cf">function</span>(sframe, psu, n, m) {</span>
<span id="cb125-2"><a href="Twostage.html#cb125-2" aria-hidden="true" tabindex="-1"></a>  units <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(sframe), <span class="at">size=</span>n, <span class="at">replace=</span><span class="cn">TRUE</span>)</span>
<span id="cb125-3"><a href="Twostage.html#cb125-3" aria-hidden="true" tabindex="-1"></a>  mypsusample <span class="ot">&lt;-</span> sframe[units,psu]</span>
<span id="cb125-4"><a href="Twostage.html#cb125-4" aria-hidden="true" tabindex="-1"></a>  ssunits <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb125-5"><a href="Twostage.html#cb125-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (psunit <span class="cf">in</span> mypsusample) {</span>
<span id="cb125-6"><a href="Twostage.html#cb125-6" aria-hidden="true" tabindex="-1"></a>    ssunit <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="at">x =</span> <span class="fu">which</span>(sframe[,psu]<span class="sc">==</span>psunit), <span class="at">size=</span>m, <span class="at">replace=</span><span class="cn">TRUE</span>)</span>
<span id="cb125-7"><a href="Twostage.html#cb125-7" aria-hidden="true" tabindex="-1"></a>    ssunits <span class="ot">&lt;-</span> <span class="fu">c</span>(ssunits, ssunit)</span>
<span id="cb125-8"><a href="Twostage.html#cb125-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb125-9"><a href="Twostage.html#cb125-9" aria-hidden="true" tabindex="-1"></a>  psudraw <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>n), <span class="at">each=</span>m)</span>
<span id="cb125-10"><a href="Twostage.html#cb125-10" aria-hidden="true" tabindex="-1"></a>  mysample <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(ssunits,sframe[ssunits,], psudraw)</span>
<span id="cb125-11"><a href="Twostage.html#cb125-11" aria-hidden="true" tabindex="-1"></a>  mysample</span>
<span id="cb125-12"><a href="Twostage.html#cb125-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Note that both the PSUs and the SSUs are selected with replacement. If a grid cell centre is selected, one point is selected fully randomly from that grid cell. This is done by shifting the centre of the grid cell to a random point within the selected grid cell with function <code>jitter</code>, see code chunk hereafter. In every grid cell there is an infinite number of points, so we must select the grid cell centres with replacement. If a grid cell is selected more than once, more than one point is selected from the associated grid cell. Column <code>psudraw</code> in the output data frame of function <code>twostage</code> is needed in estimation because PSUs are selected with replacement. In case a PSU is selected more than once, multiple estimates of the mean of that PSU are used in estimation, see next section.</p>
<p>In the next code chunk function <code>twostage</code> is used to select four times a PSU (<span class="math inline">\(n=4\)</span>), with probabilities proportional to size and with replacement (ppswr). The second stage sample size equals 10 for all PSUs (<span class="math inline">\(m_j=10,\; j = 1, \cdots, N\)</span>). These SSUs are selected by simple random sampling.</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="Twostage.html#cb126-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb126-2"><a href="Twostage.html#cb126-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb126-3"><a href="Twostage.html#cb126-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">314</span>)</span>
<span id="cb126-4"><a href="Twostage.html#cb126-4" aria-hidden="true" tabindex="-1"></a>mysample <span class="ot">&lt;-</span> <span class="fu">twostage</span>(<span class="at">sframe=</span>grdVoorst, <span class="at">psu=</span><span class="st">&quot;psu&quot;</span>, <span class="at">n=</span>n, <span class="at">m=</span>m)</span>
<span id="cb126-5"><a href="Twostage.html#cb126-5" aria-hidden="true" tabindex="-1"></a>cellsize <span class="ot">&lt;-</span> <span class="dv">25</span></span>
<span id="cb126-6"><a href="Twostage.html#cb126-6" aria-hidden="true" tabindex="-1"></a>mysample<span class="sc">$</span>s1 <span class="ot">&lt;-</span> <span class="fu">jitter</span>(mysample<span class="sc">$</span>s1, <span class="at">amount=</span>cellsize<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb126-7"><a href="Twostage.html#cb126-7" aria-hidden="true" tabindex="-1"></a>mysample<span class="sc">$</span>s2 <span class="ot">&lt;-</span> <span class="fu">jitter</span>(mysample<span class="sc">$</span>s2, <span class="at">amount=</span>cellsize<span class="sc">/</span><span class="dv">2</span>)</span></code></pre></div>
<p>Figure <a href="Twostage.html#fig:TwostageVoorst">7.1</a> shows the selected sample.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:TwostageVoorst"></span>
<img src="SpatialSampling_files/figure-html/TwostageVoorst-1.png" alt="Two-stage cluster random sample from Voorst. PSUs are 0.5 km squares, built-up areas, roads, etc. excluded. Four times a PSU is selected by ppswr. Each time a PSU is selected, ten SSus (points) are selected from that PSU by simple random sampling." width="100%" />
<p class="caption">
Figure 7.1: Two-stage cluster random sample from Voorst. PSUs are 0.5 km squares, built-up areas, roads, etc. excluded. Four times a PSU is selected by ppswr. Each time a PSU is selected, ten SSus (points) are selected from that PSU by simple random sampling.
</p>
</div>
<div id="twostagesamplingestimators" class="section level2" number="7.1">
<h2><span class="header-section-number">7.1</span> Estimation of population parameters</h2>
<p>The population total can be estimated by substituting the estimated cluster (PSU) totals in Equation <a href="Cl.html#eq:EstTotalCl">(6.4)</a>. This yields the following estimator for the population total:</p>
<p><span class="math display" id="eq:EstTotalTwostage">\[\begin{equation}
\hat{t}(z) = \frac{M}{n} \sum_{j \in \mathcal{S}} \frac{\hat{t}_{j}(z)}{M_{j}} = \frac{M}{n} \sum_{j \in \mathcal{S}} \hat{\bar{z}}_{j} \;,
\tag{7.1}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(n\)</span> is the number of PSU selections and <span class="math inline">\(M_{j}\)</span> is total number of SSUs in PSU <span class="math inline">\(j\)</span>. This shows that the mean of cluster <span class="math inline">\(j\)</span>, <span class="math inline">\(\bar{z}_j\)</span>, is replaced by the estimated mean of PSU <span class="math inline">\(j\)</span>, <span class="math inline">\(\hat{\bar{z}}_j\)</span>. Dividing this estimator by the total number of population units <span class="math inline">\(M\)</span> gives the pwr estimator of the population mean:</p>
<p><span class="math display" id="eq:EstMeanTwostage">\[\begin{equation}
\hat{\bar{\bar{z}}}=
\frac{1}{n}\sum\limits_{j \in \mathcal{S}}\hat{\bar{z}}_{j} \;,
\tag{7.2}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(\hat{\bar{z}}_{j}\)</span> the estimated mean of the PSU <span class="math inline">\(j\)</span>. With simple random sampling of SSUs this mean can be estimated by the sample mean of this PSU. Note the two bars in <span class="math inline">\(\hat{\bar{\bar{z}}}\)</span>, indicating that the population mean is estimated as the mean of estimated PSU means. When <span class="math inline">\(m_j\)</span> is equal for all PSUs the sampling design is self-weighting, i.e. the average of <span class="math inline">\(z\)</span> over all selected SSUs is an unbiased estimator of the population mean.</p>
<p>For an infinite population of points the population total is estimated by multiplying the estimated population mean (Equation <a href="Twostage.html#eq:EstMeanTwostage">(7.2)</a>) by the area of the study area.</p>
<p>The sampling variance of the estimator of the mean with two-stage cluster random sampling (PSUs selected with probabilities proportional to size with replacement, SSUs selected by simple random sampling (with replacement in case of finite populations), and <span class="math inline">\(m_j = m, \; j = 1, \cdots, N\)</span>) is equal to (<span class="citation"><a href="#ref-coc77" role="doc-biblioref">Cochran</a> (<a href="#ref-coc77" role="doc-biblioref">1977</a>)</span>, Equation (11.33)<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>)</p>
<p><span class="math display" id="eq:TrueVarEstMeanTwostage">\[\begin{equation}
V(\hat{\bar{\bar{z}}}) = \frac{S^2_{\mathrm{b}}}{n} + \frac{S^2_{\mathrm{w}}}{n\;m} \;,
\tag{7.3}
\end{equation}\]</span></p>
<p>with</p>
<p><span class="math display" id="eq:PooledBetweenClusterVariance">\[\begin{equation}
S^2_{\mathrm{b}}=\sum_{j=1}^N p_j\left(\bar{z}_j-\bar{z}\right)^2
\tag{7.4}
\end{equation}\]</span></p>
<p>and</p>
<p><span class="math display" id="eq:PooledWithinClusterVariance">\[\begin{equation}
S^2_{\mathrm{w}}=\sum_{j=1}^N p_j S^2_j \;,
\tag{7.5}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(N\)</span> the total number of PSUs in the population, <span class="math inline">\(p_j=M_j/M\)</span> the draw-by-draw selection probability of PSU <span class="math inline">\(j\)</span>, <span class="math inline">\(\bar{z}_j\)</span> the mean of PSU <span class="math inline">\(j\)</span>, <span class="math inline">\(\bar{z}\)</span> the population mean of <span class="math inline">\(z\)</span>, and <span class="math inline">\(S^2_j\)</span> the variance of <span class="math inline">\(z\)</span> within PSU <span class="math inline">\(j\)</span>:</p>
<p><span class="math display" id="eq:WithinClusterVariance">\[\begin{equation}
S^2_j = \frac{1}{M_j} \sum_{k=1}^{M_j} (z_{kj}-\bar{z}_j)^2 \;.
\tag{7.6}
\end{equation}\]</span></p>

<div class="rmdnote">
The first term of Equation <a href="Twostage.html#eq:TrueVarEstMeanTwostage">(7.3)</a> is equal to the variance of Equation <a href="Cl.html#eq:TrueVarEstMeanCl">(6.6)</a>. This variance component accounts for the variance of the true PSU means within the population. The second variance component quantifies our additional uncertainty about the population mean, as we do not observe all SSUs of the selected PSUs, but only a subset (sample) of these units.
</div>
<p>The sampling variance of the estimator of the population mean can simply be estimated by</p>
<p><span class="math display" id="eq:VarEstMeanTwostage">\[\begin{equation}
\widehat{V}\!\left(\hat{\bar{\bar{z}}}\right)=\frac{\widehat{S^2}(\hat{\bar{z}})}{n}  \;,
\tag{7.7}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(\widehat{S^2}(\hat{\bar{z}})\)</span> the estimated variance of the <em>estimated</em> PSU means:</p>
<p><span class="math display" id="eq:S2psuMeans">\[\begin{equation}
\widehat{S^2}(\hat{\bar{z}}) = \frac{1}{n-1}\sum_{j \in \mathcal{S}}(\hat{\bar{z}}_{j}-\hat{\bar{\bar{z}}})^2 \;,
\tag{7.8}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(\hat{\bar{z}}_{j}\)</span> the estimated mean of PSU <span class="math inline">\(j\)</span> and <span class="math inline">\(\hat{\bar{\bar{z}}}\)</span> the estimated population mean (Equation <a href="Twostage.html#eq:EstMeanTwostage">(7.2)</a>).</p>

<div class="rmdnote">
Neither the sizes of the PSUs, <span class="math inline">\(M_j\)</span>, nor the secondary sample sizes <span class="math inline">\(m_{j}\)</span> occur in Equations <a href="Twostage.html#eq:VarEstMeanTwostage">(7.7)</a> and <a href="Twostage.html#eq:S2psuMeans">(7.8)</a>. This simplicity is due to the fact that the PSUs are selected with replacement and with probabilities proportional to size. The effect of the secondary sample sizes on the variance is implicitly accounted for. To understand this, note that the larger <span class="math inline">\(m_{j}\)</span>, the less variable <span class="math inline">\(\hat{\bar{z}}_{j}\)</span>, and the smaller its contribution to the variance.
</div>
<p>Let us assume a linear model for the total costs: <span class="math inline">\(C = c_0 + c_1n + c_2nm\)</span>, with <span class="math inline">\(c_0\)</span> the fixed costs, <span class="math inline">\(c_1\)</span> the costs per PSU, and <span class="math inline">\(c_2\)</span> the costs per SSU. We want to minimise the total costs, under the constraint that the variance of the estimator of the population mean may not exceed <span class="math inline">\(V_{\mathrm{max}}\)</span>. The total costs can then be minimised by selecting <span class="citation">(<a href="#ref-gru06" role="doc-biblioref">de Gruijter et al. 2006</a>)</span></p>
<p><span class="math display" id="eq:nopt">\[\begin{equation}
n=\frac{1}{V_{\mathrm{max}}}\left(S_{\mathrm{w}}S_{\mathrm{b}}\sqrt{\frac{c_2}{c_1}}+S^2_{\mathrm{b}}\right)
\tag{7.9}
\end{equation}\]</span></p>
<p>PSUs and</p>
<p><span class="math display" id="eq:mopt">\[\begin{equation}
m=\frac{S_{\mathrm{w}}}{S_{\mathrm{b}}}\sqrt{\frac{c_1}{c_2}}
\tag{7.10}
\end{equation}\]</span></p>
<p>SSUs per PSU.</p>
<p>Conversely, given a budget <span class="math inline">\(C_{\mathrm{max}}\)</span>, the optimal number of PSU selections can be computed with <span class="citation">(<a href="#ref-gru06" role="doc-biblioref">de Gruijter et al. 2006</a>)</span></p>
<p><span class="math display" id="eq:nopt2">\[\begin{equation}
n=\frac{C_{\mathrm{max}}S_{\mathrm{b}}}{S_{\mathrm{w}}\sqrt{c_1c_2}+S_{\mathrm{b}}c_1}\;,
\tag{7.11}
\end{equation}\]</span></p>
<p>and <span class="math inline">\(m\)</span> as above.</p>
<p>In <strong>R</strong> the population mean and the sampling variance of the estimator of the mean can be estimated as follows.</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="Twostage.html#cb127-1" aria-hidden="true" tabindex="-1"></a>mz_psu <span class="ot">&lt;-</span> <span class="fu">tapply</span>(mysample<span class="sc">$</span>z, <span class="at">INDEX=</span>mysample<span class="sc">$</span>psudraw, <span class="at">FUN=</span>mean)</span>
<span id="cb127-2"><a href="Twostage.html#cb127-2" aria-hidden="true" tabindex="-1"></a>mz <span class="ot">&lt;-</span> <span class="fu">mean</span>(mz_psu)</span>
<span id="cb127-3"><a href="Twostage.html#cb127-3" aria-hidden="true" tabindex="-1"></a>se_mz <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">var</span>(mz_psu)<span class="sc">/</span>n)</span></code></pre></div>
<p>The estimated mean equals 7.094 g kg<sup>-1</sup>, and the estimated standard error equals 1.428 g kg<sup>-1</sup>. The sampling design is self-weighting, and so the estimated mean is equal to the sample mean.</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="Twostage.html#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">mean</span>(mysample<span class="sc">$</span>z))</span></code></pre></div>
<pre><code>[1] 7.093781</code></pre>
<p>The same estimate is obtained with functions <code>svydesign</code> and <code>svymean</code> of package <strong>survey</strong> <span class="citation">(<a href="#ref-Lumley2020" role="doc-biblioref">Lumley 2021</a>)</span>. The estimator of the population total can be written as a weighted sum of the observations with all weights equal to <span class="math inline">\(M/(n\;m)\)</span>. These weights are assigned to argument <code>weight</code>.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="Twostage.html#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb130-2"><a href="Twostage.html#cb130-2" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="fu">nrow</span>(grdVoorst)</span>
<span id="cb130-3"><a href="Twostage.html#cb130-3" aria-hidden="true" tabindex="-1"></a>mysample<span class="sc">$</span>weights <span class="ot">&lt;-</span> M<span class="sc">/</span>(n<span class="sc">*</span>m)</span>
<span id="cb130-4"><a href="Twostage.html#cb130-4" aria-hidden="true" tabindex="-1"></a>design_2stage <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">id=</span><span class="sc">~</span>psudraw<span class="sc">+</span>ssunits, <span class="at">weight=</span><span class="sc">~</span>weights, <span class="at">data=</span>mysample)</span>
<span id="cb130-5"><a href="Twostage.html#cb130-5" aria-hidden="true" tabindex="-1"></a><span class="fu">svymean</span>(<span class="sc">~</span>z, design_2stage, <span class="at">deff=</span><span class="st">&quot;replace&quot;</span>)</span></code></pre></div>
<pre><code>    mean     SE   DEff
z 7.0938 1.4281 3.1686</code></pre>
<p>Similar to (one-stage) cluster random sampling the estimated design effect is much larger than 1.</p>
<p>A confidence interval estimate of the population mean can be computed with method <code>confint</code>. The number of degrees of freedom equals the number of PSU draws minus 1.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="Twostage.html#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(<span class="fu">svymean</span>(<span class="sc">~</span>z, design_2stage, <span class="at">df=</span><span class="fu">degf</span>(design_2stage), <span class="at">level=</span><span class="fl">0.95</span>))</span></code></pre></div>
<pre><code>     2.5 %   97.5 %
z 4.294756 9.892806</code></pre>
<p>Figure <a href="Twostage.html#fig:SamplingDistributionTwostage">7.2</a> shows the approximated sampling distribution of the pwr estimator of the population mean with two-stage cluster random sampling and of the <span class="math inline">\(\pi\)</span> estimator with simple random sampling from Voorst, obtained by repeating the random sampling with each design and estimation 10,000 times. For simple random sampling the sample size is equal to <span class="math inline">\(n \times m\)</span>.</p>

<div class="figure" style="text-align: center"><span style="display:block;" id="fig:SamplingDistributionTwostage"></span>
<img src="SpatialSampling_files/figure-html/SamplingDistributionTwostage-1.png" alt="Approximated sampling distribution of the pwr estimator of the mean SOM concentration (g kg-1) in Voorst with two-stage cluster random sampling (Twostage) and of the \(\pi\) estimator with simple random sampling (SI). The sample size with both sampling designs is 40. In two-stage sampling four PSUs are selected by ppswr and ten SSus (points) are selected per PSU-draw by simple random sampling." width="80%" />
<p class="caption">
Figure 7.2: Approximated sampling distribution of the pwr estimator of the mean SOM concentration (g kg<sup>-1</sup>) in Voorst with two-stage cluster random sampling (Twostage) and of the <span class="math inline">\(\pi\)</span> estimator with simple random sampling (SI). The sample size with both sampling designs is 40. In two-stage sampling four PSUs are selected by ppswr and ten SSus (points) are selected per PSU-draw by simple random sampling.
</p>
</div>
<p>The variance of the 10,000 means with two-stage cluster random sampling equals 1.238. This is considerably larger than with simple random sampling: 0.429. The average of the estimated variances with two-stage cluster random sampling equals 1.218.</p>
<p>Optimal sample sizes for two-stage cluster random sampling (ppswr in first stage, simple random sampling without replacement in second stage) can be computed with function <code>clusOpt2</code> of <strong>R</strong> package <strong>PracTools</strong> (<span class="citation"><a href="#ref-PracTools" role="doc-biblioref">Valliant, Dever, and Kreuter</a> (<a href="#ref-PracTools" role="doc-biblioref">2021</a>)</span>, <span class="citation"><a href="#ref-Vaillant2018" role="doc-biblioref">Valliant, Dever, and Kreuter</a> (<a href="#ref-Vaillant2018" role="doc-biblioref">2018</a>)</span>). This function requires as input various variance measures, which can be computed with function <code>BW2stagePPS</code>, in case the study variable is known for the whole population, or estimated from a sample with function <code>BW2stagePPSe</code>. This is left as an exercise (Exercise 5).</p>
<div id="exercises-10" class="section level4 unnumbered">
<h4>Exercises</h4>
<ol style="list-style-type: decimal">
<li>Write an <strong>R</strong> script to compute for Voorst the true sampling variance of the estimator of the population mean for two-stage cluster random sampling, PSUs selected by ppswr, <span class="math inline">\(n=4\)</span>, and <span class="math inline">\(m=10\)</span>, see Equation <a href="Twostage.html#eq:TrueVarEstMeanTwostage">(7.3)</a>.<br />
</li>
<li>Do you expect that the standard error of the estimated population mean with ten PSU draws (<span class="math inline">\(n=10\)</span>) and four SSUs per PSU draw (<span class="math inline">\(m=4\)</span>) is larger or smaller than with four PSU draws (<span class="math inline">\(n=4\)</span>) and ten SSUs per PSU draw (<span class="math inline">\(m=10\)</span>)?<br />
</li>
<li>Compute the optimal sample sizes <span class="math inline">\(n\)</span> and <span class="math inline">\(m\)</span> for a maximum variance of the estimator of the population mean of 1, <span class="math inline">\(c_1=2\)</span> and <span class="math inline">\(c_2=1\)</span> monetary unit, see Equations <a href="Twostage.html#eq:nopt">(7.9)</a> and <a href="Twostage.html#eq:mopt">(7.10)</a>.<br />
</li>
<li>Compute the optimal sample sizes <span class="math inline">\(n\)</span> and <span class="math inline">\(m\)</span> for a budget of 100 monetary units, <span class="math inline">\(c_1=2\)</span> monetary units and <span class="math inline">\(c_2=1\)</span> monetary unit, see Equations <a href="Twostage.html#eq:nopt2">(7.11)</a> and <a href="Twostage.html#eq:mopt">(7.10)</a>.<br />
</li>
<li>Use function <code>clusOpt2</code> of <strong>R</strong> package <strong>PracTools</strong> to compute optimal sample sizes given the precision requirement for the estimated population mean of Exercise 3 and given the budget of Exercise 4. First use function <code>BW2stagePPS</code> to compute the variance measures needed as input for function <code>optClus2</code>. Note that the precision requirement of function <code>clusOpt2</code> is the coefficient of variation of the estimated population total, i.e. the standard deviation of the estimated population total divided by the population total. Compute this coefficient of variation from the maximum variance of the estimator of the population mean used in Exercise 3.<br />
</li>
<li>The variance of the estimator for the population total is <span class="citation">(<a href="#ref-coc77" role="doc-biblioref">Cochran 1977</a>)</span>:
<span class="math display" id="eq:EstVarTotalTwostageCochran">\[\begin{equation}
V(\hat{t}(z)) = \frac{1}{n} \sum_{j=1}^N p_j\left(\frac{t_j(z)}{p_j}-t(z)\right)^2 + \frac{1}{n} \sum_{j=1}^N \frac{M_j^2 (1-f_{2j})S^2_j}{m_j p_j}  \;,
\tag{7.12}
\end{equation}\]</span>
with <span class="math inline">\(\hat{t}(z)\)</span> and <span class="math inline">\(t(z)\)</span> the estimated and the true population total of <span class="math inline">\(z\)</span>, respectively, <span class="math inline">\(t_j(z)\)</span> the total of PSU <span class="math inline">\(j\)</span>, and <span class="math inline">\(p_j = M_j/M\)</span>. Use <span class="math inline">\(m_j = m, \;j = 1, \cdots, N\)</span>, and <span class="math inline">\(f_{2j}=0\)</span>, i.e. sampling from infinite population, or sampling of SSUs within PSUs by simple random sampling <em>with</em> replacement from finite population. Derive the variance of the estimator for the population mean, Equation <a href="Twostage.html#eq:TrueVarEstMeanTwostage">(7.3)</a>, from Equation <a href="Twostage.html#eq:EstVarTotalTwostageCochran">(7.12)</a>.</li>
</ol>
</div>
</div>
<div id="primary-sampling-units-selected-without-replacement" class="section level2" number="7.2">
<h2><span class="header-section-number">7.2</span> Primary sampling units selected without replacement</h2>
<p>Similar to cluster random sampling, we may prefer to select the PSUs without replacement. This leads to less strong spatial clustering of the sampling points, especially with large sampling fractions of PSUs. Sampling without replacement of PSUs can be done with function <code>UPpivotal</code> of package <strong>sampling</strong> <span class="citation">(<a href="#ref-Tille2016" role="doc-biblioref">Tillé and Matei 2021</a>)</span>, see Subsection <a href="pps.html#pivotalmethod">8.2.2</a>. The second stage sample of SSUs is selected with function <code>strata</code> of the same package, using the PSUs as strata.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="Twostage.html#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sampling)</span>
<span id="cb134-2"><a href="Twostage.html#cb134-2" aria-hidden="true" tabindex="-1"></a>M_psu <span class="ot">&lt;-</span> <span class="fu">tapply</span>(grdVoorst<span class="sc">$</span>z, <span class="at">INDEX=</span>grdVoorst<span class="sc">$</span>psu, <span class="at">FUN=</span>length)</span>
<span id="cb134-3"><a href="Twostage.html#cb134-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb134-4"><a href="Twostage.html#cb134-4" aria-hidden="true" tabindex="-1"></a>pi <span class="ot">&lt;-</span> n<span class="sc">*</span>M_psu<span class="sc">/</span>M</span>
<span id="cb134-5"><a href="Twostage.html#cb134-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">314</span>)</span>
<span id="cb134-6"><a href="Twostage.html#cb134-6" aria-hidden="true" tabindex="-1"></a>sampleind <span class="ot">&lt;-</span> <span class="fu">UPpivotal</span>(<span class="at">pik=</span>pi, <span class="at">eps=</span><span class="fl">1e-6</span>)</span>
<span id="cb134-7"><a href="Twostage.html#cb134-7" aria-hidden="true" tabindex="-1"></a>psus <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(grdVoorst<span class="sc">$</span>psu))</span>
<span id="cb134-8"><a href="Twostage.html#cb134-8" aria-hidden="true" tabindex="-1"></a>sampledpsus <span class="ot">&lt;-</span> psus[sampleind<span class="sc">==</span><span class="dv">1</span>]</span>
<span id="cb134-9"><a href="Twostage.html#cb134-9" aria-hidden="true" tabindex="-1"></a>mysample_stage1 <span class="ot">&lt;-</span> grdVoorst[grdVoorst<span class="sc">$</span>psu <span class="sc">%in%</span> sampledpsus,]</span>
<span id="cb134-10"><a href="Twostage.html#cb134-10" aria-hidden="true" tabindex="-1"></a>units <span class="ot">&lt;-</span> sampling<span class="sc">::</span><span class="fu">strata</span>(mysample_stage1, <span class="at">stratanames=</span><span class="st">&quot;psu&quot;</span>,</span>
<span id="cb134-11"><a href="Twostage.html#cb134-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">size=</span><span class="fu">rep</span>(m,n), <span class="at">method=</span><span class="st">&quot;srswor&quot;</span>)</span>
<span id="cb134-12"><a href="Twostage.html#cb134-12" aria-hidden="true" tabindex="-1"></a>mysample <span class="ot">&lt;-</span> <span class="fu">getdata</span>(mysample_stage1, units)</span>
<span id="cb134-13"><a href="Twostage.html#cb134-13" aria-hidden="true" tabindex="-1"></a>mysample<span class="sc">$</span>ssunits <span class="ot">&lt;-</span> units<span class="sc">$</span>ID_unit</span>
<span id="cb134-14"><a href="Twostage.html#cb134-14" aria-hidden="true" tabindex="-1"></a>mysample<span class="sc">$</span>pi <span class="ot">&lt;-</span> n<span class="sc">*</span>m<span class="sc">/</span>M</span>
<span id="cb134-15"><a href="Twostage.html#cb134-15" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(mean_HT <span class="ot">&lt;-</span> <span class="fu">sum</span>(mysample<span class="sc">$</span>z<span class="sc">/</span>mysample<span class="sc">$</span>pi)<span class="sc">/</span>M)</span></code></pre></div>
<pre><code>[1] 7.306838</code></pre>
<p>The population mean can be estimated with function <code>svymean</code> of package <strong>survey</strong>. To estimate the variance, a simple solution is to treat the two-stage cluster random sample as a pps sample <em>with replacement</em>, so that variance can be estimated with Equation <a href="Twostage.html#eq:VarEstMeanTwostage">(7.7)</a>. With small sampling fractions of PSUs the overestimation of the variance is negligible. With larger sampling fractions Brewer’s method is recommended, see <span class="citation"><a href="#ref-Berger2004" role="doc-biblioref">Berger</a> (<a href="#ref-Berger2004" role="doc-biblioref">2004</a>)</span> (option 2).</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="Twostage.html#cb136-1" aria-hidden="true" tabindex="-1"></a>mysample<span class="sc">$</span>fpc1 <span class="ot">&lt;-</span> n<span class="sc">*</span>M_psu[mysample<span class="sc">$</span>psu]<span class="sc">/</span>M</span>
<span id="cb136-2"><a href="Twostage.html#cb136-2" aria-hidden="true" tabindex="-1"></a>mysample<span class="sc">$</span>fpc2 <span class="ot">&lt;-</span> m<span class="sc">/</span>M_psu[mysample<span class="sc">$</span>psu]</span>
<span id="cb136-3"><a href="Twostage.html#cb136-3" aria-hidden="true" tabindex="-1"></a>design_2stageppswor <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">id=</span><span class="sc">~</span>psu<span class="sc">+</span>ssunits, <span class="at">data=</span>mysample,</span>
<span id="cb136-4"><a href="Twostage.html#cb136-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">pps=</span><span class="st">&quot;brewer&quot;</span>, <span class="at">fpc=</span><span class="sc">~</span>fpc1<span class="sc">+</span>fpc2)</span>
<span id="cb136-5"><a href="Twostage.html#cb136-5" aria-hidden="true" tabindex="-1"></a><span class="fu">svymean</span>(<span class="sc">~</span>z,design_2stageppswor)</span></code></pre></div>
<pre><code>    mean     SE
z 7.3068 1.3998</code></pre>
</div>
<div id="TwostageSISI" class="section level2" number="7.3">
<h2><span class="header-section-number">7.3</span> Simple random sampling of primary sampling units</h2>
<p>Suppose the PSUs are for some reason not selected with probabilities proportional to their size, but by simple random sampling without replacement. The inclusion probabilities of the PSUs then equal <span class="math inline">\(\pi_j=n/N,\; j = 1, \cdots, N\)</span>, and the population total can be estimated by (compare with Equation <a href="Cl.html#eq:EstTotalClEqual">(6.9)</a>)</p>
<p><span class="math display" id="eq:EstTotalTwostageEqual">\[\begin{equation}
\hat{t}(z) =  \sum_{j=1}^n \frac{\hat{t}_j(z)}{\pi_j} = \frac{N}{n} \sum_{j=1}^n \hat{t}_j(z)\;,
\tag{7.13}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(\hat{t}_j(z)\)</span> an estimator of the total of PSU <span class="math inline">\(j\)</span>. The population mean can be estimated by dividing this estimator by the population size <span class="math inline">\(M\)</span>.</p>
<p>Alternatively, we may estimate the population mean by dividing the estimate of the population total by the <em>estimated</em> population size. The population size can be estimated by the <span class="math inline">\(\pi\)</span> estimator, see Equation <a href="Cl.html#eq:EstPopulatonSizeClEqual">(6.11)</a>. The <span class="math inline">\(\pi\)</span> estimator and the ratio estimator are equal when the PSUs are selected by ppswr, but not so when the PSUs of different size are selected with equal probabilities. This is shown below. First, a sample is selected by selecting both PSUs and SSUs by simple random sampling without replacement.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="Twostage.html#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sampling)</span>
<span id="cb138-2"><a href="Twostage.html#cb138-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">314</span>)</span>
<span id="cb138-3"><a href="Twostage.html#cb138-3" aria-hidden="true" tabindex="-1"></a>psus <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(grdVoorst<span class="sc">$</span>psu))</span>
<span id="cb138-4"><a href="Twostage.html#cb138-4" aria-hidden="true" tabindex="-1"></a>ids_psu <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">length</span>(psus), <span class="at">size=</span>n, <span class="at">replace=</span><span class="cn">FALSE</span>) </span>
<span id="cb138-5"><a href="Twostage.html#cb138-5" aria-hidden="true" tabindex="-1"></a>sampledpsus <span class="ot">&lt;-</span> psus[ids_psu]</span>
<span id="cb138-6"><a href="Twostage.html#cb138-6" aria-hidden="true" tabindex="-1"></a>mysample_stage1 <span class="ot">&lt;-</span> grdVoorst[grdVoorst<span class="sc">$</span>psu <span class="sc">%in%</span> sampledpsus,]</span>
<span id="cb138-7"><a href="Twostage.html#cb138-7" aria-hidden="true" tabindex="-1"></a>units <span class="ot">&lt;-</span> sampling<span class="sc">::</span><span class="fu">strata</span>(mysample_stage1, <span class="at">stratanames=</span><span class="st">&quot;psu&quot;</span>,</span>
<span id="cb138-8"><a href="Twostage.html#cb138-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">size=</span><span class="fu">rep</span>(m,n), <span class="at">method=</span><span class="st">&quot;srswor&quot;</span>)</span>
<span id="cb138-9"><a href="Twostage.html#cb138-9" aria-hidden="true" tabindex="-1"></a>mysample <span class="ot">&lt;-</span> <span class="fu">getdata</span>(mysample_stage1, units)</span>
<span id="cb138-10"><a href="Twostage.html#cb138-10" aria-hidden="true" tabindex="-1"></a>mysample<span class="sc">$</span>ssunits <span class="ot">&lt;-</span> units<span class="sc">$</span>ID_unit</span></code></pre></div>
<p>The population mean is estimated by the <span class="math inline">\(\pi\)</span> estimator and the ratio estimator.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="Twostage.html#cb139-1" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(grdVoorst<span class="sc">$</span>psu))</span>
<span id="cb139-2"><a href="Twostage.html#cb139-2" aria-hidden="true" tabindex="-1"></a>M_psu <span class="ot">&lt;-</span> <span class="fu">tapply</span>(grdVoorst<span class="sc">$</span>z, <span class="at">INDEX=</span>grdVoorst<span class="sc">$</span>psu, <span class="at">FUN=</span>length)</span>
<span id="cb139-3"><a href="Twostage.html#cb139-3" aria-hidden="true" tabindex="-1"></a>pi_psu <span class="ot">&lt;-</span> n<span class="sc">/</span>N</span>
<span id="cb139-4"><a href="Twostage.html#cb139-4" aria-hidden="true" tabindex="-1"></a>pi_ssu <span class="ot">&lt;-</span> m<span class="sc">/</span>M_psu[mysample<span class="sc">$</span>psu]</span>
<span id="cb139-5"><a href="Twostage.html#cb139-5" aria-hidden="true" tabindex="-1"></a>mysample<span class="sc">$</span>pi <span class="ot">&lt;-</span> pi_psu<span class="sc">*</span>pi_ssu</span>
<span id="cb139-6"><a href="Twostage.html#cb139-6" aria-hidden="true" tabindex="-1"></a>z_piexpanded <span class="ot">&lt;-</span> <span class="fu">with</span>(mysample,z<span class="sc">/</span>pi)</span>
<span id="cb139-7"><a href="Twostage.html#cb139-7" aria-hidden="true" tabindex="-1"></a>tz_HT <span class="ot">&lt;-</span> <span class="fu">sum</span>(z_piexpanded)</span>
<span id="cb139-8"><a href="Twostage.html#cb139-8" aria-hidden="true" tabindex="-1"></a>mz_HT <span class="ot">&lt;-</span> tz_HT<span class="sc">/</span>M</span>
<span id="cb139-9"><a href="Twostage.html#cb139-9" aria-hidden="true" tabindex="-1"></a>M_HT <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="dv">1</span><span class="sc">/</span>mysample<span class="sc">$</span>pi)</span>
<span id="cb139-10"><a href="Twostage.html#cb139-10" aria-hidden="true" tabindex="-1"></a>mz_ratio <span class="ot">&lt;-</span> tz_HT<span class="sc">/</span>M_HT</span></code></pre></div>
<p>The <span class="math inline">\(\pi\)</span> estimate equals 7.333 g kg<sup>-1</sup>, and the ratio estimate equals 7.412 g kg<sup>-1</sup>. The <span class="math inline">\(\pi\)</span> estimate of the population mean can also be computed by first estimating totals of PSUs, see Equation <a href="Twostage.html#eq:EstTotalTwostageEqual">(7.13)</a>.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="Twostage.html#cb140-1" aria-hidden="true" tabindex="-1"></a>tz_psu <span class="ot">&lt;-</span> <span class="fu">tapply</span>(mysample<span class="sc">$</span>z<span class="sc">/</span>pi_ssu, <span class="at">INDEX=</span>mysample<span class="sc">$</span>psu, <span class="at">FUN=</span>sum)</span>
<span id="cb140-2"><a href="Twostage.html#cb140-2" aria-hidden="true" tabindex="-1"></a>tz_HT <span class="ot">&lt;-</span> <span class="fu">sum</span>(tz_psu<span class="sc">/</span>pi_psu)</span>
<span id="cb140-3"><a href="Twostage.html#cb140-3" aria-hidden="true" tabindex="-1"></a>(mz_HT <span class="ot">&lt;-</span> tz_HT<span class="sc">/</span>M)</span></code></pre></div>
<pre><code>[1] 7.333272</code></pre>
<p>The variance of the <span class="math inline">\(\pi\)</span> estimator of the population mean can be estimated by first estimating the variance of the estimator of the PSU totals:</p>
<p><span class="math display" id="eq:EstVarTotalHTTwostageSI">\[\begin{equation}
\widehat{V}(\hat{t}(z)) = N^2\left(1-\frac{n}{N}\right)\frac{\widehat{S^2}(\hat{t}_i(z))}{n} \;,
\tag{7.14}
\end{equation}\]</span></p>
<p>and dividing this variance by the squared number of population units:</p>
<p><span class="math display" id="eq:EstVarMeanHTTwostageSI">\[\begin{equation}
\widehat{V}(\hat{\bar{\bar{z}}}) = \frac{1}{M^2} \widehat{V}(\hat{t}(z)) \;,
\tag{7.15}
\end{equation}\]</span></p>
<p>as shown in the code chunk below (the final line computes the standard error).</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="Twostage.html#cb142-1" aria-hidden="true" tabindex="-1"></a>fpc <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">-</span>n<span class="sc">/</span>N</span>
<span id="cb142-2"><a href="Twostage.html#cb142-2" aria-hidden="true" tabindex="-1"></a>v_tz <span class="ot">&lt;-</span> N<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>fpc<span class="sc">*</span><span class="fu">var</span>(tz_psu)<span class="sc">/</span>n</span>
<span id="cb142-3"><a href="Twostage.html#cb142-3" aria-hidden="true" tabindex="-1"></a>(se_mz_HT <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(v_tz<span class="sc">/</span>M<span class="sc">^</span><span class="dv">2</span>))</span></code></pre></div>
<pre><code>[1] 0.6783605</code></pre>
<p>The ratio estimator of the population mean and its standard error can be computed with function <code>svymean</code> of package <strong>survey</strong>.</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="Twostage.html#cb144-1" aria-hidden="true" tabindex="-1"></a>mysample<span class="sc">$</span>fpc1 <span class="ot">&lt;-</span> N</span>
<span id="cb144-2"><a href="Twostage.html#cb144-2" aria-hidden="true" tabindex="-1"></a>mysample<span class="sc">$</span>fpc2 <span class="ot">&lt;-</span> M_psu[mysample<span class="sc">$</span>psu]</span>
<span id="cb144-3"><a href="Twostage.html#cb144-3" aria-hidden="true" tabindex="-1"></a>design_2stage <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">id=</span><span class="sc">~</span>psu<span class="sc">+</span>ssunits, <span class="at">fpc=</span><span class="sc">~</span>fpc1<span class="sc">+</span>fpc2, <span class="at">data=</span>mysample)</span>
<span id="cb144-4"><a href="Twostage.html#cb144-4" aria-hidden="true" tabindex="-1"></a><span class="fu">svymean</span>(<span class="sc">~</span>z, design_2stage)</span></code></pre></div>
<pre><code>   mean     SE
z 7.412 0.6547</code></pre>
<p>The estimated standard error of the ratio estimator is slightly smaller than the standard error of the <span class="math inline">\(\pi\)</span> estimator.</p>
</div>
<div id="StratifiedTwostage" class="section level2" number="7.4">
<h2><span class="header-section-number">7.4</span> Stratified two-stage cluster random sampling</h2>
<p>The basic sampling designs stratified random sampling (Chapter <a href="STSI.html#STSI">4</a>) and two-stage cluster random sampling can be combined into stratified two-stage cluster random sampling. Figure <a href="Twostage.html#fig:STtwostage">7.3</a> shows a stratified two-stage cluster random sample from Voorst. The strata are groups of eight PSUs within 2 km <span class="math inline">\(\times\)</span> 1 km blocks, as before in stratified cluster random sampling (Figure <a href="Cl.html#fig:ClVoorst">6.2</a>). The PSUs are 0.5 km squares (built-up areas, roads, etc. excluded), as before in (unstratified) two-stage cluster random sampling (Figure <a href="Twostage.html#fig:TwostageVoorst">7.1</a>). Within each stratum two times a PSU is selected by ppswr, and every time a PSU is selected, six SSUs (points) are selected by simple random sampling. The stratification avoids the clustering of the selected PSUs in one part of the study area. Compared to (unstratified) two-stage cluster random sampling, the geographical spreading of the PSUs is somewhat improved, which may lead to an increase of the precision of the estimated population mean.</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="Twostage.html#cb146-1" aria-hidden="true" tabindex="-1"></a>n_h <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">2</span>,<span class="dv">3</span>)</span>
<span id="cb146-2"><a href="Twostage.html#cb146-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb146-3"><a href="Twostage.html#cb146-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">314</span>)</span>
<span id="cb146-4"><a href="Twostage.html#cb146-4" aria-hidden="true" tabindex="-1"></a>stratumlabels <span class="ot">&lt;-</span> <span class="fu">unique</span>(grdVoorst<span class="sc">$</span>zonestratum)</span>
<span id="cb146-5"><a href="Twostage.html#cb146-5" aria-hidden="true" tabindex="-1"></a>mysample <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb146-6"><a href="Twostage.html#cb146-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) {</span>
<span id="cb146-7"><a href="Twostage.html#cb146-7" aria-hidden="true" tabindex="-1"></a>  grd_h <span class="ot">&lt;-</span> grdVoorst[grdVoorst<span class="sc">$</span>zonestratum<span class="sc">==</span>stratumlabels[i],]</span>
<span id="cb146-8"><a href="Twostage.html#cb146-8" aria-hidden="true" tabindex="-1"></a>  mysample_h <span class="ot">&lt;-</span> <span class="fu">twostage</span>(<span class="at">sframe=</span>grd_h, <span class="at">psu=</span><span class="st">&quot;psu&quot;</span>, <span class="at">n=</span>n_h[i], <span class="at">m=</span>m)</span>
<span id="cb146-9"><a href="Twostage.html#cb146-9" aria-hidden="true" tabindex="-1"></a>  mysample <span class="ot">&lt;-</span> <span class="fu">rbind</span>(mysample, mysample_h)</span>
<span id="cb146-10"><a href="Twostage.html#cb146-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb146-11"><a href="Twostage.html#cb146-11" aria-hidden="true" tabindex="-1"></a>mysample<span class="sc">$</span>s1 <span class="ot">&lt;-</span> <span class="fu">jitter</span>(mysample<span class="sc">$</span>s1, <span class="at">amount=</span>cellsize<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb146-12"><a href="Twostage.html#cb146-12" aria-hidden="true" tabindex="-1"></a>mysample<span class="sc">$</span>s2 <span class="ot">&lt;-</span> <span class="fu">jitter</span>(mysample<span class="sc">$</span>s2, <span class="at">amount=</span>cellsize<span class="sc">/</span><span class="dv">2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:STtwostage"></span>
<img src="SpatialSampling_files/figure-html/STtwostage-1.png" alt="Stratified two-stage random sample from Voorst. Strata are groups of eight PSUs (0.5 km squares) within 2 km $\times$ 1 km blocks. From each stratum two times a PSU is selected by ppswr, and six SSUs (points) are selected per PSU-draw by simple random sampling." width="100%" />
<p class="caption">
Figure 7.3: Stratified two-stage random sample from Voorst. Strata are groups of eight PSUs (0.5 km squares) within 2 km <span class="math inline">\(\times\)</span> 1 km blocks. From each stratum two times a PSU is selected by ppswr, and six SSUs (points) are selected per PSU-draw by simple random sampling.
</p>
</div>
<p>The population mean can be estimated in much the same way as with stratified cluster random sampling. With function <code>svymean</code> this is an easy task.</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="Twostage.html#cb147-1" aria-hidden="true" tabindex="-1"></a>N_h <span class="ot">&lt;-</span> <span class="fu">tapply</span>(grdVoorst<span class="sc">$</span>psu, <span class="at">INDEX=</span>grdVoorst<span class="sc">$</span>zonestratum,</span>
<span id="cb147-2"><a href="Twostage.html#cb147-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">FUN=</span><span class="cf">function</span>(x) {<span class="fu">length</span>(<span class="fu">unique</span>(x))})</span>
<span id="cb147-3"><a href="Twostage.html#cb147-3" aria-hidden="true" tabindex="-1"></a>M_h <span class="ot">&lt;-</span> <span class="fu">tapply</span>(grdVoorst<span class="sc">$</span>z, <span class="at">INDEX=</span>grdVoorst<span class="sc">$</span>zonestratum, <span class="at">FUN=</span>length)</span>
<span id="cb147-4"><a href="Twostage.html#cb147-4" aria-hidden="true" tabindex="-1"></a>mysample<span class="sc">$</span>w1 <span class="ot">&lt;-</span> N_h[mysample<span class="sc">$</span>zonestratum]</span>
<span id="cb147-5"><a href="Twostage.html#cb147-5" aria-hidden="true" tabindex="-1"></a>mysample<span class="sc">$</span>w2 <span class="ot">&lt;-</span> M_h[mysample<span class="sc">$</span>zonestratum]</span>
<span id="cb147-6"><a href="Twostage.html#cb147-6" aria-hidden="true" tabindex="-1"></a>design_str2stage <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">id=</span><span class="sc">~</span>psudraw<span class="sc">+</span>ssunits, <span class="at">strata=</span><span class="sc">~</span>zonestratum,</span>
<span id="cb147-7"><a href="Twostage.html#cb147-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">weights=</span><span class="sc">~</span>w1<span class="sc">+</span>w2, <span class="at">data=</span>mysample, <span class="at">nest=</span><span class="cn">TRUE</span>)</span>
<span id="cb147-8"><a href="Twostage.html#cb147-8" aria-hidden="true" tabindex="-1"></a><span class="fu">svymean</span>(<span class="sc">~</span>z, design_str2stage)</span></code></pre></div>
<pre><code>    mean     SE
z 7.9118 0.5836</code></pre>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Berger2004" class="csl-entry">
Berger, Y. G. 2004. <span>“A Simple Variance Estimator for Unequal Probability Sampling Without Replacement.”</span> <em>Canadian Journal of Applied Statistics</em> 31 (3): 305–15. <a href="https://doi.org/10.1080/0266476042000184046">https://doi.org/10.1080/0266476042000184046</a>.
</div>
<div id="ref-coc77" class="csl-entry">
Cochran, W. G. 1977. <em>Sampling Techniques</em>. New York: Wiley.
</div>
<div id="ref-gru06" class="csl-entry">
de Gruijter, J. J., D. J. Brus, M. F. P. Bierkens, and M. Knotters. 2006. <em>Sampling for Natural Resource Monitoring</em>. Berlin: Springer.
</div>
<div id="ref-Lumley2020" class="csl-entry">
———. 2021. <em><span class="nocase">survey: analysis of complex survey samples</span></em>.
</div>
<div id="ref-Tille2016" class="csl-entry">
Tillé, Y., and A. Matei. 2021. <em><span class="nocase">sampling: Survey Sampling</span></em>. <a href="https://CRAN.R-project.org/package=sampling">https://CRAN.R-project.org/package=sampling</a>.
</div>
<div id="ref-Vaillant2018" class="csl-entry">
Valliant, Richard, Jill A. Dever, and Frauke Kreuter. 2018. <em>Practical Tools for Designing and Weighting Survey Samples</em>. Second. New York: Springer.
</div>
<div id="ref-PracTools" class="csl-entry">
———. 2021. <em>PracTools: Tools for Designing and Weighting Survey Samples</em>. <a href="https://CRAN.R-project.org/package=PracTools">https://CRAN.R-project.org/package=PracTools</a>.
</div>
</div>
<div class="footnotes">
<hr />
<ol start="2">
<li id="fn2"><p>Equation (11.33) in <span class="citation"><a href="#ref-coc77" role="doc-biblioref">Cochran</a> (<a href="#ref-coc77" role="doc-biblioref">1977</a>)</span> is the variance estimator for the estimator of the population total. In Exercise 5 you are asked to derive the variance estimator for the estimator of the population mean from this variance estimator.<a href="Twostage.html#fnref2" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="Cl.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="pps.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/DickBrus/SpatialSamplingwithR/edit/master/07-Twostage.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["SpatialSampling.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
