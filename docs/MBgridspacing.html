<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 22 Model-based optimisation of the grid spacing | Spatial sampling with R</title>
  <meta name="description" content="This book is for researchers, consultants and students who would like to know how to collect spatial data, either for estimating parameters for the population or several subpopulations, or for mapping. How many data do we need, and how to select the population units? The book presents a wide overview of spatial sampling designs. Besides there is a chapter on designs for sampling in space and time for monitoring. The emphasis is not on the theory, but on how to implement sampling designs in R and on how the (sub)population parameters can be estimated from the sample." />
  <meta name="generator" content="bookdown 0.25 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 22 Model-based optimisation of the grid spacing | Spatial sampling with R" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="/images/cover.pdf" />
  <meta property="og:description" content="This book is for researchers, consultants and students who would like to know how to collect spatial data, either for estimating parameters for the population or several subpopulations, or for mapping. How many data do we need, and how to select the population units? The book presents a wide overview of spatial sampling designs. Besides there is a chapter on designs for sampling in space and time for monitoring. The emphasis is not on the theory, but on how to implement sampling designs in R and on how the (sub)population parameters can be estimated from the sample." />
  <meta name="github-repo" content="DickBrus/SpatialSamplingwithR" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 22 Model-based optimisation of the grid spacing | Spatial sampling with R" />
  
  <meta name="twitter:description" content="This book is for researchers, consultants and students who would like to know how to collect spatial data, either for estimating parameters for the population or several subpopulations, or for mapping. How many data do we need, and how to select the population units? The book presents a wide overview of spatial sampling designs. Besides there is a chapter on designs for sampling in space and time for monitoring. The emphasis is not on the theory, but on how to implement sampling designs in R and on how the (sub)population parameters can be estimated from the sample." />
  <meta name="twitter:image" content="/images/cover.pdf" />

<meta name="author" content="Dick J. Brus" />


<meta name="date" content="2023-02-06" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="Introkriging.html"/>
<link rel="next" href="MBSamplePattern.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Spatial sampling with R</a></li>

<li class="divider"></li>
<li><a href="index.html#preface" id="toc-preface">Preface</a>
<ul>
<li><a href="index.html#acknowledgments" id="toc-acknowledgments">Acknowledgments</a></li>
</ul></li>
<li><a href="GeneralIntro.html#GeneralIntro" id="toc-GeneralIntro"><span class="toc-section-number">1</span> Introduction</a>
<ul>
<li><a href="GeneralIntro.html#BasicConcepts" id="toc-BasicConcepts"><span class="toc-section-number">1.1</span> Basic sampling concepts</a>
<ul>
<li><a href="GeneralIntro.html#PopulationParameters" id="toc-PopulationParameters"><span class="toc-section-number">1.1.1</span> Population parameters</a></li>
<li><a href="GeneralIntro.html#descriptive-statistics-vs.-inference-about-a-population" id="toc-descriptive-statistics-vs.-inference-about-a-population"><span class="toc-section-number">1.1.2</span> Descriptive statistics vs. inference about a population</a></li>
<li><a href="GeneralIntro.html#random-sampling-vs.-probability-sampling" id="toc-random-sampling-vs.-probability-sampling"><span class="toc-section-number">1.1.3</span> Random sampling vs. probability sampling</a></li>
</ul></li>
<li><a href="GeneralIntro.html#DBvsMB" id="toc-DBvsMB"><span class="toc-section-number">1.2</span> Design-based vs. model-based approach</a></li>
<li><a href="GeneralIntro.html#Datasets" id="toc-Datasets"><span class="toc-section-number">1.3</span> Populations used in sampling experiments</a>
<ul>
<li><a href="GeneralIntro.html#Voorst" id="toc-Voorst"><span class="toc-section-number">1.3.1</span> Soil organic matter in Voorst, the Netherlands</a></li>
<li><a href="GeneralIntro.html#Poppy" id="toc-Poppy"><span class="toc-section-number">1.3.2</span> Poppy fields in Kandahar, Afghanistan</a></li>
<li><a href="GeneralIntro.html#Amazonia" id="toc-Amazonia"><span class="toc-section-number">1.3.3</span> Aboveground biomass in Eastern Amazonia, Brazil</a></li>
<li><a href="GeneralIntro.html#TASIberia" id="toc-TASIberia"><span class="toc-section-number">1.3.4</span> Annual mean air temperature in Iberia</a></li>
</ul></li>
</ul></li>
<li><a href="#part-probability-sampling-for-estimating-population-parameters" id="toc-part-probability-sampling-for-estimating-population-parameters">(PART) Probability sampling for estimating population parameters</a></li>
<li><a href="IntroProbabilitySampling.html#IntroProbabilitySampling" id="toc-IntroProbabilitySampling"><span class="toc-section-number">2</span> Introduction to probability sampling</a>
<ul>
<li><a href="IntroProbabilitySampling.html#arbitrary-haphazard-sampling-vs.-probability-sampling" id="toc-arbitrary-haphazard-sampling-vs.-probability-sampling">Arbitrary (haphazard) sampling vs. probability sampling</a></li>
<li><a href="IntroProbabilitySampling.html#HTestimator" id="toc-HTestimator"><span class="toc-section-number">2.1</span> Horvitz-Thompson estimator</a></li>
<li><a href="IntroProbabilitySampling.html#hansen-hurwitz-estimator" id="toc-hansen-hurwitz-estimator"><span class="toc-section-number">2.2</span> Hansen-Hurwitz estimator</a></li>
<li><a href="IntroProbabilitySampling.html#using-models-in-design-based-approach" id="toc-using-models-in-design-based-approach"><span class="toc-section-number">2.3</span> Using models in design-based approach</a></li>
</ul></li>
<li><a href="SI.html#SI" id="toc-SI"><span class="toc-section-number">3</span> Simple random sampling</a>
<ul>
<li><a href="SI.html#HTestimatorSI" id="toc-HTestimatorSI"><span class="toc-section-number">3.1</span> Estimation of population parameters</a>
<ul>
<li><a href="SI.html#PopProportion" id="toc-PopProportion"><span class="toc-section-number">3.1.1</span> Population proportion</a></li>
<li><a href="SI.html#CDF" id="toc-CDF"><span class="toc-section-number">3.1.2</span> Cumulative distribution function and quantiles</a></li>
</ul></li>
<li><a href="SI.html#VarMeanSI" id="toc-VarMeanSI"><span class="toc-section-number">3.2</span> Sampling variance of estimator of population parameters</a></li>
<li><a href="SI.html#ConfidenceInterval" id="toc-ConfidenceInterval"><span class="toc-section-number">3.3</span> Confidence interval estimate</a>
<ul>
<li><a href="SI.html#ConfidenceIntervalProportion" id="toc-ConfidenceIntervalProportion"><span class="toc-section-number">3.3.1</span> Confidence interval for a proportion</a></li>
</ul></li>
<li><a href="SI.html#SIcircularplots" id="toc-SIcircularplots"><span class="toc-section-number">3.4</span> Simple random sampling of circular plots</a>
<ul>
<li><a href="SI.html#sampling-from-a-finite-set-of-fixed-circles" id="toc-sampling-from-a-finite-set-of-fixed-circles"><span class="toc-section-number">3.4.1</span> Sampling from a finite set of fixed circles</a></li>
<li><a href="SI.html#sampling-from-an-infinite-set-of-floating-circles" id="toc-sampling-from-an-infinite-set-of-floating-circles"><span class="toc-section-number">3.4.2</span> Sampling from an infinite set of floating circles</a></li>
</ul></li>
</ul></li>
<li><a href="STSI.html#STSI" id="toc-STSI"><span class="toc-section-number">4</span> Stratified simple random sampling</a>
<ul>
<li><a href="STSI.html#EstimatorsSTSI" id="toc-EstimatorsSTSI"><span class="toc-section-number">4.1</span> Estimation of population parameters</a>
<ul>
<li><a href="STSI.html#population-proportion-cumulative-distribution-function-and-quantiles" id="toc-population-proportion-cumulative-distribution-function-and-quantiles"><span class="toc-section-number">4.1.1</span> Population proportion, cumulative distribution function, and quantiles</a></li>
<li><a href="STSI.html#WhyStratify" id="toc-WhyStratify"><span class="toc-section-number">4.1.2</span> Why should we stratify?</a></li>
</ul></li>
<li><a href="STSI.html#CISTSI" id="toc-CISTSI"><span class="toc-section-number">4.2</span> Confidence interval estimate</a></li>
<li><a href="STSI.html#STSIallocation" id="toc-STSIallocation"><span class="toc-section-number">4.3</span> Allocation of sample size to strata</a></li>
<li><a href="STSI.html#cumrootf" id="toc-cumrootf"><span class="toc-section-number">4.4</span> <em>Cum-root-f</em> stratification</a></li>
<li><a href="STSI.html#kmeansstratification" id="toc-kmeansstratification"><span class="toc-section-number">4.5</span> Stratification with multiple covariates</a></li>
<li><a href="STSI.html#geostrata" id="toc-geostrata"><span class="toc-section-number">4.6</span> Geographical stratification</a></li>
<li><a href="STSI.html#multiway-stratification" id="toc-multiway-stratification"><span class="toc-section-number">4.7</span> Multiway stratification</a></li>
<li><a href="STSI.html#MultivariateStratification" id="toc-MultivariateStratification"><span class="toc-section-number">4.8</span> Multivariate stratification</a></li>
</ul></li>
<li><a href="SY.html#SY" id="toc-SY"><span class="toc-section-number">5</span> Systematic random sampling</a>
<ul>
<li><a href="SY.html#EstVarSY" id="toc-EstVarSY"><span class="toc-section-number">5.1</span> Estimation of population parameters</a></li>
<li><a href="SY.html#approximating-the-sampling-variance-of-the-estimator-of-the-mean" id="toc-approximating-the-sampling-variance-of-the-estimator-of-the-mean"><span class="toc-section-number">5.2</span> Approximating the sampling variance of the estimator of the mean</a></li>
</ul></li>
<li><a href="Cl.html#Cl" id="toc-Cl"><span class="toc-section-number">6</span> Cluster random sampling</a>
<ul>
<li><a href="Cl.html#clustersamplingestimators" id="toc-clustersamplingestimators"><span class="toc-section-number">6.1</span> Estimation of population parameters</a></li>
<li><a href="Cl.html#clusters-selected-with-probabilities-proportional-to-size-without-replacement" id="toc-clusters-selected-with-probabilities-proportional-to-size-without-replacement"><span class="toc-section-number">6.2</span> Clusters selected with probabilities proportional to size, without replacement</a></li>
<li><a href="Cl.html#SIC" id="toc-SIC"><span class="toc-section-number">6.3</span> Simple random sampling of clusters</a></li>
<li><a href="Cl.html#StratifiedCl" id="toc-StratifiedCl"><span class="toc-section-number">6.4</span> Stratified cluster random sampling</a></li>
</ul></li>
<li><a href="Twostage.html#Twostage" id="toc-Twostage"><span class="toc-section-number">7</span> Two-stage cluster random sampling</a>
<ul>
<li><a href="Twostage.html#twostagesamplingestimators" id="toc-twostagesamplingestimators"><span class="toc-section-number">7.1</span> Estimation of population parameters</a></li>
<li><a href="Twostage.html#primary-sampling-units-selected-without-replacement" id="toc-primary-sampling-units-selected-without-replacement"><span class="toc-section-number">7.2</span> Primary sampling units selected without replacement</a></li>
<li><a href="Twostage.html#TwostageSISI" id="toc-TwostageSISI"><span class="toc-section-number">7.3</span> Simple random sampling of primary sampling units</a></li>
<li><a href="Twostage.html#StratifiedTwostage" id="toc-StratifiedTwostage"><span class="toc-section-number">7.4</span> Stratified two-stage cluster random sampling</a></li>
</ul></li>
<li><a href="pps.html#pps" id="toc-pps"><span class="toc-section-number">8</span> Sampling with probabilities proportional to size</a>
<ul>
<li><a href="pps.html#ppswr" id="toc-ppswr"><span class="toc-section-number">8.1</span> Probability-proportional-to-size sampling with replacement</a></li>
<li><a href="pps.html#ppswor" id="toc-ppswor"><span class="toc-section-number">8.2</span> Probability-proportional-to-size sampling without replacement</a>
<ul>
<li><a href="pps.html#Systematicpps" id="toc-Systematicpps"><span class="toc-section-number">8.2.1</span> Systematic pps sampling without replacement</a></li>
<li><a href="pps.html#pivotalmethod" id="toc-pivotalmethod"><span class="toc-section-number">8.2.2</span> The pivotal method</a></li>
</ul></li>
</ul></li>
<li><a href="BalancedSpreaded.html#BalancedSpreaded" id="toc-BalancedSpreaded"><span class="toc-section-number">9</span> Balanced and well-spread sampling</a>
<ul>
<li><a href="BalancedSpreaded.html#Balanced" id="toc-Balanced"><span class="toc-section-number">9.1</span> Balanced sampling</a>
<ul>
<li><a href="BalancedSpreaded.html#balanced-sample-vs.-balanced-sampling-design" id="toc-balanced-sample-vs.-balanced-sampling-design"><span class="toc-section-number">9.1.1</span> Balanced sample vs. balanced sampling design</a></li>
<li><a href="BalancedSpreaded.html#unequal-inclusion-probabilities" id="toc-unequal-inclusion-probabilities"><span class="toc-section-number">9.1.2</span> Unequal inclusion probabilities</a></li>
<li><a href="BalancedSpreaded.html#StratifiedsamplingasBalancedsampling" id="toc-StratifiedsamplingasBalancedsampling"><span class="toc-section-number">9.1.3</span> Stratified random sampling</a></li>
<li><a href="BalancedSpreaded.html#Multiwaystratification" id="toc-Multiwaystratification"><span class="toc-section-number">9.1.4</span> Multiway stratification</a></li>
</ul></li>
<li><a href="BalancedSpreaded.html#Spreaded" id="toc-Spreaded"><span class="toc-section-number">9.2</span> Well-spread sampling</a>
<ul>
<li><a href="BalancedSpreaded.html#LPM" id="toc-LPM"><span class="toc-section-number">9.2.1</span> Local pivotal method</a></li>
<li><a href="BalancedSpreaded.html#GRTS" id="toc-GRTS"><span class="toc-section-number">9.2.2</span> Generalised random-tessellation stratified sampling</a></li>
</ul></li>
<li><a href="BalancedSpreaded.html#BalancedandSpreaded" id="toc-BalancedandSpreaded"><span class="toc-section-number">9.3</span> Balanced sampling with spreading</a></li>
</ul></li>
<li><a href="Modelassisted.html#Modelassisted" id="toc-Modelassisted"><span class="toc-section-number">10</span> Model-assisted estimation</a>
<ul>
<li><a href="Modelassisted.html#GREG" id="toc-GREG"><span class="toc-section-number">10.1</span> Generalised regression estimator</a>
<ul>
<li><a href="Modelassisted.html#RegressionEstimator" id="toc-RegressionEstimator"><span class="toc-section-number">10.1.1</span> Simple and multiple regression estimators</a></li>
<li><a href="Modelassisted.html#penalised-least-squares-estimation" id="toc-penalised-least-squares-estimation"><span class="toc-section-number">10.1.2</span> Penalised least squares estimation</a></li>
<li><a href="Modelassisted.html#RegressionEstimatorSTSI" id="toc-RegressionEstimatorSTSI"><span class="toc-section-number">10.1.3</span> Regression estimator with stratified simple random sampling</a></li>
</ul></li>
<li><a href="Modelassisted.html#RatioEstimator" id="toc-RatioEstimator"><span class="toc-section-number">10.2</span> Ratio estimator</a>
<ul>
<li><a href="Modelassisted.html#RatioEstimatorSTSI" id="toc-RatioEstimatorSTSI"><span class="toc-section-number">10.2.1</span> Ratio estimators with stratified simple random sampling</a></li>
</ul></li>
<li><a href="Modelassisted.html#PoststratifiedEstimator" id="toc-PoststratifiedEstimator"><span class="toc-section-number">10.3</span> Poststratified estimator</a></li>
<li><a href="Modelassisted.html#RandomForest" id="toc-RandomForest"><span class="toc-section-number">10.4</span> Model-assisted estimation using machine learning techniques</a>
<ul>
<li><a href="Modelassisted.html#predicting-with-a-regression-tree" id="toc-predicting-with-a-regression-tree"><span class="toc-section-number">10.4.1</span> Predicting with a regression tree</a></li>
<li><a href="Modelassisted.html#predicting-with-a-random-forest" id="toc-predicting-with-a-random-forest"><span class="toc-section-number">10.4.2</span> Predicting with a random forest</a></li>
</ul></li>
<li><a href="Modelassisted.html#big-data-and-volunteer-data" id="toc-big-data-and-volunteer-data"><span class="toc-section-number">10.5</span> Big data and volunteer data</a></li>
</ul></li>
<li><a href="Twophase.html#Twophase" id="toc-Twophase"><span class="toc-section-number">11</span> Two-phase random sampling</a>
<ul>
<li><a href="Twophase.html#TwophaseStratification" id="toc-TwophaseStratification"><span class="toc-section-number">11.1</span> Two-phase random sampling for stratification</a></li>
<li><a href="Twophase.html#TwophaseRegression" id="toc-TwophaseRegression"><span class="toc-section-number">11.2</span> Two-phase random sampling for regression</a></li>
</ul></li>
<li><a href="RequiredSampleSize.html#RequiredSampleSize" id="toc-RequiredSampleSize"><span class="toc-section-number">12</span> Computing the required sample size</a>
<ul>
<li><a href="RequiredSampleSize.html#standard-error" id="toc-standard-error"><span class="toc-section-number">12.1</span> Standard error</a></li>
<li><a href="RequiredSampleSize.html#ReqSampleSizeLengthCI" id="toc-ReqSampleSizeLengthCI"><span class="toc-section-number">12.2</span> Length of confidence interval</a>
<ul>
<li><a href="RequiredSampleSize.html#length-of-confidence-interval-for-a-proportion" id="toc-length-of-confidence-interval-for-a-proportion"><span class="toc-section-number">12.2.1</span> Length of confidence interval for a proportion</a></li>
</ul></li>
<li><a href="RequiredSampleSize.html#statistical-testing-of-hypothesis" id="toc-statistical-testing-of-hypothesis"><span class="toc-section-number">12.3</span> Statistical testing of hypothesis</a>
<ul>
<li><a href="RequiredSampleSize.html#sample-size-for-testing-a-proportion" id="toc-sample-size-for-testing-a-proportion"><span class="toc-section-number">12.3.1</span> Sample size for testing a proportion</a></li>
</ul></li>
<li><a href="RequiredSampleSize.html#DesignEffect" id="toc-DesignEffect"><span class="toc-section-number">12.4</span> Accounting for design effect</a></li>
<li><a href="RequiredSampleSize.html#BayesianSampleSize" id="toc-BayesianSampleSize"><span class="toc-section-number">12.5</span> Bayesian sample size determination</a>
<ul>
<li><a href="RequiredSampleSize.html#bayesian-criteria-for-sample-size-computation" id="toc-bayesian-criteria-for-sample-size-computation"><span class="toc-section-number">12.5.1</span> Bayesian criteria for sample size computation</a></li>
<li><a href="RequiredSampleSize.html#mixed-bayesian-likelihood-approach" id="toc-mixed-bayesian-likelihood-approach"><span class="toc-section-number">12.5.2</span> Mixed Bayesian-likelihood approach</a></li>
<li><a href="RequiredSampleSize.html#estimation-of-population-mean" id="toc-estimation-of-population-mean"><span class="toc-section-number">12.5.3</span> Estimation of population mean</a></li>
<li><a href="RequiredSampleSize.html#estimation-of-a-population-proportion" id="toc-estimation-of-a-population-proportion"><span class="toc-section-number">12.5.4</span> Estimation of a population proportion</a></li>
</ul></li>
</ul></li>
<li><a href="MBpredictionofDesignVariance.html#MBpredictionofDesignVariance" id="toc-MBpredictionofDesignVariance"><span class="toc-section-number">13</span> Model-based optimisation of probability sampling designs</a>
<ul>
<li><a href="MBpredictionofDesignVariance.html#model-based-optimisation-of-sampling-design-type-and-sample-size" id="toc-model-based-optimisation-of-sampling-design-type-and-sample-size"><span class="toc-section-number">13.1</span> Model-based optimisation of sampling design type and sample size</a>
<ul>
<li><a href="MBpredictionofDesignVariance.html#AnalyticalApproach" id="toc-AnalyticalApproach"><span class="toc-section-number">13.1.1</span> Analytical approach</a></li>
<li><a href="MBpredictionofDesignVariance.html#GeostatisticalSimulationApproach" id="toc-GeostatisticalSimulationApproach"><span class="toc-section-number">13.1.2</span> Geostatistical simulation approach</a></li>
<li><a href="MBpredictionofDesignVariance.html#MBpredSamplingVarBayes" id="toc-MBpredSamplingVarBayes"><span class="toc-section-number">13.1.3</span> Bayesian approach</a></li>
</ul></li>
<li><a href="MBpredictionofDesignVariance.html#Ospats" id="toc-Ospats"><span class="toc-section-number">13.2</span> Model-based optimisation of spatial strata</a></li>
</ul></li>
<li><a href="SmallAreaEstimation.html#SmallAreaEstimation" id="toc-SmallAreaEstimation"><span class="toc-section-number">14</span> Sampling for estimating parameters of domains</a>
<ul>
<li><a href="SmallAreaEstimation.html#LargeDomainsDirectEstimator" id="toc-LargeDomainsDirectEstimator"><span class="toc-section-number">14.1</span> Direct estimator for large domains</a></li>
<li><a href="SmallAreaEstimation.html#SmallDomainsModelAssisted" id="toc-SmallDomainsModelAssisted"><span class="toc-section-number">14.2</span> Model-assisted estimators for small domains</a>
<ul>
<li><a href="SmallAreaEstimation.html#RegressionestimatorSmallDomain" id="toc-RegressionestimatorSmallDomain"><span class="toc-section-number">14.2.1</span> Regression estimator</a></li>
<li><a href="SmallAreaEstimation.html#SyntheticestimatorSmallDomain" id="toc-SyntheticestimatorSmallDomain"><span class="toc-section-number">14.2.2</span> Synthetic estimator</a></li>
</ul></li>
<li><a href="SmallAreaEstimation.html#SmallAreaModelBased" id="toc-SmallAreaModelBased"><span class="toc-section-number">14.3</span> Model-based prediction</a>
<ul>
<li><a href="SmallAreaEstimation.html#random-intercept-model" id="toc-random-intercept-model"><span class="toc-section-number">14.3.1</span> Random intercept model</a></li>
<li><a href="SmallAreaEstimation.html#geostatistical-model" id="toc-geostatistical-model"><span class="toc-section-number">14.3.2</span> Geostatistical model</a></li>
</ul></li>
<li><a href="SmallAreaEstimation.html#supplemental-probability-sampling-of-small-domains" id="toc-supplemental-probability-sampling-of-small-domains"><span class="toc-section-number">14.4</span> Supplemental probability sampling of small domains</a></li>
</ul></li>
<li><a href="RepeatedSurveys.html#RepeatedSurveys" id="toc-RepeatedSurveys"><span class="toc-section-number">15</span> Repeated sample surveys for monitoring population parameters</a>
<ul>
<li><a href="RepeatedSurveys.html#space-time-designs" id="toc-space-time-designs"><span class="toc-section-number">15.1</span> Space-time designs</a></li>
<li><a href="RepeatedSurveys.html#SpaceTimeparameters" id="toc-SpaceTimeparameters"><span class="toc-section-number">15.2</span> Space-time population parameters</a></li>
<li><a href="RepeatedSurveys.html#design-based-generalised-least-squares-estimation-of-spatial-means" id="toc-design-based-generalised-least-squares-estimation-of-spatial-means"><span class="toc-section-number">15.3</span> Design-based generalised least squares estimation of spatial means</a>
<ul>
<li><a href="RepeatedSurveys.html#current-mean" id="toc-current-mean"><span class="toc-section-number">15.3.1</span> Current mean</a></li>
<li><a href="RepeatedSurveys.html#change-of-the-spatial-mean" id="toc-change-of-the-spatial-mean"><span class="toc-section-number">15.3.2</span> Change of the spatial mean</a></li>
<li><a href="RepeatedSurveys.html#temporal-trend-of-the-spatial-mean" id="toc-temporal-trend-of-the-spatial-mean"><span class="toc-section-number">15.3.3</span> Temporal trend of the spatial mean</a></li>
<li><a href="RepeatedSurveys.html#space-time-mean" id="toc-space-time-mean"><span class="toc-section-number">15.3.4</span> Space-time mean</a></li>
</ul></li>
<li><a href="RepeatedSurveys.html#case-study-annual-mean-daily-temperature-in-iberia" id="toc-case-study-annual-mean-daily-temperature-in-iberia"><span class="toc-section-number">15.4</span> Case study: annual mean daily temperature in Iberia</a>
<ul>
<li><a href="RepeatedSurveys.html#static-synchronous-design" id="toc-static-synchronous-design"><span class="toc-section-number">15.4.1</span> Static-synchronous design</a></li>
<li><a href="RepeatedSurveys.html#independent-synchronous-design" id="toc-independent-synchronous-design"><span class="toc-section-number">15.4.2</span> Independent synchronous design</a></li>
<li><a href="RepeatedSurveys.html#serially-alternating-design" id="toc-serially-alternating-design"><span class="toc-section-number">15.4.3</span> Serially alternating design</a></li>
<li><a href="RepeatedSurveys.html#supplemented-panel-design" id="toc-supplemented-panel-design"><span class="toc-section-number">15.4.4</span> Supplemented panel design</a></li>
<li><a href="RepeatedSurveys.html#rotating-panel-design" id="toc-rotating-panel-design"><span class="toc-section-number">15.4.5</span> Rotating panel design</a></li>
<li><a href="RepeatedSurveys.html#sampling-experiment" id="toc-sampling-experiment"><span class="toc-section-number">15.4.6</span> Sampling experiment</a></li>
</ul></li>
<li><a href="RepeatedSurveys.html#space-time-sampling-with-stratified-random-sampling-in-space" id="toc-space-time-sampling-with-stratified-random-sampling-in-space"><span class="toc-section-number">15.5</span> Space-time sampling with stratified random sampling in space</a></li>
</ul></li>
<li><a href="#part-sampling-for-mapping" id="toc-part-sampling-for-mapping">(PART) Sampling for mapping</a></li>
<li><a href="IntroSamplingforMapping.html#IntroSamplingforMapping" id="toc-IntroSamplingforMapping"><span class="toc-section-number">16</span> Introduction to sampling for mapping</a>
<ul>
<li><a href="IntroSamplingforMapping.html#when-is-probability-sampling-not-required" id="toc-when-is-probability-sampling-not-required"><span class="toc-section-number">16.1</span> When is probability sampling not required?</a></li>
<li><a href="IntroSamplingforMapping.html#sampling-for-simultaneously-mapping-and-estimating-means" id="toc-sampling-for-simultaneously-mapping-and-estimating-means"><span class="toc-section-number">16.2</span> Sampling for simultaneously mapping and estimating means</a></li>
<li><a href="IntroSamplingforMapping.html#broad-overview-of-sampling-designs-for-mapping" id="toc-broad-overview-of-sampling-designs-for-mapping"><span class="toc-section-number">16.3</span> Broad overview of sampling designs for mapping</a></li>
</ul></li>
<li><a href="RegularGridSpatialCoverage.html#RegularGridSpatialCoverage" id="toc-RegularGridSpatialCoverage"><span class="toc-section-number">17</span> Regular grid and spatial coverage sampling</a>
<ul>
<li><a href="RegularGridSpatialCoverage.html#Regulargrid" id="toc-Regulargrid"><span class="toc-section-number">17.1</span> Regular grid sampling</a></li>
<li><a href="RegularGridSpatialCoverage.html#SpatialCoverage" id="toc-SpatialCoverage"><span class="toc-section-number">17.2</span> Spatial coverage sampling</a></li>
<li><a href="RegularGridSpatialCoverage.html#SpatialInfill" id="toc-SpatialInfill"><span class="toc-section-number">17.3</span> Spatial infill sampling</a></li>
</ul></li>
<li><a href="kmeans.html#kmeans" id="toc-kmeans"><span class="toc-section-number">18</span> Covariate space coverage sampling</a>
<ul>
<li><a href="kmeans.html#covariate-space-infill-sampling" id="toc-covariate-space-infill-sampling"><span class="toc-section-number">18.1</span> Covariate space infill sampling</a></li>
<li><a href="kmeans.html#PerformanceCSC" id="toc-PerformanceCSC"><span class="toc-section-number">18.2</span> Performance of covariate space coverage sampling in random forest prediction</a></li>
</ul></li>
<li><a href="cLHS.html#cLHS" id="toc-cLHS"><span class="toc-section-number">19</span> Conditioned Latin hypercube sampling</a>
<ul>
<li><a href="cLHS.html#cLHIS" id="toc-cLHIS"><span class="toc-section-number">19.1</span> Conditioned Latin hypercube infill sampling</a></li>
<li><a href="cLHS.html#performance-of-conditioned-latin-hypercube-sampling-in-random-forest-prediction" id="toc-performance-of-conditioned-latin-hypercube-sampling-in-random-forest-prediction"><span class="toc-section-number">19.2</span> Performance of conditioned Latin hypercube sampling in random forest prediction</a></li>
</ul></li>
<li><a href="SpatialResponseSurface.html#SpatialResponseSurface" id="toc-SpatialResponseSurface"><span class="toc-section-number">20</span> Spatial response surface sampling</a>
<ul>
<li><a href="SpatialResponseSurface.html#IncreaseSampleSize" id="toc-IncreaseSampleSize"><span class="toc-section-number">20.1</span> Increasing the sample size</a></li>
<li><a href="SpatialResponseSurface.html#stratified-spatial-response-surface-sampling" id="toc-stratified-spatial-response-surface-sampling"><span class="toc-section-number">20.2</span> Stratified spatial response surface sampling</a></li>
<li><a href="SpatialResponseSurface.html#mapping" id="toc-mapping"><span class="toc-section-number">20.3</span> Mapping</a></li>
</ul></li>
<li><a href="Introkriging.html#Introkriging" id="toc-Introkriging"><span class="toc-section-number">21</span> Introduction to kriging</a>
<ul>
<li><a href="Introkriging.html#OrdinaryKriging" id="toc-OrdinaryKriging"><span class="toc-section-number">21.1</span> Ordinary kriging</a></li>
<li><a href="Introkriging.html#BlockKriging" id="toc-BlockKriging"><span class="toc-section-number">21.2</span> Block-kriging</a></li>
<li><a href="Introkriging.html#IntroKED" id="toc-IntroKED"><span class="toc-section-number">21.3</span> Kriging with an external drift</a></li>
<li><a href="Introkriging.html#VariogramEstimation" id="toc-VariogramEstimation"><span class="toc-section-number">21.4</span> Estimating the semivariogram</a>
<ul>
<li><a href="Introkriging.html#MoM" id="toc-MoM"><span class="toc-section-number">21.4.1</span> Method-of-moments</a></li>
<li><a href="Introkriging.html#MLestimationVariogram" id="toc-MLestimationVariogram"><span class="toc-section-number">21.4.2</span> Maximum likelihood</a></li>
</ul></li>
<li><a href="Introkriging.html#ResidualVariogram" id="toc-ResidualVariogram"><span class="toc-section-number">21.5</span> Estimating the residual semivariogram</a>
<ul>
<li><a href="Introkriging.html#IterativeMoM" id="toc-IterativeMoM"><span class="toc-section-number">21.5.1</span> Iterative method-of-moments</a></li>
<li><a href="Introkriging.html#REML" id="toc-REML"><span class="toc-section-number">21.5.2</span> Restricted maximum likelihood</a></li>
</ul></li>
</ul></li>
<li><a href="MBgridspacing.html#MBgridspacing" id="toc-MBgridspacing"><span class="toc-section-number">22</span> Model-based optimisation of the grid spacing</a>
<ul>
<li><a href="MBgridspacing.html#GridspacingOK" id="toc-GridspacingOK"><span class="toc-section-number">22.1</span> Optimal grid spacing for ordinary kriging</a></li>
<li><a href="MBgridspacing.html#controlling-the-mean-or-a-quantile-of-the-ordinary-kriging-variance" id="toc-controlling-the-mean-or-a-quantile-of-the-ordinary-kriging-variance"><span class="toc-section-number">22.2</span> Controlling the mean or a quantile of the ordinary kriging variance</a></li>
<li><a href="MBgridspacing.html#optimal-grid-spacing-for-block-kriging" id="toc-optimal-grid-spacing-for-block-kriging"><span class="toc-section-number">22.3</span> Optimal grid spacing for block-kriging</a></li>
<li><a href="MBgridspacing.html#MBgridspacingKED" id="toc-MBgridspacingKED"><span class="toc-section-number">22.4</span> Optimal grid spacing for kriging with an external drift</a></li>
<li><a href="MBgridspacing.html#BayesianGridSpacing" id="toc-BayesianGridSpacing"><span class="toc-section-number">22.5</span> Bayesian approach</a></li>
</ul></li>
<li><a href="MBSamplePattern.html#MBSamplePattern" id="toc-MBSamplePattern"><span class="toc-section-number">23</span> Model-based optimisation of the sampling pattern</a>
<ul>
<li><a href="MBSamplePattern.html#SSA" id="toc-SSA"><span class="toc-section-number">23.1</span> Spatial simulated annealing</a></li>
<li><a href="MBSamplePattern.html#SamplePatternOK" id="toc-SamplePatternOK"><span class="toc-section-number">23.2</span> Optimising the sampling pattern for ordinary kriging</a></li>
<li><a href="MBSamplePattern.html#SamplePatternKED" id="toc-SamplePatternKED"><span class="toc-section-number">23.3</span> Optimising the sampling pattern for kriging with an external drift</a></li>
<li><a href="MBSamplePattern.html#model-based-infill-sampling-for-ordinary-kriging" id="toc-model-based-infill-sampling-for-ordinary-kriging"><span class="toc-section-number">23.4</span> Model-based infill sampling for ordinary kriging</a></li>
<li><a href="MBSamplePattern.html#model-based-infill-sampling-for-kriging-with-an-external-drift" id="toc-model-based-infill-sampling-for-kriging-with-an-external-drift"><span class="toc-section-number">23.5</span> Model-based infill sampling for kriging with an external drift</a></li>
</ul></li>
<li><a href="SamplingVariogram.html#SamplingVariogram" id="toc-SamplingVariogram"><span class="toc-section-number">24</span> Sampling for estimating the semivariogram</a>
<ul>
<li><a href="SamplingVariogram.html#NestedSampling" id="toc-NestedSampling"><span class="toc-section-number">24.1</span> Nested sampling</a></li>
<li><a href="SamplingVariogram.html#IndependentSamplingPairs" id="toc-IndependentSamplingPairs"><span class="toc-section-number">24.2</span> Independent sampling of pairs of points</a></li>
<li><a href="SamplingVariogram.html#samplingforvariogram" id="toc-samplingforvariogram"><span class="toc-section-number">24.3</span> Optimisation of sampling pattern for semivariogram estimation</a>
<ul>
<li><a href="SamplingVariogram.html#UncertainSemivariogramParameters" id="toc-UncertainSemivariogramParameters"><span class="toc-section-number">24.3.1</span> Uncertainty about semivariogram parameters</a></li>
<li><a href="SamplingVariogram.html#UncertainKrigingVariance" id="toc-UncertainKrigingVariance"><span class="toc-section-number">24.3.2</span> Uncertainty about the kriging variance</a></li>
</ul></li>
<li><a href="SamplingVariogram.html#SamplingEstimationandPrediction" id="toc-SamplingEstimationandPrediction"><span class="toc-section-number">24.4</span> Optimisation of sampling pattern for semivariogram estimation and mapping</a></li>
<li><a href="SamplingVariogram.html#a-practical-solution" id="toc-a-practical-solution"><span class="toc-section-number">24.5</span> A practical solution</a></li>
</ul></li>
<li><a href="Validation.html#Validation" id="toc-Validation"><span class="toc-section-number">25</span> Sampling for validation of maps</a>
<ul>
<li><a href="Validation.html#map-quality-indices" id="toc-map-quality-indices"><span class="toc-section-number">25.1</span> Map quality indices</a>
<ul>
<li><a href="Validation.html#estimation-of-map-quality-indices" id="toc-estimation-of-map-quality-indices"><span class="toc-section-number">25.1.1</span> Estimation of map quality indices</a></li>
</ul></li>
<li><a href="Validation.html#real-world-case-study" id="toc-real-world-case-study"><span class="toc-section-number">25.2</span> Real-world case study</a>
<ul>
<li><a href="Validation.html#estimation-of-the-population-mean-error-and-mean-squared-error" id="toc-estimation-of-the-population-mean-error-and-mean-squared-error"><span class="toc-section-number">25.2.1</span> Estimation of the population mean error and mean squared error</a></li>
<li><a href="Validation.html#estimation-of-the-standard-error-of-the-estimator-of-the-population-mean-error-and-mean-squared-error" id="toc-estimation-of-the-standard-error-of-the-estimator-of-the-population-mean-error-and-mean-squared-error"><span class="toc-section-number">25.2.2</span> Estimation of the standard error of the estimator of the population mean error and mean squared error</a></li>
<li><a href="Validation.html#estimation-of-model-efficiency-coefficient" id="toc-estimation-of-model-efficiency-coefficient"><span class="toc-section-number">25.2.3</span> Estimation of model efficiency coefficient</a></li>
<li><a href="Validation.html#statistical-testing-of-hypothesis-about-population-me-and-mse" id="toc-statistical-testing-of-hypothesis-about-population-me-and-mse"><span class="toc-section-number">25.2.4</span> Statistical testing of hypothesis about population ME and MSE</a></li>
</ul></li>
</ul></li>
<li><a href="Approaches.html#Approaches" id="toc-Approaches"><span class="toc-section-number">26</span> Design-based, model-based, and model-assisted approach for sampling and inference</a>
<ul>
<li><a href="Approaches.html#two-sources-of-randomness" id="toc-two-sources-of-randomness"><span class="toc-section-number">26.1</span> Two sources of randomness</a></li>
<li><a href="Approaches.html#iid" id="toc-iid"><span class="toc-section-number">26.2</span> Identically and independently distributed</a></li>
<li><a href="Approaches.html#BiasandVariance" id="toc-BiasandVariance"><span class="toc-section-number">26.3</span> Bias and variance</a></li>
<li><a href="Approaches.html#effectivesamplesize" id="toc-effectivesamplesize"><span class="toc-section-number">26.4</span> Effective sample size</a></li>
<li><a href="Approaches.html#ExploitSpatialStructure" id="toc-ExploitSpatialStructure"><span class="toc-section-number">26.5</span> Exploiting spatial structure in design-based approach</a></li>
<li><a href="Approaches.html#ModelassistedvsModeldependent" id="toc-ModelassistedvsModeldependent"><span class="toc-section-number">26.6</span> Model-assisted vs. model-dependent</a></li>
</ul></li>
<li><a href="#appendix-appendices" id="toc-appendix-appendices">(APPENDIX) Appendices</a></li>
<li><a href="Answers.html#Answers" id="toc-Answers"><span class="toc-section-number">27</span> Answers to exercises</a>
<ul>
<li><a href="Answers.html#introduction-to-probability-sampling" id="toc-introduction-to-probability-sampling">Introduction to probability sampling</a></li>
<li><a href="Answers.html#simple-random-sampling-1" id="toc-simple-random-sampling-1">Simple random sampling</a></li>
<li><a href="Answers.html#stratified-simple-random-sampling-1" id="toc-stratified-simple-random-sampling-1">Stratified simple random sampling</a></li>
<li><a href="Answers.html#systematic-random-sampling-2" id="toc-systematic-random-sampling-2">Systematic random sampling</a></li>
<li><a href="Answers.html#cluster-random-sampling" id="toc-cluster-random-sampling">Cluster random sampling</a></li>
<li><a href="Answers.html#two-stage-cluster-random-sampling-1" id="toc-two-stage-cluster-random-sampling-1">Two-stage cluster random sampling</a></li>
<li><a href="Answers.html#sampling-with-probabilities-proportional-to-size" id="toc-sampling-with-probabilities-proportional-to-size">Sampling with probabilities proportional to size</a></li>
<li><a href="Answers.html#balanced-and-well-spread-sampling" id="toc-balanced-and-well-spread-sampling">Balanced and well-spread sampling</a></li>
<li><a href="Answers.html#model-assisted-estimation" id="toc-model-assisted-estimation">Model-assisted estimation</a></li>
<li><a href="Answers.html#two-phase-random-sampling" id="toc-two-phase-random-sampling">Two-phase random sampling</a></li>
<li><a href="Answers.html#computing-the-required-sample-size" id="toc-computing-the-required-sample-size">Computing the required sample size</a></li>
<li><a href="Answers.html#model-based-optimisation-of-probability-sampling-designs" id="toc-model-based-optimisation-of-probability-sampling-designs">Model-based optimisation of probability sampling designs</a></li>
<li><a href="Answers.html#repeated-sample-surveys-for-monitoring-population-parameters" id="toc-repeated-sample-surveys-for-monitoring-population-parameters">Repeated sample surveys for monitoring population parameters</a></li>
<li><a href="Answers.html#regular-grid-and-spatial-coverage-sampling" id="toc-regular-grid-and-spatial-coverage-sampling">Regular grid and spatial coverage sampling</a></li>
<li><a href="Answers.html#covariate-space-coverage-sampling" id="toc-covariate-space-coverage-sampling">Covariate space coverage sampling</a></li>
<li><a href="Answers.html#conditioned-latin-hypercube-sampling" id="toc-conditioned-latin-hypercube-sampling">Conditioned Latin hypercube sampling</a></li>
<li><a href="Answers.html#model-based-optimisation-of-the-grid-spacing" id="toc-model-based-optimisation-of-the-grid-spacing">Model-based optimisation of the grid spacing</a></li>
<li><a href="Answers.html#model-based-optimisation-of-the-sampling-pattern" id="toc-model-based-optimisation-of-the-sampling-pattern">Model-based optimisation of the sampling pattern</a></li>
<li><a href="Answers.html#sampling-for-estimating-the-semivariogram" id="toc-sampling-for-estimating-the-semivariogram">Sampling for estimating the semivariogram</a></li>
<li><a href="Answers.html#sampling-for-validation-of-maps" id="toc-sampling-for-validation-of-maps">Sampling for validation of maps</a></li>
</ul></li>
<li><a href="references.html#references" id="toc-references">References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/DickBrus/">Dick Brus</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Spatial sampling with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="MBgridspacing" class="section level1 hasAnchor" number="22">
<h1><span class="header-section-number">Chapter 22</span> Model-based optimisation of the grid spacing<a href="MBgridspacing.html#MBgridspacing" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This is the first chapter on model-based sampling<a href="#fn12" class="footnote-ref" id="fnref12"><sup>12</sup></a>. In Section <a href="RegularGridSpatialCoverage.html#SpatialCoverage">17.2</a> and Chapter <a href="kmeans.html#kmeans">18</a> a geometric criterion is minimised, i.e., a criterion defined in terms of distances, either in geographic space (Section <a href="RegularGridSpatialCoverage.html#SpatialCoverage">17.2</a>) or in covariate space (Chapter <a href="kmeans.html#kmeans">18</a>). In model-based sampling, the minimisation criterion is a function of the variance of the prediction errors.</p>
<p>This chapter on model-based sampling is about optimisation of the spacing of a square grid, i.e., the distance between neighbouring points in the grid. The grid spacing is derived from a requirement on the accuracy of the map. Here and in following chapters, I assume that the map is constructed by kriging; see Chapter <a href="Introkriging.html#Introkriging">21</a> for an introduction. As we have seen in Chapter <a href="Introkriging.html#Introkriging">21</a>, a kriging prediction of the study variable at an unobserved location is accompanied by a variance of the prediction error, referred to as the kriging variance. The map accuracy requirement is a population parameter of this kriging variance, e.g., the population mean of the kriging variance.</p>
<div id="GridspacingOK" class="section level2 hasAnchor" number="22.1">
<h2><span class="header-section-number">22.1</span> Optimal grid spacing for ordinary kriging<a href="MBgridspacing.html#GridspacingOK" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Suppose that we require the population mean of the kriging variance not to exceed a given threshold. The question then is what the tolerable or maximum possible grid spacing is, given this requirement. For finding the tolerable grid spacing we must have prior knowledge of the spatial variation. I first consider the situation in which it is reasonable to assume that the model-mean of the study variable is constant throughout the study area, but is unknown. When the model-mean is unknown, ordinary kriging (OK) is used for mapping. Furthermore, we need a semivariogram of the study variable. In practice, we often do not have a reliable estimate of the semivariogram. In the best case scenario, we have some existing data, of sufficient quantity and suitable spatial distribution, that can be used to estimate the semivariogram. In other cases, such data are lacking and a best guess of the semivariogram must be made, for instance using data for the same study variable from other, similar areas.</p>
<p>There is no simple equation that relates the grid spacing to the kriging variance. What can be done is calculate the mean OK variance for a range of grid spacings, plot the mean ordinary kriging variances against the grid spacings, and use this plot inversely to determine the tolerable grid spacing, given a constraint on the mean OK variance.</p>
<p>In the next code chunks, this procedure is used to compute the tolerable spacing of a square grid for mapping soil organic matter (SOM) in West-Amhara. The legacy data of the SOM concentration (dag kg<sup>-1</sup>), used before to design a spatial infill sample (Section <a href="RegularGridSpatialCoverage.html#SpatialInfill">17.3</a>), are used here to estimate a semivariogram. A sample semivariogram is estimated by the method-of-moments (MoM), and a spherical model is fitted using functions of package <strong>gstat</strong> <span class="citation">(<a href="#ref-peb04" role="doc-biblioref">E. J. Pebesma 2004</a>)</span>. The values for the partial sill, range, and nugget, passed to function <code>fit.variogram</code> with argument <code>model</code>, are guesses from an eyeball examination of the sample semivariogram obtained with function <code>variogram</code>, see Figure <a href="MBgridspacing.html#fig:variogramSOMEthiopia">22.1</a>. The ultimate estimates of the semivariogram parameters differ from these eyeball estimates. First, the projected coordinates of the sampling points are changed from m into km using function <code>mutate</code><a href="#fn13" class="footnote-ref" id="fnref13"><sup>13</sup></a>.</p>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb478-1"><a href="MBgridspacing.html#cb478-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gstat)</span>
<span id="cb478-2"><a href="MBgridspacing.html#cb478-2" aria-hidden="true" tabindex="-1"></a>grdAmhara <span class="ot">&lt;-</span> grdAmhara <span class="sc">%&gt;%</span></span>
<span id="cb478-3"><a href="MBgridspacing.html#cb478-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">s1 =</span> s1 <span class="sc">/</span> <span class="dv">1000</span>, <span class="at">s2 =</span> s2 <span class="sc">/</span> <span class="dv">1000</span>)</span>
<span id="cb478-4"><a href="MBgridspacing.html#cb478-4" aria-hidden="true" tabindex="-1"></a>sampleAmhara <span class="ot">&lt;-</span> sampleAmhara <span class="sc">%&gt;%</span></span>
<span id="cb478-5"><a href="MBgridspacing.html#cb478-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">s1 =</span> s1 <span class="sc">/</span> <span class="dv">1000</span>, <span class="at">s2 =</span> s2 <span class="sc">/</span> <span class="dv">1000</span>)</span>
<span id="cb478-6"><a href="MBgridspacing.html#cb478-6" aria-hidden="true" tabindex="-1"></a><span class="fu">coordinates</span>(sampleAmhara) <span class="ot">&lt;-</span> <span class="er">~</span> s1 <span class="sc">+</span> s2</span>
<span id="cb478-7"><a href="MBgridspacing.html#cb478-7" aria-hidden="true" tabindex="-1"></a>vg <span class="ot">&lt;-</span> <span class="fu">variogram</span>(SOM <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> sampleAmhara)</span>
<span id="cb478-8"><a href="MBgridspacing.html#cb478-8" aria-hidden="true" tabindex="-1"></a>model_eye <span class="ot">&lt;-</span> <span class="fu">vgm</span>(<span class="at">model =</span> <span class="st">&quot;Sph&quot;</span>, <span class="at">psill =</span> <span class="fl">0.6</span>, <span class="at">range =</span> <span class="dv">40</span>, <span class="at">nugget =</span> <span class="fl">0.6</span>)</span>
<span id="cb478-9"><a href="MBgridspacing.html#cb478-9" aria-hidden="true" tabindex="-1"></a>vgm_MoM <span class="ot">&lt;-</span> <span class="fu">fit.variogram</span>(vg, <span class="at">model =</span> model_eye)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:variogramSOMEthiopia"></span>
<img src="SpatialSampling_files/figure-html/variogramSOMEthiopia-1.png" alt="Sample semivariogram and fitted spherical model of the SOM concentration in West-Amhara, estimated from the legacy data." width="80%" />
<p class="caption">
Figure 22.1: Sample semivariogram and fitted spherical model of the SOM concentration in West-Amhara, estimated from the legacy data.
</p>
</div>
<p>The semivariogram of SOM can also be estimated by maximum likelihood (ML) using function <code>likfit</code> of package <strong>geoR</strong> <span class="citation">(<a href="#ref-geoR" role="doc-biblioref">Ribeiro Jr et al. 2020</a>)</span>, see Section <a href="Introkriging.html#VariogramEstimation">21.4</a>.</p>
<div class="sourceCode" id="cb479"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb479-1"><a href="MBgridspacing.html#cb479-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geoR)</span>
<span id="cb479-2"><a href="MBgridspacing.html#cb479-2" aria-hidden="true" tabindex="-1"></a>sampleAmhara <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(sampleAmhara)</span>
<span id="cb479-3"><a href="MBgridspacing.html#cb479-3" aria-hidden="true" tabindex="-1"></a>dGeoR <span class="ot">&lt;-</span> <span class="fu">as.geodata</span>(</span>
<span id="cb479-4"><a href="MBgridspacing.html#cb479-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">obj =</span> sampleAmhara, <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">coords.col =</span> <span class="fu">c</span>(<span class="st">&quot;s1&quot;</span>, <span class="st">&quot;s2&quot;</span>),</span>
<span id="cb479-5"><a href="MBgridspacing.html#cb479-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data.col =</span> <span class="st">&quot;SOM&quot;</span>)</span>
<span id="cb479-6"><a href="MBgridspacing.html#cb479-6" aria-hidden="true" tabindex="-1"></a>vgm_ML <span class="ot">&lt;-</span> <span class="fu">likfit</span>(<span class="at">geodata =</span> dGeoR, <span class="at">trend =</span> <span class="st">&quot;cte&quot;</span>,</span>
<span id="cb479-7"><a href="MBgridspacing.html#cb479-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">cov.model =</span> <span class="st">&quot;spherical&quot;</span>, <span class="at">ini.cov.pars =</span> <span class="fu">c</span>(<span class="fl">0.6</span>, <span class="dv">40</span>),</span>
<span id="cb479-8"><a href="MBgridspacing.html#cb479-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">nugget =</span> <span class="fl">0.6</span>, <span class="at">lik.method =</span> <span class="st">&quot;ML&quot;</span>, <span class="at">messages =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>Table <a href="MBgridspacing.html#tab:VariogramEstimatesEthiopia">22.1</a> shows the ML estimates of the parameters of the spherical semivariogram, together with the MoM estimates. Either could be used in the following steps.</p>
<table class=" lightable-classic" style="font-family: &quot;Arial Narrow&quot;, &quot;Source Sans Pro&quot;, sans-serif; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:VariogramEstimatesEthiopia">Table 22.1: </span>Method-of-moments (MoM) and maximum likelihood (ML) estimates of the parameters of a spherical semivariogram of the SOM concentration in West-Amhara.
</caption>
<thead>
<tr>
<th style="text-align:left;">
Parameter
</th>
<th style="text-align:right;">
MoM
</th>
<th style="text-align:right;">
ML
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
nugget
</td>
<td style="text-align:right;">
0.62
</td>
<td style="text-align:right;">
0.56
</td>
</tr>
<tr>
<td style="text-align:left;">
partial sill
</td>
<td style="text-align:right;">
0.56
</td>
<td style="text-align:right;">
0.68
</td>
</tr>
<tr>
<td style="text-align:left;">
range
</td>
<td style="text-align:right;">
45.40
</td>
<td style="text-align:right;">
36.90
</td>
</tr>
</tbody>
</table>
</div>
<div id="controlling-the-mean-or-a-quantile-of-the-ordinary-kriging-variance" class="section level2 hasAnchor" number="22.2">
<h2><span class="header-section-number">22.2</span> Controlling the mean or a quantile of the ordinary kriging variance<a href="MBgridspacing.html#controlling-the-mean-or-a-quantile-of-the-ordinary-kriging-variance" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To decide on the grid spacing, we may require the population mean kriging variance (MKV) not to exceed a given threshold. Instead of the population mean, we may use the population median or any other quantile of the cumulative distribution function of the kriging variance, for instance the 0.90 quantile (P90), as a quality criterion. Hereafter, the ML semivariogram is used to optimise the grid spacing given a requirement on the mean, median, and P90 of the kriging variance.</p>
<p>As a first step, a series of spacings of the square grid with observations is specified. Only spacings are considered which would result in expected sample sizes that are reasonable for kriging. With a spacing of 5 km, the expected sample size is 434 points; with a spacing of 12 km, these are 75 points.</p>
<div class="sourceCode" id="cb480"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb480-1"><a href="MBgridspacing.html#cb480-1" aria-hidden="true" tabindex="-1"></a>spacing <span class="ot">&lt;-</span> <span class="dv">5</span><span class="sc">:</span><span class="dv">12</span></span></code></pre></div>
<p>The next step is to select a simple random sample of evaluation points. It is important to select a large sample, so that the precision of the estimated population mean or quantile of the kriging variance will be high.</p>

<div class="rmdnote">
To check whether the size of the simple random sample of evaluation points is sufficiently large, we may estimate the standard error of the estimator of the MKV, see Chapter <a href="SI.html#SI">3</a>, substituting the kriging variances at the evaluation points for the study variable values.
</div>
<div class="sourceCode" id="cb481"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb481-1"><a href="MBgridspacing.html#cb481-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">314</span>)</span>
<span id="cb481-2"><a href="MBgridspacing.html#cb481-2" aria-hidden="true" tabindex="-1"></a>mysample <span class="ot">&lt;-</span> grdAmhara <span class="sc">%&gt;%</span></span>
<span id="cb481-3"><a href="MBgridspacing.html#cb481-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">5000</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb481-4"><a href="MBgridspacing.html#cb481-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">s1 =</span> s1 <span class="sc">%&gt;%</span> <span class="fu">jitter</span>(<span class="at">amount =</span> <span class="fl">0.5</span>),</span>
<span id="cb481-5"><a href="MBgridspacing.html#cb481-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">s2 =</span> s2 <span class="sc">%&gt;%</span> <span class="fu">jitter</span>(<span class="at">amount =</span> <span class="fl">0.5</span>))</span></code></pre></div>
<p>The <strong>R</strong> code below shows the next steps. Given a spacing, a square grid with a fixed starting point is selected with function <code>spsample</code>, using argument <code>offset</code>. A dummy variable is added to the data frame, having value 1 at all grid points, but any other value is also fine. The predicted value at all evaluation points equals 1. However, we are not interested in the predicted value but in the kriging variance only, and we have seen in Chapter <a href="Introkriging.html#Introkriging">21</a> that the kriging variance is independent of the observations of the study variable. The ML estimates of the semivariogram are used in function <code>vgm</code> to define a semivariogram model of class <code>variogramModel</code> that can be handled by function <code>krige</code>. For each grid spacing the population mean, median, and P90 of the kriging variance are estimated from the evaluation sample. The estimated median and P90 can be computed with function <code>quantile</code>.</p>
<div class="sourceCode" id="cb482"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb482-1"><a href="MBgridspacing.html#cb482-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coordinates</span>(mysample) <span class="ot">&lt;-</span> <span class="er">~</span> s1 <span class="sc">+</span> s2</span>
<span id="cb482-2"><a href="MBgridspacing.html#cb482-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gridded</span>(grdAmhara) <span class="ot">&lt;-</span> <span class="er">~</span> s1 <span class="sc">+</span> s2</span>
<span id="cb482-3"><a href="MBgridspacing.html#cb482-3" aria-hidden="true" tabindex="-1"></a>MKV_OK <span class="ot">&lt;-</span> P50KV_OK <span class="ot">&lt;-</span> P90KV_OK <span class="ot">&lt;-</span> samplesize <span class="ot">&lt;-</span> </span>
<span id="cb482-4"><a href="MBgridspacing.html#cb482-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">numeric</span>(<span class="at">length =</span> <span class="fu">length</span>(spacing))</span>
<span id="cb482-5"><a href="MBgridspacing.html#cb482-5" aria-hidden="true" tabindex="-1"></a>vgm_ML_gstat <span class="ot">&lt;-</span> <span class="fu">vgm</span>(<span class="at">model =</span> <span class="st">&quot;Sph&quot;</span>, <span class="at">nugget =</span> vgm_ML<span class="sc">$</span>nugget,</span>
<span id="cb482-6"><a href="MBgridspacing.html#cb482-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">psill =</span> vgm_ML<span class="sc">$</span>sigmasq, <span class="at">range =</span> vgm_ML<span class="sc">$</span>phi)</span>
<span id="cb482-7"><a href="MBgridspacing.html#cb482-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">length</span>(spacing))) {</span>
<span id="cb482-8"><a href="MBgridspacing.html#cb482-8" aria-hidden="true" tabindex="-1"></a>  mygrid <span class="ot">&lt;-</span> <span class="fu">spsample</span>(<span class="at">x =</span> grdAmhara, <span class="at">cellsize =</span> spacing[i],</span>
<span id="cb482-9"><a href="MBgridspacing.html#cb482-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">&quot;regular&quot;</span>, <span class="at">offset =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>))</span>
<span id="cb482-10"><a href="MBgridspacing.html#cb482-10" aria-hidden="true" tabindex="-1"></a>  mygrid<span class="sc">$</span>dummy <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(mygrid))</span>
<span id="cb482-11"><a href="MBgridspacing.html#cb482-11" aria-hidden="true" tabindex="-1"></a>  samplesize[i] <span class="ot">&lt;-</span> <span class="fu">nrow</span>(mygrid)</span>
<span id="cb482-12"><a href="MBgridspacing.html#cb482-12" aria-hidden="true" tabindex="-1"></a>  predictions  <span class="ot">&lt;-</span> <span class="fu">krige</span>(</span>
<span id="cb482-13"><a href="MBgridspacing.html#cb482-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> dummy <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb482-14"><a href="MBgridspacing.html#cb482-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">locations =</span> mygrid,</span>
<span id="cb482-15"><a href="MBgridspacing.html#cb482-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata =</span> mysample,</span>
<span id="cb482-16"><a href="MBgridspacing.html#cb482-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> vgm_ML_gstat,</span>
<span id="cb482-17"><a href="MBgridspacing.html#cb482-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">nmax =</span> <span class="dv">100</span>,</span>
<span id="cb482-18"><a href="MBgridspacing.html#cb482-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">debug.level =</span> <span class="dv">0</span>)</span>
<span id="cb482-19"><a href="MBgridspacing.html#cb482-19" aria-hidden="true" tabindex="-1"></a>  MKV_OK[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(predictions<span class="sc">$</span>var1.var)</span>
<span id="cb482-20"><a href="MBgridspacing.html#cb482-20" aria-hidden="true" tabindex="-1"></a>  P50KV_OK[i] <span class="ot">&lt;-</span> <span class="fu">quantile</span>(predictions<span class="sc">$</span>var1.var, <span class="at">probs =</span> <span class="fl">0.5</span>)</span>
<span id="cb482-21"><a href="MBgridspacing.html#cb482-21" aria-hidden="true" tabindex="-1"></a>  P90KV_OK[i] <span class="ot">&lt;-</span> <span class="fu">quantile</span>(predictions<span class="sc">$</span>var1.var, <span class="at">probs =</span> <span class="fl">0.9</span>)</span>
<span id="cb482-22"><a href="MBgridspacing.html#cb482-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb482-23"><a href="MBgridspacing.html#cb482-23" aria-hidden="true" tabindex="-1"></a>dfKV_OK <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(spacing, samplesize, MKV_OK, P50KV_OK, P90KV_OK)</span></code></pre></div>
<p>The estimated mean and quantiles of the kriging variance are plotted against the grid spacing (Figure <a href="MBgridspacing.html#fig:MOKVvsSpacingEthiopia">22.2</a>).</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:MOKVvsSpacingEthiopia"></span>
<img src="SpatialSampling_files/figure-html/MOKVvsSpacingEthiopia-1.png" alt="Mean, median (P50), and 0.90 quantile (P90) of the ordinary kriging variance of predictions of the SOM concentration in West-Amhara, as a function of the spacing of a square grid." width="80%" />
<p class="caption">
Figure 22.2: Mean, median (P50), and 0.90 quantile (P90) of the ordinary kriging variance of predictions of the SOM concentration in West-Amhara, as a function of the spacing of a square grid.
</p>
</div>
<p>The tolerable grid spacing for the three quality indices can be computed with function <code>approx</code> of the <strong>base</strong> package, as shown below for the median kriging variance.</p>
<div class="sourceCode" id="cb483"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb483-1"><a href="MBgridspacing.html#cb483-1" aria-hidden="true" tabindex="-1"></a>spacing_tol_P50 <span class="ot">&lt;-</span> <span class="fu">approx</span>(<span class="at">x =</span> dfKV_OK<span class="sc">$</span>P50, <span class="at">y =</span> dfKV_OK<span class="sc">$</span>spacing, <span class="at">xout =</span> <span class="fl">0.8</span>)<span class="sc">$</span>y</span></code></pre></div>
<p>For a mean kriging variance of 0.8 (dag kg<sup>-1</sup>)<sup>2</sup> the tolerable grid spacing is 8.6 km. For the median kriging variance this is 9.2 km, which is somewhat larger leading to a smaller sample size. The smaller grid spacing for the mean can be explained by the right-skewed distribution of the kriging variance, so that the mean kriging variance is larger than the median kriging variance. For the P90 of the kriging variance, the tolerable grid spacing is much smaller, 6.8 km, leading to a much larger sample size.</p>
<div id="exercises-27" class="section level4 unnumbered hasAnchor">
<h4>Exercises<a href="MBgridspacing.html#exercises-27" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>Write an <strong>R</strong> script to determine the tolerable grid spacing so that the 0.50, 0.80, and 0.95 quantiles of the variance of OK predictions of SOM in West-Amhara do not exceed 0.85. Estimate the semivariogram by MoM.<br />
</li>
<li>In practice, we are uncertain about the semivariogram. For this reason, it can be wise to explore the sensitivity of the tolerable grid spacing for the semivariogram parameters.
<ul>
<li>Increase the nugget parameter of the MoM semivariogram by 5%, and change the partial sill parameter so that the sill (nugget + partial sill) is unchanged. Compute the tolerable grid spacing and the corresponding required sample size for a mean kriging variance of 0.85 (dag kg<sup>-1</sup>)<sup>2</sup>. Explain the difference.</li>
<li>Reduce the range of the MoM semivariogram by 5%. Reset the nugget and the partial sill to their original values. Compute the tolerable grid spacing and the corresponding required sample size for a mean kriging variance of 0.85 (dag kg<sup>-1</sup>)<sup>2</sup>. Explain the difference.</li>
</ul></li>
</ol>
</div>
</div>
<div id="optimal-grid-spacing-for-block-kriging" class="section level2 hasAnchor" number="22.3">
<h2><span class="header-section-number">22.3</span> Optimal grid spacing for block-kriging<a href="MBgridspacing.html#optimal-grid-spacing-for-block-kriging" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In the previous section, the tolerable grid spacing is derived from a constraint on the mean or quantile of the prediction error variances at points. The alternative is to put a constraint on the mean or quantile of the error variances of the predicted means of blocks. These means can be predicted with block-kriging (Section <a href="Introkriging.html#BlockKriging">21.2</a>). Block-kriging predictions can be obtained with function <code>krige</code> of package <strong>gstat</strong> using argument <code>block</code>. In the code chunk below, the means of 100 m <span class="math inline">\(\times\)</span> 100 m blocks are predicted by ordinary block-kriging.</p>
<div class="sourceCode" id="cb484"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb484-1"><a href="MBgridspacing.html#cb484-1" aria-hidden="true" tabindex="-1"></a>MKV_OBK <span class="ot">&lt;-</span> P50KV_OBK <span class="ot">&lt;-</span> P90KV_OBK <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="at">length =</span> <span class="fu">length</span>(spacing))</span>
<span id="cb484-2"><a href="MBgridspacing.html#cb484-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">length</span>(spacing))) {</span>
<span id="cb484-3"><a href="MBgridspacing.html#cb484-3" aria-hidden="true" tabindex="-1"></a>  mygrid <span class="ot">&lt;-</span> <span class="fu">spsample</span>(<span class="at">x =</span> grdAmhara, <span class="at">cellsize =</span> spacing[i],</span>
<span id="cb484-4"><a href="MBgridspacing.html#cb484-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">&quot;regular&quot;</span>, <span class="at">offset =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>))</span>
<span id="cb484-5"><a href="MBgridspacing.html#cb484-5" aria-hidden="true" tabindex="-1"></a>  mygrid<span class="sc">$</span>dummy <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(mygrid))</span>
<span id="cb484-6"><a href="MBgridspacing.html#cb484-6" aria-hidden="true" tabindex="-1"></a>  samplesize[i] <span class="ot">&lt;-</span> <span class="fu">nrow</span>(mygrid)</span>
<span id="cb484-7"><a href="MBgridspacing.html#cb484-7" aria-hidden="true" tabindex="-1"></a>  predictions  <span class="ot">&lt;-</span> <span class="fu">krige</span>(</span>
<span id="cb484-8"><a href="MBgridspacing.html#cb484-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> dummy <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb484-9"><a href="MBgridspacing.html#cb484-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">locations =</span> mygrid,</span>
<span id="cb484-10"><a href="MBgridspacing.html#cb484-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata =</span> mysample,</span>
<span id="cb484-11"><a href="MBgridspacing.html#cb484-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> vgm_ML_gstat,</span>
<span id="cb484-12"><a href="MBgridspacing.html#cb484-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">block =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>),</span>
<span id="cb484-13"><a href="MBgridspacing.html#cb484-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">nmax =</span> <span class="dv">100</span>,</span>
<span id="cb484-14"><a href="MBgridspacing.html#cb484-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">debug.level =</span> <span class="dv">0</span>)</span>
<span id="cb484-15"><a href="MBgridspacing.html#cb484-15" aria-hidden="true" tabindex="-1"></a>  MKV_OBK[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(predictions<span class="sc">$</span>var1.var)</span>
<span id="cb484-16"><a href="MBgridspacing.html#cb484-16" aria-hidden="true" tabindex="-1"></a>  P50KV_OBK[i] <span class="ot">&lt;-</span> <span class="fu">quantile</span>(predictions<span class="sc">$</span>var1.var, <span class="at">probs =</span> <span class="fl">0.5</span>)</span>
<span id="cb484-17"><a href="MBgridspacing.html#cb484-17" aria-hidden="true" tabindex="-1"></a>  P90KV_OBK[i] <span class="ot">&lt;-</span> <span class="fu">quantile</span>(predictions<span class="sc">$</span>var1.var, <span class="at">probs =</span> <span class="fl">0.9</span>)</span>
<span id="cb484-18"><a href="MBgridspacing.html#cb484-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb484-19"><a href="MBgridspacing.html#cb484-19" aria-hidden="true" tabindex="-1"></a>dfKV_OBK <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(spacing, MKV_OBK, P50KV_OBK, P90KV_OBK)</span></code></pre></div>
<p>Figure <a href="MBgridspacing.html#fig:MOBKVvsSpacingEthiopia">22.3</a> shows that the mean, P50, and P90 of the block-kriging predictions are substantially smaller than those of the point-kriging predictions (Figure <a href="MBgridspacing.html#fig:MOKVvsSpacingEthiopia">22.2</a>). This can be explained by the large nugget of the semivariogram (Table <a href="MBgridspacing.html#tab:VariogramEstimatesEthiopia">22.1</a>). The side length of a prediction block (100 m) is much smaller than the range of the semivariogram (36.9 km), so that in this case the mean semivariance within a prediction block is about equal to the nugget. Roughly speaking, for a given grid spacing the mean point-kriging variance is reduced by an amount about equal to this mean semivariance to yield the mean block-kriging variance for this spacing (Section <a href="Introkriging.html#BlockKriging">21.2</a>). Recall that the mean semivariance within a block is a model-based prediction of the variance within a block (Subsection <a href="MBpredictionofDesignVariance.html#AnalyticalApproach">13.1.1</a>, Equation <a href="MBpredictionofDesignVariance.html#eq:meansemivariance">(13.3)</a>).</p>

<div class="figure" style="text-align: center"><span style="display:block;" id="fig:MOBKVvsSpacingEthiopia"></span>
<img src="SpatialSampling_files/figure-html/MOBKVvsSpacingEthiopia-1.png" alt="Mean, median (P50), and 0.90 quantile (P90) of the ordinary block-kriging variance of predictions of the mean SOM concentration of blocks of 100 m \(\times\) 100 m, in West-Amhara, as a function of the spacing of a square grid." width="80%" />
<p class="caption">
Figure 22.3: Mean, median (P50), and 0.90 quantile (P90) of the ordinary block-kriging variance of predictions of the mean SOM concentration of blocks of 100 m <span class="math inline">\(\times\)</span> 100 m, in West-Amhara, as a function of the spacing of a square grid.
</p>
</div>
</div>
<div id="MBgridspacingKED" class="section level2 hasAnchor" number="22.4">
<h2><span class="header-section-number">22.4</span> Optimal grid spacing for kriging with an external drift<a href="MBgridspacing.html#MBgridspacingKED" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In the previous sections I assumed a constant model-mean for the study variable. I now consider the case where covariates that are related to the study variable are available. A model is calibrated that is the sum of a linear combination of the covariates (spatial trend) and a spatially structured residual, see Equation <a href="Introkriging.html#eq:KEDmodel2">(21.16)</a>. Predictions at the nodes of a fine grid are obtained by kriging with an external drift (KED).</p>
<p>The SOM concentration data of West-Amhara are used to estimate the parameters (regression coefficients and residual semivariogram parameters) of the model by restricted maximum likelihood (REML), see Subsection <a href="Introkriging.html#REML">21.5.2</a>.</p>
<div class="sourceCode" id="cb485"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb485-1"><a href="MBgridspacing.html#cb485-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geoR)</span>
<span id="cb485-2"><a href="MBgridspacing.html#cb485-2" aria-hidden="true" tabindex="-1"></a>dGeoR <span class="ot">&lt;-</span> <span class="fu">as.geodata</span>(<span class="at">obj =</span> sampleAmhara, <span class="at">header =</span> <span class="cn">TRUE</span>,</span>
<span id="cb485-3"><a href="MBgridspacing.html#cb485-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords.col =</span> <span class="fu">c</span>(<span class="st">&quot;s1&quot;</span>, <span class="st">&quot;s2&quot;</span>), <span class="at">data.col =</span> <span class="st">&quot;SOM&quot;</span>,</span>
<span id="cb485-4"><a href="MBgridspacing.html#cb485-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">covar.col =</span> <span class="fu">c</span>(<span class="st">&quot;dem&quot;</span>, <span class="st">&quot;rfl_NIR&quot;</span>, <span class="st">&quot;rfl_red&quot;</span>, <span class="st">&quot;lst&quot;</span>))</span>
<span id="cb485-5"><a href="MBgridspacing.html#cb485-5" aria-hidden="true" tabindex="-1"></a>vgm_REML <span class="ot">&lt;-</span> <span class="fu">likfit</span>(<span class="at">geodata =</span> dGeoR, <span class="at">trend =</span> <span class="sc">~</span> dem <span class="sc">+</span> rfl_NIR <span class="sc">+</span> rfl_red <span class="sc">+</span> lst,</span>
<span id="cb485-6"><a href="MBgridspacing.html#cb485-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">cov.model =</span> <span class="st">&quot;spherical&quot;</span>, <span class="at">ini.cov.pars =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>),</span>
<span id="cb485-7"><a href="MBgridspacing.html#cb485-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">nugget =</span> <span class="fl">0.2</span>, <span class="at">lik.method =</span> <span class="st">&quot;REML&quot;</span>, <span class="at">messages =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<table class=" lightable-classic" style="font-family: &quot;Arial Narrow&quot;, &quot;Source Sans Pro&quot;, sans-serif; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:VariogramREMLEthiopia">Table 22.2: </span>Maximum likelihood (ML) estimates of the parameters of a spherical semivariogram for the SOM concentration and restricted maximum likelihood (REML) estimates of the parameters of a spherical semivariogram for the residuals of a multiple linear regression model, for West-Amhara.
</caption>
<thead>
<tr>
<th style="text-align:left;">
Parameter
</th>
<th style="text-align:right;">
ML
</th>
<th style="text-align:right;">
REML
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
nugget
</td>
<td style="text-align:right;">
0.56
</td>
<td style="text-align:right;">
0.36
</td>
</tr>
<tr>
<td style="text-align:left;">
partial sill
</td>
<td style="text-align:right;">
0.68
</td>
<td style="text-align:right;">
0.44
</td>
</tr>
<tr>
<td style="text-align:left;">
range (km)
</td>
<td style="text-align:right;">
36.91
</td>
<td style="text-align:right;">
5.24
</td>
</tr>
</tbody>
</table>
<p>The total sill (partial sill + nugget) of the residual semivariogram, estimated by REML, equals 0.80, which is considerably smaller than that of the ML semivariogram of SOM (Table <a href="MBgridspacing.html#tab:VariogramREMLEthiopia">22.2</a>). A considerable part of the variance of SOM is explained by the covariates. Besides, note the much smaller range of the residual semivariogram. The smaller sill and range of the residual semivariogram show that the spatial structure of SOM is largely captured by the covariates. The residuals of the model-mean, which is a linear combination of the covariates, no longer show much spatial structure.</p>
<p>The mean kriging variance as obtained with KED is used as the evaluation criterion. With KED, the kriging variance is also a function of the values of the covariates at the sampling locations and the prediction location (Section <a href="Introkriging.html#IntroKED">21.3</a>). Compared with the procedure above for OK, in the code chunk below, a slightly different procedure is used. The square grid of a given spacing is randomly placed on the area (option <code>offset</code> in function <code>spsample</code> is not used), and this is repeated ten times.</p>
<div class="sourceCode" id="cb486"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb486-1"><a href="MBgridspacing.html#cb486-1" aria-hidden="true" tabindex="-1"></a>R <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb486-2"><a href="MBgridspacing.html#cb486-2" aria-hidden="true" tabindex="-1"></a>MKV_KED <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="fu">length</span>(spacing), <span class="at">ncol =</span> R)</span>
<span id="cb486-3"><a href="MBgridspacing.html#cb486-3" aria-hidden="true" tabindex="-1"></a>vgm_REML_gstat <span class="ot">&lt;-</span> <span class="fu">vgm</span>(<span class="at">model =</span> <span class="st">&quot;Sph&quot;</span>, <span class="at">nugget =</span> vgm_REML<span class="sc">$</span>nugget,</span>
<span id="cb486-4"><a href="MBgridspacing.html#cb486-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">psill =</span> vgm_REML<span class="sc">$</span>sigmasq, <span class="at">range =</span> vgm_REML<span class="sc">$</span>phi)</span>
<span id="cb486-5"><a href="MBgridspacing.html#cb486-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">314</span>)</span>
<span id="cb486-6"><a href="MBgridspacing.html#cb486-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">length</span>(spacing))) {</span>
<span id="cb486-7"><a href="MBgridspacing.html#cb486-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>R) {</span>
<span id="cb486-8"><a href="MBgridspacing.html#cb486-8" aria-hidden="true" tabindex="-1"></a>    mygrid <span class="ot">&lt;-</span> <span class="fu">spsample</span>(<span class="at">x =</span> grdAmhara, <span class="at">cellsize =</span> spacing[i], <span class="at">type =</span> <span class="st">&quot;regular&quot;</span>)</span>
<span id="cb486-9"><a href="MBgridspacing.html#cb486-9" aria-hidden="true" tabindex="-1"></a>    mygrid<span class="sc">$</span>dummy <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(mygrid))</span>
<span id="cb486-10"><a href="MBgridspacing.html#cb486-10" aria-hidden="true" tabindex="-1"></a>    mygrd <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">over</span>(mygrid, grdAmhara), mygrid)</span>
<span id="cb486-11"><a href="MBgridspacing.html#cb486-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coordinates</span>(mygrd) <span class="ot">&lt;-</span> <span class="er">~</span> x1 <span class="sc">+</span> x2</span>
<span id="cb486-12"><a href="MBgridspacing.html#cb486-12" aria-hidden="true" tabindex="-1"></a>    predictions <span class="ot">&lt;-</span> <span class="fu">krige</span>(</span>
<span id="cb486-13"><a href="MBgridspacing.html#cb486-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> dummy <span class="sc">~</span> dem <span class="sc">+</span> rfl_NIR <span class="sc">+</span> rfl_red <span class="sc">+</span> lst,</span>
<span id="cb486-14"><a href="MBgridspacing.html#cb486-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">locations =</span> mygrd,</span>
<span id="cb486-15"><a href="MBgridspacing.html#cb486-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">newdata =</span> mysample,</span>
<span id="cb486-16"><a href="MBgridspacing.html#cb486-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">model =</span> vgm_REML_gstat,</span>
<span id="cb486-17"><a href="MBgridspacing.html#cb486-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">nmax =</span> <span class="dv">100</span>,</span>
<span id="cb486-18"><a href="MBgridspacing.html#cb486-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">debug.level =</span> <span class="dv">0</span>)</span>
<span id="cb486-19"><a href="MBgridspacing.html#cb486-19" aria-hidden="true" tabindex="-1"></a>    MKV_KED[i, j] <span class="ot">&lt;-</span> <span class="fu">mean</span>(predictions<span class="sc">$</span>var1.var)</span>
<span id="cb486-20"><a href="MBgridspacing.html#cb486-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb486-21"><a href="MBgridspacing.html#cb486-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb486-22"><a href="MBgridspacing.html#cb486-22" aria-hidden="true" tabindex="-1"></a>dfKV_KED <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(spacing, MKV_KED)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:MKEDVvsSpacingEthiopia"></span>
<img src="SpatialSampling_files/figure-html/MKEDVvsSpacingEthiopia-1.png" alt="Mean kriging variance of OK and KED predictions of the SOM concentration in West-Amhara, as a function of the spacing of a square grid. With KED for each spacing, ten MKV values are shown obtained by selecting ten randomly placed grids of that spacing." width="80%" />
<p class="caption">
Figure 22.4: Mean kriging variance of OK and KED predictions of the SOM concentration in West-Amhara, as a function of the spacing of a square grid. With KED for each spacing, ten MKV values are shown obtained by selecting ten randomly placed grids of that spacing.
</p>
</div>
<p>Figure <a href="MBgridspacing.html#fig:MKEDVvsSpacingEthiopia">22.4</a> shows the mean kriging variances, obtained with OK and KED, as a function of the grid spacing. Interestingly, for grid spacings smaller than about 9 km, the mean kriging variance with KED is larger than with OK. In this case only for larger grid spacings KED outperforms OK in terms of the mean kriging variance. Only for mean kriging variances larger than about 0.82 (dag kg<sup>-1</sup>)<sup>2</sup> we can afford with KED a larger grid spacing (smaller sample size) than with OK. Only with large spacings (small sample sizes) we profit from modelling the mean as a linear function of covariates.</p>
<div class="sourceCode" id="cb487"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb487-1"><a href="MBgridspacing.html#cb487-1" aria-hidden="true" tabindex="-1"></a>MMKV_KED <span class="ot">&lt;-</span> <span class="fu">apply</span>(dfKV_KED[, <span class="sc">-</span><span class="dv">1</span>], <span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="at">FUN =</span> mean)</span>
<span id="cb487-2"><a href="MBgridspacing.html#cb487-2" aria-hidden="true" tabindex="-1"></a>spacing_tol_KED <span class="ot">&lt;-</span> <span class="fu">approx</span>(<span class="at">x =</span> MMKV_KED, <span class="at">y =</span> dfKV_KED<span class="sc">$</span>spacing, <span class="at">xout =</span> <span class="fl">0.8</span>)<span class="sc">$</span>y</span></code></pre></div>
<p>The tolerable grid spacing for a mean kriging variance of 0.8 (dag kg<sup>-1</sup>)<sup>2</sup>, using KED, equals 7.9 km.</p>
<div id="exercises-28" class="section level4 unnumbered hasAnchor">
<h4>Exercises<a href="MBgridspacing.html#exercises-28" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol start="3" style="list-style-type: decimal">
<li>Given a grid spacing, the mean kriging variance varies among randomly selected grids, especially for large spacings. Explain why.<br />
</li>
<li>Write an <strong>R</strong> script to compute the tolerable grid spacing for KED of natural logs of the electrical conductivity of the soil across the Cotton Research Farm of Uzbekistan, using natural logs of the electromagnetic induction (EM) measurements (lnEM100cm) as a covariate. Use a nugget of 0.126, a partial sill of 0.083, and a range of 230 m for an exponential semivariogram of the residuals (Table <a href="MBSamplePattern.html#tab:TableVariogramsCRF4">23.1</a>). Select a simple random sample of size 1,000 of evaluation points from the discretisation grid with interpolated lnEM100cm values to compute the mean kriging variance. Do this by selecting 1,000 grid cells by simple random sampling with replacement and jittering the centres of the selected grid cells by an amount equal to half the size of the grid cell. Use as grid spacings <span class="math inline">\(70, 75, \dots, 100\)</span> m. With a spacing of 100 m the number of grid points is about 100 (the farm has an area of about 97 ha). What is the tolerable grid spacing for a mean kriging variance of 0.165?</li>
</ol>
</div>
</div>
<div id="BayesianGridSpacing" class="section level2 hasAnchor" number="22.5">
<h2><span class="header-section-number">22.5</span> Bayesian approach<a href="MBgridspacing.html#BayesianGridSpacing" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In practice, we do not know the semivariogram. In the best case we have prior data that can be used to estimate the semivariogram. However, even in this case we are uncertain about the semivariogram model (spherical, exponential, etc.) and the semivariogram parameters. <span class="citation">Lark et al. (<a href="#ref-Lark2017" role="doc-biblioref">2017</a>)</span> showed how in a Bayesian approach we can account for uncertainty about the semivariogram parameters when we must decide on the grid spacing. In this approach a prior distribution of the semivariogram parameters is updated with the sample data to a posterior distribution <span class="citation">(<a href="#ref-Gelman2013" role="doc-biblioref">Gelman et al. 2013</a>)</span>:</p>
<p><span class="math display" id="eq:BayesRule">\[\begin{equation}
f(\pmb{\theta}|\mathbf{z}) = \frac{f(\pmb{\theta}) f(\mathbf{z}|\pmb{\theta})} {f(\mathbf{z})}\;,
\tag{22.1}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(f(\pmb{\theta}|\mathbf{z})\)</span> the posterior distribution function, i.e., the probability density function of the semivariogram parameters given the sample data, <span class="math inline">\(f(\pmb{\theta})\)</span> our prior belief in the parameters specified by a probability density function, <span class="math inline">\(f(\mathbf{z}|\pmb{\theta})\)</span> the likelihood of the data, and <span class="math inline">\(f(\mathbf{z})\)</span> the probability density function of the data. This probability density function <span class="math inline">\(f(\mathbf{z})\)</span> is hard to obtain.</p>
<p>Problems with analytical derivation of the posterior distribution are avoided by selecting a large sample of units (vectors with semivariogram parameters) from the posterior distribution through Markov chain Monte Carlo (MCMC) sampling, see Subsection <a href="MBpredictionofDesignVariance.html#MBpredSamplingVarBayes">13.1.3</a>.</p>
<p>In a Bayesian approach, we must define the likelihood function of the data, see Subsection <a href="MBpredictionofDesignVariance.html#MBpredSamplingVarBayes">13.1.3</a>. I assume that the SOM concentration data in West-Amhara have a multivariate normal distribution, and that the spatial covariance of the data can be modelled by a spherical model, see Subsection <a href="Introkriging.html#MLestimationVariogram">21.4.2</a>. The likelihood is a function of the semivariogram parameters. Given a vector of semivariogram parameters, the variance-covariance matrix of the data is computed from the matrix with geographic distances between the sampling points. Inputs of the log-likelihood function <code>ll</code> are the matrix with distances between the sampling points, the design matrix <code>X</code>, and the vector with observations of the study variable <code>z</code>, see Subsection <a href="MBpredictionofDesignVariance.html#MBpredSamplingVarBayes">13.1.3</a>.</p>
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb488-1"><a href="MBgridspacing.html#cb488-1" aria-hidden="true" tabindex="-1"></a>D <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">dist</span>(sampleAmhara[,<span class="fu">c</span>(<span class="st">&quot;s1&quot;</span>,<span class="st">&quot;s2&quot;</span>)]))</span>
<span id="cb488-2"><a href="MBgridspacing.html#cb488-2" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(sampleAmhara), <span class="dv">1</span>)</span>
<span id="cb488-3"><a href="MBgridspacing.html#cb488-3" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> sampleAmhara<span class="sc">$</span>SOM</span></code></pre></div>
<p>Besides the likelihood function, in a Bayesian approach we must define prior distributions for the semivariogram parameters. Here, we combine the partial sill and nugget into the <em>ratio of spatial dependence</em>, i.e., the proportion of the sill attributable to the partial sill. For the ratio of spatial dependence <span class="math inline">\(\xi\)</span> and the distance parameter <span class="math inline">\(\phi\)</span>, I use uniform distributions as priors, with a lower bound of 0 and an upper bound of 1 for the ratio of spatial dependence, and a lower bound of <span class="math inline">\(10^{-6}\)</span> km and an upper bound of 100 km for the range. A uniform distribution for the sill is not recommended <span class="citation">(<a href="#ref-Gelman2013" role="doc-biblioref">Gelman et al. 2013</a>)</span>. Instead, I assume a uniform distribution for the <em>inverse</em> of the sill, with a lower bound of <span class="math inline">\(10^{-6}\)</span> and an upper bound of 2.</p>
<p>These priors can be defined by function <code>createUniformPrior</code> of package <strong>BayesianTools</strong> <span class="citation">(<a href="#ref-Hartig2018" role="doc-biblioref">Hartig, Minunno, and Paul 2019</a>)</span>. There are also functions to define a beta density function (commonly used as a prior for proportions) and a truncated normal distribution as a prior. Function <code>createBayesianSetup</code> is then used to define the setup of the MCMC sampling, specifying the likelihood function, the prior, and the vector with best prior estimates of the model parameters, specified with argument <code>best</code>. The ML estimates computed in Section <a href="MBgridspacing.html#GridspacingOK">22.1</a> are used as starting values for the inverse of the sill parameter, the ratio of spatial dependence, and the range.</p>
<div class="sourceCode" id="cb489"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb489-1"><a href="MBgridspacing.html#cb489-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(BayesianTools)</span>
<span id="cb489-2"><a href="MBgridspacing.html#cb489-2" aria-hidden="true" tabindex="-1"></a>priors <span class="ot">&lt;-</span> <span class="fu">createUniformPrior</span>(</span>
<span id="cb489-3"><a href="MBgridspacing.html#cb489-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span> <span class="fu">c</span>(<span class="fl">1E-6</span>, <span class="dv">0</span>, <span class="fl">1E-6</span>), <span class="at">upper =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">100</span>))</span>
<span id="cb489-4"><a href="MBgridspacing.html#cb489-4" aria-hidden="true" tabindex="-1"></a>sill_ML <span class="ot">&lt;-</span> vgm_ML<span class="sc">$</span>nugget <span class="sc">+</span> vgm_ML<span class="sc">$</span>sigmasq</span>
<span id="cb489-5"><a href="MBgridspacing.html#cb489-5" aria-hidden="true" tabindex="-1"></a>thetas_ML <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span> <span class="sc">/</span> sill_ML, vgm_ML<span class="sc">$</span>sigmasq <span class="sc">/</span> sill_ML, vgm_ML<span class="sc">$</span>phi)</span>
<span id="cb489-6"><a href="MBgridspacing.html#cb489-6" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="st">&quot;Sph&quot;</span></span>
<span id="cb489-7"><a href="MBgridspacing.html#cb489-7" aria-hidden="true" tabindex="-1"></a>setup <span class="ot">&lt;-</span> <span class="fu">createBayesianSetup</span>(<span class="at">likelihood =</span> ll, <span class="at">prior =</span> priors,</span>
<span id="cb489-8"><a href="MBgridspacing.html#cb489-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">best =</span> thetas_ML, <span class="at">names =</span> <span class="fu">c</span>(<span class="st">&quot;lambda&quot;</span>, <span class="st">&quot;xi&quot;</span>, <span class="st">&quot;range&quot;</span>))</span></code></pre></div>
<p>A sample from the posterior distribution of the semivariogram parameters is then obtained with function <code>runMCMC</code>. Various sampling algorithms are implemented in package <strong>BayesianTools</strong>. I used the default sampler <code>DEzs</code>, which is based on the differential evolution Markov chain <span class="citation">(<a href="#ref-terBraak2008" role="doc-biblioref">ter Braak and Vrugt 2008</a>)</span>. This algorithm is passed to function <code>runMCMC</code> with argument <code>sampler</code>. It is common not to use all sampled units, but to discard the units of the burn-in period that are possibly influenced by the initial arbitrary settings, and to thin the series of units after this period. The extraction of the ultimate sample is done with function <code>getSample</code>. Argument <code>start</code> specifies the unit where the extraction starts, and argument <code>numSamples</code> specifies how many units are selected through systematic sampling of the full MCMC sample. The alternative is to use argument <code>thin</code> which defines the thinning interval.</p>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb490-1"><a href="MBgridspacing.html#cb490-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">314</span>)</span>
<span id="cb490-2"><a href="MBgridspacing.html#cb490-2" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">runMCMC</span>(setup, <span class="at">sampler =</span> <span class="st">&quot;DEzs&quot;</span>)</span>
<span id="cb490-3"><a href="MBgridspacing.html#cb490-3" aria-hidden="true" tabindex="-1"></a>mcmcsample <span class="ot">&lt;-</span> <span class="fu">getSample</span>(res, <span class="at">start =</span> <span class="dv">1000</span>, <span class="at">numSamples =</span> <span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb490-4"><a href="MBgridspacing.html#cb490-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>()</span></code></pre></div>
<p>Table <a href="MBgridspacing.html#tab:MCMCSampleVariogram">22.3</a> shows the first ten units of the MCMC sample from the posterior distribution of the semivariogram parameters.</p>
<table class=" lightable-classic" style="font-family: &quot;Arial Narrow&quot;, &quot;Source Sans Pro&quot;, sans-serif; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:MCMCSampleVariogram">Table 22.3: </span>First ten units of a MCMC sample from the posterior distribution of the parameters of a spherical semivariogram for the SOM concentration in West-Amhara.
</caption>
<thead>
<tr>
<th style="text-align:right;">
Inverse of sill
</th>
<th style="text-align:right;">
Ratio of spatial dependence
</th>
<th style="text-align:right;">
Range (km)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0.624
</td>
<td style="text-align:right;">
0.655
</td>
<td style="text-align:right;">
55.0
</td>
</tr>
<tr>
<td style="text-align:right;">
0.828
</td>
<td style="text-align:right;">
0.588
</td>
<td style="text-align:right;">
33.3
</td>
</tr>
<tr>
<td style="text-align:right;">
0.769
</td>
<td style="text-align:right;">
0.480
</td>
<td style="text-align:right;">
51.9
</td>
</tr>
<tr>
<td style="text-align:right;">
0.624
</td>
<td style="text-align:right;">
0.655
</td>
<td style="text-align:right;">
55.0
</td>
</tr>
<tr>
<td style="text-align:right;">
0.872
</td>
<td style="text-align:right;">
0.538
</td>
<td style="text-align:right;">
47.2
</td>
</tr>
<tr>
<td style="text-align:right;">
0.559
</td>
<td style="text-align:right;">
0.643
</td>
<td style="text-align:right;">
60.6
</td>
</tr>
<tr>
<td style="text-align:right;">
0.605
</td>
<td style="text-align:right;">
0.690
</td>
<td style="text-align:right;">
66.8
</td>
</tr>
<tr>
<td style="text-align:right;">
0.764
</td>
<td style="text-align:right;">
0.585
</td>
<td style="text-align:right;">
42.7
</td>
</tr>
<tr>
<td style="text-align:right;">
0.793
</td>
<td style="text-align:right;">
0.608
</td>
<td style="text-align:right;">
44.8
</td>
</tr>
<tr>
<td style="text-align:right;">
0.480
</td>
<td style="text-align:right;">
0.741
</td>
<td style="text-align:right;">
87.1
</td>
</tr>
</tbody>
</table>
<p>The units of the MCMC sample (vectors with semivariogram parameters) are used one-by-one to compute the average of the kriging variances at the simple random sample of evaluation points.</p>
<p>For each unit in the MCMC sample, the tolerable grid spacing is computed for a target MKV of 0.8. Figure <a href="MBgridspacing.html#fig:HistogramTolerableSpacing">22.5</a> shows that for most sampled semivariograms (MCMC sample units) the tolerable grid spacing equals 8 km, which roughly corresponds with the tolerable grid spacing derived above for OK. For 165 sampled semivariograms, the tolerable grid spacing exceeds 12 km. However, this grid spacing leads to a sample size that is too small for estimating the semivariogram and kriging.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:HistogramTolerableSpacing"></span>
<img src="SpatialSampling_files/figure-html/HistogramTolerableSpacing-1.png" alt="Frequency distribution of tolerable grid spacings for a target MKV of 0.8." width="80%" />
<p class="caption">
Figure 22.5: Frequency distribution of tolerable grid spacings for a target MKV of 0.8.
</p>
</div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:ProportionMCMCSamples"></span>
<img src="SpatialSampling_files/figure-html/ProportionMCMCSamples-1.png" alt="Proportion of sampled semivariograms with a MKV smaller than or equal to a target MKV of 0.8." width="80%" />
<p class="caption">
Figure 22.6: Proportion of sampled semivariograms with a MKV smaller than or equal to a target MKV of 0.8.
</p>
</div>
<p>Finally, for each grid spacing, the proportion of MCMC samples with a MKV smaller than or equal to the target MKV of 0.8 is computed. Figure <a href="MBgridspacing.html#fig:ProportionMCMCSamples">22.6</a> shows, for instance, that if the MKV is required not to exceed a target MKV of 0.8 with a probability of 80%, the tolerable grid spacing is 6.6 km. With a grid spacing of 8.6 km, as determined before, the probability that the MKV exceeds 0.8 is 54%.</p>

</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Gelman2013" class="csl-entry">
Gelman, A., J. B. Carlin, H. S. Stern, D. B. Dunson, A. Vehtari, and D. B. Rubin. 2013. <em><span>Bayesian Data Analysis</span></em>. Third. Boca Raton: Chapman &amp; Hall/CRC.
</div>
<div id="ref-Hartig2018" class="csl-entry">
Hartig, F., F. Minunno, and S. Paul. 2019. <em><span class="nocase">BayesianTools: General-Purpose MCMC and SMC Samplers and Tools for Bayesian Statistics</span></em>. <a href="https://CRAN.R-project.org/package=BayesianTools">https://CRAN.R-project.org/package=BayesianTools</a>.
</div>
<div id="ref-Lark2017" class="csl-entry">
Lark, R. M., E. M. Hamilton, B. Kaninga, K. K. Maseka, M. Mutondo, G. M. Sakala, and M. J. Watts. 2017. <span>“Planning Spatial Sampling of the Soil from an Uncertain Reconnaissance Variogram.”</span> <em>SOIL</em> 3 (4): 235–44.
</div>
<div id="ref-peb04" class="csl-entry">
Pebesma, E. J. 2004. <span>“Multivariable Geostatistics in <span>S</span>: The Gstat Package.”</span> <em>Computers &amp; Geosciences</em> 30 (7): 683–91.
</div>
<div id="ref-geoR" class="csl-entry">
Ribeiro Jr, Paulo J., Peter J. Diggle, Martin Schlather, Roger Bivand, and Brian Ripley. 2020. <em><span class="nocase">geoR: Analysis of Geostatistical Data</span></em>. <a href="https://CRAN.R-project.org/package=geoR">https://CRAN.R-project.org/package=geoR</a>.
</div>
<div id="ref-terBraak2008" class="csl-entry">
ter Braak, C. J. F., and J. A. Vrugt. 2008. <span>“<span class="nocase">Differential Evolution Markov Chain with snooker updater and fewer chains</span>.”</span> <em>Statistics and Computing</em> 18 (4): 435–46. <a href="https://doi.org/DOI 10.1007/s11222-008-9104-9">https://doi.org/DOI 10.1007/s11222-008-9104-9</a>.
</div>
</div>
<div class="footnotes">
<hr />
<ol start="12">
<li id="fn12"><p>Spatial response surface sampling can also be considered as model-based sampling, especially when a model-based criterion is used, see Chapter <a href="SpatialResponseSurface.html#SpatialResponseSurface">20</a>.<a href="MBgridspacing.html#fnref12" class="footnote-back">↩︎</a></p></li>
<li id="fn13"><p>This is mainly done to avoid problems in (restricted) maximum likelihood estimation of the (residual) semivariogram with function <code>likfit</code> of package <strong>geoR</strong>.<a href="MBgridspacing.html#fnref13" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="Introkriging.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="MBSamplePattern.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/DickBrus/SpatialSamplingwithR/edit/master/28-ModelBasedGridSpacing.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["SpatialSampling.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
