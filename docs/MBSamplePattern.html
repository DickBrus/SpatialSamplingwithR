<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 23 Model-based optimisation of the sampling pattern | Spatial sampling with R</title>
  <meta name="description" content="This book is for researchers, consultants and students who would like to know how to collect spatial data, either for estimating parameters for the population or several subpopulations, or for mapping. How many data do we need, and how to select the population units? The book presents a wide overview of spatial sampling designs. Besides there is a chapter on designs for sampling in space and time for monitoring. The emphasis is not on the theory, but on how to implement sampling designs in R and on how the (sub)population parameters can be estimated from the sample." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 23 Model-based optimisation of the sampling pattern | Spatial sampling with R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="/images/cover.pdf" />
  <meta property="og:description" content="This book is for researchers, consultants and students who would like to know how to collect spatial data, either for estimating parameters for the population or several subpopulations, or for mapping. How many data do we need, and how to select the population units? The book presents a wide overview of spatial sampling designs. Besides there is a chapter on designs for sampling in space and time for monitoring. The emphasis is not on the theory, but on how to implement sampling designs in R and on how the (sub)population parameters can be estimated from the sample." />
  <meta name="github-repo" content="DickBrus/SpatialSamplingwithR" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 23 Model-based optimisation of the sampling pattern | Spatial sampling with R" />
  
  <meta name="twitter:description" content="This book is for researchers, consultants and students who would like to know how to collect spatial data, either for estimating parameters for the population or several subpopulations, or for mapping. How many data do we need, and how to select the population units? The book presents a wide overview of spatial sampling designs. Besides there is a chapter on designs for sampling in space and time for monitoring. The emphasis is not on the theory, but on how to implement sampling designs in R and on how the (sub)population parameters can be estimated from the sample." />
  <meta name="twitter:image" content="/images/cover.pdf" />

<meta name="author" content="Dick J. Brus" />


<meta name="date" content="2022-01-05" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="MBgridspacing.html"/>
<link rel="next" href="SamplingVariogram.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Spatial sampling with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="GeneralIntro.html"><a href="GeneralIntro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="GeneralIntro.html"><a href="GeneralIntro.html#BasicConcepts"><i class="fa fa-check"></i><b>1.1</b> Basic sampling concepts</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="GeneralIntro.html"><a href="GeneralIntro.html#PopulationParameters"><i class="fa fa-check"></i><b>1.1.1</b> Population parameters</a></li>
<li class="chapter" data-level="1.1.2" data-path="GeneralIntro.html"><a href="GeneralIntro.html#descriptive-statistics-versus-inference-about-a-population"><i class="fa fa-check"></i><b>1.1.2</b> Descriptive statistics versus inference about a population</a></li>
<li class="chapter" data-level="1.1.3" data-path="GeneralIntro.html"><a href="GeneralIntro.html#random-sampling-versus-probability-sampling"><i class="fa fa-check"></i><b>1.1.3</b> Random sampling versus probability sampling</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="GeneralIntro.html"><a href="GeneralIntro.html#DBvsMB"><i class="fa fa-check"></i><b>1.2</b> Design-based versus model-based approach</a></li>
<li class="chapter" data-level="1.3" data-path="GeneralIntro.html"><a href="GeneralIntro.html#Datasets"><i class="fa fa-check"></i><b>1.3</b> Populations used in sampling experiments</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="GeneralIntro.html"><a href="GeneralIntro.html#Voorst"><i class="fa fa-check"></i><b>1.3.1</b> Soil organic matter in Voorst (Netherlands)</a></li>
<li class="chapter" data-level="1.3.2" data-path="GeneralIntro.html"><a href="GeneralIntro.html#Poppy"><i class="fa fa-check"></i><b>1.3.2</b> Poppy fields in Kandahar (Afghanistan)</a></li>
<li class="chapter" data-level="1.3.3" data-path="GeneralIntro.html"><a href="GeneralIntro.html#Amazonia"><i class="fa fa-check"></i><b>1.3.3</b> Aboveground biomass in Eastern Amazonia (Brazil)</a></li>
<li class="chapter" data-level="1.3.4" data-path="GeneralIntro.html"><a href="GeneralIntro.html#TASIberia"><i class="fa fa-check"></i><b>1.3.4</b> Annual mean air temperature in Iberia</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>I Probability sampling for estimating (sub)population parameters</b></span></li>
<li class="chapter" data-level="2" data-path="IntroProbabilitySampling.html"><a href="IntroProbabilitySampling.html"><i class="fa fa-check"></i><b>2</b> Introduction to probability sampling</a>
<ul>
<li class="chapter" data-level="2.1" data-path="IntroProbabilitySampling.html"><a href="IntroProbabilitySampling.html#HTestimator"><i class="fa fa-check"></i><b>2.1</b> Horvitz-Thompson estimator</a></li>
<li class="chapter" data-level="2.2" data-path="IntroProbabilitySampling.html"><a href="IntroProbabilitySampling.html#hansen-hurwitz-estimator"><i class="fa fa-check"></i><b>2.2</b> Hansen-Hurwitz estimator</a></li>
<li class="chapter" data-level="2.3" data-path="IntroProbabilitySampling.html"><a href="IntroProbabilitySampling.html#using-models-in-design-based-approach"><i class="fa fa-check"></i><b>2.3</b> Using models in design-based approach</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="SI.html"><a href="SI.html"><i class="fa fa-check"></i><b>3</b> Simple random sampling</a>
<ul>
<li class="chapter" data-level="3.1" data-path="SI.html"><a href="SI.html#HTestimatorSI"><i class="fa fa-check"></i><b>3.1</b> Estimation of population parameters</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="SI.html"><a href="SI.html#PopProportion"><i class="fa fa-check"></i><b>3.1.1</b> Population proportion</a></li>
<li class="chapter" data-level="3.1.2" data-path="SI.html"><a href="SI.html#CDF"><i class="fa fa-check"></i><b>3.1.2</b> Cumulative distribution function and quantiles</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="SI.html"><a href="SI.html#VarMeanSI"><i class="fa fa-check"></i><b>3.2</b> Sampling variance of estimator of population parameters</a></li>
<li class="chapter" data-level="3.3" data-path="SI.html"><a href="SI.html#ConfidenceInterval"><i class="fa fa-check"></i><b>3.3</b> Confidence interval estimate</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="SI.html"><a href="SI.html#ConfidenceIntervalProportion"><i class="fa fa-check"></i><b>3.3.1</b> Confidence interval for proportion</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="SI.html"><a href="SI.html#SIcircularplots"><i class="fa fa-check"></i><b>3.4</b> Simple random sampling of circular plots</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="SI.html"><a href="SI.html#sampling-from-a-finite-set-of-fixed-circles"><i class="fa fa-check"></i><b>3.4.1</b> Sampling from a finite set of fixed circles</a></li>
<li class="chapter" data-level="3.4.2" data-path="SI.html"><a href="SI.html#sampling-from-an-infinite-set-of-floating-circles"><i class="fa fa-check"></i><b>3.4.2</b> Sampling from an infinite set of floating circles</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="STSI.html"><a href="STSI.html"><i class="fa fa-check"></i><b>4</b> Stratified simple random sampling</a>
<ul>
<li class="chapter" data-level="4.1" data-path="STSI.html"><a href="STSI.html#EstimatorsSTSI"><i class="fa fa-check"></i><b>4.1</b> Estimation of population parameters</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="STSI.html"><a href="STSI.html#population-proportion-cumulative-distribution-function-and-quantiles"><i class="fa fa-check"></i><b>4.1.1</b> Population proportion, cumulative distribution function, and quantiles</a></li>
<li class="chapter" data-level="4.1.2" data-path="STSI.html"><a href="STSI.html#WhyStratify"><i class="fa fa-check"></i><b>4.1.2</b> Why should we stratify?</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="STSI.html"><a href="STSI.html#CISTSI"><i class="fa fa-check"></i><b>4.2</b> Confidence interval estimate</a></li>
<li class="chapter" data-level="4.3" data-path="STSI.html"><a href="STSI.html#STSIallocation"><i class="fa fa-check"></i><b>4.3</b> Allocation of sample size to strata</a></li>
<li class="chapter" data-level="4.4" data-path="STSI.html"><a href="STSI.html#cumrootf"><i class="fa fa-check"></i><b>4.4</b> <em>Cum-root-f</em> stratification</a></li>
<li class="chapter" data-level="4.5" data-path="STSI.html"><a href="STSI.html#kmeansstratification"><i class="fa fa-check"></i><b>4.5</b> Stratification with multiple covariates</a></li>
<li class="chapter" data-level="4.6" data-path="STSI.html"><a href="STSI.html#geostrata"><i class="fa fa-check"></i><b>4.6</b> Geographical stratification</a></li>
<li class="chapter" data-level="4.7" data-path="STSI.html"><a href="STSI.html#multi-way-stratification"><i class="fa fa-check"></i><b>4.7</b> Multi-way stratification</a></li>
<li class="chapter" data-level="4.8" data-path="STSI.html"><a href="STSI.html#MultivariateStratification"><i class="fa fa-check"></i><b>4.8</b> Multivariate stratification</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="SY.html"><a href="SY.html"><i class="fa fa-check"></i><b>5</b> Systematic random sampling</a>
<ul>
<li class="chapter" data-level="5.1" data-path="SY.html"><a href="SY.html#EstVarSY"><i class="fa fa-check"></i><b>5.1</b> Estimation of population parameters</a></li>
<li class="chapter" data-level="5.2" data-path="SY.html"><a href="SY.html#approximating-the-sampling-variance-of-the-estimator-of-the-mean"><i class="fa fa-check"></i><b>5.2</b> Approximating the sampling variance of the estimator of the mean</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="Cl.html"><a href="Cl.html"><i class="fa fa-check"></i><b>6</b> Cluster random sampling</a>
<ul>
<li class="chapter" data-level="6.1" data-path="Cl.html"><a href="Cl.html#clustersamplingestimators"><i class="fa fa-check"></i><b>6.1</b> Estimation of population parameters</a></li>
<li class="chapter" data-level="6.2" data-path="Cl.html"><a href="Cl.html#clusters-selected-with-probabilities-proportional-to-size-without-replacement"><i class="fa fa-check"></i><b>6.2</b> Clusters selected with probabilities proportional to size, without replacement</a></li>
<li class="chapter" data-level="6.3" data-path="Cl.html"><a href="Cl.html#SIC"><i class="fa fa-check"></i><b>6.3</b> Simple random sampling of clusters</a></li>
<li class="chapter" data-level="6.4" data-path="Cl.html"><a href="Cl.html#StratifiedCl"><i class="fa fa-check"></i><b>6.4</b> Stratified cluster random sampling</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="Twostage.html"><a href="Twostage.html"><i class="fa fa-check"></i><b>7</b> Two-stage cluster random sampling</a>
<ul>
<li class="chapter" data-level="7.1" data-path="Twostage.html"><a href="Twostage.html#twostagesamplingestimators"><i class="fa fa-check"></i><b>7.1</b> Estimation of population parameters</a></li>
<li class="chapter" data-level="7.2" data-path="Twostage.html"><a href="Twostage.html#primary-sampling-units-selected-without-replacement"><i class="fa fa-check"></i><b>7.2</b> Primary sampling units selected without replacement</a></li>
<li class="chapter" data-level="7.3" data-path="Twostage.html"><a href="Twostage.html#TwostageSISI"><i class="fa fa-check"></i><b>7.3</b> Simple random sampling of primary sampling units</a></li>
<li class="chapter" data-level="7.4" data-path="Twostage.html"><a href="Twostage.html#StratifiedTwostage"><i class="fa fa-check"></i><b>7.4</b> Stratified two-stage cluster random sampling</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="pps.html"><a href="pps.html"><i class="fa fa-check"></i><b>8</b> Sampling with probabilities proportional to size</a>
<ul>
<li class="chapter" data-level="8.1" data-path="pps.html"><a href="pps.html#ppswr"><i class="fa fa-check"></i><b>8.1</b> Probability-proportional-to-size sampling with replacement</a></li>
<li class="chapter" data-level="8.2" data-path="pps.html"><a href="pps.html#ppswor"><i class="fa fa-check"></i><b>8.2</b> Probability-proportional-to-size sampling without replacement</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="pps.html"><a href="pps.html#Systematicpps"><i class="fa fa-check"></i><b>8.2.1</b> Systematic pps sampling without replacement</a></li>
<li class="chapter" data-level="8.2.2" data-path="pps.html"><a href="pps.html#pivotalmethod"><i class="fa fa-check"></i><b>8.2.2</b> The pivotal method</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html"><i class="fa fa-check"></i><b>9</b> Balanced and well-spread sampling</a>
<ul>
<li class="chapter" data-level="9.1" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#Balanced"><i class="fa fa-check"></i><b>9.1</b> Balanced sampling</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#balanced-sample-versus-balanced-sampling-design"><i class="fa fa-check"></i><b>9.1.1</b> Balanced sample versus balanced sampling design</a></li>
<li class="chapter" data-level="9.1.2" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#unequal-inclusion-probabilities"><i class="fa fa-check"></i><b>9.1.2</b> Unequal inclusion probabilities</a></li>
<li class="chapter" data-level="9.1.3" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#StratifiedsamplingasBalancedsampling"><i class="fa fa-check"></i><b>9.1.3</b> Stratified random sampling</a></li>
<li class="chapter" data-level="9.1.4" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#Multiwaystratification"><i class="fa fa-check"></i><b>9.1.4</b> Multi-way stratification</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#Spreaded"><i class="fa fa-check"></i><b>9.2</b> Well-spread sampling</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#LPM"><i class="fa fa-check"></i><b>9.2.1</b> Local pivotal method</a></li>
<li class="chapter" data-level="9.2.2" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#GRTS"><i class="fa fa-check"></i><b>9.2.2</b> Generalised random-tessellation stratified sampling</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#BalancedandSpreaded"><i class="fa fa-check"></i><b>9.3</b> Balanced sampling with spreading</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="Modelassisted.html"><a href="Modelassisted.html"><i class="fa fa-check"></i><b>10</b> Model-assisted estimation</a>
<ul>
<li class="chapter" data-level="10.1" data-path="Modelassisted.html"><a href="Modelassisted.html#GREG"><i class="fa fa-check"></i><b>10.1</b> Generalised regression estimator</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="Modelassisted.html"><a href="Modelassisted.html#RegressionEstimator"><i class="fa fa-check"></i><b>10.1.1</b> Simple and multiple regression estimators</a></li>
<li class="chapter" data-level="10.1.2" data-path="Modelassisted.html"><a href="Modelassisted.html#penalised-least-squares-estimation"><i class="fa fa-check"></i><b>10.1.2</b> Penalised least squares estimation</a></li>
<li class="chapter" data-level="10.1.3" data-path="Modelassisted.html"><a href="Modelassisted.html#RegressionEstimatorSTSI"><i class="fa fa-check"></i><b>10.1.3</b> Regression estimator with stratified simple random sampling</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="Modelassisted.html"><a href="Modelassisted.html#RatioEstimator"><i class="fa fa-check"></i><b>10.2</b> Ratio estimator</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="Modelassisted.html"><a href="Modelassisted.html#RatioEstimatorSTSI"><i class="fa fa-check"></i><b>10.2.1</b> Ratio estimators with stratified simple random sampling</a></li>
<li class="chapter" data-level="10.2.2" data-path="Modelassisted.html"><a href="Modelassisted.html#PoststratifiedEstimator"><i class="fa fa-check"></i><b>10.2.2</b> Poststratified estimator</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="Modelassisted.html"><a href="Modelassisted.html#RandomForest"><i class="fa fa-check"></i><b>10.3</b> Model-assisted estimation using machine learning techniques</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="Modelassisted.html"><a href="Modelassisted.html#predicting-with-a-regression-tree"><i class="fa fa-check"></i><b>10.3.1</b> Predicting with a regression tree</a></li>
<li class="chapter" data-level="10.3.2" data-path="Modelassisted.html"><a href="Modelassisted.html#predicting-with-a-random-forest"><i class="fa fa-check"></i><b>10.3.2</b> Predicting with a random forest</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="Modelassisted.html"><a href="Modelassisted.html#big-data-and-volunteer-data"><i class="fa fa-check"></i><b>10.4</b> Big data and volunteer data</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="Twophase.html"><a href="Twophase.html"><i class="fa fa-check"></i><b>11</b> Two-phase random sampling</a>
<ul>
<li class="chapter" data-level="11.1" data-path="Twophase.html"><a href="Twophase.html#TwophaseStratification"><i class="fa fa-check"></i><b>11.1</b> Two-phase random sampling for stratification</a></li>
<li class="chapter" data-level="11.2" data-path="Twophase.html"><a href="Twophase.html#TwophaseRegression"><i class="fa fa-check"></i><b>11.2</b> Two-phase random sampling for regression</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html"><i class="fa fa-check"></i><b>12</b> Computing the required sample size</a>
<ul>
<li class="chapter" data-level="12.1" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#standard-error"><i class="fa fa-check"></i><b>12.1</b> Standard error</a></li>
<li class="chapter" data-level="12.2" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#ReqSampleSizeLengthCI"><i class="fa fa-check"></i><b>12.2</b> Length of confidence interval</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#length-of-confidence-interval-for-a-proportion"><i class="fa fa-check"></i><b>12.2.1</b> Length of confidence interval for a proportion</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#statistical-testing-of-hypothesis"><i class="fa fa-check"></i><b>12.3</b> Statistical testing of hypothesis</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#sample-size-for-testing-a-proportion"><i class="fa fa-check"></i><b>12.3.1</b> Sample size for testing a proportion</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#DesignEffect"><i class="fa fa-check"></i><b>12.4</b> Accounting for design effect</a></li>
<li class="chapter" data-level="12.5" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#BayesianSampleSize"><i class="fa fa-check"></i><b>12.5</b> Bayesian sample size determination</a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#bayesian-criteria-for-sample-size-computation"><i class="fa fa-check"></i><b>12.5.1</b> Bayesian criteria for sample size computation</a></li>
<li class="chapter" data-level="12.5.2" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#mixed-bayesian-likelihood-approach"><i class="fa fa-check"></i><b>12.5.2</b> Mixed Bayesian-likelihood approach</a></li>
<li class="chapter" data-level="12.5.3" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#estimation-of-population-mean"><i class="fa fa-check"></i><b>12.5.3</b> Estimation of population mean</a></li>
<li class="chapter" data-level="12.5.4" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#estimation-of-a-population-proportion"><i class="fa fa-check"></i><b>12.5.4</b> Estimation of a population proportion</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="MBpredictionofDesignVariance.html"><a href="MBpredictionofDesignVariance.html"><i class="fa fa-check"></i><b>13</b> Model-based optimisation of probability sampling designs</a>
<ul>
<li class="chapter" data-level="13.1" data-path="MBpredictionofDesignVariance.html"><a href="MBpredictionofDesignVariance.html#model-based-optimisation-of-sampling-design-type-and-sample-size"><i class="fa fa-check"></i><b>13.1</b> Model-based optimisation of sampling design type and sample size</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="MBpredictionofDesignVariance.html"><a href="MBpredictionofDesignVariance.html#AnalyticalApproach"><i class="fa fa-check"></i><b>13.1.1</b> Analytical approach</a></li>
<li class="chapter" data-level="13.1.2" data-path="MBpredictionofDesignVariance.html"><a href="MBpredictionofDesignVariance.html#GeostatisticalSimulationApproach"><i class="fa fa-check"></i><b>13.1.2</b> Geostatistical simulation approach</a></li>
<li class="chapter" data-level="13.1.3" data-path="MBpredictionofDesignVariance.html"><a href="MBpredictionofDesignVariance.html#MBpredSamplingVarBayes"><i class="fa fa-check"></i><b>13.1.3</b> Bayesian approach</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="MBpredictionofDesignVariance.html"><a href="MBpredictionofDesignVariance.html#Ospats"><i class="fa fa-check"></i><b>13.2</b> Model-based optimisation of spatial strata</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html"><i class="fa fa-check"></i><b>14</b> Sampling for estimating parameters of (small) domains</a>
<ul>
<li class="chapter" data-level="14.1" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#LargeDomainsDirectEstimator"><i class="fa fa-check"></i><b>14.1</b> Direct estimator for large domains</a></li>
<li class="chapter" data-level="14.2" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#SmallDomainsModelAssisted"><i class="fa fa-check"></i><b>14.2</b> Model-assisted estimators for small domains</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#RegressionestimatorSmallDomain"><i class="fa fa-check"></i><b>14.2.1</b> Regression estimator</a></li>
<li class="chapter" data-level="14.2.2" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#SyntheticestimatorSmallDomain"><i class="fa fa-check"></i><b>14.2.2</b> Synthetic estimator</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#SmallAreaModelBased"><i class="fa fa-check"></i><b>14.3</b> Model-based prediction</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#random-intercept-model"><i class="fa fa-check"></i><b>14.3.1</b> Random intercept model</a></li>
<li class="chapter" data-level="14.3.2" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#geostatistical-model"><i class="fa fa-check"></i><b>14.3.2</b> Geostatistical model</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#supplemental-probability-sampling-of-small-domains"><i class="fa fa-check"></i><b>14.4</b> Supplemental probability sampling of small domains</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html"><i class="fa fa-check"></i><b>15</b> Repeated sample surveys for monitoring population parameters</a>
<ul>
<li class="chapter" data-level="15.1" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#space-time-designs"><i class="fa fa-check"></i><b>15.1</b> Space-time designs</a></li>
<li class="chapter" data-level="15.2" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#SpaceTimeparameters"><i class="fa fa-check"></i><b>15.2</b> Space-time population parameters</a></li>
<li class="chapter" data-level="15.3" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#design-based-generalised-least-squares-estimation-of-spatial-means"><i class="fa fa-check"></i><b>15.3</b> Design-based generalised least squares estimation of spatial means</a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#current-mean"><i class="fa fa-check"></i><b>15.3.1</b> Current mean</a></li>
<li class="chapter" data-level="15.3.2" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#change-of-the-spatial-mean"><i class="fa fa-check"></i><b>15.3.2</b> Change of the spatial mean</a></li>
<li class="chapter" data-level="15.3.3" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#temporal-trend-of-the-spatial-mean"><i class="fa fa-check"></i><b>15.3.3</b> Temporal trend of the spatial mean</a></li>
<li class="chapter" data-level="15.3.4" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#space-time-mean"><i class="fa fa-check"></i><b>15.3.4</b> Space-time mean</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#case-study-annual-mean-daily-temperature-in-iberia"><i class="fa fa-check"></i><b>15.4</b> Case study: annual mean daily temperature in Iberia</a>
<ul>
<li class="chapter" data-level="15.4.1" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#static-synchronous-design"><i class="fa fa-check"></i><b>15.4.1</b> Static-synchronous design</a></li>
<li class="chapter" data-level="15.4.2" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#independent-synchronous-design"><i class="fa fa-check"></i><b>15.4.2</b> Independent synchronous design</a></li>
<li class="chapter" data-level="15.4.3" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#serially-alternating-design"><i class="fa fa-check"></i><b>15.4.3</b> Serially alternating design</a></li>
<li class="chapter" data-level="15.4.4" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#supplemented-panel-design"><i class="fa fa-check"></i><b>15.4.4</b> Supplemented panel design</a></li>
<li class="chapter" data-level="15.4.5" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#rotating-panel-design"><i class="fa fa-check"></i><b>15.4.5</b> Rotating panel design</a></li>
<li class="chapter" data-level="15.4.6" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#sampling-experiment"><i class="fa fa-check"></i><b>15.4.6</b> Sampling experiment</a></li>
</ul></li>
<li class="chapter" data-level="15.5" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#space-time-sampling-with-stratified-random-sampling-in-space"><i class="fa fa-check"></i><b>15.5</b> Space-time sampling with stratified random sampling in space</a></li>
</ul></li>
<li class="part"><span><b>II Sampling for mapping</b></span></li>
<li class="chapter" data-level="16" data-path="IntroSamplingforMapping.html"><a href="IntroSamplingforMapping.html"><i class="fa fa-check"></i><b>16</b> Introduction to sampling for mapping</a>
<ul>
<li class="chapter" data-level="16.1" data-path="IntroSamplingforMapping.html"><a href="IntroSamplingforMapping.html#when-is-probability-sampling-not-required"><i class="fa fa-check"></i><b>16.1</b> When is probability sampling not required?</a></li>
<li class="chapter" data-level="16.2" data-path="IntroSamplingforMapping.html"><a href="IntroSamplingforMapping.html#sampling-for-simultaneously-mapping-and-estimating-means"><i class="fa fa-check"></i><b>16.2</b> Sampling for simultaneously mapping and estimating means</a></li>
<li class="chapter" data-level="16.3" data-path="IntroSamplingforMapping.html"><a href="IntroSamplingforMapping.html#broad-overview-of-sampling-designs-for-mapping"><i class="fa fa-check"></i><b>16.3</b> Broad overview of sampling designs for mapping</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="RegularGridSpatialCoverage.html"><a href="RegularGridSpatialCoverage.html"><i class="fa fa-check"></i><b>17</b> Regular grid and spatial coverage sampling</a>
<ul>
<li class="chapter" data-level="17.1" data-path="RegularGridSpatialCoverage.html"><a href="RegularGridSpatialCoverage.html#Regulargrid"><i class="fa fa-check"></i><b>17.1</b> Regular grid sampling</a></li>
<li class="chapter" data-level="17.2" data-path="RegularGridSpatialCoverage.html"><a href="RegularGridSpatialCoverage.html#SpatialCoverage"><i class="fa fa-check"></i><b>17.2</b> Spatial coverage sampling</a></li>
<li class="chapter" data-level="17.3" data-path="RegularGridSpatialCoverage.html"><a href="RegularGridSpatialCoverage.html#SpatialInfill"><i class="fa fa-check"></i><b>17.3</b> Spatial infill sampling</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="kmeans.html"><a href="kmeans.html"><i class="fa fa-check"></i><b>18</b> Covariate space coverage sampling</a>
<ul>
<li class="chapter" data-level="18.1" data-path="kmeans.html"><a href="kmeans.html#covariate-space-infill-sampling"><i class="fa fa-check"></i><b>18.1</b> Covariate space infill sampling</a></li>
<li class="chapter" data-level="18.2" data-path="kmeans.html"><a href="kmeans.html#PerformanceCSC"><i class="fa fa-check"></i><b>18.2</b> Performance of covariate space coverage sampling in random forest prediction</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="cLHS.html"><a href="cLHS.html"><i class="fa fa-check"></i><b>19</b> Conditioned Latin hypercube sampling</a>
<ul>
<li class="chapter" data-level="19.1" data-path="cLHS.html"><a href="cLHS.html#cLHIS"><i class="fa fa-check"></i><b>19.1</b> Conditioned Latin hypercube infill sampling</a></li>
<li class="chapter" data-level="19.2" data-path="cLHS.html"><a href="cLHS.html#performance-of-conditioned-latin-hypercube-sampling-in-random-forest-prediction"><i class="fa fa-check"></i><b>19.2</b> Performance of conditioned Latin hypercube sampling in random forest prediction</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="SpatialResponseSurface.html"><a href="SpatialResponseSurface.html"><i class="fa fa-check"></i><b>20</b> Spatial response surface sampling</a>
<ul>
<li class="chapter" data-level="20.1" data-path="SpatialResponseSurface.html"><a href="SpatialResponseSurface.html#IncreaseSampleSize"><i class="fa fa-check"></i><b>20.1</b> Increasing the sample size</a></li>
<li class="chapter" data-level="20.2" data-path="SpatialResponseSurface.html"><a href="SpatialResponseSurface.html#stratified-spatial-response-surface-sampling"><i class="fa fa-check"></i><b>20.2</b> Stratified spatial response surface sampling</a></li>
<li class="chapter" data-level="20.3" data-path="SpatialResponseSurface.html"><a href="SpatialResponseSurface.html#mapping"><i class="fa fa-check"></i><b>20.3</b> Mapping</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="Introkriging.html"><a href="Introkriging.html"><i class="fa fa-check"></i><b>21</b> Introduction to kriging</a>
<ul>
<li class="chapter" data-level="21.1" data-path="Introkriging.html"><a href="Introkriging.html#OrdinaryKriging"><i class="fa fa-check"></i><b>21.1</b> Ordinary kriging</a></li>
<li class="chapter" data-level="21.2" data-path="Introkriging.html"><a href="Introkriging.html#BlockKriging"><i class="fa fa-check"></i><b>21.2</b> Block-kriging</a></li>
<li class="chapter" data-level="21.3" data-path="Introkriging.html"><a href="Introkriging.html#IntroKED"><i class="fa fa-check"></i><b>21.3</b> Kriging with an external drift</a></li>
<li class="chapter" data-level="21.4" data-path="Introkriging.html"><a href="Introkriging.html#VariogramEstimation"><i class="fa fa-check"></i><b>21.4</b> Estimating the semivariogram</a>
<ul>
<li class="chapter" data-level="21.4.1" data-path="Introkriging.html"><a href="Introkriging.html#MoM"><i class="fa fa-check"></i><b>21.4.1</b> Method-of-moments</a></li>
<li class="chapter" data-level="21.4.2" data-path="Introkriging.html"><a href="Introkriging.html#MLestimationVariogram"><i class="fa fa-check"></i><b>21.4.2</b> Maximum likelihood</a></li>
</ul></li>
<li class="chapter" data-level="21.5" data-path="Introkriging.html"><a href="Introkriging.html#ResidualVariogram"><i class="fa fa-check"></i><b>21.5</b> Estimating the residual semivariogram</a>
<ul>
<li class="chapter" data-level="21.5.1" data-path="Introkriging.html"><a href="Introkriging.html#IterativeMoM"><i class="fa fa-check"></i><b>21.5.1</b> Iterative method-of-moments</a></li>
<li class="chapter" data-level="21.5.2" data-path="Introkriging.html"><a href="Introkriging.html#REML"><i class="fa fa-check"></i><b>21.5.2</b> Restricted maximum likelihood</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="22" data-path="MBgridspacing.html"><a href="MBgridspacing.html"><i class="fa fa-check"></i><b>22</b> Model-based optimisation of the grid spacing</a>
<ul>
<li class="chapter" data-level="22.1" data-path="MBgridspacing.html"><a href="MBgridspacing.html#GridspacingOK"><i class="fa fa-check"></i><b>22.1</b> Optimal grid spacing for ordinary kriging</a></li>
<li class="chapter" data-level="22.2" data-path="MBgridspacing.html"><a href="MBgridspacing.html#controlling-the-mean-or-a-quantile-of-the-ordinary-kriging-variance"><i class="fa fa-check"></i><b>22.2</b> Controlling the mean or a quantile of the ordinary kriging variance</a></li>
<li class="chapter" data-level="22.3" data-path="MBgridspacing.html"><a href="MBgridspacing.html#optimal-grid-spacing-for-block-kriging"><i class="fa fa-check"></i><b>22.3</b> Optimal grid spacing for block-kriging</a></li>
<li class="chapter" data-level="22.4" data-path="MBgridspacing.html"><a href="MBgridspacing.html#MBgridspacingKED"><i class="fa fa-check"></i><b>22.4</b> Optimal grid spacing for kriging with an external drift</a></li>
<li class="chapter" data-level="22.5" data-path="MBgridspacing.html"><a href="MBgridspacing.html#BayesianGridSpacing"><i class="fa fa-check"></i><b>22.5</b> Bayesian approach</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="MBSamplePattern.html"><a href="MBSamplePattern.html"><i class="fa fa-check"></i><b>23</b> Model-based optimisation of the sampling pattern</a>
<ul>
<li class="chapter" data-level="23.1" data-path="MBSamplePattern.html"><a href="MBSamplePattern.html#SSA"><i class="fa fa-check"></i><b>23.1</b> Spatial simulated annealing</a></li>
<li class="chapter" data-level="23.2" data-path="MBSamplePattern.html"><a href="MBSamplePattern.html#SamplePatternOK"><i class="fa fa-check"></i><b>23.2</b> Optimising the sampling pattern for ordinary kriging</a></li>
<li class="chapter" data-level="23.3" data-path="MBSamplePattern.html"><a href="MBSamplePattern.html#SamplePatternKED"><i class="fa fa-check"></i><b>23.3</b> Optimising the sampling pattern for kriging with an external drift</a></li>
<li class="chapter" data-level="23.4" data-path="MBSamplePattern.html"><a href="MBSamplePattern.html#model-based-infill-sampling-for-ordinary-kriging"><i class="fa fa-check"></i><b>23.4</b> Model-based infill sampling for ordinary kriging</a></li>
<li class="chapter" data-level="23.5" data-path="MBSamplePattern.html"><a href="MBSamplePattern.html#model-based-infill-sampling-for-kriging-with-an-external-drift"><i class="fa fa-check"></i><b>23.5</b> Model-based infill sampling for kriging with an external drift</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html"><i class="fa fa-check"></i><b>24</b> Sampling for estimating the semivariogram</a>
<ul>
<li class="chapter" data-level="24.1" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#NestedSampling"><i class="fa fa-check"></i><b>24.1</b> Nested sampling</a></li>
<li class="chapter" data-level="24.2" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#IndependentSamplingPairs"><i class="fa fa-check"></i><b>24.2</b> Independent sampling of pairs of points</a></li>
<li class="chapter" data-level="24.3" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#samplingforvariogram"><i class="fa fa-check"></i><b>24.3</b> Optimisation of sampling pattern for semivariogram estimation</a>
<ul>
<li class="chapter" data-level="24.3.1" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#UncertainSemivariogramParameters"><i class="fa fa-check"></i><b>24.3.1</b> Uncertainty about semivariogram parameters</a></li>
<li class="chapter" data-level="24.3.2" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#UncertainKrigingVariance"><i class="fa fa-check"></i><b>24.3.2</b> Uncertainty about the kriging variance</a></li>
</ul></li>
<li class="chapter" data-level="24.4" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#SamplingEstimationandPrediction"><i class="fa fa-check"></i><b>24.4</b> Optimisation of sampling pattern for semivariogram estimation and mapping</a></li>
<li class="chapter" data-level="24.5" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#a-practical-solution"><i class="fa fa-check"></i><b>24.5</b> A practical solution</a></li>
</ul></li>
<li class="chapter" data-level="25" data-path="Validation.html"><a href="Validation.html"><i class="fa fa-check"></i><b>25</b> Sampling for validation of maps</a>
<ul>
<li class="chapter" data-level="25.1" data-path="Validation.html"><a href="Validation.html#map-quality-indices"><i class="fa fa-check"></i><b>25.1</b> Map quality indices</a>
<ul>
<li class="chapter" data-level="25.1.1" data-path="Validation.html"><a href="Validation.html#estimation-of-map-quality-indices"><i class="fa fa-check"></i><b>25.1.1</b> Estimation of map quality indices</a></li>
</ul></li>
<li class="chapter" data-level="25.2" data-path="Validation.html"><a href="Validation.html#real-world-case-study"><i class="fa fa-check"></i><b>25.2</b> Real-world case study</a>
<ul>
<li class="chapter" data-level="25.2.1" data-path="Validation.html"><a href="Validation.html#estimation-of-the-population-mean-error-and-mean-squared-error"><i class="fa fa-check"></i><b>25.2.1</b> Estimation of the population mean error and mean squared error</a></li>
<li class="chapter" data-level="25.2.2" data-path="Validation.html"><a href="Validation.html#estimation-of-the-standard-error-of-the-estimator-of-the-population-mean-error-and-mean-squared-error"><i class="fa fa-check"></i><b>25.2.2</b> Estimation of the standard error of the estimator of the population mean error and mean squared error</a></li>
<li class="chapter" data-level="25.2.3" data-path="Validation.html"><a href="Validation.html#estimation-of-model-efficiency-coefficient"><i class="fa fa-check"></i><b>25.2.3</b> Estimation of model efficiency coefficient</a></li>
<li class="chapter" data-level="25.2.4" data-path="Validation.html"><a href="Validation.html#statistical-testing-of-hypothesis-about-population-me-and-mse"><i class="fa fa-check"></i><b>25.2.4</b> Statistical testing of hypothesis about population ME and MSE</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="26" data-path="Approaches.html"><a href="Approaches.html"><i class="fa fa-check"></i><b>26</b> Design-based, model-based, and model-assisted approach for sampling and inference</a>
<ul>
<li class="chapter" data-level="26.1" data-path="Approaches.html"><a href="Approaches.html#two-sources-of-randomness"><i class="fa fa-check"></i><b>26.1</b> Two sources of randomness</a></li>
<li class="chapter" data-level="26.2" data-path="Approaches.html"><a href="Approaches.html#iid"><i class="fa fa-check"></i><b>26.2</b> “Identically and independently distributed” (i.i.d.)</a></li>
<li class="chapter" data-level="26.3" data-path="Approaches.html"><a href="Approaches.html#BiasandVariance"><i class="fa fa-check"></i><b>26.3</b> Bias and variance</a></li>
<li class="chapter" data-level="26.4" data-path="Approaches.html"><a href="Approaches.html#effectivesamplesize"><i class="fa fa-check"></i><b>26.4</b> Effective sample size</a></li>
<li class="chapter" data-level="26.5" data-path="Approaches.html"><a href="Approaches.html#ExploitSpatialStructure"><i class="fa fa-check"></i><b>26.5</b> Exploiting spatial structure in design-based approach</a></li>
<li class="chapter" data-level="26.6" data-path="Approaches.html"><a href="Approaches.html#ModelassistedvsModeldependent"><i class="fa fa-check"></i><b>26.6</b> Model-assisted versus model-dependent</a></li>
</ul></li>
<li class="appendix"><span><b>Appendices</b></span></li>
<li class="chapter" data-level="A" data-path="Answers.html"><a href="Answers.html"><i class="fa fa-check"></i><b>A</b> Answers to exercises</a>
<ul>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#introduction-to-probability-sampling"><i class="fa fa-check"></i>Introduction to probability sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#simple-random-sampling-1"><i class="fa fa-check"></i>Simple random sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#stratified-simple-random-sampling-1"><i class="fa fa-check"></i>Stratified simple random sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#systematic-random-sampling-2"><i class="fa fa-check"></i>Systematic random sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#cluster-random-sampling"><i class="fa fa-check"></i>Cluster random sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#two-stage-cluster-random-sampling-1"><i class="fa fa-check"></i>Two-stage cluster random sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#sampling-with-probabilities-proportional-to-size"><i class="fa fa-check"></i>Sampling with probabilities proportional to size</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#balanced-and-well-spread-sampling"><i class="fa fa-check"></i>Balanced and well-spread sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#model-assisted-estimation"><i class="fa fa-check"></i>Model-assisted estimation</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#two-phase-random-sampling"><i class="fa fa-check"></i>Two-phase random sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#computing-the-required-sample-size"><i class="fa fa-check"></i>Computing the required sample size</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#model-based-optimisation-of-probability-sampling-designs"><i class="fa fa-check"></i>Model-based optimisation of probability sampling designs</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#repeated-sample-surveys-for-monitoring-population-parameters"><i class="fa fa-check"></i>Repeated sample surveys for monitoring population parameters</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#regular-grid-and-spatial-coverage-sampling"><i class="fa fa-check"></i>Regular grid and spatial coverage sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#covariate-space-coverage-sampling"><i class="fa fa-check"></i>Covariate space coverage sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#conditioned-latin-hypercube-sampling"><i class="fa fa-check"></i>Conditioned Latin hypercube sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#model-based-optimisation-of-the-grid-spacing"><i class="fa fa-check"></i>Model-based optimisation of the grid spacing</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#model-based-optimisation-of-the-sampling-pattern"><i class="fa fa-check"></i>Model-based optimisation of the sampling pattern</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#sampling-for-estimating-the-semivariogram"><i class="fa fa-check"></i>Sampling for estimating the semivariogram</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#sampling-for-validation-of-maps"><i class="fa fa-check"></i>Sampling for validation of maps</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/DickBrus/">Dick Brus</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Spatial sampling with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="MBSamplePattern" class="section level1" number="23">
<h1><span class="header-section-number">Chapter 23</span> Model-based optimisation of the sampling pattern</h1>
<p>In Chapter <a href="MBgridspacing.html#MBgridspacing">22</a> a model of the spatial variation is used to optimise the spacing of a regular grid. The grid spacing determines the number of grid points within the study area, so optimisation of the grid spacing is equivalent to optimisation of the sample size of a square grid.</p>
<p>This chapter is about optimisation of the spatial coordinates of the sampling units <em>given the sample size</em>. So, we are searching for the optimal spatial sampling pattern of a fixed number of sampling units. The constraint of sampling on a regular grid is dropped. In general the optimal spatial sampling pattern is irregular. Similar to spatial coverage sampling (Section <a href="RegularGridSpatialCoverage.html#SpatialCoverage">17.2</a>), we search for the optimal sampling pattern through minimisation of an explicit criterion. In spatial coverage sampling the minimisation criterion is the mean squared shortest distance (MSSD) which is minimised by k-means. In this chapter the minimisation criterion is the mean kriging variance (MKV) or a quantile of the kriging variance. Algorithm k-means cannot be used for minimising this criterion as it uses (standardised) distances between cluster centres (the sampling locations) and the nodes of a discretisation grid, and the kriging variance is not a simple linear function of these distances. A different optimisation algorithm is needed. Here spatial simulated annealing is used which is explained in the next subsection. Non-spatial simulated annealing was used before in conditioned Latin hypercube sampling using package <strong>clhs</strong> (Chapter <a href="cLHS.html#cLHS">19</a>).</p>
<div id="SSA" class="section level2" number="23.1">
<h2><span class="header-section-number">23.1</span> Spatial simulated annealing</h2>
<p>Inspired by the potentials of optimisation through simulated annealing <span class="citation">(<a href="#ref-Kirkpatrick1983" role="doc-biblioref">Kirkpatrick, Gelatt, and Vecchi 1983</a>)</span>, <span class="citation"><a href="#ref-vgr98" role="doc-biblioref">van Groenigen and Stein</a> (<a href="#ref-vgr98" role="doc-biblioref">1998</a>)</span> proposed to optimise the sampling pattern by spatial simulated annealing (SSA), see also <span class="citation"><a href="#ref-vgr99" role="doc-biblioref">van Groenigen, Siderius, and Stein</a> (<a href="#ref-vgr99" role="doc-biblioref">1999</a>)</span> and <span class="citation"><a href="#ref-vgr00" role="doc-biblioref">van Groenigen, Pieters, and Stein</a> (<a href="#ref-vgr00" role="doc-biblioref">2000</a>)</span>. This is an iterative, random search procedure, in which a sequence of samples is generated. A new sample (proposed sample) is obtained by slightly modifying the current sample. One sampling location of the current sample is randomly selected, and this location is shifted to a random location within the neighbourhood of the selected location.</p>
<p>The minimisation criterion is computed for the proposed sample and compared with that of the current sample. If the criterion of the proposed sample is smaller, the sample is accepted. If the criterion is larger, the sample is accepted with a probability equal to</p>
<p><span class="math display" id="eq:AcceptanceProb">\[\begin{equation}
P = e^{\frac{-\Delta}{T}}\;,
\tag{23.1}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(\Delta\)</span> the increase of the criterion and <span class="math inline">\(T\)</span> the “temperature.”</p>

<div class="rmdnote">
The name of this parameter shows the link with annealing in metallurgy. Annealing is a heat treatment of a material above its recrystallisation temperature. Simulated annealing mimics the gradual cooling of metal alloys, resulting in an optimum or near-optimum structure of the atoms in the alloy.
</div>
<p>The larger the value of <span class="math inline">\(T\)</span>, the larger the probability that a proposed sample with a given increase of the criterion is accepted (Figure <a href="MBSamplePattern.html#fig:AcceptanceProbabilitySSA">23.1</a>). The temperature <span class="math inline">\(T\)</span> is stepwise decreased during the optimisation: <span class="math inline">\(T_{k+1} = \alpha T_k\)</span>. In Figure <a href="MBSamplePattern.html#fig:AcceptanceProbabilitySSA">23.1</a> <span class="math inline">\(\alpha\)</span> equals 0.9. The effect of decreasing the temperature is that the acceptance probability of worse samples decreases during the optimisation and approaches 0 towards the end of the optimisation. Note that the temperature remains constant during a number of iterations, referred to as the chain length. In Figure <a href="MBSamplePattern.html#fig:AcceptanceProbabilitySSA">23.1</a> this chain length equals 100 iterations. Finally, a stopping criterion is required. Various stopping criteria are possible; one option is to set the maximum numbers of chains with no improvement. <span class="math inline">\(T, \alpha\)</span>, the chain length, and the stopping criterion are annealing schedule parameters that must be chosen by the user.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:AcceptanceProbabilitySSA"></span>
<img src="SpatialSampling_files/figure-html/AcceptanceProbabilitySSA-1.png" alt="Acceptance probability as a function of the change in the mean kriging variance (MKV) used as a minimisation criterion, and cooling schedule in spatial simulated annealing. For negative changes (MKV of proposed sample smaller than of current sample) the acceptance probability equals 1." width="100%" />
<p class="caption">
Figure 23.1: Acceptance probability as a function of the change in the mean kriging variance (MKV) used as a minimisation criterion, and cooling schedule in spatial simulated annealing. For negative changes (MKV of proposed sample smaller than of current sample) the acceptance probability equals 1.
</p>
</div>
</div>
<div id="SamplePatternOK" class="section level2" number="23.2">
<h2><span class="header-section-number">23.2</span> Optimising the sampling pattern for ordinary kriging</h2>
<p>In ordinary kriging (OK) we assume a constant model-mean. No covariates are available that are related to the study variable. Optimisation of the sampling pattern for OK is illustrated with the Cotton Research Farm in Uzbekistan which was used before to illustrate spatial response surface sampling (Chapter <a href="SpatialResponseSurface.html#SpatialResponseSurface">20</a>). The spatial coordinates of 50 sampling locations are optimised for mapping of the soil salinity (as measured by the electrical conductivity, ECe, of the soil) by OK. In this section the coordinates of the sampling points are optimised for OK. In Section <a href="MBSamplePattern.html#SamplePatternKED">23.3</a> this is done for kriging with an external drift. In that section a map of interpolated electromagnetic induction (EM) measurements is used to further optimise the coordinates of the sampling points.</p>
<p>Model-based optimisation of the sampling pattern for OK requires as input a semivariogram of the study variable. For the Cotton Research Farm I used the ECe (dS m<sup>-1</sup>) data collected in eight surveys in the period 2008 - 2011 at 142 points to estimate this semivariogram <span class="citation">(<a href="#ref-Akramkhanov2014" role="doc-biblioref">Akramkhanov, Brus, and Walvoort 2014</a>)</span>. The ECe data are natural-log transformed. The sample semivariogram is shown in Figure <a href="MBSamplePattern.html#fig:variogramlnECe">23.2</a>. The <strong>R</strong> code below shows how I fitted the semivariogram model with function <code>nls</code> (“non-linear least squares”) of the <strong>stat</strong> package. I did not use function <code>fit.variogram</code> of the <strong>gstat</strong> package <span class="citation">(<a href="#ref-peb04" role="doc-biblioref">E. J. Pebesma 2004</a>)</span>, because this function requires the output of function <code>variogram</code> as input, whereas the sample semivariogram is here computed in a different way.</p>

<div class="rmdnote">
The sample semivariogram is computed by first estimating sample semivariograms for each of the eight surveys separately, followed by computing weighted averages of semivariances and distances per lag, using the numbers of pairs as weights (<strong>R</strong> code not shown).
</div>
<p>The semivariogram parameters as estimated by <code>nls</code> are then used to define a semivariogram model of class <code>variogramModel</code> of package <strong>gstat</strong>, using function <code>vgm</code>. This is done because function <code>optimMKV</code> requires a semivariogram model of this class, see hereafter. As already mentioned in Chapter <a href="MBgridspacing.html#MBgridspacing">22</a>, in practice we often do not have legacy data from which we can estimate the semivariogram, and a best guess of the semivariogram then must be made.</p>
<div class="sourceCode" id="cb514"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb514-1"><a href="MBSamplePattern.html#cb514-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gstat)</span>
<span id="cb514-2"><a href="MBSamplePattern.html#cb514-2" aria-hidden="true" tabindex="-1"></a>res_nls <span class="ot">&lt;-</span> <span class="fu">nls</span>(semivar <span class="sc">~</span> nugget <span class="sc">+</span> psill <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span>h <span class="sc">/</span> range)),</span>
<span id="cb514-3"><a href="MBSamplePattern.html#cb514-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">start =</span> <span class="fu">list</span>(<span class="at">nugget =</span> <span class="fl">0.1</span>, <span class="at">psill =</span> <span class="fl">0.4</span>, <span class="at">range =</span> <span class="dv">200</span>), <span class="at">weights =</span> somnp)</span>
<span id="cb514-4"><a href="MBSamplePattern.html#cb514-4" aria-hidden="true" tabindex="-1"></a>vgm_lnECe <span class="ot">&lt;-</span> <span class="fu">vgm</span>(<span class="at">model =</span> <span class="st">&quot;Exp&quot;</span>, <span class="at">nugget =</span> <span class="fu">coef</span>(res_nls)[<span class="dv">1</span>],</span>
<span id="cb514-5"><a href="MBSamplePattern.html#cb514-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">psill =</span> <span class="fu">coef</span>(res_nls)[<span class="dv">2</span>], <span class="at">range =</span> <span class="fu">coef</span>(res_nls)[<span class="dv">3</span>])</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:variogramlnECe"></span>
<img src="SpatialSampling_files/figure-html/variogramlnECe-1.png" alt="Sample semivariogram and fitted exponential model of lnECe at the Cotton Research Farm." width="80%" />
<p class="caption">
Figure 23.2: Sample semivariogram and fitted exponential model of lnECe at the Cotton Research Farm.
</p>
</div>
<p>The estimated semivariogram parameters are shown in Table <a href="MBSamplePattern.html#tab:TableVariogramsCRF4">23.1</a>. The nugget-to-sill ratio is about 1/4, and the effective range is about 575 m (three times the distance parameter of an exponential model).</p>
<p>The coordinates of the sampling points are optimised with function <code>optimMKV</code> of package <strong>spsann</strong> <span class="citation">(<a href="#ref-Alessandro2016" role="doc-biblioref">Samuel-Rosa 2019</a>)</span><a href="#fn13" class="footnote-ref" id="fnref13"><sup>13</sup></a> First, the candidate sampling points are specified by the nodes of a grid discretising the population. As explained hereafter, this does not necessarily imply that the population is treated as a finite population. Next, the parameters of the annealing schedule are set. Note that both the initial acceptance rate and the initial temperature are set, which may seem weird as the acceptance rate is a function of the temperature, see Equation <a href="MBSamplePattern.html#eq:AcceptanceProb">(23.1)</a>. The initial acceptance rate is used as a threshold value. The optimisation stops when an initial temperature is chosen that leads to an acceptance rate smaller than the chosen value for the initial acceptance rate. In this case a larger value for the initial temperature must be chosen. Arguments <code>chain.length</code> and <code>stopping</code> of function <code>scheduleSPSANN</code> are multipliers. So, for a chain length of five, the number of iterations equals <span class="math inline">\(5n\)</span>, with <span class="math inline">\(n\)</span> the sample size.</p>
<p>During the optimisation a sample is perturbed by replacing one randomly selected point of the current sample by a new point. This selection of the new point is done in two steps. In the first step one node of the discretisation grid (specified with argument <code>candi</code>) is randomly selected. Only the nodes within a neighbourhood defined by <code>x.min</code>, <code>x.max</code>, <code>y.min</code>, and <code>y.max</code> can be selected. The nodes within this neighbourhood have equal probability of being selected. In the second step one point is selected within a grid cell with the selected node at its centre and a side length specified with argument <code>cellsize</code>. So, it is natural to set <code>cellsize</code> to the spacing of the discretisation grid. With <code>cellsize = 0</code> the sampling points are restricted to the nodes of the discretisation grid.</p>
<div class="sourceCode" id="cb515"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb515-1"><a href="MBSamplePattern.html#cb515-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spsann)</span>
<span id="cb515-2"><a href="MBSamplePattern.html#cb515-2" aria-hidden="true" tabindex="-1"></a>candi <span class="ot">&lt;-</span> grdCRF[, <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>)]</span>
<span id="cb515-3"><a href="MBSamplePattern.html#cb515-3" aria-hidden="true" tabindex="-1"></a>schedule <span class="ot">&lt;-</span> <span class="fu">scheduleSPSANN</span>(</span>
<span id="cb515-4"><a href="MBSamplePattern.html#cb515-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">initial.acceptance =</span> <span class="fl">0.8</span>,</span>
<span id="cb515-5"><a href="MBSamplePattern.html#cb515-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">initial.temperature =</span> <span class="fl">0.004</span>, <span class="at">temperature.decrease =</span> <span class="fl">0.95</span>,</span>
<span id="cb515-6"><a href="MBSamplePattern.html#cb515-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">500</span>, <span class="at">chain.length =</span> <span class="dv">2</span>, <span class="at">stopping =</span> <span class="dv">10</span>, <span class="at">cellsize =</span> <span class="dv">25</span>)</span></code></pre></div>
<p>The <strong>R</strong> code for optimising the sampling pattern is as follows.</p>
<div class="sourceCode" id="cb516"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb516-1"><a href="MBSamplePattern.html#cb516-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">314</span>)</span>
<span id="cb516-2"><a href="MBSamplePattern.html#cb516-2" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">optimMKV</span>(</span>
<span id="cb516-3"><a href="MBSamplePattern.html#cb516-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">points =</span> <span class="dv">50</span>, <span class="at">candi =</span> candi,</span>
<span id="cb516-4"><a href="MBSamplePattern.html#cb516-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">vgm =</span> vgm_lnECe, <span class="at">eqn =</span> z <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb516-5"><a href="MBSamplePattern.html#cb516-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">schedule =</span> schedule, <span class="at">nmax =</span> <span class="dv">20</span>, </span>
<span id="cb516-6"><a href="MBSamplePattern.html#cb516-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">plotit =</span> <span class="cn">FALSE</span>, <span class="at">track =</span> <span class="cn">TRUE</span>)</span>
<span id="cb516-7"><a href="MBSamplePattern.html#cb516-7" aria-hidden="true" tabindex="-1"></a>mysample <span class="ot">&lt;-</span> candi[res<span class="sc">$</span>points<span class="sc">$</span>id, ]</span>
<span id="cb516-8"><a href="MBSamplePattern.html#cb516-8" aria-hidden="true" tabindex="-1"></a>trace <span class="ot">&lt;-</span> res<span class="sc">$</span>objective<span class="sc">$</span>energy</span></code></pre></div>
<p>The spatial pattern of the sample in Figure <a href="MBSamplePattern.html#fig:ModelBasedSampleOK">23.3</a> and the trace of the MKV in Figure <a href="MBSamplePattern.html#fig:TraceMOKV">23.4</a> suggest that we are close to the global optimum.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:ModelBasedSampleOK"></span>
<img src="SpatialSampling_files/figure-html/ModelBasedSampleOK-1.png" alt="Optimised sampling pattern for the mean variance of OK predictions of lnECe (model-based sample) and spatial coverage sample of the Cotton Research Farm." width="100%" />
<p class="caption">
Figure 23.3: Optimised sampling pattern for the mean variance of OK predictions of lnECe (model-based sample) and spatial coverage sample of the Cotton Research Farm.
</p>
</div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:TraceMOKV"></span>
<img src="SpatialSampling_files/figure-html/TraceMOKV-1.png" alt="Trace of the mean ordinary kriging variance (MOKV)." width="80%" />
<p class="caption">
Figure 23.4: Trace of the mean ordinary kriging variance (MOKV).
</p>
</div>
<p>For comparison I also computed a spatial coverage sample of the same size. The spatial patterns of the two samples are quite similar (Figure <a href="MBSamplePattern.html#fig:ModelBasedSampleOK">23.3</a>). The MKV of the spatial coverage sample equals 0.2633 (dS m<sup>-1</sup>)<sup>2</sup>, whereas for the model-based sample the MKV equals 0.2642 (dS m<sup>-1</sup>)<sup>2</sup>. So, no gain in precision is achieved by the model-based optimisation of the sampling pattern compared to spatial coverage sampling. With <code>cellsize = 0</code> the minimised MKV is slightly smaller: 0.2578 (dS m<sup>-1</sup>)<sup>2</sup>. This outcome is in agreement with the results reported by <span class="citation"><a href="#ref-bru07c" role="doc-biblioref">Brus, de Gruijter, and van Groenigen</a> (<a href="#ref-bru07c" role="doc-biblioref">2007</a>)</span>.</p>
<p>Instead of the mean OK variance (MOKV), we may prefer to use some quantile of the cumulative distribution function of the OK variance as a minimisation criterion. For instance, if we use the 0.90 quantile as criterion, we are searching for the sampling locations so that the 90th percentile (P90) of the OK variance is minimal. This can be done with function <code>optimUSER</code> of package <strong>spsann</strong>. The objective function to be minimised can be passed to this function with argument <code>fun</code>. In this case the objective function is as follows.</p>
<div class="sourceCode" id="cb517"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb517-1"><a href="MBSamplePattern.html#cb517-1" aria-hidden="true" tabindex="-1"></a>QOKV <span class="ot">&lt;-</span> <span class="cf">function</span>(points, esample, model, nmax, prob) {</span>
<span id="cb517-2"><a href="MBSamplePattern.html#cb517-2" aria-hidden="true" tabindex="-1"></a>  points <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(points)</span>
<span id="cb517-3"><a href="MBSamplePattern.html#cb517-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coordinates</span>(points) <span class="ot">&lt;-</span> <span class="er">~</span> x <span class="sc">+</span> y</span>
<span id="cb517-4"><a href="MBSamplePattern.html#cb517-4" aria-hidden="true" tabindex="-1"></a>  points<span class="sc">$</span>dum <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb517-5"><a href="MBSamplePattern.html#cb517-5" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">krige</span>(</span>
<span id="cb517-6"><a href="MBSamplePattern.html#cb517-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> dum <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb517-7"><a href="MBSamplePattern.html#cb517-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">locations =</span> points,</span>
<span id="cb517-8"><a href="MBSamplePattern.html#cb517-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata =</span> esample,</span>
<span id="cb517-9"><a href="MBSamplePattern.html#cb517-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> model,</span>
<span id="cb517-10"><a href="MBSamplePattern.html#cb517-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">nmax =</span> nmax,</span>
<span id="cb517-11"><a href="MBSamplePattern.html#cb517-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">debug.level =</span> <span class="dv">0</span>)</span>
<span id="cb517-12"><a href="MBSamplePattern.html#cb517-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">quantile</span>(res<span class="sc">$</span>var1.var, <span class="at">probs =</span> prob)</span>
<span id="cb517-13"><a href="MBSamplePattern.html#cb517-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The next code chunk shows how this objective function can be minimised.</p>
<div class="sourceCode" id="cb518"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb518-1"><a href="MBSamplePattern.html#cb518-1" aria-hidden="true" tabindex="-1"></a>myevalsample <span class="ot">&lt;-</span> candi</span>
<span id="cb518-2"><a href="MBSamplePattern.html#cb518-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coordinates</span>(myevalsample) <span class="ot">&lt;-</span> <span class="er">~</span> x <span class="sc">+</span> y</span>
<span id="cb518-3"><a href="MBSamplePattern.html#cb518-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">314</span>)</span>
<span id="cb518-4"><a href="MBSamplePattern.html#cb518-4" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">optimUSER</span>(</span>
<span id="cb518-5"><a href="MBSamplePattern.html#cb518-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">points =</span> <span class="dv">50</span>, <span class="at">candi =</span> candi,</span>
<span id="cb518-6"><a href="MBSamplePattern.html#cb518-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">fun =</span> QOKV,</span>
<span id="cb518-7"><a href="MBSamplePattern.html#cb518-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">esample =</span> myevalsample,</span>
<span id="cb518-8"><a href="MBSamplePattern.html#cb518-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> vgm_lnECe,</span>
<span id="cb518-9"><a href="MBSamplePattern.html#cb518-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">nmax =</span> <span class="dv">20</span>, <span class="at">prob =</span> <span class="fl">0.9</span>,</span>
<span id="cb518-10"><a href="MBSamplePattern.html#cb518-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">schedule =</span> schedule)</span></code></pre></div>
<p>Argument <code>esample</code> specifies a <code>SpatialPoints</code> object with the evaluation points, i.e. the points at which the kriging variance is computed. Above I used all candidate sampling points as evaluation points. Computing time can be reduced by selecting a coarser square grid with evaluation points. The number of points used in kriging is specified with argument <code>nmax</code>, and the probability of the cumulative distribution function of the kriging variance is specified with argument <code>prob</code>. Optimisation of the sampling pattern for a quantile of the ordinary kriging variance is left as an exercise.</p>
<div id="exercises-29" class="section level4 unnumbered">
<h4>Exercises</h4>
<ol style="list-style-type: decimal">
<li>Write an <strong>R</strong> script to optimise the spatial coordinates of sixteen points in a square for OK. First create a discretisation grid of 20 <span class="math inline">\(\times\)</span> 20 nodes. Use an exponential semivariogram without nugget, with a sill of 2, and a distance parameter of four times the spacing of the discretisation grid. Optimise the sampling pattern with SSA (using functions <code>scheduleSPSANN</code> and <code>optimMKV</code> of package <strong>spsann</strong>).
<ul>
<li>Check whether the optimisation has converged by plotting the trace of the optimisation criterion MKV.</li>
<li>Based on the coordinates of the sampling points, do you think the sample is the global optimum, i.e. the sample with the smallest possible MKV?<br />
</li>
</ul></li>
<li>Write an <strong>R</strong> script to optimise the sampling pattern of 50 points, using the P90 of the variance of OK predictions of lnECe on the Cotton Research Farm as a minimisation criterion. Use the semivariogram parameters of Table <a href="MBSamplePattern.html#tab:TableVariogramsCRF4">23.1</a>. Compare the optimised sample with the sample optimised with the mean OK variance (shown in Figure <a href="MBSamplePattern.html#fig:ModelBasedSampleOK">23.3</a>).</li>
</ol>
</div>
</div>
<div id="SamplePatternKED" class="section level2" number="23.3">
<h2><span class="header-section-number">23.3</span> Optimising the sampling pattern for kriging with an external drift</h2>
<p>If we have one or more covariates that are linearly related to the study variable, the study variable can be mapped by kriging with an external drift (KED). A requirement is that we have maps of the covariates so that, once we have estimated the parameters of the model for KED from the data collected at the optimised sample, these covariate maps can be used to map the study variable (see Equation <a href="Introkriging.html#eq:KEDvariance2">(21.21)</a>).</p>
<p>Optimisation of the sampling pattern for KED requires as input the semivariogram of the residuals. Besides, we must decide on the covariates for the model-mean. Note that we do not need estimates of the regression coefficients associated with the covariates as input, but just which combination of covariates we want to use for modelling the model-mean of the study variable.</p>
<p>Optimisation of the sampling pattern for KED is illustrated with the Cotton Research Farm. The interpolated natural log of the EM data (with transmitter at 1 m) is used as a covariate, see Figure <a href="SpatialResponseSurface.html#fig:EMdataUzbekistan">20.1</a>. The data for fitting the model are in data file <code>sampleCRF</code>. The parameters of the residual semivariogram are estimated by restricted maximum likelihood (REML), see Subsection <a href="Introkriging.html#REML">21.5.2</a>.</p>
<p>At several points multiple pairs of observations of the study variable ECe and the covariate EM have been made. These calibration data have exactly the same spatial coordinates. This leads to problems with REML estimation. The covariance matrix is not positive definite, so that it cannot be inverted. To solve this problem I jittered the coordinates of the sampling points by a small amount.</p>
<!-- Note that in the next chunk I use EM as measured at the calibration sites (sampleCRF.rda) to fit the regression model and to compute the residuals. Ideally the interpolated EM values in data/grdCRF.rda (obtained by ordinary kriging of EM data in TransectsData_EM_CRF_Uzbekistan.csv) at the calibration sites are used as a covariate. However, the EM measurements in  the transects are at one time only, whereas the calibration data consist of simultaneous EM and EC measurements at multiple times. Therefore, to keep it simple, I used the EM data at the calibration sites -->
<div class="sourceCode" id="cb519"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb519-1"><a href="MBSamplePattern.html#cb519-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geoR)</span>
<span id="cb519-2"><a href="MBSamplePattern.html#cb519-2" aria-hidden="true" tabindex="-1"></a>sampleCRF<span class="sc">$</span>lnEM100 <span class="ot">&lt;-</span> <span class="fu">log</span>(sampleCRF<span class="sc">$</span>EMv1m)</span>
<span id="cb519-3"><a href="MBSamplePattern.html#cb519-3" aria-hidden="true" tabindex="-1"></a>sampleCRF<span class="sc">$</span>x <span class="ot">&lt;-</span> <span class="fu">jitter</span>(sampleCRF<span class="sc">$</span>x, <span class="at">amount =</span> <span class="fl">0.001</span>)</span>
<span id="cb519-4"><a href="MBSamplePattern.html#cb519-4" aria-hidden="true" tabindex="-1"></a>sampleCRF<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="fu">jitter</span>(sampleCRF<span class="sc">$</span>y, <span class="at">amount =</span> <span class="fl">0.001</span>)</span>
<span id="cb519-5"><a href="MBSamplePattern.html#cb519-5" aria-hidden="true" tabindex="-1"></a>dGeoR <span class="ot">&lt;-</span> <span class="fu">as.geodata</span>(<span class="at">obj =</span> sampleCRF, <span class="at">header =</span> <span class="cn">TRUE</span>,</span>
<span id="cb519-6"><a href="MBSamplePattern.html#cb519-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords.col =</span> <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>), <span class="at">data.col =</span> <span class="st">&quot;lnECe&quot;</span>, <span class="at">covar.col =</span> <span class="st">&quot;lnEM100&quot;</span>)</span>
<span id="cb519-7"><a href="MBSamplePattern.html#cb519-7" aria-hidden="true" tabindex="-1"></a>vgm_REML <span class="ot">&lt;-</span> <span class="fu">likfit</span>(<span class="at">geodata =</span> dGeoR, <span class="at">trend =</span> <span class="sc">~</span> lnEM100,</span>
<span id="cb519-8"><a href="MBSamplePattern.html#cb519-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">cov.model =</span> <span class="st">&quot;exponential&quot;</span>, <span class="at">ini.cov.pars =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">200</span>),</span>
<span id="cb519-9"><a href="MBSamplePattern.html#cb519-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">nugget =</span> <span class="fl">0.1</span>, <span class="at">lik.method =</span> <span class="st">&quot;REML&quot;</span>, <span class="at">messages =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>The REML estimates of the parameters of the residual semivariogram are shown in Table <a href="MBSamplePattern.html#tab:TableVariogramsCRF4">23.1</a>. The estimated sill (sum of nugget and partial sill) of the residual semivariogram is substantially smaller than that of lnECe, showing that the linear model for the model-mean explains a considerable part of the spatial variation of lnECe.</p>
<table class=" lightable-classic" style="font-family: &quot;Arial Narrow&quot;, &quot;Source Sans Pro&quot;, sans-serif; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:TableVariogramsCRF4">Table 23.1: </span>Estimated parameters of an exponential semivariogram for lnECe (estimated by method-of-moments) and for the residuals of a linear regression model for lnECe using lnEM100cm as a predictor (estimated by REML).
</caption>
<thead>
<tr>
<th style="text-align:left;">
Variable
</th>
<th style="text-align:right;">
Nugget
</th>
<th style="text-align:right;">
Partial sill
</th>
<th style="text-align:right;">
Distance parameter (m)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
lnECe
</td>
<td style="text-align:right;">
0.116
</td>
<td style="text-align:right;">
0.336
</td>
<td style="text-align:right;">
192
</td>
</tr>
<tr>
<td style="text-align:left;">
residuals
</td>
<td style="text-align:right;">
0.126
</td>
<td style="text-align:right;">
0.083
</td>
<td style="text-align:right;">
230
</td>
</tr>
</tbody>
</table>
<p>To optimise the sampling pattern for KED, using the mean KED variance as a minimisation criterion, a data frame with the covariates at the candidate sampling points must be specified with argument <code>covars</code>. The formula for the model-mean is specified with argument <code>eqn</code>.</p>
<div class="sourceCode" id="cb520"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb520-1"><a href="MBSamplePattern.html#cb520-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">314</span>)</span>
<span id="cb520-2"><a href="MBSamplePattern.html#cb520-2" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">optimMKV</span>(</span>
<span id="cb520-3"><a href="MBSamplePattern.html#cb520-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">points =</span> <span class="dv">50</span>, <span class="at">candi =</span> candi, <span class="at">covars =</span> grdCRF,</span>
<span id="cb520-4"><a href="MBSamplePattern.html#cb520-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">vgm =</span> vgm_REML_gstat, <span class="at">eqn =</span> z <span class="sc">~</span> lnEM100cm,</span>
<span id="cb520-5"><a href="MBSamplePattern.html#cb520-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">schedule =</span> schedule, <span class="at">nmax =</span> <span class="dv">20</span>,</span>
<span id="cb520-6"><a href="MBSamplePattern.html#cb520-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">plotit =</span> <span class="cn">FALSE</span>, <span class="at">track =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>Figure <a href="MBSamplePattern.html#fig:ModelBasedSampleKED">23.5</a> shows the optimised locations of a sample of 50 points. This clearly shows the irregular spatial pattern of the sampling points induced by the covariate lnEM100cm.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:ModelBasedSampleKED"></span>
<img src="SpatialSampling_files/figure-html/ModelBasedSampleKED-1.png" alt="Optimised sampling pattern for KED of lnECe at the Cotton Research Farm, using lnEM100cm as a covariate." width="100%" />
<p class="caption">
Figure 23.5: Optimised sampling pattern for KED of lnECe at the Cotton Research Farm, using lnEM100cm as a covariate.
</p>
</div>
<p>Comparing the population and sample histograms of the covariate clearly shows that locations with small and locations with large values for the covariate are preferentially selected (Figure <a href="MBSamplePattern.html#fig:histogramslnEM">23.6</a>). The optimised sampling pattern is a compromise between spreading in geographic space and covariate space, see also <span class="citation"><a href="#ref-heu07" role="doc-biblioref">Heuvelink, Brus, and Gruijter</a> (<a href="#ref-heu07" role="doc-biblioref">2007</a>)</span> and <span class="citation"><a href="#ref-bru07" role="doc-biblioref">Brus and Heuvelink</a> (<a href="#ref-bru07" role="doc-biblioref">2007</a>)</span>. More precisely, locations are selected by spreading them out throughout the study area, while accounting for the values of the covariates at the selected locations, in a way that locations with covariate values near the minimum and maximum are preferred. This can be explained by noting that the variance of the KED prediction error can be decomposed into two components: the variance of the interpolated residuals and the variance of the estimator of the model-mean, see Section <a href="Introkriging.html#IntroKED">21.3</a>. The contribution of the first variance component is minimised through geographical spreading, that of the second component by selecting locations with covariate values near the minimum and maximum.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:histogramslnEM"></span>
<img src="SpatialSampling_files/figure-html/histogramslnEM-1.png" alt="Sample histogram and population histogram of lnEM100cm used as covariate in model-based optimisation of the sampling pattern for mapping with KED." width="100%" />
<p class="caption">
Figure 23.6: Sample histogram and population histogram of lnEM100cm used as covariate in model-based optimisation of the sampling pattern for mapping with KED.
</p>
</div>

<div class="rmdnote">
A sample with covariate values close to the minimum and maximum only is not desirable if we do not want to rely on the assumption of a linear relation between the study variable and the covariates. To identify a non-linear relation, locations with intermediate covariate values are needed. Optimisation using a semivariogram with clear spatial structure leads to geographical spreading of the sampling units, so that most likely also locations with intermediate covariate values are selected.
</div>
<p>When one or more covariates are used in optimisation of the sampling pattern but not used in KED once the data are collected, the sample is suboptimal for the model used in prediction. Inversely, ignoring a covariate in optimisation of the sampling pattern while using this covariate as a predictor also leads to suboptimal samples. The selection of covariates to be used in sampling design therefore should be done with care. Besides, as we will see in the next exercise, the nugget of the residual semivariogram has a strong effect on the optimised sampling pattern, stressing the importance of a reliable prior estimate of this semivariogram parameter.</p>
<div id="exercises-30" class="section level4 unnumbered">
<h4>Exercises</h4>
<ol start="3" style="list-style-type: decimal">
<li>Write an <strong>R</strong> script to optimise the sampling pattern of sixteen points in a square for KED. Use the <span class="math inline">\(x\)</span>-coordinate as a covariate. First create a discretisation grid of 20 <span class="math inline">\(\times\)</span> 20 nodes. Use an exponential residual semivariogram without nugget, with a sill of 2, and a distance parameter of four times the spacing of the discretisation grid. Optimise the sampling pattern with SSA (using functions <code>scheduleSPSANN</code> and <code>optimMKV</code> of package <strong>spsann</strong>).
<ul>
<li>What do you think of the spatial coverage of the optimised sample? Compare the sample with the optimised sample for OK, see exercise of Section <a href="MBSamplePattern.html#SamplePatternOK">23.2</a>.</li>
<li>Repeat the optimisation using a residual semivariogram with a nugget of 1.5 and a partial sill of 0.5. Note that the sill is again 2, as before.</li>
<li>Compare the optimised sample with the previous sample. What is the most striking difference?</li>
<li>How will the optimised sample look like with a pure nugget semivariogram? Check your assumption using such semivariogram in SSA.</li>
</ul></li>
</ol>
</div>
</div>
<div id="model-based-infill-sampling-for-ordinary-kriging" class="section level2" number="23.4">
<h2><span class="header-section-number">23.4</span> Model-based infill sampling for ordinary kriging</h2>
<p>Similar to spatial infill sampling using MSSD as a minimisation criterion (Section <a href="RegularGridSpatialCoverage.html#SpatialInfill">17.3</a>), we may design a model-based infill sample. Package <strong>spsann</strong> can be used for this, using argument <code>points</code> of function <code>optimMKV</code>.</p>
<p>In Section <a href="MBgridspacing.html#GridspacingOK">22.1</a> the legacy data of West-Amhara were used to estimate the parameters of a spherical semivariogram for the SOM concentration. The estimated parameters are shown in Table <a href="MBgridspacing.html#tab:VariogramEstimatesEthiopia">22.1</a>. The maximum likelihood estimates are used in this section to optimise the spatial coordinates of the infill sample.</p>
<p>In the next code chunk a list is created, containing a data frame with the coordinates of the fixed points (specified with sub-argument <code>fixed</code>) and an integer of the number of additional points to be selected (specified with sub-argument <code>free</code>). The list is passed to function <code>optimMKV</code> with argument <code>points</code>. For kriging I reduced the number of legacy points by keeping one point only per grid cell of 1 km <span class="math inline">\(\times\)</span> 1 km. This is done with function <code>remove.duplicates</code> of package <strong>sp</strong>.</p>
<div class="sourceCode" id="cb521"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb521-1"><a href="MBSamplePattern.html#cb521-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb521-2"><a href="MBSamplePattern.html#cb521-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coordinates</span>(sampleAmhara) <span class="ot">&lt;-</span> <span class="er">~</span> s1 <span class="sc">+</span> s2</span>
<span id="cb521-3"><a href="MBSamplePattern.html#cb521-3" aria-hidden="true" tabindex="-1"></a>legacy <span class="ot">&lt;-</span> <span class="fu">remove.duplicates</span>(sampleAmhara, <span class="at">zero =</span> <span class="dv">1</span>, <span class="at">remove.second =</span> <span class="cn">TRUE</span>)</span>
<span id="cb521-4"><a href="MBSamplePattern.html#cb521-4" aria-hidden="true" tabindex="-1"></a>pnts <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">fixed =</span> <span class="fu">coordinates</span>(legacy), <span class="at">free =</span> <span class="dv">100</span>)</span>
<span id="cb521-5"><a href="MBSamplePattern.html#cb521-5" aria-hidden="true" tabindex="-1"></a>candi <span class="ot">&lt;-</span> grdAmhara[, <span class="fu">c</span>(<span class="st">&quot;s1&quot;</span>, <span class="st">&quot;s2&quot;</span>)]</span>
<span id="cb521-6"><a href="MBSamplePattern.html#cb521-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(candi) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>)</span></code></pre></div>
<p>The number of points used in kriging can be passed to function <code>optimMKV</code> with argument <code>nmax</code>.</p>
<div class="sourceCode" id="cb522"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb522-1"><a href="MBSamplePattern.html#cb522-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">314</span>)</span>
<span id="cb522-2"><a href="MBSamplePattern.html#cb522-2" aria-hidden="true" tabindex="-1"></a>vgm_ML_gstat <span class="ot">&lt;-</span> <span class="fu">vgm</span>(<span class="at">model =</span> <span class="st">&quot;Sph&quot;</span>, <span class="at">psill =</span> vgm_ML<span class="sc">$</span>sigmasq,</span>
<span id="cb522-3"><a href="MBSamplePattern.html#cb522-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">range =</span> vgm_ML<span class="sc">$</span>phi, <span class="at">nugget =</span> vgm_ML<span class="sc">$</span>nugget)</span>
<span id="cb522-4"><a href="MBSamplePattern.html#cb522-4" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">optimMKV</span>(</span>
<span id="cb522-5"><a href="MBSamplePattern.html#cb522-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">points =</span> pnts, <span class="at">candi =</span> candi,</span>
<span id="cb522-6"><a href="MBSamplePattern.html#cb522-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">vgm =</span> vgm_ML_gstat, <span class="at">eqn =</span> z <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb522-7"><a href="MBSamplePattern.html#cb522-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">nmax =</span> <span class="dv">20</span>, <span class="at">schedule =</span> schedule, <span class="at">track =</span> <span class="cn">FALSE</span>)</span>
<span id="cb522-8"><a href="MBSamplePattern.html#cb522-8" aria-hidden="true" tabindex="-1"></a>infillSample <span class="ot">&lt;-</span> res<span class="sc">$</span>points <span class="sc">%&gt;%</span></span>
<span id="cb522-9"><a href="MBSamplePattern.html#cb522-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(free <span class="sc">==</span> <span class="dv">1</span>)</span></code></pre></div>
<p>Figure <a href="MBSamplePattern.html#fig:ModelBasedInfill">23.7</a> shows a model-based infill sample of 100 points for OK of the soil organic matter (SOM) concentration (dag kg<sup>-1</sup>) throughout West-Amhara. Comparison of the model-based infill sample with the spatial infill sample of Figure <a href="RegularGridSpatialCoverage.html#fig:spatialinfillEthiopia">17.5</a> shows that in a wider zone on both sides of the roads no new sampling points are selected. This can be explained by the large range, 36.9 km, of the semivariogram.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:ModelBasedInfill"></span>
<img src="SpatialSampling_files/figure-html/ModelBasedInfill-1.png" alt="Model-based infill sample for OK of the SOM concentration throughout West-Amhara. Legacy units have free-value 0, infill units have free-value 1." width="100%" />
<p class="caption">
Figure 23.7: Model-based infill sample for OK of the SOM concentration throughout West-Amhara. Legacy units have free-value 0, infill units have free-value 1.
</p>
</div>
</div>
<div id="model-based-infill-sampling-for-kriging-with-an-external-drift" class="section level2" number="23.5">
<h2><span class="header-section-number">23.5</span> Model-based infill sampling for kriging with an external drift</h2>
<p>For West-Amhara maps of covariates are available that can be used in KED, see Section <a href="MBgridspacing.html#MBgridspacingKED">22.4</a>. The prediction error variance with KED is partly determined by the covariate values (see Section <a href="MBSamplePattern.html#SamplePatternKED">23.3</a>), and therefore, when filling in the undersampled areas, locations with extreme values for the covariates are preferably selected. In Section <a href="MBgridspacing.html#MBgridspacingKED">22.4</a> the legacy data were used to estimate the residual semivariogram by REML, see Table <a href="MBgridspacing.html#tab:VariogramREMLEthiopia">22.2</a>. In the next code chunk the estimated parameters of the residual semivariogram are used to optimise the spatial pattern of an infill sample of 100 points for mapping the SOM concentration throughout West-Amhara by KED, using elevation (dem), NIR-reflectance (rfl_NIR), red-reflectance (rfl_red), and land surface temperature (lst) as predictors for the model-mean.</p>
<div class="sourceCode" id="cb523"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb523-1"><a href="MBSamplePattern.html#cb523-1" aria-hidden="true" tabindex="-1"></a>covars <span class="ot">&lt;-</span> grdAmhara[, <span class="fu">c</span>(<span class="st">&quot;dem&quot;</span>, <span class="st">&quot;rfl_NIR&quot;</span>, <span class="st">&quot;rfl_red&quot;</span>, <span class="st">&quot;lst&quot;</span>)]</span>
<span id="cb523-2"><a href="MBSamplePattern.html#cb523-2" aria-hidden="true" tabindex="-1"></a>vgm_REML_gstat <span class="ot">&lt;-</span> <span class="fu">vgm</span>(<span class="at">model =</span> <span class="st">&quot;Sph&quot;</span>, <span class="at">psill =</span> vgm_REML<span class="sc">$</span>sigmasq,</span>
<span id="cb523-3"><a href="MBSamplePattern.html#cb523-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">range =</span> vgm_REML<span class="sc">$</span>phi, <span class="at">nugget =</span> vgm_REML<span class="sc">$</span>nugget)</span>
<span id="cb523-4"><a href="MBSamplePattern.html#cb523-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">314</span>)</span>
<span id="cb523-5"><a href="MBSamplePattern.html#cb523-5" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">optimMKV</span>(</span>
<span id="cb523-6"><a href="MBSamplePattern.html#cb523-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">points =</span> pnts, <span class="at">candi =</span> candi, <span class="at">covars =</span> covars,</span>
<span id="cb523-7"><a href="MBSamplePattern.html#cb523-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">vgm =</span> vgm_REML_gstat,</span>
<span id="cb523-8"><a href="MBSamplePattern.html#cb523-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">eqn =</span> z <span class="sc">~</span> dem <span class="sc">+</span> rfl_NIR <span class="sc">+</span> rfl_red <span class="sc">+</span> lst,</span>
<span id="cb523-9"><a href="MBSamplePattern.html#cb523-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">nmax =</span> <span class="dv">20</span>, <span class="at">schedule =</span> schedule, <span class="at">track =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>Figure <a href="MBSamplePattern.html#fig:ModelBasedInfillKED">23.8</a> shows the optimised sample. Again the legacy points are avoided, but the infill sampling of the under-sampled areas is less uniform compared to Figure <a href="MBSamplePattern.html#fig:ModelBasedInfill">23.7</a>. Spreading in geographical space is less important than with OK because the residual semivariogram has a much smaller range (Table <a href="MBgridspacing.html#tab:VariogramREMLEthiopia">22.2</a>). Spreading in covariate space does not play any role with OK, whereas with KED selecting locations with extreme values for the covariates is important to minimise the uncertainty about the estimated model-mean.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:ModelBasedInfillKED"></span>
<img src="SpatialSampling_files/figure-html/ModelBasedInfillKED-1.png" alt="Model-based infill sample for KED of the SOM concentration throughout West-Amhara, plotted on a map of one of the covariates. Legacy units have free-value 0, infill units have free-value 1." width="100%" />
<p class="caption">
Figure 23.8: Model-based infill sample for KED of the SOM concentration throughout West-Amhara, plotted on a map of one of the covariates. Legacy units have free-value 0, infill units have free-value 1.
</p>
</div>
<p>The MKV of the optimised sample equals 0.878 (dag kg<sup>-1</sup>)<sup>2</sup>, which is somewhat larger than the sill (sum of nugget and partial sill) of the residual semivariogram (Table <a href="MBgridspacing.html#tab:VariogramREMLEthiopia">22.2</a>). This can be explained by the very small range of the semivariogram, so that ignoring the uncertainty about the model-mean, the kriging variance at nearly all locations in the study area equals the sill. Besides, we are uncertain about the model-mean, explaining that the MKV can be larger than the sill.</p>
<pre><code>           used  (Mb) gc trigger  (Mb)  max used   (Mb)
Ncells  5747588 307.0    9514657 508.2   9514657  508.2
Vcells 27607548 210.7   88864970 678.0 176940428 1350.0</code></pre>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Akramkhanov2014" class="csl-entry">
Akramkhanov, A., D. J. Brus, and D. J. J. Walvoort. 2014. <span>“<span class="nocase">Geostatistical monitoring of soil salinity in Uzbekistan by repeated EMI surveys</span>.”</span> <em>Geoderma</em> 213: 600–607.
</div>
<div id="ref-bru07c" class="csl-entry">
Brus, D. J., J. J. de Gruijter, and J. W. van Groenigen. 2007. <span>“<span class="nocase">Designing Spatial Coverage Samples Using the k-means Clustering Algorithm</span>.”</span> In <em><span>Digital Soil Mapping. An Introductory Perspective</span></em>, edited by P. Lagacherie, A. B. McBratney, and M. Voltz, 183–92. Elsevier.
</div>
<div id="ref-bru07" class="csl-entry">
Brus, D. J., and G. B. M. Heuvelink. 2007. <span>“Optimization of Sample Patterns for Universal Kriging of Environmental Variables.”</span> <em>Geoderma</em> 138 (1–2): 86–95.
</div>
<div id="ref-heu07" class="csl-entry">
Heuvelink, G. B. M., D. J. Brus, and J. J. de Gruijter. 2007. <span>“Optimization of Sample Configurations for Digital Mapping of Soil Properties with Universal Kriging.”</span> In <em>Digital Soil Mapping. An Introductory Perspective</em>, edited by P. Lagacherie, A. B. McBratney, and M. Voltz, 137–51. Elsevier.
</div>
<div id="ref-Kirkpatrick1983" class="csl-entry">
Kirkpatrick, S., C. D. Gelatt, and M. P. Vecchi. 1983. <span>“Optimization by Simulated Annealing.”</span> <em>Science</em> 220 (4598): 671–80. https://doi.org/<a href="https://doi.org/10.1126/science.220.4598.671">https://doi.org/10.1126/science.220.4598.671</a>.
</div>
<div id="ref-peb04" class="csl-entry">
Pebesma, E. J. 2004. <span>“Multivariable Geostatistics in <span>S</span>: The Gstat Package.”</span> <em>Computers &amp; Geosciences</em> 30 (7): 683–91.
</div>
<div id="ref-Alessandro2016" class="csl-entry">
Samuel-Rosa, A. 2019. <em><span class="nocase">spsann: Optimization of Sample Configurations using Spatial Simulated Annealing</span></em>. <a href="https://CRAN.R-project.org/package=spsann">https://CRAN.R-project.org/package=spsann</a>.
</div>
<div id="ref-vgr00" class="csl-entry">
van Groenigen, J. W., G. Pieters, and A. Stein. 2000. <span>“Optimizing Spatial Sampling for Multivariate Contamination in Urban Areas.”</span> <em>Environmetrics</em> 11 (2): 227–44.
</div>
<div id="ref-vgr99" class="csl-entry">
van Groenigen, J. W., W. Siderius, and A. Stein. 1999. <span>“Constrained Optimisation of Soil Sampling for Minimisation of the Kriging Variance.”</span> <em>Geoderma</em> 87 (3): 239–59.
</div>
<div id="ref-vgr98" class="csl-entry">
van Groenigen, J. W., and A. Stein. 1998. <span>“Constrained Optimization of Spatial Sampling Using Continuous Simulated Annealing.”</span> <em>Journal of Environmental Quality</em> 27 (5): 1078–86.
</div>
</div>
<div class="footnotes">
<hr />
<ol start="13">
<li id="fn13"><p>At the moment of writing this book package <strong>spsann</strong> is not available on CRAN. I have added the file <code>spsann_2.2.0.tar.gz</code> to the folder <code>Rscripts</code> of the github repository of this book. In this folder you can also find a the file <code>pedometrics_0.7.0.tar.gz</code> which is a dependency of <code>spsann</code>. The packages can be installed with <strong>RStudio</strong> by selecting “Package Archive File (.zip; .tar.gz)” from the drop-down list in the field “Install from:”<a href="MBSamplePattern.html#fnref13" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="MBgridspacing.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="SamplingVariogram.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/DickBrus/SpatialSamplingwithR/edit/master/29-ModelBasedSamplePattern.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["SpatialSampling.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
