<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 13 Model-based optimisation of probability sampling designs | Spatial sampling with R</title>
  <meta name="description" content="This book is for students, scientists, researchers and consultants who want to know how to collect spatial data, either for estimating parameters for the population or several subpopulations, or for mapping. How many data do we need, and how to select the population units? The book presents a wide overview of spatial sampling designs. Besides there is a chapter on designs for sampling in space and time for monitoring. The emphasis is not on the theory, but on how to implement sampling designs in R and on how the (sub)population parameters can be estimated from the sample." />
  <meta name="generator" content="bookdown 0.23 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 13 Model-based optimisation of probability sampling designs | Spatial sampling with R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="/images/cover.pdf" />
  <meta property="og:description" content="This book is for students, scientists, researchers and consultants who want to know how to collect spatial data, either for estimating parameters for the population or several subpopulations, or for mapping. How many data do we need, and how to select the population units? The book presents a wide overview of spatial sampling designs. Besides there is a chapter on designs for sampling in space and time for monitoring. The emphasis is not on the theory, but on how to implement sampling designs in R and on how the (sub)population parameters can be estimated from the sample." />
  <meta name="github-repo" content="DickBrus/SpatialSamplingwithR" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 13 Model-based optimisation of probability sampling designs | Spatial sampling with R" />
  
  <meta name="twitter:description" content="This book is for students, scientists, researchers and consultants who want to know how to collect spatial data, either for estimating parameters for the population or several subpopulations, or for mapping. How many data do we need, and how to select the population units? The book presents a wide overview of spatial sampling designs. Besides there is a chapter on designs for sampling in space and time for monitoring. The emphasis is not on the theory, but on how to implement sampling designs in R and on how the (sub)population parameters can be estimated from the sample." />
  <meta name="twitter:image" content="/images/cover.pdf" />

<meta name="author" content="Dick J. Brus" />


<meta name="date" content="2021-10-15" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="RequiredSampleSize.html"/>
<link rel="next" href="SmallAreaEstimation.html"/>
<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Spatial sampling with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="GeneralIntro.html"><a href="GeneralIntro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="GeneralIntro.html"><a href="GeneralIntro.html#BasicConcepts"><i class="fa fa-check"></i><b>1.1</b> Basic sampling concepts</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="GeneralIntro.html"><a href="GeneralIntro.html#PopulationParameters"><i class="fa fa-check"></i><b>1.1.1</b> Population parameters</a></li>
<li class="chapter" data-level="1.1.2" data-path="GeneralIntro.html"><a href="GeneralIntro.html#descriptive-statistics-versus-inference-about-a-population"><i class="fa fa-check"></i><b>1.1.2</b> Descriptive statistics versus inference about a population</a></li>
<li class="chapter" data-level="1.1.3" data-path="GeneralIntro.html"><a href="GeneralIntro.html#random-sampling-versus-probability-sampling"><i class="fa fa-check"></i><b>1.1.3</b> Random sampling versus probability sampling</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="GeneralIntro.html"><a href="GeneralIntro.html#DBvsMB"><i class="fa fa-check"></i><b>1.2</b> Design-based versus model-based approach</a></li>
<li class="chapter" data-level="1.3" data-path="GeneralIntro.html"><a href="GeneralIntro.html#Datasets"><i class="fa fa-check"></i><b>1.3</b> Populations used in sampling experiments</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="GeneralIntro.html"><a href="GeneralIntro.html#Voorst"><i class="fa fa-check"></i><b>1.3.1</b> Soil organic matter in Voorst (Netherlands)</a></li>
<li class="chapter" data-level="1.3.2" data-path="GeneralIntro.html"><a href="GeneralIntro.html#Poppy"><i class="fa fa-check"></i><b>1.3.2</b> Poppy fields in Kandahar (Afghanistan)</a></li>
<li class="chapter" data-level="1.3.3" data-path="GeneralIntro.html"><a href="GeneralIntro.html#aboveground-biomass-in-eastern-amazonia-brazil"><i class="fa fa-check"></i><b>1.3.3</b> Aboveground biomass in Eastern Amazonia (Brazil)</a></li>
<li class="chapter" data-level="1.3.4" data-path="GeneralIntro.html"><a href="GeneralIntro.html#TASSpainPortugal"><i class="fa fa-check"></i><b>1.3.4</b> Annual mean air temperature in Spain and Portugal</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>I Probability sampling for estimating (sub)population parameters</b></span></li>
<li class="chapter" data-level="2" data-path="IntroProbabilitySampling.html"><a href="IntroProbabilitySampling.html"><i class="fa fa-check"></i><b>2</b> Introduction to probability sampling</a>
<ul>
<li class="chapter" data-level="2.1" data-path="IntroProbabilitySampling.html"><a href="IntroProbabilitySampling.html#HTestimator"><i class="fa fa-check"></i><b>2.1</b> Horvitz-Thompson estimator</a></li>
<li class="chapter" data-level="2.2" data-path="IntroProbabilitySampling.html"><a href="IntroProbabilitySampling.html#hansen-hurwitz-estimator"><i class="fa fa-check"></i><b>2.2</b> Hansen-Hurwitz estimator</a></li>
<li class="chapter" data-level="2.3" data-path="IntroProbabilitySampling.html"><a href="IntroProbabilitySampling.html#using-models-in-design-based-approach"><i class="fa fa-check"></i><b>2.3</b> Using models in design-based approach</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="SI.html"><a href="SI.html"><i class="fa fa-check"></i><b>3</b> Simple random sampling</a>
<ul>
<li class="chapter" data-level="3.1" data-path="SI.html"><a href="SI.html#HTestimatorSI"><i class="fa fa-check"></i><b>3.1</b> Estimation of population parameters</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="SI.html"><a href="SI.html#PopProportion"><i class="fa fa-check"></i><b>3.1.1</b> Population proportion</a></li>
<li class="chapter" data-level="3.1.2" data-path="SI.html"><a href="SI.html#CDF"><i class="fa fa-check"></i><b>3.1.2</b> Cumulative distribution function and quantiles</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="SI.html"><a href="SI.html#VarMeanSI"><i class="fa fa-check"></i><b>3.2</b> Sampling variance of estimator of population parameter</a></li>
<li class="chapter" data-level="3.3" data-path="SI.html"><a href="SI.html#ConfidenceInterval"><i class="fa fa-check"></i><b>3.3</b> Confidence interval estimate</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="SI.html"><a href="SI.html#ConfidenceIntervalProportion"><i class="fa fa-check"></i><b>3.3.1</b> Confidence interval for proportion</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="SI.html"><a href="SI.html#SIcircularplots"><i class="fa fa-check"></i><b>3.4</b> Simple random sampling of circular plots</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="SI.html"><a href="SI.html#sampling-from-a-finite-set-of-fixed-circles"><i class="fa fa-check"></i><b>3.4.1</b> Sampling from a finite set of fixed circles</a></li>
<li class="chapter" data-level="3.4.2" data-path="SI.html"><a href="SI.html#sampling-from-an-infinite-set-of-floating-circles"><i class="fa fa-check"></i><b>3.4.2</b> Sampling from an infinite set of floating circles</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="STSI.html"><a href="STSI.html"><i class="fa fa-check"></i><b>4</b> Stratified simple random sampling</a>
<ul>
<li class="chapter" data-level="4.1" data-path="STSI.html"><a href="STSI.html#EstimatorsSTSI"><i class="fa fa-check"></i><b>4.1</b> Estimation of population parameters</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="STSI.html"><a href="STSI.html#population-proportion-cumulative-distribution-function-and-quantiles"><i class="fa fa-check"></i><b>4.1.1</b> Population proportion, cumulative distribution function and quantiles</a></li>
<li class="chapter" data-level="4.1.2" data-path="STSI.html"><a href="STSI.html#WhyStratify"><i class="fa fa-check"></i><b>4.1.2</b> Why should we stratify?</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="STSI.html"><a href="STSI.html#CISTSI"><i class="fa fa-check"></i><b>4.2</b> Confidence interval estimate</a></li>
<li class="chapter" data-level="4.3" data-path="STSI.html"><a href="STSI.html#STSIallocation"><i class="fa fa-check"></i><b>4.3</b> Allocation of sample size to strata</a></li>
<li class="chapter" data-level="4.4" data-path="STSI.html"><a href="STSI.html#cumrootf"><i class="fa fa-check"></i><b>4.4</b> <em>Cum-root-f</em> stratification</a></li>
<li class="chapter" data-level="4.5" data-path="STSI.html"><a href="STSI.html#kmeansstratification"><i class="fa fa-check"></i><b>4.5</b> Stratification with multiple covariates</a></li>
<li class="chapter" data-level="4.6" data-path="STSI.html"><a href="STSI.html#geostrata"><i class="fa fa-check"></i><b>4.6</b> Geographical stratification</a></li>
<li class="chapter" data-level="4.7" data-path="STSI.html"><a href="STSI.html#multi-way-stratification"><i class="fa fa-check"></i><b>4.7</b> Multi-way stratification</a></li>
<li class="chapter" data-level="4.8" data-path="STSI.html"><a href="STSI.html#MultivariateStratification"><i class="fa fa-check"></i><b>4.8</b> Multivariate stratification</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="SY.html"><a href="SY.html"><i class="fa fa-check"></i><b>5</b> Systematic random sampling</a>
<ul>
<li class="chapter" data-level="5.1" data-path="SY.html"><a href="SY.html#EstVarSY"><i class="fa fa-check"></i><b>5.1</b> Estimation of population parameters</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="SY.html"><a href="SY.html#approximating-the-sampling-variance-of-the-estimator-of-the-mean"><i class="fa fa-check"></i><b>5.1.1</b> Approximating the sampling variance of the estimator of the mean</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="Cl.html"><a href="Cl.html"><i class="fa fa-check"></i><b>6</b> Cluster random sampling</a>
<ul>
<li class="chapter" data-level="6.1" data-path="Cl.html"><a href="Cl.html#clustersamplingestimators"><i class="fa fa-check"></i><b>6.1</b> Estimation of population parameters</a></li>
<li class="chapter" data-level="6.2" data-path="Cl.html"><a href="Cl.html#clusters-selected-with-probabilities-proportional-to-size-without-replacement"><i class="fa fa-check"></i><b>6.2</b> Clusters selected with probabilities proportional to size, without replacement</a></li>
<li class="chapter" data-level="6.3" data-path="Cl.html"><a href="Cl.html#simple-random-sampling-of-clusters"><i class="fa fa-check"></i><b>6.3</b> Simple random sampling of clusters</a></li>
<li class="chapter" data-level="6.4" data-path="Cl.html"><a href="Cl.html#StratifiedCl"><i class="fa fa-check"></i><b>6.4</b> Stratified cluster random sampling</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="Twostage.html"><a href="Twostage.html"><i class="fa fa-check"></i><b>7</b> Two-stage cluster random sampling</a>
<ul>
<li class="chapter" data-level="7.1" data-path="Twostage.html"><a href="Twostage.html#twostagesamplingestimators"><i class="fa fa-check"></i><b>7.1</b> Estimation of population parameters</a></li>
<li class="chapter" data-level="7.2" data-path="Twostage.html"><a href="Twostage.html#primary-sampling-units-selected-with-probabilities-proportional-to-size-without-replacement"><i class="fa fa-check"></i><b>7.2</b> Primary sampling units selected with probabilities proportional to size, without replacement</a></li>
<li class="chapter" data-level="7.3" data-path="Twostage.html"><a href="Twostage.html#simple-random-sampling-of-primary-sampling-units"><i class="fa fa-check"></i><b>7.3</b> Simple random sampling of primary sampling units</a></li>
<li class="chapter" data-level="7.4" data-path="Twostage.html"><a href="Twostage.html#StratifiedTwostage"><i class="fa fa-check"></i><b>7.4</b> Stratified two-stage cluster random sampling</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="pps.html"><a href="pps.html"><i class="fa fa-check"></i><b>8</b> Sampling with probabilities proportional to size</a>
<ul>
<li class="chapter" data-level="8.1" data-path="pps.html"><a href="pps.html#ppswr"><i class="fa fa-check"></i><b>8.1</b> Probability-proportional-to-size sampling with replacement</a></li>
<li class="chapter" data-level="8.2" data-path="pps.html"><a href="pps.html#ppswor"><i class="fa fa-check"></i><b>8.2</b> Probability-proportional-to-size sampling without replacement</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="pps.html"><a href="pps.html#Systematicpps"><i class="fa fa-check"></i><b>8.2.1</b> Systematic pps sampling without replacement</a></li>
<li class="chapter" data-level="8.2.2" data-path="pps.html"><a href="pps.html#pivotalmethod"><i class="fa fa-check"></i><b>8.2.2</b> The pivotal method</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html"><i class="fa fa-check"></i><b>9</b> Balanced and well-spread sampling</a>
<ul>
<li class="chapter" data-level="9.1" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#Balanced"><i class="fa fa-check"></i><b>9.1</b> Balanced sampling</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#balanced-sample-versus-balanced-sampling-design"><i class="fa fa-check"></i><b>9.1.1</b> Balanced sample versus balanced sampling design</a></li>
<li class="chapter" data-level="9.1.2" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#unequal-inclusion-probabilities"><i class="fa fa-check"></i><b>9.1.2</b> Unequal inclusion probabilities</a></li>
<li class="chapter" data-level="9.1.3" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#StratifiedsamplingasBalancedsampling"><i class="fa fa-check"></i><b>9.1.3</b> Stratified random sampling</a></li>
<li class="chapter" data-level="9.1.4" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#Multiwaystratification"><i class="fa fa-check"></i><b>9.1.4</b> Multi-way stratification</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#Spreaded"><i class="fa fa-check"></i><b>9.2</b> Well-spread sampling</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#LPM"><i class="fa fa-check"></i><b>9.2.1</b> Local pivotal method</a></li>
<li class="chapter" data-level="9.2.2" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#GRTS"><i class="fa fa-check"></i><b>9.2.2</b> Generalised random-tessellation stratified sampling</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="BalancedSpreaded.html"><a href="BalancedSpreaded.html#BalancedandSpreaded"><i class="fa fa-check"></i><b>9.3</b> Balanced sampling with spreading</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="Modelassisted.html"><a href="Modelassisted.html"><i class="fa fa-check"></i><b>10</b> Model-assisted estimation</a>
<ul>
<li class="chapter" data-level="10.1" data-path="Modelassisted.html"><a href="Modelassisted.html#GREG"><i class="fa fa-check"></i><b>10.1</b> Generalised regression estimator</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="Modelassisted.html"><a href="Modelassisted.html#RegressionEstimator"><i class="fa fa-check"></i><b>10.1.1</b> Simple and multiple regression estimators</a></li>
<li class="chapter" data-level="10.1.2" data-path="Modelassisted.html"><a href="Modelassisted.html#penalised-least-squares-estimation"><i class="fa fa-check"></i><b>10.1.2</b> Penalised least squares estimation</a></li>
<li class="chapter" data-level="10.1.3" data-path="Modelassisted.html"><a href="Modelassisted.html#RegressionEstimatorSTSI"><i class="fa fa-check"></i><b>10.1.3</b> Regression estimator with stratified simple random sampling</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="Modelassisted.html"><a href="Modelassisted.html#RatioEstimator"><i class="fa fa-check"></i><b>10.2</b> Ratio estimator</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="Modelassisted.html"><a href="Modelassisted.html#RatioEstimatorSTSI"><i class="fa fa-check"></i><b>10.2.1</b> Ratio estimators with stratified simple random sampling</a></li>
<li class="chapter" data-level="10.2.2" data-path="Modelassisted.html"><a href="Modelassisted.html#PoststratifiedEstimator"><i class="fa fa-check"></i><b>10.2.2</b> Poststratified estimator</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="Modelassisted.html"><a href="Modelassisted.html#RandomForest"><i class="fa fa-check"></i><b>10.3</b> Model-assisted estimation using machine learning techniques</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="Modelassisted.html"><a href="Modelassisted.html#predicting-with-a-regression-tree"><i class="fa fa-check"></i><b>10.3.1</b> Predicting with a regression tree</a></li>
<li class="chapter" data-level="10.3.2" data-path="Modelassisted.html"><a href="Modelassisted.html#predicting-with-a-random-forest"><i class="fa fa-check"></i><b>10.3.2</b> Predicting with a random forest</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="Modelassisted.html"><a href="Modelassisted.html#big-data-and-volunteer-data"><i class="fa fa-check"></i><b>10.4</b> Big data and volunteer data</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="Twophase.html"><a href="Twophase.html"><i class="fa fa-check"></i><b>11</b> Two-phase random sampling</a>
<ul>
<li class="chapter" data-level="11.1" data-path="Twophase.html"><a href="Twophase.html#TwophaseStratification"><i class="fa fa-check"></i><b>11.1</b> Two-phase random sampling for stratification</a></li>
<li class="chapter" data-level="11.2" data-path="Twophase.html"><a href="Twophase.html#TwophaseRegression"><i class="fa fa-check"></i><b>11.2</b> Two-phase random sampling for regression</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html"><i class="fa fa-check"></i><b>12</b> Computing the required sample size</a>
<ul>
<li class="chapter" data-level="12.1" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#standard-error-of-estimator"><i class="fa fa-check"></i><b>12.1</b> Standard error of estimator</a></li>
<li class="chapter" data-level="12.2" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#ReqSampleSizeLengthCI"><i class="fa fa-check"></i><b>12.2</b> Length of confidence interval</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#length-of-confidence-interval-for-a-proportion"><i class="fa fa-check"></i><b>12.2.1</b> Length of confidence interval for a proportion</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#statistical-testing-of-hypothesis"><i class="fa fa-check"></i><b>12.3</b> Statistical testing of hypothesis</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#sample-size-for-testing-a-proportion"><i class="fa fa-check"></i><b>12.3.1</b> Sample size for testing a proportion</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#DesignEffect"><i class="fa fa-check"></i><b>12.4</b> Accounting for design effect</a></li>
<li class="chapter" data-level="12.5" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#BayesianSampleSize"><i class="fa fa-check"></i><b>12.5</b> Bayesian sample size determination</a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#bayesian-criteria-for-sample-size-computation"><i class="fa fa-check"></i><b>12.5.1</b> Bayesian criteria for sample size computation</a></li>
<li class="chapter" data-level="12.5.2" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#mixed-bayesian-likelihood-approach"><i class="fa fa-check"></i><b>12.5.2</b> Mixed Bayesian-likelihood approach</a></li>
<li class="chapter" data-level="12.5.3" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#estimation-of-population-mean"><i class="fa fa-check"></i><b>12.5.3</b> Estimation of population mean</a></li>
<li class="chapter" data-level="12.5.4" data-path="RequiredSampleSize.html"><a href="RequiredSampleSize.html#estimation-of-a-population-proportion"><i class="fa fa-check"></i><b>12.5.4</b> Estimation of a population proportion</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="MBpredictionofDesignVariance.html"><a href="MBpredictionofDesignVariance.html"><i class="fa fa-check"></i><b>13</b> Model-based optimisation of probability sampling designs</a>
<ul>
<li class="chapter" data-level="13.1" data-path="MBpredictionofDesignVariance.html"><a href="MBpredictionofDesignVariance.html#model-based-optimisation-of-sampling-design-type-and-sample-size"><i class="fa fa-check"></i><b>13.1</b> Model-based optimisation of sampling design type and sample size</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="MBpredictionofDesignVariance.html"><a href="MBpredictionofDesignVariance.html#AnalyticalApproach"><i class="fa fa-check"></i><b>13.1.1</b> Analytical approach</a></li>
<li class="chapter" data-level="13.1.2" data-path="MBpredictionofDesignVariance.html"><a href="MBpredictionofDesignVariance.html#GeostatisticalSimulationApproach"><i class="fa fa-check"></i><b>13.1.2</b> Geostatistical simulation approach</a></li>
<li class="chapter" data-level="13.1.3" data-path="MBpredictionofDesignVariance.html"><a href="MBpredictionofDesignVariance.html#MBpredSamplingVarBayes"><i class="fa fa-check"></i><b>13.1.3</b> Bayesian approach</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="MBpredictionofDesignVariance.html"><a href="MBpredictionofDesignVariance.html#Ospats"><i class="fa fa-check"></i><b>13.2</b> Model-based optimisation of spatial strata</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html"><i class="fa fa-check"></i><b>14</b> Sampling for estimating parameters of (small) domains</a>
<ul>
<li class="chapter" data-level="14.1" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#LargeDomainsDirectEstimator"><i class="fa fa-check"></i><b>14.1</b> Direct estimator for large domains</a></li>
<li class="chapter" data-level="14.2" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#SmallDomainsModelAssisted"><i class="fa fa-check"></i><b>14.2</b> Model-assisted estimators for small domains</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#RegressionestimatorSmallDomain"><i class="fa fa-check"></i><b>14.2.1</b> Regression estimator</a></li>
<li class="chapter" data-level="14.2.2" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#SyntheticestimatorSmallDomain"><i class="fa fa-check"></i><b>14.2.2</b> Synthetic estimator</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#SmallAreaModelBased"><i class="fa fa-check"></i><b>14.3</b> Model-based prediction</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#random-intercept-model"><i class="fa fa-check"></i><b>14.3.1</b> Random intercept model</a></li>
<li class="chapter" data-level="14.3.2" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#geostatistical-model"><i class="fa fa-check"></i><b>14.3.2</b> Geostatistical model</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="SmallAreaEstimation.html"><a href="SmallAreaEstimation.html#supplemental-probability-sampling-of-small-domains"><i class="fa fa-check"></i><b>14.4</b> Supplemental probability sampling of small domains</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html"><i class="fa fa-check"></i><b>15</b> Repeated sample surveys for monitoring population parameters</a>
<ul>
<li class="chapter" data-level="15.1" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#space-time-designs"><i class="fa fa-check"></i><b>15.1</b> Space-time designs</a></li>
<li class="chapter" data-level="15.2" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#SpaceTimeparameters"><i class="fa fa-check"></i><b>15.2</b> Space-time population parameters</a></li>
<li class="chapter" data-level="15.3" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#design-based-generalised-least-squares-estimation-of-spatial-means"><i class="fa fa-check"></i><b>15.3</b> Design-based generalised least squares estimation of spatial means</a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#current-mean"><i class="fa fa-check"></i><b>15.3.1</b> Current mean</a></li>
<li class="chapter" data-level="15.3.2" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#change-of-the-spatial-mean"><i class="fa fa-check"></i><b>15.3.2</b> Change of the spatial mean</a></li>
<li class="chapter" data-level="15.3.3" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#trend-of-the-spatial-mean"><i class="fa fa-check"></i><b>15.3.3</b> Trend of the spatial mean</a></li>
<li class="chapter" data-level="15.3.4" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#space-time-mean"><i class="fa fa-check"></i><b>15.3.4</b> Space-time mean</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#case-study-annual-mean-daily-temperature-in-spain"><i class="fa fa-check"></i><b>15.4</b> Case study: annual mean daily temperature in Spain</a>
<ul>
<li class="chapter" data-level="15.4.1" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#static-synchronous-design"><i class="fa fa-check"></i><b>15.4.1</b> Static-synchronous design</a></li>
<li class="chapter" data-level="15.4.2" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#independent-synchronous-design"><i class="fa fa-check"></i><b>15.4.2</b> Independent synchronous design</a></li>
<li class="chapter" data-level="15.4.3" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#serially-alternating-design"><i class="fa fa-check"></i><b>15.4.3</b> Serially alternating design</a></li>
<li class="chapter" data-level="15.4.4" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#supplemented-panel-design"><i class="fa fa-check"></i><b>15.4.4</b> Supplemented panel design</a></li>
<li class="chapter" data-level="15.4.5" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#rotating-panel-design"><i class="fa fa-check"></i><b>15.4.5</b> Rotating panel design</a></li>
</ul></li>
<li class="chapter" data-level="15.5" data-path="RepeatedSurveys.html"><a href="RepeatedSurveys.html#space-time-sampling-with-stratified-random-sampling-in-space"><i class="fa fa-check"></i><b>15.5</b> Space-time sampling with stratified random sampling in space</a></li>
</ul></li>
<li class="part"><span><b>II Sampling for mapping</b></span></li>
<li class="chapter" data-level="16" data-path="IntroSamplingforMapping.html"><a href="IntroSamplingforMapping.html"><i class="fa fa-check"></i><b>16</b> Introduction to sampling for mapping</a>
<ul>
<li class="chapter" data-level="16.1" data-path="IntroSamplingforMapping.html"><a href="IntroSamplingforMapping.html#when-is-probability-sampling-not-required"><i class="fa fa-check"></i><b>16.1</b> When is probability sampling not required?</a></li>
<li class="chapter" data-level="16.2" data-path="IntroSamplingforMapping.html"><a href="IntroSamplingforMapping.html#sampling-for-simultaneously-mapping-and-estimating-means"><i class="fa fa-check"></i><b>16.2</b> Sampling for simultaneously mapping and estimating means</a>
<ul>
<li class="chapter" data-level="16.2.1" data-path="IntroSamplingforMapping.html"><a href="IntroSamplingforMapping.html#balanced-stratified-random-sampling"><i class="fa fa-check"></i><b>16.2.1</b> Balanced stratified random sampling</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="IntroSamplingforMapping.html"><a href="IntroSamplingforMapping.html#broad-overview-of-sampling-designs-for-mapping"><i class="fa fa-check"></i><b>16.3</b> Broad overview of sampling designs for mapping</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="RegularGridSpatialCoverage.html"><a href="RegularGridSpatialCoverage.html"><i class="fa fa-check"></i><b>17</b> Regular grid and spatial coverage sampling</a>
<ul>
<li class="chapter" data-level="17.1" data-path="RegularGridSpatialCoverage.html"><a href="RegularGridSpatialCoverage.html#Regulargrid"><i class="fa fa-check"></i><b>17.1</b> Regular grid sampling</a></li>
<li class="chapter" data-level="17.2" data-path="RegularGridSpatialCoverage.html"><a href="RegularGridSpatialCoverage.html#SpatialCoverage"><i class="fa fa-check"></i><b>17.2</b> Spatial coverage sampling</a></li>
<li class="chapter" data-level="17.3" data-path="RegularGridSpatialCoverage.html"><a href="RegularGridSpatialCoverage.html#SpatialInfill"><i class="fa fa-check"></i><b>17.3</b> Spatial infill sampling</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="kmeans.html"><a href="kmeans.html"><i class="fa fa-check"></i><b>18</b> Covariate space coverage sampling</a>
<ul>
<li class="chapter" data-level="18.1" data-path="kmeans.html"><a href="kmeans.html#covariate-space-infill-sampling"><i class="fa fa-check"></i><b>18.1</b> Covariate space infill sampling</a></li>
<li class="chapter" data-level="18.2" data-path="kmeans.html"><a href="kmeans.html#PerformanceCSC"><i class="fa fa-check"></i><b>18.2</b> Performance of covariate space coverage sampling in random forest prediction</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="cLHS.html"><a href="cLHS.html"><i class="fa fa-check"></i><b>19</b> Conditioned Latin hypercube sampling</a>
<ul>
<li class="chapter" data-level="19.1" data-path="cLHS.html"><a href="cLHS.html#cLHIS"><i class="fa fa-check"></i><b>19.1</b> Conditioned Latin hypercube infill sampling</a></li>
<li class="chapter" data-level="19.2" data-path="cLHS.html"><a href="cLHS.html#performance-of-conditioned-latin-hypercube-sampling-in-random-forest-prediction"><i class="fa fa-check"></i><b>19.2</b> Performance of conditioned Latin hypercube sampling in random forest prediction</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="SpatialResponseSurface.html"><a href="SpatialResponseSurface.html"><i class="fa fa-check"></i><b>20</b> Spatial response surface sampling</a>
<ul>
<li class="chapter" data-level="20.1" data-path="SpatialResponseSurface.html"><a href="SpatialResponseSurface.html#IncreaseSampleSize"><i class="fa fa-check"></i><b>20.1</b> Increasing the sample size</a></li>
<li class="chapter" data-level="20.2" data-path="SpatialResponseSurface.html"><a href="SpatialResponseSurface.html#stratified-spatial-response-surface-sampling"><i class="fa fa-check"></i><b>20.2</b> Stratified spatial response surface sampling</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="Introkriging.html"><a href="Introkriging.html"><i class="fa fa-check"></i><b>21</b> Introduction to kriging</a>
<ul>
<li class="chapter" data-level="21.1" data-path="Introkriging.html"><a href="Introkriging.html#ordinary-kriging"><i class="fa fa-check"></i><b>21.1</b> Ordinary kriging</a></li>
<li class="chapter" data-level="21.2" data-path="Introkriging.html"><a href="Introkriging.html#BlockKriging"><i class="fa fa-check"></i><b>21.2</b> Block-kriging</a></li>
<li class="chapter" data-level="21.3" data-path="Introkriging.html"><a href="Introkriging.html#IntroKED"><i class="fa fa-check"></i><b>21.3</b> Kriging with an external drift</a></li>
<li class="chapter" data-level="21.4" data-path="Introkriging.html"><a href="Introkriging.html#VariogramEstimation"><i class="fa fa-check"></i><b>21.4</b> Estimating the semivariogram</a>
<ul>
<li class="chapter" data-level="21.4.1" data-path="Introkriging.html"><a href="Introkriging.html#MoM"><i class="fa fa-check"></i><b>21.4.1</b> Method-of-moments</a></li>
<li class="chapter" data-level="21.4.2" data-path="Introkriging.html"><a href="Introkriging.html#MLestimationVariogram"><i class="fa fa-check"></i><b>21.4.2</b> Maximum likelihood</a></li>
</ul></li>
<li class="chapter" data-level="21.5" data-path="Introkriging.html"><a href="Introkriging.html#ResidualVariogram"><i class="fa fa-check"></i><b>21.5</b> Estimating the residual semivariogram</a>
<ul>
<li class="chapter" data-level="21.5.1" data-path="Introkriging.html"><a href="Introkriging.html#IterativeMoM"><i class="fa fa-check"></i><b>21.5.1</b> Iterative method-of-moments</a></li>
<li class="chapter" data-level="21.5.2" data-path="Introkriging.html"><a href="Introkriging.html#REML"><i class="fa fa-check"></i><b>21.5.2</b> Restricted maximum likelihood</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="22" data-path="MBgridspacing.html"><a href="MBgridspacing.html"><i class="fa fa-check"></i><b>22</b> Model-based optimisation of the grid spacing</a>
<ul>
<li class="chapter" data-level="22.1" data-path="MBgridspacing.html"><a href="MBgridspacing.html#GridspacingOK"><i class="fa fa-check"></i><b>22.1</b> Optimal grid spacing for ordinary kriging</a></li>
<li class="chapter" data-level="22.2" data-path="MBgridspacing.html"><a href="MBgridspacing.html#controlling-the-mean-or-a-quantile-of-the-ordinary-kriging-variance"><i class="fa fa-check"></i><b>22.2</b> Controlling the mean or a quantile of the ordinary kriging variance</a></li>
<li class="chapter" data-level="22.3" data-path="MBgridspacing.html"><a href="MBgridspacing.html#optimal-grid-spacing-for-block-kriging"><i class="fa fa-check"></i><b>22.3</b> Optimal grid spacing for block-kriging</a></li>
<li class="chapter" data-level="22.4" data-path="MBgridspacing.html"><a href="MBgridspacing.html#MBgridspacingKED"><i class="fa fa-check"></i><b>22.4</b> Optimal grid spacing for kriging with an external drift</a></li>
<li class="chapter" data-level="22.5" data-path="MBgridspacing.html"><a href="MBgridspacing.html#BayesianGridSpacing"><i class="fa fa-check"></i><b>22.5</b> Bayesian approach</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="MBSamplePattern.html"><a href="MBSamplePattern.html"><i class="fa fa-check"></i><b>23</b> Model-based optimisation of the sampling pattern</a>
<ul>
<li class="chapter" data-level="23.1" data-path="MBSamplePattern.html"><a href="MBSamplePattern.html#SSA"><i class="fa fa-check"></i><b>23.1</b> Spatial simulated annealing</a></li>
<li class="chapter" data-level="23.2" data-path="MBSamplePattern.html"><a href="MBSamplePattern.html#SamplePatternOK"><i class="fa fa-check"></i><b>23.2</b> Optimising the sampling pattern for ordinary kriging</a></li>
<li class="chapter" data-level="23.3" data-path="MBSamplePattern.html"><a href="MBSamplePattern.html#SamplePatternKED"><i class="fa fa-check"></i><b>23.3</b> Optimising the sampling pattern for kriging with an external drift</a></li>
<li class="chapter" data-level="23.4" data-path="MBSamplePattern.html"><a href="MBSamplePattern.html#model-based-infill-sampling"><i class="fa fa-check"></i><b>23.4</b> Model-based infill sampling</a>
<ul>
<li class="chapter" data-level="23.4.1" data-path="MBSamplePattern.html"><a href="MBSamplePattern.html#model-based-infill-sampling-for-kriging-with-an-external-drift"><i class="fa fa-check"></i><b>23.4.1</b> Model-based infill sampling for kriging with an external drift</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="24" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html"><i class="fa fa-check"></i><b>24</b> Sampling for estimating the semivariogram</a>
<ul>
<li class="chapter" data-level="24.1" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#nested-sampling"><i class="fa fa-check"></i><b>24.1</b> Nested sampling</a></li>
<li class="chapter" data-level="24.2" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#independent-sampling-of-pairs-of-points"><i class="fa fa-check"></i><b>24.2</b> Independent sampling of pairs of points</a></li>
<li class="chapter" data-level="24.3" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#samplingforvariogram"><i class="fa fa-check"></i><b>24.3</b> Optimisation of sampling pattern for semivariogram estimation</a>
<ul>
<li class="chapter" data-level="24.3.1" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#UncertainSemivariogramParameters"><i class="fa fa-check"></i><b>24.3.1</b> Uncertainty about semivariogram parameters</a></li>
<li class="chapter" data-level="24.3.2" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#UncertainKrigingVariance"><i class="fa fa-check"></i><b>24.3.2</b> Uncertainty about the kriging variance</a></li>
</ul></li>
<li class="chapter" data-level="24.4" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#SamplingEstimationandPrediction"><i class="fa fa-check"></i><b>24.4</b> Optimisation of sampling pattern for semivariogram estimation and mapping</a></li>
<li class="chapter" data-level="24.5" data-path="SamplingVariogram.html"><a href="SamplingVariogram.html#a-practical-solution"><i class="fa fa-check"></i><b>24.5</b> A practical solution</a></li>
</ul></li>
<li class="chapter" data-level="25" data-path="Validation.html"><a href="Validation.html"><i class="fa fa-check"></i><b>25</b> Sampling for validation of maps</a>
<ul>
<li class="chapter" data-level="25.1" data-path="Validation.html"><a href="Validation.html#map-quality-indices"><i class="fa fa-check"></i><b>25.1</b> Map quality indices</a>
<ul>
<li class="chapter" data-level="25.1.1" data-path="Validation.html"><a href="Validation.html#estimation-of-map-quality-indices"><i class="fa fa-check"></i><b>25.1.1</b> Estimation of map quality indices</a></li>
</ul></li>
<li class="chapter" data-level="25.2" data-path="Validation.html"><a href="Validation.html#real-world-case-study"><i class="fa fa-check"></i><b>25.2</b> Real-world case study</a>
<ul>
<li class="chapter" data-level="25.2.1" data-path="Validation.html"><a href="Validation.html#estimation-of-the-population-mean-error-and-mean-squared-error"><i class="fa fa-check"></i><b>25.2.1</b> Estimation of the population Mean Error and Mean Squared Error</a></li>
<li class="chapter" data-level="25.2.2" data-path="Validation.html"><a href="Validation.html#estimation-of-the-standard-error-of-the-estimated-population-me-and-mse"><i class="fa fa-check"></i><b>25.2.2</b> Estimation of the standard error of the estimated population ME and MSE</a></li>
<li class="chapter" data-level="25.2.3" data-path="Validation.html"><a href="Validation.html#estimation-of-mec"><i class="fa fa-check"></i><b>25.2.3</b> Estimation of MEC</a></li>
<li class="chapter" data-level="25.2.4" data-path="Validation.html"><a href="Validation.html#statistical-testing-of-hypothesis-about-population-me-and-mse"><i class="fa fa-check"></i><b>25.2.4</b> Statistical testing of hypothesis about population ME and MSE</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="26" data-path="Approaches.html"><a href="Approaches.html"><i class="fa fa-check"></i><b>26</b> Design-based, model-based and model-assisted approach for sampling and inference</a>
<ul>
<li class="chapter" data-level="26.1" data-path="Approaches.html"><a href="Approaches.html#two-sources-of-randomness"><i class="fa fa-check"></i><b>26.1</b> Two sources of randomness</a></li>
<li class="chapter" data-level="26.2" data-path="Approaches.html"><a href="Approaches.html#iid"><i class="fa fa-check"></i><b>26.2</b> “Identically and independently distributed” (i.i.d.)</a></li>
<li class="chapter" data-level="26.3" data-path="Approaches.html"><a href="Approaches.html#BiasandVariance"><i class="fa fa-check"></i><b>26.3</b> Bias and variance</a></li>
<li class="chapter" data-level="26.4" data-path="Approaches.html"><a href="Approaches.html#effectivesamplesize"><i class="fa fa-check"></i><b>26.4</b> Effective sample size</a></li>
<li class="chapter" data-level="26.5" data-path="Approaches.html"><a href="Approaches.html#ExploitSpatialStructure"><i class="fa fa-check"></i><b>26.5</b> Exploiting spatial structure in design-based approach</a></li>
<li class="chapter" data-level="26.6" data-path="Approaches.html"><a href="Approaches.html#ModelassistedvsModeldependent"><i class="fa fa-check"></i><b>26.6</b> Model-assisted versus model-dependent</a></li>
</ul></li>
<li class="appendix"><span><b>Appendices</b></span></li>
<li class="chapter" data-level="A" data-path="Answers.html"><a href="Answers.html"><i class="fa fa-check"></i><b>A</b> Answers to exercises</a>
<ul>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#introduction-to-probability-sampling"><i class="fa fa-check"></i>Introduction to probability sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#simple-random-sampling"><i class="fa fa-check"></i>Simple random sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#stratified-random-sampling"><i class="fa fa-check"></i>Stratified random sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#systematic-random-sampling"><i class="fa fa-check"></i>Systematic random sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#cluster-random-sampling"><i class="fa fa-check"></i>Cluster random sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#two-stage-random-sampling"><i class="fa fa-check"></i>Two-stage random sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#sampling-with-probabilities-proportional-to-size"><i class="fa fa-check"></i>Sampling with probabilities proportional to size</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#balanced-and-well-spread-sampling"><i class="fa fa-check"></i>Balanced and well-spread sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#model-assisted-estimation"><i class="fa fa-check"></i>Model-assisted estimation</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#two-phase-random-sampling"><i class="fa fa-check"></i>Two-phase random sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#computing-the-required-sample-size"><i class="fa fa-check"></i>Computing the required sample size</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#model-based-optimisation-of-probability-sampling-designs"><i class="fa fa-check"></i>Model-based optimisation of probability sampling designs</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#repeated-sample-surveys-for-monitoring-population-parameters"><i class="fa fa-check"></i>Repeated sample surveys for monitoring population parameters</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#regular-grid-and-spatial-coverage-sampling"><i class="fa fa-check"></i>Regular grid and spatial coverage sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#covariate-space-coverage-sampling"><i class="fa fa-check"></i>Covariate space coverage sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#conditioned-latin-hypercube-sampling"><i class="fa fa-check"></i>Conditioned Latin hypercube sampling</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#model-based-optimisation-of-the-grid-spacing"><i class="fa fa-check"></i>Model-based optimisation of the grid spacing</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#model-based-optimisation-of-the-sampling-pattern"><i class="fa fa-check"></i>Model-based optimisation of the sampling pattern</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#sampling-for-estimating-the-semivariogram"><i class="fa fa-check"></i>Sampling for estimating the semivariogram</a></li>
<li class="chapter" data-level="" data-path="Answers.html"><a href="Answers.html#sampling-for-validation-of-maps"><i class="fa fa-check"></i>Sampling for validation of maps</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/DickBrus/">Dick Brus</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Spatial sampling with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="MBpredictionofDesignVariance" class="section level1" number="13">
<h1><span class="header-section-number">Chapter 13</span> Model-based optimisation of probability sampling designs</h1>
<p>In Chapter <a href="Modelassisted.html#Modelassisted">10</a> on model-assisted estimation I explained how a linear regression model or a non-linear model obtained with a machine learning algorithm, can be used to increase the precision of design-based estimates of the population mean or total using the data collected by a given probability sampling design. In this chapter I explain how a model of the study variable can be used at an earlier stage, to optimise probability sampling designs. I show how a model can be used to choose between alternative sampling design types, for instance between systematic random sampling spreading out the sampling units throughout the study area, and two-stage cluster random sampling resulting in spatial clusters of samplng units. Besides I explain how a model can be used to optimise the sample size of a given sampling design type, for instance, the number of primary and secondary units with two-stage cluster random sampling. The final section of this chapter is about how a model can be used to optimise spatial strata for stratified simple random sampling.</p>
<p>The models used in this chapter are all geostatistical models of the spatial variation. Chapter <a href="Introkriging.html#Introkriging">21</a> is an introduction to geostatistical modelling. Several geostatistical concepts explained in that chapter are needed here to predict the sampling variance.</p>
<p>A general geostatistical model of the spatial variation is</p>
<p><span class="math display" id="eq:geostatmodel">\[\begin{equation}
\begin{split}
Z(\mathbf{s}) &amp;= \mu(\mathbf{s}) + \epsilon(\mathbf{s}) \\
\epsilon(\mathbf{s}) &amp;\sim \mathcal{N}(0,\sigma^2) \\
\mathrm{Cov}(\epsilon(\mathbf{s}),\epsilon(\mathbf{s}^{\prime})) &amp;= C(\mathbf{h}) 
\end{split}
\;,
\tag{13.1}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(Z(\mathbf{s})\)</span> the study variable at location <span class="math inline">\(\mathbf{s}\)</span>, <span class="math inline">\(\mu(\mathbf{s})\)</span> the mean at location <span class="math inline">\(\mathbf{s}\)</span>, <span class="math inline">\(\epsilon(\mathbf{s})\)</span> the residual at location <span class="math inline">\(\mathbf{s}\)</span>, and <span class="math inline">\(C(\mathbf{h})\)</span> the covariance of the residuals at two locations separated by vector <span class="math inline">\(\mathbf{h} = \mathbf{s}-\mathbf{s}^{\prime}\)</span>. Note that contrary to the mean <span class="math inline">\(\mu\)</span> the variance of the residuals <span class="math inline">\(\sigma^2\)</span> is assumed constant.</p>
<p>The model of the spatial variation has several parameters. In case of a model in which the mean is a linear combination of covariates, these are the regression coefficients associated with the covariates, and the parameters of a semivariogram describing the spatial dependence of the residuals. A semivariogram is a model for half the expectation of the squared difference of the study variable or the residuals of a model at two locations, referred to as the semivariance, as a function of the length (and direction) of the vector separating the two locations (Chapter <a href="Introkriging.html#Introkriging">21</a>).</p>
<p>Use of the model for prediction of the sampling variance of a design-based estimator of the population mean requires prior knowledge of the semivariogram. When data are available collected from the study area of interest, these data can be used to choose a semivariogram model and estimate the parameters of the model. If no such data are available, we must make a best guess, based on data collected in other areas. In all cases I recommend to keep the model as simple as possible.</p>
<div id="model-based-optimisation-of-sampling-design-type-and-sample-size" class="section level2" number="13.1">
<h2><span class="header-section-number">13.1</span> Model-based optimisation of sampling design type and sample size</h2>
<p>In Chapter <a href="RequiredSampleSize.html#RequiredSampleSize">12</a> I presented methods and formulas for computing the required sample size given various measures to quantify the quality of the survey result. These required sample sizes are for simple random sampling. For other types of sampling design, the required sample size can be approximated by multiplying the required sample size for simple random sampling with the design effect, see Section <a href="RequiredSampleSize.html#DesignEffect">12.4</a>. An alternative is to use a model of the spatial variation to predict the sampling variance of the estimator of the mean for the type of sampling design under study and a range of sample sizes, plotting the predicted variance (or standard error) against the sample size, and using this plot inversely to derive the required sample size given a constraint on the sampling variance (standard error).</p>
<p>The computed required sample size applies to several given parameters of the sampling design. For instance, for stratified random sampling the sample size is computed for a given stratification and sample size allocation scheme, for cluster random sampling for given clusters, and for two-stage cluster random sampling for given primary sampling units (psu’s) and number of secondary sampling units selected per PSU draw. However, the model can also be used to optimise these sampling design parameters. For stratified random sampling the optimal allocation can be computed by predicting the population variances within strata and using the predicted population variances per stratum in Equation <a href="STSI.html#eq:optallocation">(4.17)</a>, and even the stratification can be optimised (Section <a href="MBpredictionofDesignVariance.html#Ospats">13.2</a>)). If we have a cost model, for cluster random sampling the size and shape of the clusters can be optimised, and for two-stage cluster random sampling the number of PSU draws and number of SSUs per PSU draw can be optimised.</p>
<p>Model-based prediction of the sampling variance can also be useful to compare alternative types of sampling design at equal total costs or equal variances of the estimated population mean or total. For instance, to compare systematic random sampling, leading to good spatial coverage, and two-stage cluster random sampling, resulting in spatial clusters of observations.</p>
<p>Three approaches for model-based prediction of the sampling variance of a design-based estimator of the population mean (or total) are described, the analytical approach (Section <a href="MBpredictionofDesignVariance.html#AnalyticalApproach">13.1.1</a>), the geostatistical simulation approach (Section <a href="MBpredictionofDesignVariance.html#GeostatisticalSimulationApproach">13.1.2</a>) and the Bayesian approach (Section <a href="MBpredictionofDesignVariance.html#MBpredSamplingVarBayes">13.1.3</a>). In the analytical approach we assume that the mean, <span class="math inline">\(\mu(\mathbf{s})\)</span> in Equation <a href="MBpredictionofDesignVariance.html#eq:geostatmodel">(13.1)</a>, is everywhere the same. This assumption is relaxed in the geostatistical simulation approach. This approach can also be used to predict the sampling variance using a model in which the mean is a linear combination of covariates and/or spatial coordinates, and to predict the sampling variance of the estimator of the mean of trans-Gaussian variables, i.e. random variables that can be transformed to a Gaussian variable.</p>
<p>The predicted sampling variances of the estimated population mean obtained with the analytical and geostatistical simulation approach are conditional on the model of the spatial variation. Uncertainty about this model is not accounted for. On the contrary, in the Bayesian approach we do account for our uncertainty about the assumed model, and we analyse how this uncertainty propagates to the sampling variance of the estimator of the mean.</p>
<div id="AnalyticalApproach" class="section level3" number="13.1.1">
<h3><span class="header-section-number">13.1.1</span> Analytical approach</h3>
<p>In the analytical approach the sampling variance of the estimator of the mean is derived from mean semivariances within the study area and mean semivariances within the sample. Assuming isotropy, these mean semivariances are a function of the separation distance between pairs of points.</p>
<p>The sampling variance of a design-based estimator of the population mean can be predicted by (<span class="citation"><a href="#ref-dom94" role="doc-biblioref">Domburg, de Gruijter, and Brus</a> (<a href="#ref-dom94" role="doc-biblioref">1994</a>)</span>, <span class="citation"><a href="#ref-gru06" role="doc-biblioref">de Gruijter et al.</a> (<a href="#ref-gru06" role="doc-biblioref">2006</a>)</span>)</p>
<p><span class="math display" id="eq:MBdesignvarAnydesign">\[\begin{equation}
E_{\xi}\{V_p(\hat{\bar{z}})\}=\bar{\gamma}-E_p(\pmb{\lambda}^{\prime}\pmb{\Gamma}_{\mathcal{S}}\pmb{\lambda}) \;,
\tag{13.2}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(E_{\xi}(\cdot)\)</span> is the statistical expectation over realisations from the model <span class="math inline">\(\xi\)</span>, <span class="math inline">\(E_{p}(\cdot)\)</span> is the statistical expectation over repeated sampling with sampling design <span class="math inline">\(p\)</span>, <span class="math inline">\(V_{p}(\hat{\bar{z}})\)</span> is the variance of the estimator of the population mean over repeated sampling with sampling design <span class="math inline">\(p\)</span>, <span class="math inline">\(\bar{\gamma}\)</span> is the mean semivariance of the random variable at two randomly selected locations in the study area, <span class="math inline">\(\pmb{\lambda}\)</span> is the vector of design-based weights of the units of a sample selected with design <span class="math inline">\(p\)</span>, and <span class="math inline">\(\pmb{\Gamma}_{\mathcal{S}}\)</span> is the matrix of semivariances between the units of a sample <span class="math inline">\(\mathcal{S}\)</span> selected with design <span class="math inline">\(p\)</span>.</p>
<p>The mean semivariance <span class="math inline">\(\bar{\gamma}\)</span> is a model-based prediction of the population variance (spatial variance), i.e. the model-expectation of the population variance:</p>
<p><span class="math display" id="eq:meansemivariance">\[\begin{equation}
\bar{\gamma} = E_{\xi}\{\sigma^2(z)\}\:.
\tag{13.3}
\end{equation}\]</span></p>
<p>The mean semivariance <span class="math inline">\(\bar{\gamma}\)</span> can be calculated by discretising the study area by a fine square grid, and computing the matrix with geographical distances between the discretisation nodes, transforming this into a semivariance matrix, and computing the average of all elements of the semivariance matrix. The second term <span class="math inline">\(E_p(\pmb{\lambda}^{\prime}\pmb{\Gamma}_{\mathcal{S}}\pmb{\lambda})\)</span> can be evaluated by Monte-Carlo simulation, repeatedly selecting a sample according to design <span class="math inline">\(p\)</span>, calculating <span class="math inline">\(\pmb{\lambda}^{\prime}\pmb{\Gamma}_{\mathcal{S}}\pmb{\lambda}\)</span>, and averaging.</p>

<div class="rmdnote">
The semivariance at zero distance (same location) is 0, so on the diagonal of a semivariance matrix we have zeroes. If a semivariogram with nugget is assumed, these zeroes on the diagonal must be replaced by the nugget to compute <span class="math inline">\(\bar{\gamma}\)</span>. The same holds for the diagonal zeroes in <span class="math inline">\(\pmb{\Gamma}_{\mathcal{S}}\)</span>.
</div>
<p>This generic procedure is still computationally demanding, but it is the only option for complex spatial sampling designs. For basic sampling designs the general formula can be worked out. For simple random sampling, the sampling variance can be predicted by</p>
<p><span class="math display" id="eq:MBdesignvarSI">\[\begin{equation}
E_{\xi}\{V_\mathrm{SI}(\hat{\bar{z}})\}=\bar{\gamma }/n \;,
\tag{13.4}
\end{equation}\]</span></p>
<p>and for stratified simple random sampling by</p>
<p><span class="math display" id="eq:MBdesignvarSTSI">\[\begin{equation}
E_{\xi}\{V_\mathrm{STSI}(\hat{\bar{z}})\}=\sum_{h=1}^H w^2_h \bar{\gamma_h}/n_h \;,
\tag{13.5}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(H\)</span> the number of strata, <span class="math inline">\(w_h\)</span> the stratum weight (relative size), <span class="math inline">\(\bar{\gamma}_h\)</span> the mean semivariance of stratum <span class="math inline">\(h\)</span>, and <span class="math inline">\(n_h\)</span> the number of sampling units of stratum <span class="math inline">\(h\)</span>.</p>

<div class="rmdnote">
The model-based predictions of the variances within the strata, <span class="math inline">\(\bar{\gamma}_h\)</span>, can also be used to compute the sample sizes for Neyman allocation, which are the optimal sample sizes when the mean costs per unit are equal for the strata. To compute these sample sizes the standard deviations <span class="math inline">\(S_h(z)\)</span> in Equation <a href="STSI.html#eq:Neymanallocation">(4.16)</a> are replaced by <span class="math inline">\(\sqrt{\bar{\gamma}_h}\)</span>.
</div>
<p>For systematic random sampling (sampling on a randomly placed grid), the variance can be predicted by</p>
<p><span class="math display" id="eq:MBdesignvarSY">\[\begin{equation}
E_{\xi}\{V_\mathrm{SY}(\hat{\bar{z}})\}=\bar{\gamma} - E_{\mathrm{SY}}(\bar{\gamma}_{\mathrm{SY}}) \;,
\tag{13.6}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(E_{\mathrm{SY}}(\bar{\gamma}_{\mathrm{SY}})\)</span> the design-expectation, i.e. the expectation over repeated systematic sampling, of the mean semivariance within the systematic sample (grid). With systematic random sampling the number of grid points within the study area can vary among samples, as well as the spatial pattern of the points (Chapter <a href="SY.html#SY">5</a>). Therefore multiple systematic random samples must be selected, and the average of the mean semivariance within the systematic sample must be computed.</p>
<p>The analytical approach is illustrated with the data of agricultural field Leest <span class="citation">(<a href="#ref-HofmanBrus2021" role="doc-biblioref">Hofman and Brus 2021</a>)</span>. Nitrate-N (NO3-N) in kg/ha in the layer 0 - 90 cm, using a standard soil density of 1500 kg/m<span class="math inline">\(^3\)</span>, is measured at 30 points. These data are used to compute a sample semivariogram using the method-of-moments with function <code>variogram</code>, see Chapter <a href="Introkriging.html#Introkriging">21</a>. A spherical model without nugget is fitted to the sample semivariogram using function <code>fit.variogram</code>. The numbers in this plot are the numbers of pairs of points used to compute the semivariances.</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="MBpredictionofDesignVariance.html#cb344-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gstat)</span>
<span id="cb344-2"><a href="MBpredictionofDesignVariance.html#cb344-2" aria-hidden="true" tabindex="-1"></a>mydata <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/Leest05.csv&quot;</span>)</span>
<span id="cb344-3"><a href="MBpredictionofDesignVariance.html#cb344-3" aria-hidden="true" tabindex="-1"></a><span class="fu">coordinates</span>(mydata) <span class="ot">&lt;-</span> <span class="er">~</span>Easting<span class="sc">+</span>Northing</span>
<span id="cb344-4"><a href="MBpredictionofDesignVariance.html#cb344-4" aria-hidden="true" tabindex="-1"></a>vg <span class="ot">&lt;-</span> <span class="fu">variogram</span>(N<span class="sc">~</span><span class="dv">1</span>, <span class="at">data=</span>mydata)</span>
<span id="cb344-5"><a href="MBpredictionofDesignVariance.html#cb344-5" aria-hidden="true" tabindex="-1"></a>vgm_MoM <span class="ot">&lt;-</span> <span class="fu">fit.variogram</span>(vg, <span class="at">model=</span><span class="fu">vgm</span>(<span class="at">model=</span><span class="st">&quot;Sph&quot;</span>, <span class="at">psill=</span><span class="dv">2000</span>, <span class="at">range=</span><span class="dv">20</span>))</span>
<span id="cb344-6"><a href="MBpredictionofDesignVariance.html#cb344-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(vg, vgm_MoM, <span class="at">plot.numbers=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:VariogramLeest"></span>
<img src="SpatialSampling_files/figure-html/VariogramLeest-1.png" alt="Sample semivariogram and fitted spherical model for NO3-N in agricultural field Leest. Numbers are numbers of pairs used in computing semivariances." width="80%" />
<p class="caption">
Figure 13.1: Sample semivariogram and fitted spherical model for NO3-N in agricultural field Leest. Numbers are numbers of pairs used in computing semivariances.
</p>
</div>
<p>The few data makes that the sample semivariogram is very noisy. For the moment I ignore my uncertainty about the semivariogram parameters; in Section <a href="MBpredictionofDesignVariance.html#MBpredSamplingVarBayes">13.1.3</a> I show how we can account for our uncertainty about the semivariogram parameters in model-based prediction of the sampling variance. A spherical semivariogram model without nugget is fitted to the sample semivariogram, i.e. the intercept is 0. The fitted range of the model is 45 m, and the fitted sill equals 966. The fitted semivariogram is used to predict the sampling variance for three sampling designs: simple random sampling, stratified simple random sampling, and systematic random sampling. The costs for these three design types will be about equal, as the study area is small, so that the access time of the sampling points selected with the three designs is about equal. The sample size is 25 points. For systematic random sampling the number of points varies among the samples. For this sampling design the <em>expected</em> sample size is 25 points.</p>
<p>For simple random sampling we must compute the mean semivariance within the field (Equation <a href="MBpredictionofDesignVariance.html#eq:MBdesignvarSI">(13.4)</a>). This mean semivariance is approximated by discretising the field by a square grid of 2000 points, computing the 2000 <span class="math inline">\(\times\)</span> 2000 matrix with distances between all pairs of discretisation nodes, transforming this distance matrix into a semivariance matrix using function <code>variogramLine</code> of package <strong>gstat</strong> <span class="citation">(<a href="#ref-peb04" role="doc-biblioref">Pebesma 2004</a>)</span> , and finally averaging the semivariances. Note that in this case we do not need to replace the zeroes on the diagonal of the semivariance matrix by the nugget, as a model without nugget is fitted. The shape file is read with function <code>readOGR</code> of package <strong>rgdal</strong> <span class="citation">(<a href="#ref-rgdal" role="doc-biblioref">R. Bivand, Keitt, and Rowlingson 2020</a>)</span>, resulting in an object of class <code>SpatialPolygonsDataFrame</code>. The projection attributes of this object are removed with function <code>proj4string</code> to avoid an error message when running function <code>spsample</code>.</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="MBpredictionofDesignVariance.html#cb345-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb345-2"><a href="MBpredictionofDesignVariance.html#cb345-2" aria-hidden="true" tabindex="-1"></a>shpField <span class="ot">&lt;-</span> <span class="fu">readOGR</span>(<span class="at">dsn=</span><span class="st">&quot;data&quot;</span>, <span class="at">layer=</span><span class="st">&quot;Leest5&quot;</span>, <span class="at">verbose=</span><span class="cn">FALSE</span>)</span>
<span id="cb345-3"><a href="MBpredictionofDesignVariance.html#cb345-3" aria-hidden="true" tabindex="-1"></a><span class="fu">proj4string</span>(shpField) <span class="ot">&lt;-</span> <span class="cn">NA_character_</span></span>
<span id="cb345-4"><a href="MBpredictionofDesignVariance.html#cb345-4" aria-hidden="true" tabindex="-1"></a>mygrid <span class="ot">&lt;-</span> <span class="fu">spsample</span>(shpField, <span class="at">type=</span><span class="st">&quot;regular&quot;</span>, <span class="at">n=</span><span class="dv">2000</span>, <span class="at">offset=</span><span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb345-5"><a href="MBpredictionofDesignVariance.html#cb345-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as</span>(., <span class="st">&quot;data.frame&quot;</span>)</span>
<span id="cb345-6"><a href="MBpredictionofDesignVariance.html#cb345-6" aria-hidden="true" tabindex="-1"></a>H <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">dist</span>(mygrid))</span>
<span id="cb345-7"><a href="MBpredictionofDesignVariance.html#cb345-7" aria-hidden="true" tabindex="-1"></a>G <span class="ot">&lt;-</span> <span class="fu">variogramLine</span>(vgm_MoM, <span class="at">dist_vector=</span>H)</span>
<span id="cb345-8"><a href="MBpredictionofDesignVariance.html#cb345-8" aria-hidden="true" tabindex="-1"></a>m_semivar_field <span class="ot">&lt;-</span> <span class="fu">mean</span>(G)</span>
<span id="cb345-9"><a href="MBpredictionofDesignVariance.html#cb345-9" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">25</span></span>
<span id="cb345-10"><a href="MBpredictionofDesignVariance.html#cb345-10" aria-hidden="true" tabindex="-1"></a>Exi_V_SI <span class="ot">&lt;-</span> m_semivar_field<span class="sc">/</span>n</span></code></pre></div>
<p>The model-based prediction of the sampling variance of the estimator of the mean with this design equals 35.</p>
<p>The strata of the stratified simple random sampling design are compact geographical strata of equal size (Section <a href="STSI.html#geostrata">4.6</a>). The number of geostrata is equal to the sample size, 25 points, so that we have one point per stratum. With this design the sampling points are reasonably well spread out over the field, but not as good as with systematic random sampling. To predict the sampling variance we must compute the mean semivariances within the geostrata, see Equation <a href="MBpredictionofDesignVariance.html#eq:MBdesignvarSTSI">(13.5)</a>. Note that the stratum weights are constant as the strata have equal size: <span class="math inline">\(w_h = 1/n\)</span>, and as <span class="math inline">\(n_h=1\)</span> Equation <a href="MBpredictionofDesignVariance.html#eq:MBdesignvarSTSI">(13.5)</a> reduces to</p>
<p><span class="math display" id="eq:MBdesignvarSTSI2">\[\begin{equation}
E_{\xi}\{V_\mathrm{STSI}(\hat{\bar{z}})\}=\frac{1}{n^2}\sum_{h=1}^H \bar{\gamma_h} \;,
\tag{13.7}
\end{equation}\]</span></p>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="MBpredictionofDesignVariance.html#cb346-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spcosa)</span>
<span id="cb346-2"><a href="MBpredictionofDesignVariance.html#cb346-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gridded</span>(mygrid) <span class="ot">&lt;-</span> <span class="er">~</span>x1<span class="sc">+</span>x2</span>
<span id="cb346-3"><a href="MBpredictionofDesignVariance.html#cb346-3" aria-hidden="true" tabindex="-1"></a>mygeostrata <span class="ot">&lt;-</span> <span class="fu">stratify</span>(mygrid, <span class="at">nStrata=</span>n, <span class="at">equalArea=</span><span class="cn">TRUE</span>, <span class="at">nTry=</span><span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb346-4"><a href="MBpredictionofDesignVariance.html#cb346-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as</span>(., <span class="st">&quot;data.frame&quot;</span>)</span>
<span id="cb346-5"><a href="MBpredictionofDesignVariance.html#cb346-5" aria-hidden="true" tabindex="-1"></a>m_semivar_geostrata <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="at">length=</span>n)</span>
<span id="cb346-6"><a href="MBpredictionofDesignVariance.html#cb346-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb346-7"><a href="MBpredictionofDesignVariance.html#cb346-7" aria-hidden="true" tabindex="-1"></a> ids <span class="ot">&lt;-</span> <span class="fu">which</span>(mygeostrata<span class="sc">$</span>stratumId<span class="sc">==</span>(i<span class="dv">-1</span>))</span>
<span id="cb346-8"><a href="MBpredictionofDesignVariance.html#cb346-8" aria-hidden="true" tabindex="-1"></a> mysubgrd <span class="ot">&lt;-</span> mygeostrata[ids,]</span>
<span id="cb346-9"><a href="MBpredictionofDesignVariance.html#cb346-9" aria-hidden="true" tabindex="-1"></a> H_geostratum <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">dist</span>(mysubgrd[,<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>)]))</span>
<span id="cb346-10"><a href="MBpredictionofDesignVariance.html#cb346-10" aria-hidden="true" tabindex="-1"></a> G_geostratum <span class="ot">&lt;-</span> <span class="fu">variogramLine</span>(vgm_MoM, <span class="at">dist_vector=</span>H_geostratum)</span>
<span id="cb346-11"><a href="MBpredictionofDesignVariance.html#cb346-11" aria-hidden="true" tabindex="-1"></a> m_semivar_geostrata[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(G_geostratum)</span>
<span id="cb346-12"><a href="MBpredictionofDesignVariance.html#cb346-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb346-13"><a href="MBpredictionofDesignVariance.html#cb346-13" aria-hidden="true" tabindex="-1"></a>Exi_V_STSI <span class="ot">&lt;-</span> <span class="fu">sum</span>(m_semivar_geostrata)<span class="sc">/</span>n<span class="sc">^</span><span class="dv">2</span></span></code></pre></div>
<p>The model-based prediction of the sampling variance of the estimator of the mean with this design equals 13.6, which is much smaller than with simple random sampling. The large stratification effect can be explained by the assumed strong spatial structure of NO3-N in the agricultural field and the improved geographical spreading of the sampling points, see Figure <a href="MBpredictionofDesignVariance.html#fig:VariogramLeest">13.1</a>.</p>
<p>To predict the sampling variance for systematic random sampling with an expected sample size of 25 points, we must compute the design-expectation of the mean semivariance within the systematic sample (Equation <a href="MBpredictionofDesignVariance.html#eq:MBdesignvarSY">(13.6)</a>). This expectation is approximated by selecting a large number of systematic random samples, computing the mean semivariance for each sample, and averaging. This average of mean semivariances within a systematic sample is subtracted from the mean semivariance within the field.</p>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="MBpredictionofDesignVariance.html#cb347-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">314</span>)</span>
<span id="cb347-2"><a href="MBpredictionofDesignVariance.html#cb347-2" aria-hidden="true" tabindex="-1"></a>m_semivar_SY <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="at">length=</span><span class="dv">100</span>)</span>
<span id="cb347-3"><a href="MBpredictionofDesignVariance.html#cb347-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>) {</span>
<span id="cb347-4"><a href="MBpredictionofDesignVariance.html#cb347-4" aria-hidden="true" tabindex="-1"></a>  mySYsample <span class="ot">&lt;-</span> <span class="fu">spsample</span>(<span class="at">x=</span>mygrid, <span class="at">n=</span>n, <span class="at">type=</span><span class="st">&quot;regular&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb347-5"><a href="MBpredictionofDesignVariance.html#cb347-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as</span>(., <span class="st">&quot;data.frame&quot;</span>)</span>
<span id="cb347-6"><a href="MBpredictionofDesignVariance.html#cb347-6" aria-hidden="true" tabindex="-1"></a>  H_SY <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">dist</span>(mySYsample))</span>
<span id="cb347-7"><a href="MBpredictionofDesignVariance.html#cb347-7" aria-hidden="true" tabindex="-1"></a>  G_SY <span class="ot">&lt;-</span> <span class="fu">variogramLine</span>(vgm_MoM, <span class="at">dist_vector=</span>H_SY)</span>
<span id="cb347-8"><a href="MBpredictionofDesignVariance.html#cb347-8" aria-hidden="true" tabindex="-1"></a>  m_semivar_SY[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(G_SY)</span>
<span id="cb347-9"><a href="MBpredictionofDesignVariance.html#cb347-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb347-10"><a href="MBpredictionofDesignVariance.html#cb347-10" aria-hidden="true" tabindex="-1"></a>Exi_V_SY <span class="ot">&lt;-</span> m_semivar_field<span class="sc">-</span><span class="fu">mean</span>(m_semivar_SY)</span></code></pre></div>
<p>The model-based prediction of the sampling variance of the estimator of the mean with this design equals 8, which is smaller than that of stratified simple random sampling. This can be explained by the improved geographical spreading of the sampling points with systematic random sampling as compared to stratified simple random sampling with compact geographical strata.</p>
<div id="bulking-soil-aliquots-into-a-composite-sample" class="section level4" number="13.1.1.1">
<h4><span class="header-section-number">13.1.1.1</span> Bulking soil aliquots into a composite sample</h4>
<p>If the soil aliqouts collected at the points of the stratified random sample are bulked into a composite, as is usually done in soil testing of agricultural fields, the procedure for predicting the variance of the estimator of the mean is slightly different. Only the composite sample is analysed in a laboratory on NO3-N, not the individual soil aliquots. This implies that the contribution of the measurement error to the total uncertainty about the population mean is larger. To predict the sampling variance in this situation, we need the semivariogram of errorless measurements of NO3-N, i.e. of the true NO3-N contents of soil aliquots collected at points. The sill of this semivariogram will be smaller than the sill of the semivariogram of measured NO3-N data. A simple option is to subtract an estimate of the measurement error variance from the semivariogram of measured NO3-N data that contain a measurement error. So the measurement error variance is subtracted from the nugget. This may lead to negative nuggets, which is not allowed (a variance cannot be negative). The preferable alternative is to fit the model with maximum likelihood, and adding the measurement error variance to the diagonal of the covariance matrix of the data, see function <code>ll</code> in Section <a href="MBpredictionofDesignVariance.html#MBpredSamplingVarBayes">13.1.3</a>.</p>
</div>
<div id="exercises-19" class="section level4 unnumbered">
<h4>Exercises</h4>
<ol style="list-style-type: decimal">
<li>Write an <strong>R</strong> script to predict the sampling variance of the estimator of the mean of NO3-N of agricultural field Leest, for simple random random sampling and a sample size of 25 points. Use in prediction a spherical semivariogram with a nugget of 483, a partial sill of 483 and a range of 44.6 m. The sum of the nugget and partial sill (966) is equal to the sill of the semivariogram used above in predicting sampling variances. Compare the predicted sampling variance with the predicted sampling variance for the same sampling design, obtained with the semivariogram without nugget. Explain the difference.<br />
</li>
<li>Write an <strong>R</strong> script to compute the required sample size for simple random random sampling of agricultural field Leest, for a maximum length of a 95% confidence interval of 20. Use the semivariogram without nugget in predicting the sampling variance. See Section <a href="RequiredSampleSize.html#ReqSampleSizeLengthCI">12.2</a> (Equation <a href="RequiredSampleSize.html#eq:nreqwidthCI">(12.7)</a>) for how to compute this required sample size given a prior estimate of the standard deviation of the study variable in the population.<br />
</li>
<li>Do the same for systematic random sampling. Note that for this sampling design no such formula is available. Predict for a series of <em>expected</em> sample sizes, <span class="math inline">\(n = 5,6,\dots , 40\)</span>, the sampling variance of the estimator of the mean, using Equation <a href="MBpredictionofDesignVariance.html#eq:MBdesignvarSY">(13.6)</a>. Approximate <span class="math inline">\(E_{\mathrm{SY}}(\bar{\gamma}_{\mathrm{SY}})\)</span> from ten repeated selections. Compute the length of the confidence interval from the predicted sampling variances, and plot the interval length against the sample size. Finally, determine the required sample size for a maximum length of 20. What is the design effect for an expected sample size of 34 points (the required sample size for simple random sampling), see Equation <a href="RequiredSampleSize.html#eq:designeffect">(12.13)</a>? Also compute the design effect for expected sample sizes of <span class="math inline">\(5,6,\dots , 40\)</span>. Explain why the design effect is not constant.</li>
</ol>
</div>
</div>
<div id="GeostatisticalSimulationApproach" class="section level3" number="13.1.2">
<h3><span class="header-section-number">13.1.2</span> Geostatistical simulation approach</h3>
<p>The alternative to the analytical approach is to use a geostatistical simulation approach. It is computationally more demanding, but an advantage of this approach is its flexibility. It can also be used to predict the sampling variance of the estimator of the mean using a geostatistical model with a non-constant mean. And besides, this approach can also handle trans-Gaussian variables, i.e. of variables whose distribution can be transformed into a normal distribution. In Section <a href="MBpredictionofDesignVariance.html#MBpredSamplingVarBayes">13.1.3</a> geostatistical simulation is used to predict the variance of the estimator of the mean of a lognormal variable.</p>
<p>The geostatistical simulation approach for predicting the sampling variance of a design-based estimator of the population mean involves the following steps:</p>
<ol style="list-style-type: decimal">
<li>Select a large number <span class="math inline">\(S\)</span> of random samples with sampling design <span class="math inline">\(p\)</span>.<br />
</li>
<li>Use the model to simulate values of the study variable for all sampling points.<br />
</li>
<li>Estimate for each sample the population mean, using the design-based estimator of the population mean for sampling design <span class="math inline">\(p\)</span>. This results in <span class="math inline">\(S\)</span> estimated population means.<br />
</li>
<li>Compute the variance of the <span class="math inline">\(S\)</span> estimated means.<br />
</li>
<li>Repeat steps 1 to 4 <span class="math inline">\(R\)</span> times, and compute the mean of the <span class="math inline">\(R\)</span> variances.</li>
</ol>
<p>This approach is illustrated with the three administrative regions (woredas) in Ethiopia where a large sample is available with organic matter data in the topsoil (SOM) in mass percentages (wt%) of dry soil. The soil samples are collected along roads (see Figure <a href="RegularGridSpatialCoverage.html#fig:spatialinfillEthiopia">17.5</a>). It is a convenience sample, not a probability sample, so these sample data cannot be used in design-based or model-assisted estimation of the mean or total soil carbon stock in the study area. However, the data can be used to model the spatial variation of SOM, and this geostatistical model can then be used to design a probability sample for design-based estimation of the total SOM stock. Apart from the point data of SOM, maps of covariates are available, such as a digital elevation model and remote sensing reflectance data. I selected four covariates to model the mean of SOM: elevation (dem), average near infrared reflectance (rfl-NIR), average red reflectance (rfl-red) and average land surface temperature (lst). I assume a normal distribution for the residuals of the linear model. The model parameters are estimated by restricted maximum likelihood (REML), using package <strong>geoR</strong> <span class="citation">(<a href="#ref-geoR" role="doc-biblioref">Ribeiro Jr et al. 2020</a>)</span>, see Section <a href="Introkriging.html#REML">21.5.2</a> for details on REML estimation of a geostatistical model.</p>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="MBpredictionofDesignVariance.html#cb348-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geoR)</span>
<span id="cb348-2"><a href="MBpredictionofDesignVariance.html#cb348-2" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file=</span><span class="st">&quot;data/ThreeWoredasEthiopia.RData&quot;</span>)</span>
<span id="cb348-3"><a href="MBpredictionofDesignVariance.html#cb348-3" aria-hidden="true" tabindex="-1"></a>priordata <span class="ot">&lt;-</span> <span class="fu">as</span>(priordataEthiopia, <span class="st">&quot;data.frame&quot;</span>)</span>
<span id="cb348-4"><a href="MBpredictionofDesignVariance.html#cb348-4" aria-hidden="true" tabindex="-1"></a>dGeoR <span class="ot">&lt;-</span> <span class="fu">as.geodata</span>(<span class="at">obj=</span>priordata, <span class="at">header=</span><span class="cn">TRUE</span>,</span>
<span id="cb348-5"><a href="MBpredictionofDesignVariance.html#cb348-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords.col=</span><span class="dv">13</span><span class="sc">:</span><span class="dv">14</span>, <span class="at">data.col=</span><span class="dv">1</span>, <span class="at">covar.col=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>))</span>
<span id="cb348-6"><a href="MBpredictionofDesignVariance.html#cb348-6" aria-hidden="true" tabindex="-1"></a>vgm_REML <span class="ot">&lt;-</span> <span class="fu">likfit</span>(<span class="at">geodata=</span>dGeoR, </span>
<span id="cb348-7"><a href="MBpredictionofDesignVariance.html#cb348-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">trend=</span><span class="sc">~</span>dem<span class="sc">+</span>rfl_NIR<span class="sc">+</span>rfl_red<span class="sc">+</span>lst, </span>
<span id="cb348-8"><a href="MBpredictionofDesignVariance.html#cb348-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">cov.model=</span><span class="st">&quot;spherical&quot;</span>, <span class="at">ini.cov.pars=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>),<span class="at">nugget=</span><span class="fl">0.2</span>,</span>
<span id="cb348-9"><a href="MBpredictionofDesignVariance.html#cb348-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">lik.method=</span><span class="st">&quot;REML&quot;</span>, <span class="at">messages=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p>The estimated parameters of the residual semivariogram of SOM are shown in Table <a href="MBgridspacing.html#tab:VariogramREMLEthiopia">22.2</a>. The estimated regression coefficients are 56.5 for the intercept, 0.157 for elevation (dem), 9.54 for NIR reflectance, -8.98 for red reflectance and -0.178 for land surface temperature.</p>
<p>Package <strong>gstat</strong> is used for geostatistical simulation, and therefore first the REML estimates of the semivariogram parameters are assigned to the arguments <code>nugget</code>, <code>psill</code> and <code>range</code> of the function <code>vgm</code> of this package.</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="MBpredictionofDesignVariance.html#cb349-1" aria-hidden="true" tabindex="-1"></a>vgm_REML_gstat <span class="ot">&lt;-</span> <span class="fu">vgm</span>(<span class="at">model=</span><span class="st">&quot;Sph&quot;</span>, <span class="at">nugget=</span>vgm_REML<span class="sc">$</span>tausq,</span>
<span id="cb349-2"><a href="MBpredictionofDesignVariance.html#cb349-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">psill=</span>vgm_REML<span class="sc">$</span>sigmasq, <span class="at">range=</span>vgm_REML<span class="sc">$</span>phi)</span></code></pre></div>
<p>The fitted model of the spatial variation of SOM is used to compare systematic random sampling and two-stage cluster random sampling at equal variances of the estimator of the mean. First the sampling variance with systematic random sampling is predicted. One hundred systematic random samples (<span class="math inline">\(S=100\)</span>) with an expected sample size of 50 points (<span class="math inline">\(E[n]=50\)</span>) are selected. The four covariates at the selected sampling points are extracted by overlaying the <code>SpatialPointsDataFrame</code> <code>mySYsamples</code> and the <code>SpatialPixelsDataFrame</code> <code>grd</code> with function <code>over</code> of package <strong>sp</strong> <span class="citation">(<a href="#ref-Pebesma2005" role="doc-biblioref">Pebesma and Bivand 2005</a>)</span>. Values at the sampling points are simulated by sequential Gaussian simulation <span class="citation">(<a href="#ref-goo97" role="doc-biblioref">Goovaerts 1997</a>)</span>, using function <code>krige</code> with argument <code>nsim=1</code> of package <strong>gstat</strong>. The argument <code>dummy</code> is set to <code>TRUE</code> to enforce unconditional simulation.</p>

<div class="rmdnote">
The alternative is conditional simulation, using the data of the convenience sample as conditioning data. Conditional simulation is only recommended if the quality of these legacy data is sufficient, and we may trust that the study variable at the legacy points is not changed since these legacy data are collected.
</div>
<p>Note that by first drawing 100 samples, followed by simulating values of <span class="math inline">\(z\)</span> at the selected sampling points, instead of first simulating values of <span class="math inline">\(z\)</span> at the nodes of a discretisation grid, followed by selecting samples and overlaying with the simulated field, the simulated values of points in the same discretisation cell differ, so that we account for the infinite number of points in the population.</p>
<p>With systematic random sampling the sample mean is an approximately unbiased estimator of the population mean (Chapter <a href="SY.html#SY">5</a>). Therefore, of each sample the mean of the simulated values is computed, using the function <code>tapply</code>. Finally, the variance of the 100 sample means is computed. This is a conditional variance, conditional on the simulated values. The whole procedure is repeated 100 times (<span class="math inline">\(R=100\)</span>), leading to 100 conditional variances of sample means.</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="MBpredictionofDesignVariance.html#cb350-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file=</span><span class="st">&quot;data/CovariatesThreeWoredasEthiopia.RData&quot;</span>)</span>
<span id="cb350-2"><a href="MBpredictionofDesignVariance.html#cb350-2" aria-hidden="true" tabindex="-1"></a>grd <span class="ot">&lt;-</span> grdEthiopia</span>
<span id="cb350-3"><a href="MBpredictionofDesignVariance.html#cb350-3" aria-hidden="true" tabindex="-1"></a><span class="fu">gridded</span>(grd) <span class="ot">&lt;-</span> <span class="er">~</span>s1<span class="sc">+</span>s2</span>
<span id="cb350-4"><a href="MBpredictionofDesignVariance.html#cb350-4" aria-hidden="true" tabindex="-1"></a>S <span class="ot">&lt;-</span> R <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb350-5"><a href="MBpredictionofDesignVariance.html#cb350-5" aria-hidden="true" tabindex="-1"></a>v_mzsim_SY <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="at">length=</span>R)</span>
<span id="cb350-6"><a href="MBpredictionofDesignVariance.html#cb350-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">314</span>)</span>
<span id="cb350-7"><a href="MBpredictionofDesignVariance.html#cb350-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>R) {</span>
<span id="cb350-8"><a href="MBpredictionofDesignVariance.html#cb350-8" aria-hidden="true" tabindex="-1"></a>  mySYsamples <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb350-9"><a href="MBpredictionofDesignVariance.html#cb350-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>S) {</span>
<span id="cb350-10"><a href="MBpredictionofDesignVariance.html#cb350-10" aria-hidden="true" tabindex="-1"></a>    xy <span class="ot">&lt;-</span> <span class="fu">spsample</span>(<span class="at">x=</span>grd, <span class="at">n=</span><span class="dv">50</span>, <span class="at">type=</span><span class="st">&quot;regular&quot;</span>)</span>
<span id="cb350-11"><a href="MBpredictionofDesignVariance.html#cb350-11" aria-hidden="true" tabindex="-1"></a>    mySY <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb350-12"><a href="MBpredictionofDesignVariance.html#cb350-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">s1=</span>xy<span class="sc">$</span>x1, <span class="at">s2=</span>xy<span class="sc">$</span>x2, <span class="at">sample=</span><span class="fu">rep</span>(j, <span class="fu">length</span>(xy)))</span>
<span id="cb350-13"><a href="MBpredictionofDesignVariance.html#cb350-13" aria-hidden="true" tabindex="-1"></a>    mySYsamples <span class="ot">&lt;-</span> <span class="fu">rbind</span>(mySYsamples, mySY)</span>
<span id="cb350-14"><a href="MBpredictionofDesignVariance.html#cb350-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb350-15"><a href="MBpredictionofDesignVariance.html#cb350-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coordinates</span>(mySYsamples) <span class="ot">&lt;-</span> <span class="er">~</span>s1<span class="sc">+</span>s2</span>
<span id="cb350-16"><a href="MBpredictionofDesignVariance.html#cb350-16" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">over</span>(mySYsamples, grd)</span>
<span id="cb350-17"><a href="MBpredictionofDesignVariance.html#cb350-17" aria-hidden="true" tabindex="-1"></a>  mySYs <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(mySYsamples, res[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>)])</span>
<span id="cb350-18"><a href="MBpredictionofDesignVariance.html#cb350-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coordinates</span>(mySYs) <span class="ot">&lt;-</span> <span class="er">~</span>s1<span class="sc">+</span>s2</span>
<span id="cb350-19"><a href="MBpredictionofDesignVariance.html#cb350-19" aria-hidden="true" tabindex="-1"></a>  zsim <span class="ot">&lt;-</span> <span class="fu">krige</span>(</span>
<span id="cb350-20"><a href="MBpredictionofDesignVariance.html#cb350-20" aria-hidden="true" tabindex="-1"></a>    dummy<span class="sc">~</span>dem<span class="sc">+</span>rfl_NIR<span class="sc">+</span>rfl_red<span class="sc">+</span>lst, </span>
<span id="cb350-21"><a href="MBpredictionofDesignVariance.html#cb350-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">locations=</span>mySYs, <span class="at">newdata=</span>mySYs, </span>
<span id="cb350-22"><a href="MBpredictionofDesignVariance.html#cb350-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">model=</span>vgm_REML_gstat, <span class="at">beta=</span>vgm_REML<span class="sc">$</span>beta,</span>
<span id="cb350-23"><a href="MBpredictionofDesignVariance.html#cb350-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">nmax=</span><span class="dv">20</span>, <span class="at">nsim=</span><span class="dv">1</span>,</span>
<span id="cb350-24"><a href="MBpredictionofDesignVariance.html#cb350-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">dummy=</span><span class="cn">TRUE</span>,</span>
<span id="cb350-25"><a href="MBpredictionofDesignVariance.html#cb350-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">debug.level=</span><span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">as</span>(.,<span class="st">&quot;data.frame&quot;</span>)</span>
<span id="cb350-26"><a href="MBpredictionofDesignVariance.html#cb350-26" aria-hidden="true" tabindex="-1"></a>  m_zsim <span class="ot">&lt;-</span> <span class="fu">tapply</span>(zsim<span class="sc">$</span>sim1, <span class="at">INDEX=</span>mySYs<span class="sc">$</span>sample, <span class="at">FUN=</span>mean)</span>
<span id="cb350-27"><a href="MBpredictionofDesignVariance.html#cb350-27" aria-hidden="true" tabindex="-1"></a>  v_mzsim_SY[i] <span class="ot">&lt;-</span> <span class="fu">var</span>(m_zsim)</span>
<span id="cb350-28"><a href="MBpredictionofDesignVariance.html#cb350-28" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The mean of the 100 conditional variances equals 0.018. This is a Monte Carlo approximation of the model-based prediction of the sampling variance of the ratio estimator of the mean for systematic random sampling with an expected sample size of 50.</p>
<p>Due to the geographical spreading of the sampling points with systematic random sampling, the accuracy of the estimated mean is expected to be high compared to that of other sampling designs of the same size. However, with large areas the time needed for travelling to the sampling points can become substantial, lowering the sampling efficiency. With large areas, sampling designs leading to spatial clusters of sampling points can be an attractive alternative. One option then is two-stage cluster random sampling, see Chapter <a href="Twostage.html#Twostage">7</a>. The question is whether this alternative design is more efficient than systematic random sampling.</p>
<p>For the three woredas in Ethiopia 100 compact geostrata (see Section <a href="STSI.html#geostrata">4.6</a>) are computed. Here these geostrata are not used as strata in stratified random sampling, but as primary sampling units (psu’s) in two-stage cluster random sampling. The difference is that in stratified random sampling from each geostratum at least one sampling unit is selected, whereas in two-stage cluster random sampling only a randomly selected subset of the geostrata is sampled. The compact geostrata, used as PSUs, are computed with function <code>kmeans</code>, and as a consequence the PSUs do not have equal size. This is not needed in two-stage cluster random sampling, see Chapter <a href="Twostage.html#Twostage">7</a>. If PSUs of equal size are preferred, then these can be computed with function <code>stratify</code> of package <strong>spcosa</strong> with argument <code>equalArea=TRUE</code>, see Section <a href="STSI.html#geostrata">4.6</a>.</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="MBpredictionofDesignVariance.html#cb351-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file=</span><span class="st">&quot;data/CovariatesThreeWoredasEthiopia.RData&quot;</span>)</span>
<span id="cb351-2"><a href="MBpredictionofDesignVariance.html#cb351-2" aria-hidden="true" tabindex="-1"></a>grd <span class="ot">&lt;-</span> grdEthiopia</span>
<span id="cb351-3"><a href="MBpredictionofDesignVariance.html#cb351-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">314</span>)</span>
<span id="cb351-4"><a href="MBpredictionofDesignVariance.html#cb351-4" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(grd[,<span class="fu">c</span>(<span class="st">&quot;s1&quot;</span>,<span class="st">&quot;s2&quot;</span>)], <span class="at">iter.max=</span><span class="dv">1000</span>, <span class="at">centers=</span><span class="dv">100</span>, <span class="at">nstart=</span><span class="dv">100</span>)</span>
<span id="cb351-5"><a href="MBpredictionofDesignVariance.html#cb351-5" aria-hidden="true" tabindex="-1"></a>mypsus <span class="ot">&lt;-</span> res<span class="sc">$</span>cluster</span>
<span id="cb351-6"><a href="MBpredictionofDesignVariance.html#cb351-6" aria-hidden="true" tabindex="-1"></a>psusize <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">table</span>(mypsus))</span>
<span id="cb351-7"><a href="MBpredictionofDesignVariance.html#cb351-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(psusize)</span></code></pre></div>
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   79.0   103.8   109.0   108.4   113.0   131.0 </code></pre>
<p>To keep the estimation of the population mean simple, the PSUs are selected with probabilities proportional to their size and with replacement (ppswr sampling), see Chapter <a href="Twostage.html#Twostage">7</a>.</p>
<div id="optimisation-of-sample-sizes-for-two-stage-cluster-random-sampling" class="section level4" number="13.1.2.1">
<h4><span class="header-section-number">13.1.2.1</span> Optimisation of sample sizes for two-stage cluster random sampling</h4>
<p>In Section <a href="Twostage.html#twostagesamplingestimators">7.1</a> formulas are presented for computing the optimal number of PSU draws and SSU draws per PSU draw. The optimal sample sizes are a function of the pooled variance of primary unit means, <span class="math inline">\(S^2_{\mathrm{b}}\)</span>, and the pooled variance of secondary units (points) within the primary units, <span class="math inline">\(S^2_{\mathrm{b}}\)</span>. In this section these variance components are predicted with the geostatistical model.</p>
<p>As a first step a large number of fields is simulated.</p>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="MBpredictionofDesignVariance.html#cb353-1" aria-hidden="true" tabindex="-1"></a>grd<span class="sc">$</span>psu <span class="ot">&lt;-</span> mypsus</span>
<span id="cb353-2"><a href="MBpredictionofDesignVariance.html#cb353-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coordinates</span>(grd) <span class="ot">&lt;-</span> <span class="er">~</span>s1<span class="sc">+</span>s2</span>
<span id="cb353-3"><a href="MBpredictionofDesignVariance.html#cb353-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">314</span>)</span>
<span id="cb353-4"><a href="MBpredictionofDesignVariance.html#cb353-4" aria-hidden="true" tabindex="-1"></a>zsim <span class="ot">&lt;-</span> <span class="fu">krige</span>(</span>
<span id="cb353-5"><a href="MBpredictionofDesignVariance.html#cb353-5" aria-hidden="true" tabindex="-1"></a>  dummy<span class="sc">~</span>dem<span class="sc">+</span>rfl_NIR<span class="sc">+</span>rfl_red<span class="sc">+</span>lst, </span>
<span id="cb353-6"><a href="MBpredictionofDesignVariance.html#cb353-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">locations=</span>grd, <span class="at">newdata=</span>grd, </span>
<span id="cb353-7"><a href="MBpredictionofDesignVariance.html#cb353-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">model=</span>vgm_REML_gstat, <span class="at">beta=</span>vgm_REML<span class="sc">$</span>beta, </span>
<span id="cb353-8"><a href="MBpredictionofDesignVariance.html#cb353-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">nmax=</span><span class="dv">20</span>, <span class="at">nsim=</span><span class="dv">1000</span>, </span>
<span id="cb353-9"><a href="MBpredictionofDesignVariance.html#cb353-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">dummy=</span><span class="cn">TRUE</span>, <span class="at">debug.level=</span><span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">as</span>(.,<span class="st">&quot;data.frame&quot;</span>)</span>
<span id="cb353-10"><a href="MBpredictionofDesignVariance.html#cb353-10" aria-hidden="true" tabindex="-1"></a>zsim <span class="ot">&lt;-</span> zsim[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)]</span></code></pre></div>
<p>For each simulated field the means of the PSUs and the variances within the PSUs are computed using function <code>tapply</code> in function <code>apply</code>.</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="MBpredictionofDesignVariance.html#cb354-1" aria-hidden="true" tabindex="-1"></a>m_zsim_psu <span class="ot">&lt;-</span> <span class="fu">apply</span>(zsim, <span class="at">MARGIN=</span><span class="dv">2</span>, <span class="at">FUN=</span><span class="cf">function</span>(x)</span>
<span id="cb354-2"><a href="MBpredictionofDesignVariance.html#cb354-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tapply</span>(x, <span class="at">INDEX=</span>grd<span class="sc">$</span>psu, <span class="at">FUN=</span>mean))</span>
<span id="cb354-3"><a href="MBpredictionofDesignVariance.html#cb354-3" aria-hidden="true" tabindex="-1"></a>v_zsim_psu <span class="ot">&lt;-</span> <span class="fu">apply</span>(zsim, <span class="at">MARGIN=</span><span class="dv">2</span>, <span class="at">FUN=</span><span class="cf">function</span>(x)</span>
<span id="cb354-4"><a href="MBpredictionofDesignVariance.html#cb354-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tapply</span>(x, <span class="at">INDEX=</span>grd<span class="sc">$</span>psu, <span class="at">FUN=</span>var))</span></code></pre></div>
<p>Next, for each simulated field the pooled variance of PSU means and pooled variance within PSUs is computed, and finally these pooled variances are averaged over all simulated fields. These averages are approximations of the model-expectations of the pooled between unit and within unit variances, <span class="math inline">\(E_{\xi}[S^2_{\mathrm{b}}]\)</span> and <span class="math inline">\(E_{\xi}[S^2_{\mathrm{w}}]\)</span>.</p>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb355-1"><a href="MBpredictionofDesignVariance.html#cb355-1" aria-hidden="true" tabindex="-1"></a>p_psu <span class="ot">&lt;-</span> psusize<span class="sc">/</span><span class="fu">sum</span>(psusize)</span>
<span id="cb355-2"><a href="MBpredictionofDesignVariance.html#cb355-2" aria-hidden="true" tabindex="-1"></a>S2b <span class="ot">&lt;-</span> <span class="fu">apply</span>(m_zsim_psu, <span class="at">MARGIN=</span><span class="dv">2</span>, <span class="at">FUN=</span><span class="cf">function</span>(x)</span>
<span id="cb355-3"><a href="MBpredictionofDesignVariance.html#cb355-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(p_psu<span class="sc">*</span>(x<span class="sc">-</span><span class="fu">sum</span>(p_psu<span class="sc">*</span>x))<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb355-4"><a href="MBpredictionofDesignVariance.html#cb355-4" aria-hidden="true" tabindex="-1"></a>S2w <span class="ot">&lt;-</span> <span class="fu">apply</span>(v_zsim_psu, <span class="at">MARGIN=</span><span class="dv">2</span>, <span class="at">FUN=</span><span class="cf">function</span>(x)</span>
<span id="cb355-5"><a href="MBpredictionofDesignVariance.html#cb355-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(p_psu<span class="sc">*</span>x))</span>
<span id="cb355-6"><a href="MBpredictionofDesignVariance.html#cb355-6" aria-hidden="true" tabindex="-1"></a>Exi_S2b <span class="ot">&lt;-</span> <span class="fu">mean</span>(S2b)</span>
<span id="cb355-7"><a href="MBpredictionofDesignVariance.html#cb355-7" aria-hidden="true" tabindex="-1"></a>Exi_S2w <span class="ot">&lt;-</span> <span class="fu">mean</span>(S2w)</span></code></pre></div>
<p>The optimal sample sizes are computed for a simple linear costs model: <span class="math inline">\(C = c_0 + c_1\;n + c_2n\;m\)</span>, with <span class="math inline">\(c_0\)</span> the fixed costs, <span class="math inline">\(c_1\)</span> the access costs per primary unit, including the access costs of the SSUs (points) within a given PSU, and <span class="math inline">\(c_2\)</span> the observation costs per SSU. For the optimal sample sizes only the ratio of <span class="math inline">\(c_1\)</span> and <span class="math inline">\(c_2\)</span> is important, not their absolute values.</p>
<p>Given values for <span class="math inline">\(c_1\)</span> and <span class="math inline">\(c_2\)</span>, the optimal number of PSU draws <span class="math inline">\(n\)</span>, and optimal number of SSU draws per PSU draw <span class="math inline">\(m\)</span> is computed, required for a sampling variance of the estimator of the mean equal to the sampling variance with systematic random sampling of 50 points, see Equations <a href="Twostage.html#eq:nopt">(7.9)</a> and <a href="Twostage.html#eq:mopt">(7.10)</a>.</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="MBpredictionofDesignVariance.html#cb356-1" aria-hidden="true" tabindex="-1"></a>c1 <span class="ot">&lt;-</span> <span class="dv">2</span>; c2 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb356-2"><a href="MBpredictionofDesignVariance.html#cb356-2" aria-hidden="true" tabindex="-1"></a>nopt <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>Exi_vmz_SY<span class="sc">*</span>(<span class="fu">sqrt</span>(Exi_S2w<span class="sc">*</span>Exi_S2b)<span class="sc">*</span><span class="fu">sqrt</span>(c2<span class="sc">/</span>c1)<span class="sc">+</span>Exi_S2b)</span>
<span id="cb356-3"><a href="MBpredictionofDesignVariance.html#cb356-3" aria-hidden="true" tabindex="-1"></a>mopt <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(Exi_S2w<span class="sc">/</span>Exi_S2b)<span class="sc">*</span><span class="fu">sqrt</span>(c1<span class="sc">/</span>c2)</span></code></pre></div>
<p>The optimised number of PSU draws is 32, and the optimal number of points per PSU draw equals 3. The total number of sampling points is 32 <span class="math inline">\(\times\)</span> 3 <span class="math inline">\(=96\)</span>. This is much larger than the sample size of 50 obtained with systematic random sampling. The total observation costs therefore are substantially larger. However, the access time can be substantially smaller due to the spatial clustering of sampling points. To answer the question whether the costs saved by this reduced access time outweighs the extra costs of observation, the model for the access costs and observation costs must be further developed.</p>
</div>
</div>
<div id="MBpredSamplingVarBayes" class="section level3" number="13.1.3">
<h3><span class="header-section-number">13.1.3</span> Bayesian approach</h3>
<p>The model-based prediction of the variance of the design-based estimate of the population mean for a given sampling design is conditional on the model. If we change the model type or the model parameters, the predicted sampling variance also changes. In most situations we are quite uncertain about the model, even in situations where we have data that can be used to estimate the model parameters, as in the Ethiopia case study. Instead of using the best estimated model to predict the sampling variance as done in the previous sections, we may prefer to account for the uncertainty about the model parameters. This can be done through a Bayesian approach, in which the legacy data are used to update a prior distribution of the model parameters to a posterior distribution. For details about a Bayesian approach for estimating model parameters, see Section <a href="MBgridspacing.html#BayesianGridSpacing">22.5</a>. A sample from the posterior distribution of model parameters is used one-by-one to predict the sampling variance. This can be done either analytically, as described in Section <a href="MBpredictionofDesignVariance.html#AnalyticalApproach">13.1.1</a>, or through geostatistical simulation. Both approaches result in a <em>distribution</em> of sampling variances, reflecting our uncertainty about the sampling variance of the estimator of the population mean due to uncertainty about the semivariogram. The mean or median of the distribution of sampling variances can be used as the predicted sampling variance.</p>
<p>The Bayesian approach is illustrated with a case study on predicting the sampling variance of NO3-N in an agricultural field in Belgium <span class="citation">(<a href="#ref-HofmanBrus2021" role="doc-biblioref">Hofman and Brus 2021</a>)</span>. Data of NO3-N are available at 30 points, forming approximately a square grid with a spacing of about 4.5 m. As a first step, I check whether we can safely assume that the data come from a normal distribution.</p>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb357-1"><a href="MBpredictionofDesignVariance.html#cb357-1" aria-hidden="true" tabindex="-1"></a>mydata <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/Melle17.csv&quot;</span>, <span class="at">header=</span><span class="cn">TRUE</span>)</span>
<span id="cb357-2"><a href="MBpredictionofDesignVariance.html#cb357-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mydata, <span class="fu">aes</span>(<span class="at">sample=</span>N)) <span class="sc">+</span></span>
<span id="cb357-3"><a href="MBpredictionofDesignVariance.html#cb357-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_qq</span>() <span class="sc">+</span></span>
<span id="cb357-4"><a href="MBpredictionofDesignVariance.html#cb357-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_qq_line</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:qqplotMelle"></span>
<img src="SpatialSampling_files/figure-html/qqplotMelle-1.png" alt="Q-Q plot of Nitrate-N of field Melle." width="80%" />
<p class="caption">
Figure 13.2: Q-Q plot of Nitrate-N of field Melle.
</p>
</div>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="MBpredictionofDesignVariance.html#cb358-1" aria-hidden="true" tabindex="-1"></a>pvalue <span class="ot">&lt;-</span> <span class="fu">shapiro.test</span>(mydata<span class="sc">$</span>N)<span class="sc">$</span>p.value</span></code></pre></div>
<p>The Q-Qplot shows that a normal distribution is not very likely: there are too many large values, the distribution is skewed to the right. Also the <span class="math inline">\(p\)</span>-value of the Shapiro-Wilk test shows that we should reject the null-hypothesis of a normal distribution for the data: <em>p</em>=0.0028. I therefore proceed with the natural logarithm of NO3-N, in short lnN.</p>
<p>As a first step the semivariogram of lnN is estimated by maximum likelihood (Section <a href="Introkriging.html#MLestimationVariogram">21.4.2</a>). An exponential semivariogram model is assumed, see Equation <a href="Introkriging.html#eq:exponential">(21.12)</a>.</p>

<div class="rmdnote">
The parameters that are estimated are the reciprocal of the sill <span class="math inline">\(\lambda\)</span>, the ratio of spatial dependence <span class="math inline">\(\xi\)</span>, defined as the partial sill divided by the sill, and the distance parameter <span class="math inline">\(\phi\)</span>. This parameterisation of the semivariogram is chosen because hereafter in the Bayesian approach prior distributions are chosen for these parameters.
</div>
<p>The likelihood function is defined, using a somewhat unusual parameterisation, tailored to the Markov chain Monte Carlo (MCMC) sampling from the posterior distribution of the semivariogram parameters. In MCMC a Markov chain of sampling units (vectors with semivariogram parameters) is generated by using the previous sampling unit to randomly generate the next sampling unit (<span class="citation"><a href="#ref-Gelman2013" role="doc-biblioref">Gelman et al.</a> (<a href="#ref-Gelman2013" role="doc-biblioref">2013</a>)</span>, Chapter 11]. In MCMC sampling the probability of accepting a proposed sampling unit <span class="math inline">\(\pmb{\theta}^*\)</span> is a function of the ratio of the posterior density of the proposed sampling unit and that of the current sampling unit, <span class="math inline">\(f(\pmb{\theta}^*|\mathbf{z})/f(\pmb{\theta}_{t-1}|\mathbf{z})\)</span>, so that the normalising constant, the denominator of Equation <a href="RequiredSampleSize.html#eq:BayesTheorem">(12.15)</a>, cancels. For a nice introduction to MCMC I refer to these <a href="http://nitro.biosci.arizona.edu/courses/EEB596/handouts/Gibbs.pdf">lecture notes</a>. <code>crossprod(X, Cinv)</code> is the same as <code>t(X) %*% Cinv</code>.</p>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="MBpredictionofDesignVariance.html#cb359-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mvtnorm)</span>
<span id="cb359-2"><a href="MBpredictionofDesignVariance.html#cb359-2" aria-hidden="true" tabindex="-1"></a>ll <span class="ot">&lt;-</span><span class="cf">function</span>(thetas) {</span>
<span id="cb359-3"><a href="MBpredictionofDesignVariance.html#cb359-3" aria-hidden="true" tabindex="-1"></a>  sill <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>thetas[<span class="dv">1</span>]</span>
<span id="cb359-4"><a href="MBpredictionofDesignVariance.html#cb359-4" aria-hidden="true" tabindex="-1"></a>  psill <span class="ot">&lt;-</span> thetas[<span class="dv">2</span>]<span class="sc">*</span>sill</span>
<span id="cb359-5"><a href="MBpredictionofDesignVariance.html#cb359-5" aria-hidden="true" tabindex="-1"></a>  nugget <span class="ot">&lt;-</span> sill<span class="sc">-</span>psill</span>
<span id="cb359-6"><a href="MBpredictionofDesignVariance.html#cb359-6" aria-hidden="true" tabindex="-1"></a>  vgmodel <span class="ot">&lt;-</span> <span class="fu">vgm</span>(<span class="at">model=</span>model, <span class="at">psill=</span>psill, <span class="at">range=</span>thetas[<span class="dv">3</span>], <span class="at">nugget=</span>nugget)</span>
<span id="cb359-7"><a href="MBpredictionofDesignVariance.html#cb359-7" aria-hidden="true" tabindex="-1"></a>  C <span class="ot">&lt;-</span> <span class="fu">variogramLine</span>(vgmodel, <span class="at">dist_vector=</span>D, <span class="at">covariance=</span><span class="cn">TRUE</span>)</span>
<span id="cb359-8"><a href="MBpredictionofDesignVariance.html#cb359-8" aria-hidden="true" tabindex="-1"></a>  Cinv <span class="ot">&lt;-</span> <span class="fu">solve</span>(C)</span>
<span id="cb359-9"><a href="MBpredictionofDesignVariance.html#cb359-9" aria-hidden="true" tabindex="-1"></a>  XCXinv <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">crossprod</span>(X, Cinv) <span class="sc">%*%</span> X)</span>
<span id="cb359-10"><a href="MBpredictionofDesignVariance.html#cb359-10" aria-hidden="true" tabindex="-1"></a>  XCz <span class="ot">&lt;-</span> <span class="fu">crossprod</span>(X, Cinv) <span class="sc">%*%</span> z</span>
<span id="cb359-11"><a href="MBpredictionofDesignVariance.html#cb359-11" aria-hidden="true" tabindex="-1"></a>  beta <span class="ot">&lt;-</span> XCXinv <span class="sc">%*%</span> XCz</span>
<span id="cb359-12"><a href="MBpredictionofDesignVariance.html#cb359-12" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(X<span class="sc">%*%</span>beta)</span>
<span id="cb359-13"><a href="MBpredictionofDesignVariance.html#cb359-13" aria-hidden="true" tabindex="-1"></a>  logLik <span class="ot">&lt;-</span> <span class="fu">dmvnorm</span>(<span class="at">x=</span>z, <span class="at">mean=</span>mu, <span class="at">sigma=</span>C, <span class="at">log=</span><span class="cn">TRUE</span>)</span>
<span id="cb359-14"><a href="MBpredictionofDesignVariance.html#cb359-14" aria-hidden="true" tabindex="-1"></a>  logLik</span>
<span id="cb359-15"><a href="MBpredictionofDesignVariance.html#cb359-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Next, initial estimates of the semivariogram parameters are estimated by maximising the likelihood, using function <code>optim</code>.</p>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb360-1"><a href="MBpredictionofDesignVariance.html#cb360-1" aria-hidden="true" tabindex="-1"></a>lambda.ini <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="fu">var</span>(mydata<span class="sc">$</span>lnN)</span>
<span id="cb360-2"><a href="MBpredictionofDesignVariance.html#cb360-2" aria-hidden="true" tabindex="-1"></a>xi.ini <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb360-3"><a href="MBpredictionofDesignVariance.html#cb360-3" aria-hidden="true" tabindex="-1"></a>phi.ini <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb360-4"><a href="MBpredictionofDesignVariance.html#cb360-4" aria-hidden="true" tabindex="-1"></a>pars <span class="ot">&lt;-</span> <span class="fu">c</span>(lambda.ini, xi.ini, phi.ini)</span>
<span id="cb360-5"><a href="MBpredictionofDesignVariance.html#cb360-5" aria-hidden="true" tabindex="-1"></a>D <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">dist</span>(mydata[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)]))</span>
<span id="cb360-6"><a href="MBpredictionofDesignVariance.html#cb360-6" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(mydata), <span class="dv">1</span>)</span>
<span id="cb360-7"><a href="MBpredictionofDesignVariance.html#cb360-7" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> mydata<span class="sc">$</span>lnN</span>
<span id="cb360-8"><a href="MBpredictionofDesignVariance.html#cb360-8" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="st">&quot;Exp&quot;</span></span>
<span id="cb360-9"><a href="MBpredictionofDesignVariance.html#cb360-9" aria-hidden="true" tabindex="-1"></a>vgML <span class="ot">&lt;-</span> <span class="fu">optim</span>(pars, ll, <span class="at">control=</span><span class="fu">list</span>(<span class="at">fnscale =</span> <span class="sc">-</span><span class="dv">1</span>),</span>
<span id="cb360-10"><a href="MBpredictionofDesignVariance.html#cb360-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower=</span><span class="fu">c</span>(<span class="fl">1e-6</span>,<span class="dv">0</span>,<span class="fl">1e-6</span>), <span class="at">upper=</span><span class="fu">c</span>(<span class="dv">1000</span>,<span class="dv">1</span>,<span class="dv">150</span>), <span class="at">method=</span><span class="st">&quot;L-BFGS-B&quot;</span>)</span></code></pre></div>
<p>The maximum likelihood (ML) estimates of the semivariogram parameters are used as initial values in MCMC sampling. A uniform prior is used for the inverse of the sill parameter, <span class="math inline">\(\lambda=1/\sigma^2\)</span>, with a lower bound of <span class="math inline">\(10^{-6}\)</span> and an upper bound of 1. For the distance parameter <span class="math inline">\(\phi\)</span> of the exponential semivariogram a uniform prior is assumed, with a lower bound of <span class="math inline">\(10^{-6}\)</span> m. and an upper bound of 150 m. For the relative nugget, <span class="math inline">\(\tau^2/\sigma^2\)</span>, a uniform prior is assumed with a lower bound of 0 and an upper bound of 1.</p>
<p>These priors can be defined by function <code>createUniformPrior</code> of package <strong>BayesianTools</strong> <span class="citation">(<a href="#ref-Hartig2018" role="doc-biblioref">Hartig, Minunno, and Paul 2018</a>)</span>. The function <code>createBayesianSetup</code> is then used to define the setup of the MCMC sampling, specifying the likelihood function, the prior, and the vector with best prior estimates of the model parameters, specified with argument <code>best</code>. Argument <code>sampler</code> of function <code>runMCMC</code> specifies the type of MCMC sampler. I used the differential evolution algorithm of <span class="citation"><a href="#ref-terBraak2008" role="doc-biblioref">ter Braak and Vrugt</a> (<a href="#ref-terBraak2008" role="doc-biblioref">2008</a>)</span>. Argument <code>start</code> of function <code>getSample</code> specifies the burn-in period, i.e. the number of first samples that are discarded to diminish the influence of the initial semivariogram parameter values. Argument <code>numSamples</code> specifies the sample size, i.e. the number of saved vectors with semivariogram parameter values, drawn from the posterior distribution.</p>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="MBpredictionofDesignVariance.html#cb361-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(BayesianTools)</span>
<span id="cb361-2"><a href="MBpredictionofDesignVariance.html#cb361-2" aria-hidden="true" tabindex="-1"></a>priors <span class="ot">&lt;-</span> <span class="fu">createUniformPrior</span>(<span class="at">lower=</span><span class="fu">c</span>(<span class="fl">1e-6</span>, <span class="dv">0</span>, <span class="fl">1e-6</span>),</span>
<span id="cb361-3"><a href="MBpredictionofDesignVariance.html#cb361-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">upper=</span><span class="fu">c</span>(<span class="dv">1000</span>,<span class="dv">1</span>,<span class="dv">150</span>))</span>
<span id="cb361-4"><a href="MBpredictionofDesignVariance.html#cb361-4" aria-hidden="true" tabindex="-1"></a>bestML <span class="ot">&lt;-</span> <span class="fu">c</span>(vgML<span class="sc">$</span>par[<span class="dv">1</span>], vgML<span class="sc">$</span>par[<span class="dv">2</span>], vgML<span class="sc">$</span>par[<span class="dv">3</span>])</span>
<span id="cb361-5"><a href="MBpredictionofDesignVariance.html#cb361-5" aria-hidden="true" tabindex="-1"></a>setup <span class="ot">&lt;-</span> <span class="fu">createBayesianSetup</span>(<span class="at">likelihood=</span>ll, <span class="at">prior=</span>priors,</span>
<span id="cb361-6"><a href="MBpredictionofDesignVariance.html#cb361-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">best=</span>bestML, <span class="at">names=</span><span class="fu">c</span>(<span class="st">&quot;lambda&quot;</span>,<span class="st">&quot;xi&quot;</span>,<span class="st">&quot;phi&quot;</span>))</span>
<span id="cb361-7"><a href="MBpredictionofDesignVariance.html#cb361-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">314</span>)</span>
<span id="cb361-8"><a href="MBpredictionofDesignVariance.html#cb361-8" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">runMCMC</span>(setup, <span class="at">sampler=</span><span class="st">&quot;DEzs&quot;</span>)</span>
<span id="cb361-9"><a href="MBpredictionofDesignVariance.html#cb361-9" aria-hidden="true" tabindex="-1"></a>MCMCsample <span class="ot">&lt;-</span> <span class="fu">getSample</span>(res, <span class="at">start=</span><span class="dv">1000</span>, <span class="at">numSamples=</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>(.)</span></code></pre></div>
<p>Figure <a href="MBpredictionofDesignVariance.html#fig:MCMCsampleVariogramlnN">13.3</a> shows several semivariograms, sampled by MCMC from the posterior distribution of the estimated semivariogram parameters.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:MCMCsampleVariogramlnN"></span>
<img src="SpatialSampling_files/figure-html/MCMCsampleVariogramlnN-1.png" alt="Semivariograms of lnN, obtained by MCMC sampling from posterior distribution of the estimated semivariogram parameters for field Melle." width="80%" />
<p class="caption">
Figure 13.3: Semivariograms of lnN, obtained by MCMC sampling from posterior distribution of the estimated semivariogram parameters for field Melle.
</p>
</div>
<p>The evaluated sampling design is the same as used in Section <a href="MBpredictionofDesignVariance.html#AnalyticalApproach">13.1.1</a> for field Leest: stratified simple random sampling, using compact geographical strata of equal size, a total sample size of 25 points, and one point per stratum.</p>
<p>The next step is to simulate with each of the sampled semivariograms a large number of maps of lnN. This is done by sequential Gaussian simulation, conditional on the available data. The simulated values are backtransformed. Each simulated map is then used to compute the variance of the simulated values within the geostrata <span class="math inline">\(S^2_h\)</span>. These stratum variances are used to compute the sampling variance of the estimator of the mean. Plugging <span class="math inline">\(w_h = 1/n\)</span> (all strata have equal size) and <span class="math inline">\(n_h=1\)</span> into Equation <a href="STSI.html#eq:EstVarMeanSTSI">(4.4)</a>, yields (compare with Equation <a href="MBpredictionofDesignVariance.html#eq:MBdesignvarSTSI2">(13.7)</a>)</p>
<p><span class="math display" id="eq:VarSTSIMelles">\[\begin{equation}
    V(\hat{\bar{z}}) = \frac{1}{n^2}\sum_{h=1}^H S^2_h \;.
    \tag{13.8}
\end{equation}\]</span></p>
<p>I used the first 100 sampled semivariograms, and with each semivariogram I simulated 100 maps.</p>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="MBpredictionofDesignVariance.html#cb362-1" aria-hidden="true" tabindex="-1"></a>V <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data=</span><span class="cn">NA</span>, <span class="at">nrow=</span><span class="dv">100</span>, <span class="at">ncol=</span><span class="dv">100</span>)</span>
<span id="cb362-2"><a href="MBpredictionofDesignVariance.html#cb362-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coordinates</span>(mydata) <span class="ot">&lt;-</span> <span class="er">~</span>Easting<span class="sc">+</span>Northing</span>
<span id="cb362-3"><a href="MBpredictionofDesignVariance.html#cb362-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">314</span>)</span>
<span id="cb362-4"><a href="MBpredictionofDesignVariance.html#cb362-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>) {</span>
<span id="cb362-5"><a href="MBpredictionofDesignVariance.html#cb362-5" aria-hidden="true" tabindex="-1"></a>  sill <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>MCMCsample<span class="sc">$</span>lambda[i]</span>
<span id="cb362-6"><a href="MBpredictionofDesignVariance.html#cb362-6" aria-hidden="true" tabindex="-1"></a>  psill <span class="ot">&lt;-</span> MCMCsample<span class="sc">$</span>xi[i]<span class="sc">*</span>sill</span>
<span id="cb362-7"><a href="MBpredictionofDesignVariance.html#cb362-7" aria-hidden="true" tabindex="-1"></a>  nug <span class="ot">&lt;-</span> sill <span class="sc">-</span> psill</span>
<span id="cb362-8"><a href="MBpredictionofDesignVariance.html#cb362-8" aria-hidden="true" tabindex="-1"></a>  range <span class="ot">&lt;-</span> MCMCsample<span class="sc">$</span>phi[i]</span>
<span id="cb362-9"><a href="MBpredictionofDesignVariance.html#cb362-9" aria-hidden="true" tabindex="-1"></a>  vgmdl <span class="ot">&lt;-</span> <span class="fu">vgm</span>(<span class="at">model=</span><span class="st">&quot;Exp&quot;</span>, <span class="at">nugget=</span>nug, <span class="at">psill=</span>psill, <span class="at">range=</span>range)</span>
<span id="cb362-10"><a href="MBpredictionofDesignVariance.html#cb362-10" aria-hidden="true" tabindex="-1"></a>  ysim <span class="ot">&lt;-</span> <span class="fu">krige</span>(</span>
<span id="cb362-11"><a href="MBpredictionofDesignVariance.html#cb362-11" aria-hidden="true" tabindex="-1"></a>    lnN<span class="sc">~</span><span class="dv">1</span>, <span class="at">locations=</span>mydata, <span class="at">newdata=</span>mygrid, </span>
<span id="cb362-12"><a href="MBpredictionofDesignVariance.html#cb362-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">model=</span>vgmdl, </span>
<span id="cb362-13"><a href="MBpredictionofDesignVariance.html#cb362-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">nmax=</span><span class="dv">20</span>, <span class="at">nsim=</span><span class="dv">100</span>,</span>
<span id="cb362-14"><a href="MBpredictionofDesignVariance.html#cb362-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">debug.level=</span><span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">as</span>(., <span class="st">&quot;data.frame&quot;</span>)</span>
<span id="cb362-15"><a href="MBpredictionofDesignVariance.html#cb362-15" aria-hidden="true" tabindex="-1"></a>  zsim <span class="ot">&lt;-</span> <span class="fu">exp</span>(ysim[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)])</span>
<span id="cb362-16"><a href="MBpredictionofDesignVariance.html#cb362-16" aria-hidden="true" tabindex="-1"></a>  S2h <span class="ot">&lt;-</span> <span class="fu">apply</span>(zsim, <span class="at">MARGIN=</span><span class="dv">2</span>, <span class="at">FUN=</span><span class="cf">function</span>(x)</span>
<span id="cb362-17"><a href="MBpredictionofDesignVariance.html#cb362-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tapply</span>(x, <span class="at">INDEX=</span><span class="fu">as.factor</span>(mygeostrata<span class="sc">$</span>stratumId), <span class="at">FUN=</span>var))</span>
<span id="cb362-18"><a href="MBpredictionofDesignVariance.html#cb362-18" aria-hidden="true" tabindex="-1"></a>  V[i,] <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>n<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="fu">apply</span>(S2h, <span class="at">MARGIN=</span><span class="dv">2</span>, <span class="at">FUN=</span>sum)</span>
<span id="cb362-19"><a href="MBpredictionofDesignVariance.html#cb362-19" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Figure <a href="MBpredictionofDesignVariance.html#fig:plotsimulatedmapsMelle">13.4</a> shows sixteen simulated maps, simulated with the first four semivariograms. The four maps in a row (a to d) are simulated with the same semivariogram. All maps show that the simulated data have positive skew, which is in agreement with the prior data. The data obtained by simulating from a lognormal distribution are always strictly positive. This is not guaranteed when simulating from a normal distribution.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:plotsimulatedmapsMelle"></span>
<img src="SpatialSampling_files/figure-html/plotsimulatedmapsMelle-1.png" alt="Maps of NO3-N simulated with four semivariograms (rows). Each semivariogram is used to simulate four maps (columns a-d)." width="100%" />
<p class="caption">
Figure 13.4: Maps of NO3-N simulated with four semivariograms (rows). Each semivariogram is used to simulate four maps (columns a-d).
</p>
</div>
<p>The sampling variances of the estimated mean of NO3-N obtained with these sixteen maps are shown below.</p>
<pre><code>      a     b     c     d
1 1.322 0.816 0.869 0.842
2 1.407 1.170 0.959 1.143
3 0.589 0.587 0.563 0.552
4 0.873 1.778 0.904 0.679</code></pre>
<p>The sampling variance shows quite strong variation among the maps. The histogram shows the uncertainty distribution of the sampling variance, due to uncertainty about the semivariogram, as well as due to uncertainty about the spatial distribution of NO3-N within the agricultural field given the semivariogram and the available data from that field.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:histogramNMelle"></span>
<img src="SpatialSampling_files/figure-html/histogramNMelle-1.png" alt="Histogram of simulated sampling variances of the estimator of the mean of NO3-N for stratified simple random sampling of field Melle." width="80%" />
<p class="caption">
Figure 13.5: Histogram of simulated sampling variances of the estimator of the mean of NO3-N for stratified simple random sampling of field Melle.
</p>
</div>
<p>As a model-based prediction of the sampling variance we can take the mean or the median of the sampling variances over all <span class="math inline">\(100 \times 100\)</span> simulated maps, which are equal to 0.724 and 0.663, respectively. If we want to be more safe, we can take a high quantile, e.g. the P90 of this distribution as the predicted sampling variance, which is equal to 1.099</p>
<p>I used the 30 data as conditioning data in geostatistical simulation. Unconditional simulation is recommended if we cannot rely on the quality of the legacy data, for instance due to a temporal change in lnN since the time the legacy data were observed. For NO3-N this might well be the case. I believe that, although the effect of 30 observations on the simulated fields and on the uncertainty distribution of the sampling variance will be very small, one still may prefer unconditional simulation. With unconditional simulation we must assign the model mean <span class="math inline">\(\mu\)</span> to the argument <code>beta</code> of function <code>krige</code>. The estimated model mean depends on the semivariogram parameters. The next code chunk shows how this model mean can be estimated (see also function <code>ll</code> above).</p>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="MBpredictionofDesignVariance.html#cb364-1" aria-hidden="true" tabindex="-1"></a>C <span class="ot">&lt;-</span> <span class="fu">variogramLine</span>(vgmodel, <span class="at">dist_vector=</span>D, <span class="at">covariance=</span><span class="cn">TRUE</span>)</span>
<span id="cb364-2"><a href="MBpredictionofDesignVariance.html#cb364-2" aria-hidden="true" tabindex="-1"></a>Cinv <span class="ot">&lt;-</span> <span class="fu">solve</span>(C)</span>
<span id="cb364-3"><a href="MBpredictionofDesignVariance.html#cb364-3" aria-hidden="true" tabindex="-1"></a>XCXinv <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">crossprod</span>(X, Cinv) <span class="sc">%*%</span> X)</span>
<span id="cb364-4"><a href="MBpredictionofDesignVariance.html#cb364-4" aria-hidden="true" tabindex="-1"></a>XCz <span class="ot">&lt;-</span> <span class="fu">crossprod</span>(X, Cinv) <span class="sc">%*%</span> z</span>
<span id="cb364-5"><a href="MBpredictionofDesignVariance.html#cb364-5" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> XCXinv <span class="sc">%*%</span> XCz</span></code></pre></div>
</div>
</div>
<div id="Ospats" class="section level2" number="13.2">
<h2><span class="header-section-number">13.2</span> Model-based optimisation of spatial strata</h2>
<p><span class="citation"><a href="#ref-deGruijter2015" role="doc-biblioref">de Gruijter, Minasny, and McBratney</a> (<a href="#ref-deGruijter2015" role="doc-biblioref">2015</a>)</span> described a novel spatial stratification method that uses model predictions of the study variable as a stratification variable while accounting for errors in the predictions, as well as spatial correlation of the prediction errors.</p>
<p>The <strong>Julia</strong> package <strong>Ospats</strong> is an implementation of the stratification method. In <strong>Ospats</strong> the stratification is optimised through iterative reallocation of the raster cells to the strata. Recently, this stratification method was implemented in the package <strong>SamplingStrata</strong> (<span class="citation"><a href="#ref-Barcaroli2014" role="doc-biblioref">Giulio Barcaroli</a> (<a href="#ref-Barcaroli2014" role="doc-biblioref">2014</a>)</span>, <span class="citation"><a href="#ref-Barcaroli2020" role="doc-biblioref">G. Barcaroli et al.</a> (<a href="#ref-Barcaroli2020" role="doc-biblioref">2020</a>)</span>). However, the algorithm used to optimise the strata differs from that in <strong>Ospats</strong>. In <code>SamplingStrata</code> the stratification is optimised by optimising the breaks (splitting points) on the stratification variable with a genetic algorithm. Optimisation of the strata through optimisation of the breaks on the stratification variable necessarily leads to non-overlapping strata, while with iterative reallocation the strata may overlap, i.e. when the strata are sorted on the mean of the stratification variable, the upper bound of a stratum can be larger than the lower bound of the next stratum. As argued by <span class="citation"><a href="#ref-deGruijter2015" role="doc-biblioref">de Gruijter, Minasny, and McBratney</a> (<a href="#ref-deGruijter2015" role="doc-biblioref">2015</a>)</span> optimisation of strata through optimisation of the stratum breaks can be suboptimal. On the other hand, optimisation through optimisation of the breaks needs fewer computations, and therefore is quicker.</p>
<p>The situation considered in this section is that prior data are available, either from the study area itself or from another similar area, that can be used to fit a linear regression model for the study variable, using one or more quantitative covariates and/or factors as predictors. These predictors must be available in the study area so that the fitted model can be used to map the study variable in the study area. We wish to collect (more) data by stratified simple random sampling, to be used in design-based estimation of the population mean or total of the study variable. The central research question then is how to construct these strata.</p>
<p>Recall the formula for the variance of the estimator of the mean for stratified simple random sampling (see Equations <a href="STSI.html#eq:EstVarMeanSTSI">(4.4)</a> and <a href="STSI.html#eq:EstVarstratummean">(4.5)</a>):</p>
<p><span class="math display" id="eq:VarMeanSTSI2">\[\begin{equation}
V\!\left(\hat{\bar{z}}\right)=\sum\limits_{h=1}^{H}w_{h}^{2} \frac{S^2_h(z)}{n_h}\;.
\tag{13.9}
\end{equation}\]</span></p>
<p>Plugging the stratum sample sizes under optimal allocation (Equation <a href="STSI.html#eq:optallocation">(4.17)</a>) into Equation <a href="MBpredictionofDesignVariance.html#eq:VarMeanSTSI2">(13.9)</a>, gives for the variance of the estimator of the mean</p>
<p><span class="math display" id="eq:VSTSINeyman">\[\begin{equation}
V\!\left(\hat{\bar{z}}\right)=\frac{1}{n}\left(\sum\limits_{h=1}^{H}w_h S_h(z) \sqrt{c_h} \sum_{h=1}^H \frac{w_h S_h(z)}{\sqrt{c_h}}\right)\;.
\tag{13.10}
\end{equation}\]</span></p>
<p>So given the total sample size <span class="math inline">\(n\)</span> the variance of the estimator of the mean is minimal when the criterion</p>
<p><span class="math display" id="eq:minicritospats">\[\begin{equation}
O = \sum\limits_{h=1}^{H}w_h S_h(z) \sqrt{c_h} \sum_{h=1}^H \frac{w_h S_h(z)}{\sqrt{c_h}}
\tag{13.11}
\end{equation}\]</span></p>
<p>is minimised.</p>
<p>Assuming that the costs are equal for all population units, so that the mean costs are the same for all strata, the minimisation criterion reduces to</p>
<p><span class="math display" id="eq:EOconstantch">\[\begin{equation}
O = \left(\sum\limits_{h=1}^H w_h S_h(z)\right)^2\;.
\tag{13.12}
\end{equation}\]</span></p>
<p>In practice we do not know the values of the study variable <span class="math inline">\(z\)</span>. <span class="citation"><a href="#ref-deGruijter2015" role="doc-biblioref">de Gruijter, Minasny, and McBratney</a> (<a href="#ref-deGruijter2015" role="doc-biblioref">2015</a>)</span> consider the situation where we have predictions of the study variable from a linear regression model: <span class="math inline">\(\hat{z} = z + \epsilon\)</span>, with <span class="math inline">\(\epsilon\)</span> the prediction error. So this implies that we do not know the stratum standard deviations <span class="math inline">\(S_h(z)\)</span> of Equation <a href="MBpredictionofDesignVariance.html#eq:VSTSINeyman">(13.10)</a>. What we do have are the stratum standard deviations of the predictions of <span class="math inline">\(z\)</span>: <span class="math inline">\(S_h(\hat{z})\)</span>. With many statistical models, such as regression and kriging models, the standard deviation of the predictions are smaller than that of the study variable: <span class="math inline">\(S_h(\hat{z}) &lt; S_h(z)\)</span>. This is known as the smoothing or levelling effect.</p>
<p>The stratum standard deviations in the minimisation criterion are replaced by model-expectations of these stratum standard deviations, i.e. by model-based predictions of the stratum standard deviations), <span class="math inline">\(E[S_h(z)]\)</span>. This leads to the following minimisation criterion:</p>
<p><span class="math display" id="eq:EOconstantch2">\[\begin{equation}
E_{\xi}[O] = \left(\sum\limits_{h=1}^H w_h E_{\xi}[S_h(z)]\right)^2\;.
\tag{13.13}
\end{equation}\]</span></p>
<p>The stratum variances are predicted by</p>
<p><span class="math display">\[\begin{equation}
E_{\xi}[S^2_h(z)]=\frac{1}{N^2_h}\sum_{i=1}^{N_h-1}\sum_{j=i+1}^{N_h}E_{\xi}[d^2_{ij}]\;,
\end{equation}\]</span></p>
<p>with <span class="math inline">\(d^2_{ij} = (z_i-z_j)^2\)</span> the squared difference of the study variable values at two nodes of a discretisation grid. The model-expectation of the squared differences are equal to</p>
<p><span class="math display" id="eq:Exid2ij">\[\begin{equation}
E_{\xi}[d^2_{ij}] = (\hat{z}_i-\hat{z}_j)^2+S^2(\epsilon_i)+S^2(\epsilon_j)-2S^2(\epsilon_i,\epsilon_j)
\tag{13.14}
\;, 
\end{equation}\]</span></p>
<p>with <span class="math inline">\(S^2(\epsilon_i)\)</span> the variance of the prediction error at node <span class="math inline">\(i\)</span>, and <span class="math inline">\(S^2(\epsilon_i,\epsilon_j)\)</span> the covariance of the prediction errors at nodes <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>. The authors then argue that for smoothers, such as kriging and regression, the first term must be divided by the squared correlation coefficient <span class="math inline">\(R^2\)</span>:</p>
<p><span class="math display" id="eq:Exid2ij2">\[\begin{equation}
E_{\xi}[d^2_{ij}] = \frac{(\hat{z}_i-\hat{z}_j)^2}{R^2}+S^2(\epsilon_i)+S^2(\epsilon_j)-2S^2(\epsilon_i,\epsilon_j) \;.
\tag{13.15}
\end{equation}\]</span></p>
<p>The predicted stratum standard deviations are approximated by the square root of Equation <a href="MBpredictionofDesignVariance.html#eq:Exid2ij2">(13.15)</a>. Plugging these model-based predictions of the stratum standard deviations into the minimisation criterion, Equation <a href="MBpredictionofDesignVariance.html#eq:EOconstantch">(13.12)</a>, yields</p>
<p><span class="math display" id="eq:minicritospatsDeGruijter">\[\begin{equation}
E_{\xi}[O] = \frac{1}{N} \sum\limits_{h=1}^H \left( \sum_{i=1}^{N_h-1}\sum_{j=i+1}^{N_h}\frac{(\hat{z}_i-\hat{z}_j)^2}{R^2}+S^2(\epsilon_i)+S^2(\epsilon_j)-2S^2(\epsilon_i,\epsilon_j) \right)^{1/2}\;.
\tag{13.16}
\end{equation}\]</span></p>
<p>Optimal spatial stratification with package <strong>SamplingStrata</strong> is illustrated with a survey of the soil organic matter (SOM) concentration (g/kg) in the topsoil (A horizon) of Xuancheng (China). Three samples are available. These three samples are merged. The total number of sampling points is 183. This sample is used to fit a simple linear regression model for SOM, using the elevation of the surface (dem) as a predictor. The function <code>lm</code> of the <strong>stats</strong> package is used to fit the simple linear regression model.</p>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="MBpredictionofDesignVariance.html#cb365-1" aria-hidden="true" tabindex="-1"></a>sample_grid <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/Xuancheng_gridsample.csv&quot;</span>)</span>
<span id="cb365-2"><a href="MBpredictionofDesignVariance.html#cb365-2" aria-hidden="true" tabindex="-1"></a>sample_iPSM <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/Xuancheng_iPSMsample.csv&quot;</span>)</span>
<span id="cb365-3"><a href="MBpredictionofDesignVariance.html#cb365-3" aria-hidden="true" tabindex="-1"></a>sample_test <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/Xuancheng_STSIsample.csv&quot;</span>)</span>
<span id="cb365-4"><a href="MBpredictionofDesignVariance.html#cb365-4" aria-hidden="true" tabindex="-1"></a>mysample <span class="ot">&lt;-</span> <span class="fu">rbind</span>(sample_grid, sample_iPSM, sample_test[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">13</span>,<span class="dv">14</span>,<span class="dv">15</span>)])</span>
<span id="cb365-5"><a href="MBpredictionofDesignVariance.html#cb365-5" aria-hidden="true" tabindex="-1"></a>lm_SOM <span class="ot">&lt;-</span> <span class="fu">lm</span>(SOM_A_hori<span class="sc">~</span>dem, <span class="at">data=</span>mysample)</span></code></pre></div>
<p>In fitting a linear regression model we assume that the relation is linear, that the residual variance is constant (independent of the fitted value) and the residuals have a normal distribution. These assumptions are checked with a scatter plot of the residuals against the fitted value and a Q-Q plot, respectively.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:checkassumptions"></span>
<img src="SpatialSampling_files/figure-html/checkassumptions-1.png" alt="Scatter plot of residuals against fitted value, and Q-Q plot of residuals, for a simple linear regression model of soil organic matter concentration in Xuancheng, with elevation as a predictor." width="100%" />
<p class="caption">
Figure 13.6: Scatter plot of residuals against fitted value, and Q-Q plot of residuals, for a simple linear regression model of soil organic matter concentration in Xuancheng, with elevation as a predictor.
</p>
</div>
<p>The scatter plot shows that the first assumption is realistic. No pattern can be seen: at all fitted values the residuals are scattered around the horizontal line. However, the second and thirds assumptions are questionable: the residual variance clearly increases with the fitted value, and the distribution of the residuals has positive skew, i.e. it has a long upper tail. There clearly is some evidence that these two assumptions are violated. Possibly these problems can be solved by fitting a model for the natural logarithm of SOM.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:checkassumptions2"></span>
<img src="SpatialSampling_files/figure-html/checkassumptions2-1.png" alt="Scatter plot of residuals against fitted value, and Q-Q plot of residuals, for a simple linear regression model of natural logarithm of soil organic matter concentration in Xuancheng, with elevation as a predictor." width="100%" />
<p class="caption">
Figure 13.7: Scatter plot of residuals against fitted value, and Q-Q plot of residuals, for a simple linear regression model of natural logarithm of soil organic matter concentration in Xuancheng, with elevation as a predictor.
</p>
</div>
<p>The variance of the residuals is more constant, and the Q-Q plot is improved, although we now have too many strong negative residuals for a normal distribution. I proceed with the model for natural log-transformed SOM (lnSOM). The fitted linear regression model is used to predict lnSOM at the nodes of a 200 m <span class="math inline">\(\times\)</span> 200 m discretisation grid.</p>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="MBpredictionofDesignVariance.html#cb366-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;data/Xuancheng.RData&quot;</span>)</span>
<span id="cb366-2"><a href="MBpredictionofDesignVariance.html#cb366-2" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">predict</span>(lm_lnSOM, <span class="at">newdata=</span><span class="fu">as</span>(grd,<span class="st">&quot;data.frame&quot;</span>), <span class="at">se.fit=</span><span class="cn">TRUE</span>)</span>
<span id="cb366-3"><a href="MBpredictionofDesignVariance.html#cb366-3" aria-hidden="true" tabindex="-1"></a>grd <span class="ot">&lt;-</span> <span class="fu">within</span>(<span class="fu">as</span>(grd,<span class="st">&quot;data.frame&quot;</span>), </span>
<span id="cb366-4"><a href="MBpredictionofDesignVariance.html#cb366-4" aria-hidden="true" tabindex="-1"></a>              {lnSOMpred <span class="ot">&lt;-</span> res<span class="sc">$</span>fit; varpred <span class="ot">&lt;-</span> res<span class="sc">$</span>se.fit<span class="sc">^</span><span class="dv">2</span>})</span></code></pre></div>
<p>The predictions and their standard errors are shown in Figure <a href="MBpredictionofDesignVariance.html#fig:predictedlnSOM">13.8</a>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:predictedlnSOM"></span>
<img src="SpatialSampling_files/figure-html/predictedlnSOM-1.png" alt="Predicted natural logarithm of soil organic matter concentration (g/kg) in the topsoil, and its  standard error in Xuancheng, obtained with a linear regression model with elevation as predictor." width="100%" />
<p class="caption">
Figure 13.8: Predicted natural logarithm of soil organic matter concentration (g/kg) in the topsoil, and its standard error in Xuancheng, obtained with a linear regression model with elevation as predictor.
</p>
</div>
<p>Let us check now whether the spatial structure of the study variable lnSOM is fully captured by the mean, modelled as a linear function of elevation. This can be checked by estimating the semivariogram of the model residuals. If the semivariogram of the residuals is pure nugget (the semivariance does not increase with distance), then we can assume that the prediction errors are independent. In that case we do not need to account for a covariance of the prediction errors in optimisation of the spatial strata. However, if the semivariogram does show spatial structure, we must account for a covariance of the prediction errors. Figure <a href="MBpredictionofDesignVariance.html#fig:residualvariogramSOM">13.9</a> shows the sample semivariogram of the residuals computed with function <code>variogram</code> of package <strong>gstat</strong>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:residualvariogramSOM"></span>
<img src="SpatialSampling_files/figure-html/residualvariogramSOM-1.png" alt="Sample semivariogram of residuals of simple linear regression model for natural logarithm of soil organic matter concentration in Xuancheng." width="80%" />
<p class="caption">
Figure 13.9: Sample semivariogram of residuals of simple linear regression model for natural logarithm of soil organic matter concentration in Xuancheng.
</p>
</div>
<p>The sample semivariogram does not show much spatial structure, but the first two points in the semivariogram have somewhat smaller values. This indicates that the residuals at two close points, say <span class="math inline">\(&lt; \pm 5\)</span> km are not independent, whereas if the distance between the two points <span class="math inline">\(&gt; \pm 5\)</span> km, they are independent. This spatial dependency of the residuals can be modelled, e.g. by an exponential function. The exponential semivariogram has three parameters, the nugget variance <span class="math inline">\(c_0\)</span>, the partial sill <span class="math inline">\(c_1\)</span> and the distance parameter <span class="math inline">\(\phi\)</span>. The total number of model parameters now is five: two regression coefficients (intercept and slope for elevation), and three semivariogram parameters. All five parameters can best be estimated by restricted maximum likelihood, see Section <a href="Introkriging.html#REML">21.5.2</a>. Table <a href="MBpredictionofDesignVariance.html#tab:TableModelXuancheng">13.1</a> shows the estimated regression coefficients and semivariogram parameters. Up to a distance of about three times the estimated distance parameter <span class="math inline">\(\phi\)</span>, which is about 8 km, the residuals are spatially correlated; beyond that distance, they are hardly correlated anymore.</p>
<table class=" lightable-classic" style="font-family: &quot;Arial Narrow&quot;, &quot;Source Sans Pro&quot;, sans-serif; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:TableModelXuancheng">Table 13.1: </span>Estimated regression coefficients (intercept and slope for dem), and parameters of exponential semivariogram for natural logarithm of soil organic matter concentration in Xuancheng (China).
</caption>
<thead>
<tr>
<th style="text-align:right;">
Int
</th>
<th style="text-align:right;">
dem
</th>
<th style="text-align:right;">
Nugget
</th>
<th style="text-align:right;">
Partial sill
</th>
<th style="text-align:right;">
Distance parameter (km)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
2.771
</td>
<td style="text-align:right;">
0.00222
</td>
<td style="text-align:right;">
0.085
</td>
<td style="text-align:right;">
0.061
</td>
<td style="text-align:right;">
2.588
</td>
</tr>
</tbody>
</table>
<p>We conclude that the errors in the regression model predictions are not independent, although the correlation will be weak in this case, and that we must account for this correlation in optimising the spatial strata.</p>
<p>The discretisation grid with predicted lnSOM consists of 115,526 nodes. These are too many for function <code>optimStrata</code>. The grid is therefore thinned to a grid with a spacing of 800 m <span class="math inline">\(\times\)</span> 800 m, resulting in 7257 nodes.</p>
<p>The first step in optimisation of spatial strata with package <strong>SamplingStrata</strong> is to build the sampling frame with function <code>buildFrameSpatial</code>. The argument <code>X</code> specifies the stratification variables, and argument <code>Y</code> specifies the study variables. In our case we have only one stratification variable and one study variable, and these are the same variable. Argument <code>var</code> specifies the variance of the prediction error of the study variable. The variable <code>dom</code> is an identifier of the domain of interest of which we want to estimate the mean or total. I assigned the value 1 to all population units, which implies that the stratification is optimised for the entire population. If we have multiple domains of interest, the stratification is optimised for each domain separately.</p>
<p>Finally, as a preparatory step we must specify how precise the estimated mean should be. This precision must be specified in terms of the coefficient of variation (cv), i.e. the standard error of the estimated mean divided by the mean. In case of multiple domains of interest, and multiple study variables a cv must be specified per domain and per study variable. This precision requirement is used to compute the sample size for Neyman allocation (Equation <a href="STSI.html#eq:Neymanallocation">(4.16)</a>)<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a>. The optimal stratification is independent of the precision requirement, although for a large cv, the optimal number of strata can be smaller than the value assigned to argument <code>nStrata</code> of function <code>optimStrata</code>, see hereafter.</p>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="MBpredictionofDesignVariance.html#cb367-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SamplingStrata)</span>
<span id="cb367-2"><a href="MBpredictionofDesignVariance.html#cb367-2" aria-hidden="true" tabindex="-1"></a>subgrd<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(subgrd))</span>
<span id="cb367-3"><a href="MBpredictionofDesignVariance.html#cb367-3" aria-hidden="true" tabindex="-1"></a>subgrd<span class="sc">$</span>dom <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>,<span class="fu">nrow</span>(subgrd))</span>
<span id="cb367-4"><a href="MBpredictionofDesignVariance.html#cb367-4" aria-hidden="true" tabindex="-1"></a>frame <span class="ot">&lt;-</span><span class="fu">buildFrameSpatial</span>(<span class="at">df=</span>subgrd, <span class="at">id=</span><span class="st">&quot;id&quot;</span>,<span class="at">X=</span><span class="fu">c</span>(<span class="st">&quot;lnSOMpred&quot;</span>), <span class="at">Y=</span><span class="fu">c</span>(<span class="st">&quot;lnSOMpred&quot;</span>),</span>
<span id="cb367-5"><a href="MBpredictionofDesignVariance.html#cb367-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">variance=</span><span class="fu">c</span>(<span class="st">&quot;varpred&quot;</span>), <span class="at">lon=</span><span class="st">&quot;x1&quot;</span>, <span class="at">lat=</span><span class="st">&quot;x2&quot;</span>, <span class="at">domainvalue=</span><span class="st">&quot;dom&quot;</span>)</span>
<span id="cb367-6"><a href="MBpredictionofDesignVariance.html#cb367-6" aria-hidden="true" tabindex="-1"></a>cv <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">list</span>(<span class="at">DOM=</span><span class="st">&quot;DOM1&quot;</span>,<span class="at">CV1=</span><span class="fl">0.005</span>,<span class="at">domainvalue=</span><span class="dv">1</span>))</span></code></pre></div>
<p>The optimal spatial stratification can be computed with function <code>optimStrata</code>, with argument <code>method="spatial"</code>. The <span class="math inline">\(R^2\)</span> value of the linear regression model, used in the minimisation criterion (Equation <a href="MBpredictionofDesignVariance.html#eq:minicritospatsDeGruijter">(13.16)</a>), can be assigned to argument <code>fitting</code>.</p>

<div class="rmdnote">
I am not sure that the correction factor <span class="math inline">\(R^2\)</span> in Equation <a href="MBpredictionofDesignVariance.html#eq:Exid2ij">(13.14)</a> is really needed. I believe that the smoothing effect is already accounted for by the variances and covariances of the prediction errors. I used an <span class="math inline">\(R^2\)</span> value of 1.
</div>
<p>Arguments <code>range</code> and <code>kappa</code> are parameters of an exponential semivariogram, needed for computing the covariance of the prediction errors. Function <code>optimiStrata</code> uses an extra parameter in the exponential semivariogram (Equation <a href="Introkriging.html#eq:exponential">(21.12)</a>), <span class="math inline">\(c_0+c_1\; \mathrm{exp}(-\kappa h/\phi)\)</span>, so for the usual exponential semivariogram <code>kappa</code> equals 1.</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="MBpredictionofDesignVariance.html#cb368-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">optimStrata</span>(<span class="at">framesamp=</span>frame, <span class="at">method=</span><span class="st">&quot;spatial&quot;</span>, <span class="at">errors=</span>cv, <span class="at">nStrata=</span><span class="dv">5</span>,</span>
<span id="cb368-2"><a href="MBpredictionofDesignVariance.html#cb368-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">fitting=</span><span class="dv">1</span>, <span class="at">range=</span><span class="fu">c</span>(vgm_REML<span class="sc">$</span>phi), <span class="at">kappa=</span><span class="dv">1</span>, <span class="at">showPlot=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p>A summary of the optimised strata can be obtained with function <code>summaryStrata</code>.</p>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb369-1"><a href="MBpredictionofDesignVariance.html#cb369-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(smr_strata <span class="ot">&lt;-</span> <span class="fu">summaryStrata</span>(</span>
<span id="cb369-2"><a href="MBpredictionofDesignVariance.html#cb369-2" aria-hidden="true" tabindex="-1"></a>  res<span class="sc">$</span>framenew, res<span class="sc">$</span>aggr_strata, <span class="at">progress=</span><span class="cn">FALSE</span>))</span></code></pre></div>
<pre><code>  Domain Stratum Population Allocation SamplingRate Lower_X1 Upper_X1
1      1       1       3090         12     0.004035 2.767950 2.862539
2      1       2       1931         10     0.005087 2.864846 2.991733
3      1       3       1133         10     0.008555 2.994040 3.215515
4      1       4        769         11     0.014398 3.217822 3.600789
5      1       5        334         11     0.033443 3.605403 5.098052</code></pre>
<p>In the next code chunk it is checked whether the coefficient of variation is indeed equal to the desired value.</p>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb371-1"><a href="MBpredictionofDesignVariance.html#cb371-1" aria-hidden="true" tabindex="-1"></a>strata <span class="ot">&lt;-</span> res<span class="sc">$</span>aggr_strata</span>
<span id="cb371-2"><a href="MBpredictionofDesignVariance.html#cb371-2" aria-hidden="true" tabindex="-1"></a>framenew <span class="ot">&lt;-</span> res<span class="sc">$</span>framenew</span>
<span id="cb371-3"><a href="MBpredictionofDesignVariance.html#cb371-3" aria-hidden="true" tabindex="-1"></a>N_h <span class="ot">&lt;-</span> strata<span class="sc">$</span>N</span>
<span id="cb371-4"><a href="MBpredictionofDesignVariance.html#cb371-4" aria-hidden="true" tabindex="-1"></a>w_h <span class="ot">&lt;-</span> N_h<span class="sc">/</span><span class="fu">sum</span>(N_h)</span>
<span id="cb371-5"><a href="MBpredictionofDesignVariance.html#cb371-5" aria-hidden="true" tabindex="-1"></a>se <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>(w_h<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>strata<span class="sc">$</span>S1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>strata<span class="sc">$</span>SOLUZ))</span>
<span id="cb371-6"><a href="MBpredictionofDesignVariance.html#cb371-6" aria-hidden="true" tabindex="-1"></a>se<span class="sc">/</span><span class="fu">mean</span>(framenew<span class="sc">$</span>Y1)</span></code></pre></div>
<pre><code>[1] 0.005033349</code></pre>
<p>The coefficient of variation can also be computed with function <code>expected_CV</code>.</p>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb373-1"><a href="MBpredictionofDesignVariance.html#cb373-1" aria-hidden="true" tabindex="-1"></a><span class="fu">expected_CV</span>(strata)</span></code></pre></div>
<pre><code>     cv(Y1)
DOM1  0.005</code></pre>
<p>Figure <a href="MBpredictionofDesignVariance.html#fig:optimalstrataXuanchengSamplingStrata">13.10</a> shows the optimised strata. I used the stratum bounds in the data frame <code>smr_strata</code>, to compute the stratum for all raster cells of the original 200 m <span class="math inline">\(\times\)</span> 200 m grid.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:optimalstrataXuanchengSamplingStrata"></span>
<img src="SpatialSampling_files/figure-html/optimalstrataXuanchengSamplingStrata-1.png" alt="Model-based optimal strata for estimating the population mean of natural logarithm of soil organic matter (lnSOM) concentration (g/kg)." width="100%" />
<p class="caption">
Figure 13.10: Model-based optimal strata for estimating the population mean of natural logarithm of soil organic matter (lnSOM) concentration (g/kg).
</p>
</div>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Barcaroli2020" class="csl-entry">
Barcaroli, G., M. Ballin, H. Odendaal, D. Pagliuca, E. Willighagen, and D. Zardetto. 2020. <em><span class="nocase">SamplingStrata: Optimal Stratification of Sampling Frames for Multipurpose Sampling Surveys</span></em>. <a href="{https://cran.r-project.org/package=SamplingStrata}">{https://cran.r-project.org/package=SamplingStrata}</a>.
</div>
<div id="ref-Barcaroli2014" class="csl-entry">
Barcaroli, Giulio. 2014. <span>“<span class="nocase">SamplingStrata: An R Package for the optimisation of Stratified Sampling</span>.”</span> <em>Journal of Statistical Software</em> 61 (4). <a href="https://doi.org/10.18637/jss.v061.i04">https://doi.org/10.18637/jss.v061.i04</a>.
</div>
<div id="ref-rgdal" class="csl-entry">
Bivand, Roger, Tim Keitt, and Barry Rowlingson. 2020. <em><span class="nocase">rgdal: Bindings for the ’Geospatial’ Data Abstraction Library</span></em>. <a href="https://CRAN.R-project.org/package=rgdal">https://CRAN.R-project.org/package=rgdal</a>.
</div>
<div id="ref-gru06" class="csl-entry">
de Gruijter, J. J., D. J. Brus, M. F. P. Bierkens, and M. Knotters. 2006. <em>Sampling for Natural Resource Monitoring</em>. Berlin: Springer.
</div>
<div id="ref-deGruijter2015" class="csl-entry">
de Gruijter, J. J., B. Minasny, and A. B. McBratney. 2015. <span>“Optimising Stratification and Allocation for Design-Based Estimation of Spatial Means Using Predictions with Error.”</span> <em>Journal of Survey Statistics and Methodology</em> 3: 19–42.
</div>
<div id="ref-dom94" class="csl-entry">
Domburg, P., J. J. de Gruijter, and D. J. Brus. 1994. <span>“A Structured Approach to Designing Soil Survey Schemes with Prediction of Sampling Error from Variograms.”</span> <em>Geoderma</em> 62: 151–64.
</div>
<div id="ref-Gelman2013" class="csl-entry">
Gelman, A., J. B. Carlin, H. S. Stern, D. B. Dunson, A. Vehtari, and D. B. Rubin. 2013. <em><span>Bayesian Data Analysis</span></em>. Third. CRC Press.
</div>
<div id="ref-goo97" class="csl-entry">
Goovaerts, P. 1997. <em>Geostatistics for Natural Resources Evaluation</em>. New York: Oxford University Press.
</div>
<div id="ref-Hartig2018" class="csl-entry">
Hartig, F., F. Minunno, and S. Paul. 2018. <em><span class="nocase">BayesianTools: General-Purpose MCMC and SMC Samplers and Tools for Bayesian Statistics</span></em>. <a href="https://CRAN.R-project.org/package=BayesianTools">https://CRAN.R-project.org/package=BayesianTools</a>.
</div>
<div id="ref-HofmanBrus2021" class="csl-entry">
Hofman, S. C. K., and D. J. Brus. 2021. <span>“<span class="nocase">How many sampling points are needed to estimate the mean nitrateconcentration of agricultural fields? A geostatistical simulation approach with uncertain variograms</span>.”</span> <em>Geoderma</em>.
</div>
<div id="ref-peb04" class="csl-entry">
Pebesma, E. J. 2004. <span>“Multivariable Geostatistics in <span>S</span>: The Gstat Package.”</span> <em>Computers &amp; Geosciences</em> 30: 683–91.
</div>
<div id="ref-Pebesma2005" class="csl-entry">
Pebesma, E. J., and R. S. Bivand. 2005. <span>“<span class="nocase">Classes and methods for spatial data in R</span>.”</span> <em>R News</em> 5 (2): 9–13. <a href="http://cran.r-project.org/doc/Rnews/">http://cran.r-project.org/doc/Rnews/</a>.
</div>
<div id="ref-geoR" class="csl-entry">
Ribeiro Jr, Paulo J., Peter J. Diggle, Martin Schlather, Roger Bivand, and Brian Ripley. 2020. <em><span class="nocase">geoR: Analysis of Geostatistical Data</span></em>. <a href="https://CRAN.R-project.org/package=geoR">https://CRAN.R-project.org/package=geoR</a>.
</div>
<div id="ref-terBraak2008" class="csl-entry">
ter Braak, C. J. F., and J. A. Vrugt. 2008. <span>“Differential Evolution Markov Chain with Snooker Updater and Fewer Chains.”</span> <em>Statistics and Computing</em> 18: 435–46. <a href="https://doi.org/DOI 10.1007/s11222-008-9104-9">https://doi.org/DOI 10.1007/s11222-008-9104-9</a>.
</div>
</div>
<div class="footnotes">
<hr />
<ol start="6">
<li id="fn6"><p>For multivariate stratification, i.e. stratification with multiple study variables, Bethel allocation is used to compute the required sample size.<a href="MBpredictionofDesignVariance.html#fnref6" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="RequiredSampleSize.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="SmallAreaEstimation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/DickBrus/SpatialSamplingwithR/edit/master/13-MBOptimisationProbabilitySampling.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["SpatialSampling.epub"],
"search": {
"engine": "lunr",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
